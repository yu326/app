function createDatahelperLeft(a,b,d,c){var a=a;var b=b;var d=d;var c=c;this.firstLevelClick=function(g){var h=a;$(h+" ul").hide();var f=$(g).next();if(f.html()!=null){if(f[0].tagName.toLowerCase()!="ul"){$(h+" h2").removeClass("menuh1");$(g).addClass("menuh1")}if(f[0].tagName.toLowerCase()=="ul"){$(h+" h2").removeClass("menuh1");$(g).addClass("menuh1");if(f.css("display")=="none"){$(g).next().show("slow")}else{$(g).next().hide("slow")}}}else{$(h+" h2").removeClass("menuh1");$(g).addClass("menuh1");var e=$(g).children("img")}};this.secondLevelClick=function(g){var j=$(g).attr("navid");var h=$(g).attr("pagetype");var k=$(g).attr("filepath");var e=$(g).attr("pagetitle");e=e==undefined?"":e;window.currPagetype=h;if(window.Global!=undefined&&Global.RequestQueue!=undefined){var l=new Date();var f=l.getTime();Global.RequestQueue.setTag(f+"_"+j)}window.currNavid=j;window.currTabsParentID=j;window.currParentNavid=$(g).parent().prev().attr("navid");window.currFilepath=k;window.currTabsParentFilepath=k;window.currInstance=null;window.currMergedata=null;window.currMergeSched=null;window.instances=[];$("#modelselect").empty();$("body").find("div[id^=show_]").css("display","none");$("#lidownloadexcel").hide();$(a+" h2").removeClass("menuh1");$(g).parent().prev().addClass("menuh1");$(a+" ul li").removeClass("cho");$(a+" ul li").css("cursor","pointer");$(a+" ul li img").css("display","none");$(g).addClass("cho");$(g).css("cursor","pointer");$(g).find("img").css("display","");var i=$(g).parent().prev().text();window.Level1Title=i;window.Level2Title=e;setTopNav(i,e);document.title=(Global.webname?Global.webname+"-":"")+i+"-"+e;createDatahelperRight(b,j,h,k)};this.init=function(){var r=commonFun.queryString("navid");var j=[];var n={id:1,level:1,name:"历史数据",pagetitle:"历史数据",isdefault:false,modelType:2,modelid:0,filepath:"",icon:null};n.childNav=[];var h=r==3;var w={id:3,level:2,name:"定时更新/事件预警",pagetitle:"定时更新/事件预警",modelType:2,modelid:0,filepath:"",isdefault:h};n.childNav.push(w);var h=r==2;var e={id:2,level:2,name:"快照历史",pagetitle:"快照历史",modelType:2,modelid:0,filepath:"",isdefault:h};n.childNav.push(e);var h=r==5;var p={id:5,level:2,name:"事件历史",pagetitle:"事件历史",modelType:2,modelid:0,filepath:"",isdefault:h};n.childNav.push(p);j.push(n);var o={id:6,level:1,name:"管理标签",pagetitle:"管理标签",isdefault:true,modelType:2,modelid:0,filepath:"",icon:null};o.childNav=[];var h=r==7;var v={id:7,level:2,name:"管理标签",pagetitle:"管理标签",modelType:2,modelid:0,filepath:"",isdefault:h};o.childNav.push(v);j.push(o);var i="";if(j!=null){var m;var g;var k=0;$.each(j,function(u,s){var y="";var x=b==1?"_"+k.toString():s.id;var l=b==1?s.name:s.pagetitle;if(s.isdefault===true){y="class='menuh1'";m=x}if(s.icon==null||s.icon==""){s.icon="images/pot1.gif"}i+="<h2 "+y+" pagetitle = '"+l+"' navid="+x+" style='cursor:pointer;' ><img src=\""+s.icon+'" align="absmiddle" />'+s.name+"</h2>";k++;if(s.childNav!=null&&s.childNav!=""){i+="<ul class='son'>";$.each(s.childNav,function(C,B){var F=b==1?B.modelid:B.id;var E=b==1?1:B.modelType;var A=b==1?B.name:B.pagetitle;var z="";var D="style='display:none;'";if(B.isdefault==true){z="class='cho'";g=F;D=""}i+="<li "+z+"  navid='"+F+"' pagetitle = '"+A+"' pagetype='"+E+"' filepath='"+B.filepath+"' ><img src='images/arrow.gif' align='absmiddle' "+D+"/>"+B.name+"</li>";k++});i+="</ul>"}});$(a).html(i);$(a+" ul li").bind("click",function(){window.navSecondClick=true;secondLevelClick(this)});$(a+" h2").bind("click",function(){firstLevelClick(this)});window.navSecondClick=false;if(g!=null&&g!=""&&g!=undefined){var f=$(a+" li[navid="+g+"]");var t=$(f).parent().prev();firstLevelClick(t);secondLevelClick(f)}else{var t=$(a+" h2:first-child");if(t.length>0){var q=t.next();if(q.length>0&&q.children().length>0){var f=q.find("li:first-child");if(f.length>0){firstLevelClick(t);secondLevelClick(f)}}}}}};this.init()};function createDatahelperRight(b,f,h,j){var s=this;var a="#modelcondition";window.maxInstanceID=-1;window.maxElementID=-1;window.maxgroupid=0;this.pagetype=parseInt(h,10);var e="";var o="";var d="";var r="";var g;var p=10;var q;var t;var l=[];var k="<input type='button' value='删除' name='deleteitem' style='background-color:#2E6E9E;color:#FFFFFF;' />";var n="<input type='button' value='取消' name='deleteitemselected' style='background-color:#EA3D3D;color:#FFFFFF;' />";this.setSelectedCountPosition=function(){$("#selectdiv").css({display:"inline-block",position:"absolute",width:"20px","z-index":1005,left:$("#selectedcount").offset().left,top:$("#selectedcount").offset().top-40});$("#selectedcount").attr("currstate","unfolded")};this.hideSelectedCount=function(){$("#selectdiv").hide();$("#selectedcount").attr("currstate","folded")};this.deleteSubmitBtn=function(x){var A="";if(x==undefined){A="snapshotdeletediv"}else{A=x}var y=l.length;if(y>0){var z="<input type='button' id='confirmdelete' name='confirmdelete' value='确认删除' />&nbsp;<input type='button' id='selectedcount' name='selectedcount' value='已选择"+y+"条' currstate='folded' />";$("#"+A+"").empty().append(z)}else{$("#"+A+"").empty()}};this.snapshotPreview=function(x){if($("#snapshot_preview_div").length==0){$("<div id='snapshot_preview_div'></div>").insertAfter("body")}else{$("#snapshot_preview_div").empty()}$("#snapshot_preview_div").dialog({title:"历史快照预览",width:648,modal:true,autoOpen:true,resizable:false,close:function(){$("#snapshot_preview_div").empty();$("div[id^=show_1]").remove()}});config.allowdrilldown=false;var y=x.snapid;$.ajax({url:config.elementsUrl(x.instanceid,0,y),dataType:"json",type:"GET",beforeSend:function(){showWaitImg("#snapshot_preview_div")},success:function(B){$("#snapshot_preview_div").empty();if(B&&B.elements){window.instances=[];var D=new Instance(f,x.instanceid,x.instancetype);if(B.pinrelation!=undefined){D.pinRelation=B.pinrelation}if(B.schedparams!=undefined){D.schedparams=B.schedparams}window.instances.push(D);var z=0;var A="";var E=0;var C="";$.each(B.elements,function(I,O){if(O.modelname){C+=O.modelname}else{C+=O.title}var M=O.datajson;var K=M.filtervalue.length;if(M.filterrelation==null&&K>0){initFilterRelation(M)}if(M.filterrelation!=null){switch(M.modelid){case 1:C+=foltopConfigRelationview(M.filterrelation,M.filtervalue,M.filter);break;case 2:C+=userConfigRelationview(M.filterrelation,M.filtervalue,M.filter);break;case 31:C+=topicConfigRelationview(M.filterrelation,M.filtervalue,M.filter);break;case 51:C+=weiboConfigRelationview(M.filterrelation,M.filtervalue,M.filter);break}}var N=O.inputpin?O.inputpin:null;var G=O.outputpin?O.outputpin:null;var P=new Element(O.instanceid,O.instancetype,O.elementid,O.type,O.modelid,O.title,O.datajson,N,G);if(O.snapshot!=undefined&&O.snapshot!=null){P.setSnapshot(O.snapshot,O.updatetime);if(B.schedparams!=undefined){if(B.schedparams.eventlist!=undefined){if(B.schedparams.eventlist.alarms!=undefined){if(B.schedparams.eventlist.alarms.length>0){P.hasalarm=true}}}}}if(x.instancetype==3){if(O.subInstanceType!=undefined){P.subInstanceType=O.subInstanceType}if(O.overlayindex!=undefined){P.overlayindex=O.overlayindex}if(O.modelname!=undefined){P.modelname=O.modelname}if(O.referencedata!=undefined){P.referencedata=O.referencedata}if(O.secondaryyaxis!=undefined){P.secondaryyaxis=O.secondaryyaxis}if(O.referencedataratio!=undefined){P.referencedataratio=O.referencedataratio}if(O.showid!=undefined){P.showid=O.showid}if(O.xcombined!=undefined){D.xcombined=O.xcombined}if(O.xzreverse!=undefined){D.xzreverse=O.xzreverse}if(O.columnstacking!=undefined){D.columnstacking=O.columnstacking}}D.elements.push(P);if(x.instancetype==3){if(P.elementType==2){if(O.overlayindex>=z){z=O.overlayindex;A=O.elementid;E=I}}if(P.elementID!=B.elements[B.elements.length-1].elementid){return true}}else{A=O.elementid;E=I;if(P.elementType!=2){return true}}$("#snapshot_preview_div").append("<div>条件组合:"+C+"</div>");var H="";if(isArray(x.content.showid)){H=x.content.showid[0]}else{H=x.content.showid}if(!H){if(isArray(O.datajson.showid)){H=O.datajson.showid[0]}else{H=O.datajson.showid}}if(!H){H="filterchart"}D.elements[E].allshow.push({newobj:true,parentdomid:"snapshot_preview_div",id:1,showid:H,scopetype:"all",scopeobj:null});D.elements[E].show("",false);var F=x.content.showtitle;if(!F){F=O.datajson.showtitle}var L="show_1";if(F){addTitle("#"+L+"","snapshot_preview_div");$("#"+L+"").children("h1").empty().append(F)}var J="#"+L;$("#snapshot_preview_div").parent("div[role=dialog]").attr("targetselector",J);$("#snapshot_preview_div").append("<a title='去原页面查看快照' href='javascript:void(0)'  id='gooriginalshow' style='float:right;cursor:pointer;text-align:right;width: 100%;'>去原页面查看快照&gt;&gt;</a>");$("#gooriginalshow").unbind("click");$("#gooriginalshow").bind("click",function(){$("#snapshot_preview_div").dialog("close");$("#snapshot_preview_div").dialog("destroy");gotoOrishow(x)})})}},error:function(){alert("数据请求异常!")}})};var c=function(){var x="<div id='snapshotdiv'>";x+="<div id='snapshot_search_div'>";x+="一级导航:<select id='snapshot_search_level1' /></select>";x+="二级导航:<select id='snapshot_search_level2' /></select>";x+="卡片名称:<select id='snapshot_search_level3' /></select>";x+="快照时间:<input id='snapshot_search_updatetimestart' name='snapshot_search_updatetimestart' class='Wdate' type='text' readonly='readonly'>至<input id='snapshot_search_updatetimeend' name='snapshot_search_updatetimeend' class='Wdate' type='text' readonly='readonly'>";x+="<input type='button' name='snapshot_search' value='查询' id='snapshot_search' />";x+="<input type='button' name='snapshot_reset' value='清空' id='snapshot_reset' />";x+="<input type='hidden' name='snapshot_list_orderby' id='snapshot_list_orderby' />";x+="</div>";x+="<table class='table1' align='center' width='98%' border='0' cellspacing='0' cellpadding='0' id='snapshotlist'>";x+="</table>";x+="</div>";$("#modelcondition").empty().append(x);initNavMenu("",e,o,d);w(p,1);$("#snapshot_search_updatetimestart").unbind("click");$("#snapshot_search_updatetimestart").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss"})});$("#snapshot_search_updatetimeend").unbind("click");$("#snapshot_search_updatetimeend").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss"})});$("#snapshot_search").bind("click",function(){r="";w(p,1)});$("#snapshot_reset").bind("click",function(){$("#snapshot_search_div [id^='snapshot_'][type!=button]").each(function(y,z){$(z).val("")})})};var w=function(B,A){if(A==""||A==null||A==undefined){q=1}else{q=A}var z="";var E=$("#snapshot_search_level1").val();e=E;if(E){z+="&level1id="+E+""}var G=$("#snapshot_search_level2").val();e=G;if(G){z+="&level2id="+G+""}var x=$("#snapshot_search_level3").val();e=x;if(x){z+="&level3id="+x+""}if(r){z+="&instanceid="+r+""}var C=$("#snapshot_search_updatetimestart").val();if(C){z+="&updatetimestart="+getTimeSec(C)+""}var F=$("#snapshot_search_updatetimeend").val();if(F){z+="&updatetimeend="+getTimeSec(F)+""}var D=$("#snapshot_list_orderby").val();if(D){z+="&orderby="+D+""}var y=config.phpUrl+"modelinterface.php?type=getsnapshothistorylist&page="+q+"&pagesize="+B+""+z+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:y,beforeSend:function(){$("#snapshotlist").html("<tr><td><img src='"+config.imagePath+"wait.gif' id='waitimg'/></td></tr>")},success:function(M){var K=[];var H="ui-icon ui-icon-carat-2-n-s";var L=$("#snapshot_list_orderby").val();var J=L.split(" ");if(J[1]=="asc"){H="ui-icon ui-icon-triangle-1-n"}else{H="ui-icon ui-icon-triangle-1-s"}var I='<tr><th style="width:65px;">选择</th><th style="width:100px;">一级导航</th><th style="width:100px;">二级导航</th><th style="width:100px;">所属卡片</th><th>模型标题</th><th><span name="sort" _target="a.updatetime" style="display:inline-block;cursor:pointer">快照时间<span class="'+H+'" style="display:inline-block"></span></th><th>操作</th></tr>';var N=[];if(M!=null&&M.children!=undefined&&M.children.length>0){$.each(M.children,function(S,P){var O="";if(!P.showtitle){N=arrayAppend(N,P.filepath)}else{O=P.showtitle}var R=P.level3==undefined?"":P.level3;var Q="";if(l.inArray(P.snapid)){Q=n}else{Q=k}I+="<tr><td><span id='delete_"+P.snapid+"'>"+Q+"</span></td><td>"+P.level1+"</td><td>"+P.level2+"</td><td>"+R+"</td><td><span name='snapshot_showtitle_"+P.elementid+"'>"+O+"</span></td><td>"+formatTime("yyyy-MM-dd hh:mm:ss",P.updatetime)+"</td><td><a href='javascript:void(0);' id='snapshot_preview_"+P.snapid+"' code='"+P.snapid+"'>详情</a></td></tr>";K.push(P)});I+="<tr><td colspan='2'><div style='text-align:left;' id='snapshotdeletediv'></div></td>";if(M.totalcount>B){I+="<td colspan='5'><div id='snapshotpage' style='text-align:left;'></div></td>"}I+="</tr>";$("#snapshotlist").attr("totalcount",M.totalcount)}else{I+="<tr><td colspan='7'>暂无记录!</td></tr>"}$("#snapshotlist").empty().append(I);$("span[name=sort]").unbind("click");$("span[name=sort]").bind("click",function(){var Q=$(this).attr("_target");var P=$(this).children("span").attr("class");var O="";$("span[name=sort][_target!="+Q+"]").children("span").attr("class","ui-icon ui-icon-carat-2-n-s");if(P=="ui-icon ui-icon-carat-2-n-s"||P=="ui-icon ui-icon-triangle-1-s"){O="asc";$(this).children("span").attr("class","ui-icon ui-icon-triangle-1-n")}else{$(this).children("span").attr("class","ui-icon ui-icon-triangle-1-s");O="desc"}$("#snapshot_list_orderby").val(Q+" "+O);w(B,1)});$("#snapshotlist a[id^=snapshot_preview_]").bind("click",function(){var P=$(this).attr("code");var O;if(K.length>0){$.each(K,function(Q,R){if(R.snapid==P){eleitem=R;return false}})}snapshotPreview(eleitem)});if(N.length>0){$("body").append("<div id='temp_show' style='display:none;'></div>");$.each(N,function(O,P){$.ajax({url:P+"?"+Math.random(),dataType:"html",type:"GET",async:false,success:function(Q){$("#temp_show").html(Q);$("#temp_show div").each(function(R,T){if($(T).attr("instanceid")){var V=$(T).attr("elementid");var S=getShowTitleCom(T);var W=$(T).attr("title");if((S==undefined||S=="")&&(W!=undefined&&W!="")){S=W}if(S){if($("span[name=snapshot_showtitle_"+V+"]").length>0){$("span[name=snapshot_showtitle_"+V+"]").text(S)}var U=$(T).attr("showid");$.each(K,function(X,Y){if(Y.elementid==V){Y.content.showid=U;Y.content.showtitle=S}})}else{var U=$(T).attr("showid");$.each(K,function(X,Y){if(Y.elementid==V){if(!Y.content.showid){Y.content.showid=U}}})}}})}})});$("#temp_show").remove()}s.deleteSubmitBtn();$("#snapshotlist").find("input[name=deleteitem]").die("click");$("#snapshotlist").find("input[name=deleteitem]").live("click",function(){var P=$(this).parent("span").attr("id");var O=P.split("_");var Q=O[1];l=arrayAppend(l,Q);$("#"+P+"").empty().append(n);s.deleteSubmitBtn()});$("#snapshotlist").find("input[name=deleteitemselected]").die("click");$("#snapshotlist").find("input[name=deleteitemselected]").live("click",function(){var P=$(this).parent("span").attr("id");var O=P.split("_");var Q=O[1];l=arrayDelete(l,Q);$("#"+P+"").empty().append(k);s.deleteSubmitBtn()});$("#confirmdelete").die("click");$("#confirmdelete").live("click",function(){if(confirm("确定删除"+l.length+"条数据?")){var P=l.join(",");var O=config.phpUrl+"modelinterface.php?type=deletesnapshothistory&deletestr="+P+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:O,async:false,beforeSend:function(){},success:function(Q){if(parseInt(Q.result,10)){l.length=0;w(B,1)}else{alert("删除失败!");return false}},complete:function(){},error:function(){}})}else{return false}});$("#selectedcount").die("click");$("#selectedcount").live("click",function(){var O="<div id='selectdiv'><input type='button' name='selectall' id='selectall' value='全选' style='margin:0;'/><input type='button' name='selectnone' id='selectnone' value='清空' style='margin:0;'/></div>";if($("#selectdiv").length==0){$("body").append(O)}var P=$("#selectedcount").attr("currstate");if(P=="folded"){s.setSelectedCountPosition()}else{s.hideSelectedCount()}$("#selectdiv").bind("mouseleave",function(){s.hideSelectedCount()});$("#selectall").unbind("click");$("#selectall").bind("click",function(){$("#snapshotlist").find("input[name=deleteitem]").each(function(S,U){var R=$(U).parent("span").attr("id");var Q=R.split("_");var T=Q[1];l=arrayAppend(l,T);$(U).parent().empty().append(n)});s.deleteSubmitBtn();s.setSelectedCountPosition()});$("#selectnone").unbind("click");$("#selectnone").bind("click",function(){$("#snapshotlist").find("input[name=deleteitemselected]").each(function(S,U){var R=$(U).parent("span").attr("id");var Q=R.split("_");var T=Q[1];$(U).parent().empty().append(k)});l.length=0;s.deleteSubmitBtn();$("#selectdiv").remove()})});if(M!=null&&M.totalcount!=undefined&&M.totalcount>B){pageDisplay(M.totalcount,w,"snapshotpage",B,q)}},complete:function(){$("#waitimg").css({display:"none"})},error:function(){}})};var u=function(){var x="<div id='eventalertdiv'>";x+="<div id='eventalert_search_div'>";x+="一级导航:<select id='eventalert_search_level1'></select>";x+="二级导航:<select id='eventalert_search_level2'></select>";x+="卡片名称:<select id='eventalert_search_level3'></select>";x+="任务类型:<select id='eventalert_search_task'><option value=''>请选择</option><option value='13'>定时更新</option><option value='14'>事件预警</option></select>";x+="状态:<select id='eventalert_search_status'><option value='1'>活动</option><option value='0'>过期</option></select>";x+="<input type='button' name='eventalert_search' value='查询' id='eventalert_search' />";x+="<input type='button' name='eventalert_reset' value='清空' id='eventalert_reset' />";x+="</div>";x+="<table class='table1' align='center' width='98%' border='0' cellspacing='0' cellpadding='0' id='eventalertlist'>";x+="</table>";x+="</div>";$("#modelcondition").empty().append(x);initNavMenu("event",e,o,d);if(window.navSecondClick){t=""}else{t=commonFun.queryString("task")}$("#eventalert_search_task").val(t);m(p,1);$("#eventalert_search_updatetimestart").unbind("click");$("#eventalert_search_updatetimestart").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss"})});$("#eventalert_search_updatetimeend").unbind("click");$("#eventalert_search_updatetimeend").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss"})});$("#eventalert_search").bind("click",function(){l.length=0;m(p,1)});$("#eventalert_reset").bind("click",function(){$("#eventalert_search_div [id^='eventalert_'][type!=button]").each(function(y,z){$(z).val("")})})};var v=function(){myEventHistoryList()};var m=function(C,B){if(B==""||B==null||B==undefined){q=1}else{q=B}var A="";var D=$("#eventalert_search_level1").val();e=D;if(D){A+="&level1id="+D+""}var F=$("#eventalert_search_level2").val();e=F;if(F){A+="&level2id="+F+""}var x=$("#eventalert_search_level3").val();e=x;if(x){A+="&level3id="+x+""}var z=$("#eventalert_search_status").val();if(z!=undefined){A+="&schedstatus="+z+""}var E=$("#eventalert_search_task").val();if(E){A+="&task="+E+""}var y=config.phpUrl+"modelinterface.php?type=geteventlist&page="+q+"&pagesize="+C+""+A+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:y,beforeSend:function(){$("#eventalertlist").html("<tr><td><img src='"+config.imagePath+"wait.gif' id='waitimg'/></td></tr>")},success:function(I){var H=[];var G="<tr><th style='width:65px;'>选择</th><th style='width:100px;'>一级导航</th><th style='width:100px;'>二级导航</th><th style='width:100px;'>所属卡片</th><th>模型标题</th>";if(E=="13"||E==""){G+="<th>计划描述</th>";G+="<th style='width:65px;'>快照历史</th>"}if(E=="14"||E==""){G+="<th style='width:65px;'>预警名称</th><th>预警名称描述</th><th style='width:65px;'>警报</th><th style='width:65px;'>事件预警</th>"}G+="<th style='width:110px;'>数据更新计划</th><th style='width:35px;'>前往</th></tr>";var J=[];if(I!=null&&I.children!=undefined&&I.children.length>0){$.each(I.children,function(S,M){var T="";if(!M.showtitle){T=M.filepath;J=arrayAppend(J,M.filepath)}else{T=M.showtitle}var U=M.level3==undefined?"":M.level3;var V="";if(l.inArray(M.snapid)){V=n}else{V=k}var R=M.scheduleid==undefined?"":M.scheduleid;G+="<tr><td><span id='delete_"+M.instanceid+"-"+R+"'>"+V+"</span></td><td>"+M.level1+"</td><td>"+M.level2+"</td><td>"+U+"</td><td><span name='eventalert_showtitle_"+M.instanceid+"'>"+T+"</span></td>";if(E=="13"||E==""){var X=M.snapshot==null?"无历史":"<a id='eventalert_snapshothistory_"+M.instanceid+"' code="+M.instanceid+" href='javascript:void(0);'>快照历史</a>";G+="<td>"+M.remarks+"</td>";G+="<td>"+X+"</td>"}if(E=="14"||E==""){var K=M.eventname==undefined?"":M.eventname;var P=M.eventremarks==undefined?"":M.eventremarks;var W=parseInt(M.eventalarms,10)>0?"<a id='eventalert_history_"+M.instanceid+"' code="+M.instanceid+" scheduleid="+R+" href='javascript:void(0);'>事件历史</a>":"无事件";var O="";var Q="";if(parseInt(z,10)){if(M.haseventalert){Q="编辑预警"}else{Q="新增预警"}}else{Q="查看预警"}O="<a id='eventalert_item_"+M.instanceid+"' code='"+M.instanceid+"' scheduleid="+R+" href='javascript:void(0)'>"+Q+"</a>";G+="<td>"+K+"</td><td>"+P+"</td><td>"+W+"</td><td>"+O+"</td>"}var N="";var L="";if(parseInt(z,10)){L="编辑更新计划"}else{L="查看更新计划"}N="<a id='eventalert_update_"+M.instanceid+"' code='"+M.instanceid+"' scheduleid="+R+" href='javascript:void(0)'>"+L+"</a>";G+="<td>"+N+"</td><td><a id='eventalert_goto_"+M.instanceid+"' code='"+M.instanceid+"'  href='javascript:void(0)'>前往</a></td></tr>";H.push(M)});G+="<tr><td colspan='2'><div style='text-align:left;' id='eventalertdeletediv'></div></td>";if(I.totalcount>C){G+="<td colspan='5'><div id='eventalertpage' style='text-align:left;'></div></td>"}G+="</tr>";$("#eventalertlist").attr("totalcount",I.totalcount)}else{G+="<tr><td colspan='7'>暂无记录!</td></tr>"}$("#eventalertlist").empty().append(G);$("#eventalertlist a[id^=eventalert_snapshothistory_]").bind("click",function(){r=$(this).attr("code");var N="#menu";var L=$(N+" li[navid=2]");var K=$(L).attr("pagetitle");$(N+" h2").removeClass("menuh1");$(L).parent().prev().addClass("menuh1");$(N+" ul li").removeClass("cho");$(N+" ul li").css("cursor","pointer");$(N+" ul li img").css("display","none");$(L).addClass("cho");$(L).css("cursor","pointer");$(L).find("img").css("display","");var M=$(L).parent().prev().text();window.Level1Title=M;window.Level2Title=K;setTopNav(M,K);document.title=(Global.webname?Global.webname+"-":"")+M+"-"+K;c()});$("#eventalertlist a[id^=eventalert_history_]").bind("click",function(){var P=$(this).attr("code");var N=$(this).attr("scheduleid");var L={};$.each(H,function(R,S){if(S.instanceid==P){L.firstrequestData=S.snapshot;L.dataJson=S.content}});var Q="#menu";var M=$(Q+" li[navid=5]");var K=$(M).attr("pagetitle");$(Q+" h2").removeClass("menuh1");$(M).parent().prev().addClass("menuh1");$(Q+" ul li").removeClass("cho");$(Q+" ul li").css("cursor","pointer");$(Q+" ul li img").css("display","none");$(M).addClass("cho");$(M).css("cursor","pointer");$(M).find("img").css("display","");var O=$(M).parent().prev().text();window.Level1Title=O;window.Level2Title=K;setTopNav(O,K);document.title=(Global.webname?Global.webname+"-":"")+O+"-"+K;myEventHistoryList(P,L,N)});$("#eventalertlist a[id^=eventalert_update_]").bind("click",function(){var K=this;var O=$(this).attr("code");var Q="";var L=parseInt($("#eventalert_search_status").val(),10);if(L!=undefined){Q+="&schedstatus="+L+""}var P=$("#eventalert_search_task").val();if(P){Q+="&task="+P+""}var N=parseInt($(this).attr("scheduleid"),10);if(N){Q+="&scheduleid="+N+""}var M=config.phpUrl+"modelinterface.php?type=geteventitem"+Q+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:M,async:false,success:function(R){$.each(H,function(T,U){if(U.scheduleid==N){var S={};S.instancetype=U.instancetype;S.classifyquery=U.content.classifyquery;S.firstrequestData=U.snapshot;S.dataJson=U.content;var V={};if(R.sched!=null){V=R.sched.params.taskparams;V.cronstart=R.sched.starttime;V.cronend=R.sched.endtime;V.crontime=R.sched.crontime;V.remarks=R.sched.remarks;V.status=R.sched.status;V.elecondition=S}myUpdateSchedule(function(Y){var W=config.phpUrl+"modelinterface.php?type=updateschedule";var X={};X.schedparams=Y;X.schedparams.scheduleid=N;X.schedparams.instanceid=O;$.ajax({url:W,type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(X),success:function(Z){if(parseInt(Z.result,10)){m(C,1)}else{alert("修改失败!")}},error:function(){}})},V,undefined,undefined,L);return false}})}})});$("#eventalertlist a[id^=eventalert_item_]").bind("click",function(){var K=this;var O=$(this).attr("code");var Q="";var L=parseInt($("#eventalert_search_status").val(),10);if(L!==undefined){Q+="&schedstatus="+L+""}var P=$("#eventalert_search_task").val();if(P){Q+="&task="+P+""}var N=$(this).attr("scheduleid");if(N){Q+="&scheduleid="+N+""}var M=config.phpUrl+"modelinterface.php?type=geteventitem"+Q+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:M,async:false,success:function(R){$.each(H,function(T,U){if(U.scheduleid==N){var S={};S.instancetype=U.instancetype;S.classifyquery=U.content.classifyquery;S.firstrequestData=U.snapshot;S.dataJson=U.content;var V={};if(R.sched!=null){V=R.sched.params.taskparams;V.cronstart=R.sched.starttime;V.cronend=R.sched.endtime;V.crontime=R.sched.crontime;V.status=R.sched.status;V.remarks=R.sched.remarks;V.elecondition=S}myUpdateSchedule(function(Y){var W=config.phpUrl+"modelinterface.php?type=updateschedule";var X={};X.schedparams=Y;X.schedparams.scheduleid=N;X.schedparams.instanceid=O;$.ajax({url:W,type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(X),success:function(Z){if(parseInt(Z.result,10)){m(C,1)}else{alert("修改失败!")}},error:function(){}})},V,undefined,true,L);return false}})}})});$("#eventalertlist a[id^=eventalert_goto_]").bind("click",function(){var L=$(this).attr("code");var K;$.each(H,function(M,N){if(N.instanceid==L){K=N;return false}});gotoOrishow(K)});if(J.length>0){$("body").append("<div id='temp_show' style='display:none;'></div>");$.each(J,function(K,L){$.ajax({url:L+"?"+Math.random(),dataType:"html",type:"GET",async:false,success:function(M){$("#temp_show").html(M);$("#temp_show div").each(function(N,Q){if($(Q).attr("instanceid")){var S=$(Q).attr("elementid");var O=$(Q).attr("instanceid");var P=getShowTitleCom(Q);var T=$(Q).attr("title");if((P==undefined||P=="")&&(T!=undefined&&T!="")){P=T}if($("span[name=eventalert_showtitle_"+O+"]").length>0){$("span[name=eventalert_showtitle_"+O+"]").text(P)}var R=$(Q).attr("showid");$.each(H,function(U,V){if(V.elementid==S){V.content.showid=R;V.content.showtitle=P}})}})}})});$("#temp_show").remove()}s.deleteSubmitBtn("eventalertdeletediv");$("#eventalertlist").find("input[name=deleteitem]").die("click");$("#eventalertlist").find("input[name=deleteitem]").live("click",function(){var L=$(this).parent("span").attr("id");var K=L.split("_");var M=K[1];l=arrayAppend(l,M);$("#"+L+"").empty().append(n);s.deleteSubmitBtn("eventalertdeletediv")});$("#eventalertlist").find("input[name=deleteitemselected]").die("click");$("#eventalertlist").find("input[name=deleteitemselected]").live("click",function(){var L=$(this).parent("span").attr("id");var K=L.split("_");var M=K[1];l=arrayDelete(l,M);$("#"+L+"").empty().append(k);s.deleteSubmitBtn("eventalertdeletediv")});$("#confirmdelete").die("click");$("#confirmdelete").live("click",function(){if(confirm("确定删除"+l.length+"条数据?")){var N="";var M=l.join(",");N+="&deletestr="+M+"";var K=$("#eventalert_search_status").val();if(K!=undefined){N+="&schedstatus="+K+""}var L=config.phpUrl+"modelinterface.php?type=deleteeventalert"+N+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:L,async:false,beforeSend:function(){},success:function(O){if(parseInt(O.result,10)){l.length=0;m(C,1)}else{alert("删除失败!");return false}},complete:function(){},error:function(){}})}else{return false}});$("#selectedcount").die("click");$("#selectedcount").live("click",function(){var K="<div id='selectdiv'><input type='button' name='selectall' id='selectall' value='全选' style='margin:0;' /><input type='button' name='selectnone' id='selectnone' value='清空' style='margin:0;'/></div>";if($("#selectdiv").length==0){$("body").append(K)}var L=$("#selectedcount").attr("currstate");if(L=="folded"){s.setSelectedCountPosition()}else{s.hideSelectedCount()}$("#selectdiv").bind("mouseleave",function(){s.hideSelectedCount()});$("#selectall").unbind("click");$("#selectall").bind("click",function(){$("#eventalertlist").find("input[name=deleteitem]").each(function(O,Q){var N=$(Q).parent("span").attr("id");var M=N.split("_");var P=M[1];l=arrayAppend(l,P);$(Q).parent().empty().append(n)});s.deleteSubmitBtn("eventalertdeletediv");s.setSelectedCountPosition()});$("#selectnone").unbind("click");$("#selectnone").bind("click",function(){$("#eventalertlist").find("input[name=deleteitemselected]").each(function(O,Q){var N=$(Q).parent("span").attr("id");var M=N.split("_");var P=M[1];$(Q).parent().empty().append(k)});l.length=0;s.deleteSubmitBtn("eventalertdeletediv");$("#selectdiv").remove()})});if(I!=null&&I.totalcount!=undefined&&I.totalcount>C){pageDisplay(I.totalcount,m,"eventalertpage",C,q)}},complete:function(){$("#waitimg").css({display:"none"})},error:function(){}})};var i=function(){var x="<div id='managetagdiv'>";x+="<input type='button' name='snapshot_reset' value='查询' id='manage_tag_select' />";x+="</div>";$("#modelcondition").empty().append(x);$("#manage_tag_select").bind("click",function(){$("#editdiv").dialog("open");createModelSelect("#editmodelselectdiv",2,51,0,1);config.allowshowselecttag=true;config.allowshowaddtag=false;$("#editmodelselectdiv").css("display","none");$("#tabdiv a[modelid]").each(function(y){if(y==3){$(this).trigger("click")}})})};switch(parseInt(f,10)){case 2:r="";c();break;case 5:v();break;case 3:u();break;case 7:i();break;default:$("#modelcondition").empty();break}};function createDatahelperTop(c,b){var e=$(c.top);createDatahelperLeft(c.left);var d='<div id="logo"><img id="companylogo" width="0" height="0" style="float:left;" src="" /></div>';d+='<div id="sys">';d+="<ul>";d+="<li>";d+='<a id="dashboard" href="javascript:void(0)" style="color:#FFFFFF">仪表盘</a>';d+="</li>";d+="<li>";d+='<a id="btnlogout" href="javascript:void(0)" style="color:#FFFFFF">退出</a>';d+="</li>";d+="</ul>";d+="</div>";e.empty().append(d);$("#companylogo").bind("load",function(){picresize(this,134,60);var f=$(this).parent();$(this).css("padding-top",(f.height()-$(this).outerHeight(true))-8)});if(config.selfstyle){var a="tenant/"+Global.tenantid+"/inverselogo.png";if(a!=null&&a!=""){$("#companylogo").attr("src",a)}}else{$("#companylogo").attr("src","images/inverselogo.gif")}$("<span class='STYLE5'>"+Global.webname+"</span>").insertBefore("#topnav");$("#btnlogout").bind("click",function(){editTips(function(){$.post(config.phpUrl+"checkuser.php",{type:"logout"},function(){location.href=config.sitePath+"login.html"})})});$("#dashboard").bind("click",function(){window.open(config.sitePath+"index.html","_blank")})}function setTopNav(b,a){if(b!=""&&b!=undefined){$("#level1").html(b)}if(a!=""&&a!=undefined){$("#level2").html(a)}};if(!window.Global){window.Global=new Object()}Global._Clipboard=function(){this.hasdata=false;this.copyData=[];this.copyHtml="";this.mergefield=[];this.mergesched=[]};Global._Clipboard.prototype={copy:function(a){this.copyData=[];var h=[];var f="";if($(a).attr("isgroup")=="1"||$(a).attr("id")=="modelcondition"){var q=$(a).attr("id");$(a).attr("id","copy_"+q);f=getFHHtml($(a));$(a).attr("id",q);var e=[];var n=[];$(a).find("div").each(function(t,u){if($(u).attr("isgroup")){var s=$(u).attr("id");var w="copy_"+s;e.push({oldid:s,newid:w});$(u).attr("id",w)}else{if($(u).attr("instanceid")){var r=$(u).attr("instanceid");var v="copy_"+r;n.push({oldincid:r,newincid:v});$(u).attr("instanceid",v)}}});var g=[];$(a).find("div[isdescribe]").each(function(s,t){var u=$(t).attr("id");var r="copy_"+u;g.push({oldid:u,newid:r});$(t).attr("id",r)});if(f!=""){if($(a).attr("id")=="modelcondition"){f=getChildHtml($(a))}else{f+=getChildHtml($(a))+"</div>"}}for(var d=0;d<e.length;d++){$(a).find("#"+e[d].newid).attr("id",e[d].oldid)}for(var d=0;d<n.length;d++){$(a).find("div[instanceid="+n[d].newincid+"]").attr("instanceid",n[d].oldincid)}for(var d=0;d<g.length;d++){$(a).find("#"+g[d].newid).attr("id",g[d].oldid)}$(a).find("div[instanceid][elementid]").each(function(r,s){h.push(s)})}else{if($(a).attr("isdescribe")=="1"){var m=$(a).attr("id");$(a).attr("id","copy_"+m);f=getFHHtml($(a));$(a).attr("id",m);if(f!=""){f+="</div>"}}else{var l=$(a).attr("instanceid");$(a).attr("instanceid","copy_"+l);f=getFHHtml($(a));$(a).attr("instanceid",l);if(f!=""){f+="</div>"}h.push(a)}}if(f==""){return false}this.copyHtml=f;for(var d=0;d<h.length;d++){var o=$(h[d]).data("showobj");if(o!=undefined&&o!=null){var j={instanceType:1,elements:[]};var c;$(window.instances).each(function(r,s){if(o.element.instanceID==s.instanceID){c=s;return false}});var k=false;$(this.copyData).each(function(r,i){if(i.oldInstanceID==c.instanceID){k=true;return false}});if(k){continue}j.instanceType=c.instanceType;j.oldInstanceID=c.instanceID;if(c.schedparams){j.schedparams=deepClone(c.schedparams)}if(c.instanceType==1){j.pinRelation=[];var p={elementType:2,dataJson:deepClone(o.postDataJson),issnap:o.element.issnap,firstrequestData:deepClone(o.element.firstrequestData),updateTime:o.element.updateTime,inputPin:null,outputPin:null,oldElementID:o.element.elementID,elementName:o.element.elementName};j.elements.push(p)}else{if(c.instanceType==3){j.pinRelation=deepClone(c.pinRelation);j.xzreverse=c.xzreverse;j.xcombined=c.xcombined;j.columnstacking=c.columnstacking;var b=c.elements.length;$.each(c.elements,function(s,i){var r={elementType:i.elementType,dataJson:deepClone(i.dataJson),inputPin:deepClone(i.inputPin),outputPin:deepClone(i.outputPin),oldElementID:i.elementID,elementName:i.elementName,modelname:i.modelname,overlayindex:i.overlayindex,showid:i.showid,subInstanceType:i.subInstanceType,referencedata:i.referencedata,referencedataratio:i.referencedataratio,secondaryyaxis:i.secondaryyaxis};if(s==(b-1)){r.issnap=i.issnap;r.firstrequestData=deepClone(i.firstrequestData);r.updateTime=i.updateTime}j.elements.push(r)})}else{j.pinRelation=deepClone(c.pinRelation);$(c.elements).each(function(r,s){if(s.elementType!=2||(s.elementType==2&&s.elementID==o.element.elementID)){var t={elementType:s.elementType,dataJson:deepClone(s.dataJson),inputPin:deepClone(s.inputPin),outputPin:deepClone(s.outputPin),oldElementID:s.elementID,elementName:s.elementName};if(s.elementType==2){t.issnap=s.issnap;t.firstrequestData=deepClone(s.firstrequestData);t.updateTime=s.updateTime}j.elements.push(t)}})}}this.copyData.push(j)}}this.hasdata=true;return true},paste:function(g){if(g==undefined){g=this}if(g.copyHtml!=""){changePage(4);$("#modelcondition").append(g.copyHtml);$("div[isgroup=1][id^=copy_group]").each(function(k,m){window.maxgroupid++;$(m).attr("id","group"+window.maxgroupid);var j=getShowTitleCom(m);if(j!=undefined&&j!=""){if($(m).children().length>0){$(m).children(":first").before("<h1>"+j+"</h1>")}else{$(m).append("<h1>"+j+"</h1>")}}var l=m;createShowByID("groupshow",l,null,function(i){$(l).data("showobj",i);i.setID($(l).attr("id"),"#"+$(l).attr("id"));if($(l).attr("remark")!=undefined&&$(l).attr("remark")!=""){i.createRemark()}});bindMouseEvent(m)});$("div[isdescribe=1][id^=copy_describe]").each(function(k,m){window.maxdescribeid++;$(m).attr("id","describe"+window.maxdescribeid);var j=getShowTitleCom(m);if(j!=undefined&&j!=""){$(m).append("<h1>"+j+"</h1>")}var l=m;createShowByID("descriptionshow",l,null,function(i){$(l).data("showobj",i);i.setID($(l).attr("id"),"#"+$(l).attr("id"));if($(l).attr("remark")!=undefined&&$(l).attr("remark")!=""){i.createRemark()}});bindMouseEvent(m)});var d=0;for(var b=0;b<g.copyData.length;b++){var h=deepClone(g.copyData[b]);var a={};var f=new Instance(window.currNavid,window.maxInstanceID,h.instanceType);$.each(Global.Clipboard.mergesched,function(i,k){for(var j in k){$.each(k[j],function(l,m){if(m==h.oldInstanceID){k[j][l]=window.maxInstanceID}})}});window.maxInstanceID--;f.pinRelation=h.pinRelation;f.xzreverse=h.xzreverse;f.xcombined=h.xcombined;f.columnstacking=h.columnstacking;f.schedparams=h.schedparams;f.preAdd();window.instances.push(f);var c=null;var e=h.elements.length;$(h.elements).each(function(m,l){var i=--window.maxElementID;if(f.instanceType==2){if(window.linkageobj==null){window.linkageobj=new Linkage()}}if(f.instanceType==3){if(window.overlayobj==null){window.overlayobj=new Overlay()}}$.each(Global.Clipboard.mergefield,function(n,p){for(var o in p){$.each(p[o],function(q,r){if(r==l.oldElementID){p[o][q]=i}})}});a[l.oldElementID]=i;var j=new Element(f.instanceID,f.instanceType,i,l.elementType,l.dataJson.modelid,l.elementName,deepClone(l.dataJson),l.inputPin,l.outputPin);j.modelname=l.modelname;j.overlayindex=l.overlayindex;j.showid=l.showid;j.subInstanceType=l.subInstanceType;j.referencedataratio=l.referencedataratio;j.secondaryyaxis=l.secondaryyaxis;j.referencedata=l.referencedata;j.issnap=l.issnap;j.firstrequestData=deepClone(l.firstrequestData);j.updateTime=l.updateTime;f.elements.push(j);$(f.pinRelation).each(function(n,o){o.instanceid=f.instanceID;if(o.outelementid==l.oldElementID){$.each(l.outputPin,function(q,p){if(p.outpinid==o.outpinid){o.outelementid=i}})}if(o.inelementid==l.oldElementID){$.each(l.inputPin,function(p,q){if(q.inpinid==o.inpinid){o.inelementid=i}})}});if(e-1==m){c=j;var k=$("div[instanceid=copy_"+h.oldInstanceID+"][elementid="+l.oldElementID+"]");k.attr("instanceid",f.instanceID).attr("elementid",i);j.allshow=[];k.each(function(o,s){var n=getShowTitleCom(s);if(n!=undefined&&n!=""){$(s).append("<h1>"+n+"</h1>")}var r=Global.GetNextShowID();$(s).attr("id","show_"+r);var p=$(s).attr("scopetype");var q=$(s).attr("scope");if(p==undefined||p==null||p==""){p="all"}if(q==undefined||q==null||q==""){q=""}j.showIDArr.push($(s).attr("showid"));j.allshow.push({newobj:true,id:r,showid:$(s).attr("showid"),scopetype:p,scopeobj:q});bindMouseEvent(s)})}});$(f.elements).each(function(j,i){if(i.inputPin.length>0){$.each(i.inputPin,function(l,k){if(a[k.inelementid]!=undefined){k.inelementid=a[k.inelementid]}if(a[k.outelementid]!=undefined){k.outelementid=a[k.outelementid]}k.instanceid=f.instanceID})}if(i.outputPin.length>0){$.each(i.outputPin,function(l,k){if(a[k.inelementid]!=undefined){k.inelementid=a[k.inelementid]}if(a[k.outelementid]!=undefined){k.outelementid=a[k.outelementid]}k.instanceid=f.instanceID})}if(i.dataJson.filtervalue){$(i.dataJson.filtervalue).each(function(k,l){if(l.fieldvalue.datatype=="array"){for(var m=0;m<l.fieldvalue.value.length;m++){if(l.fieldvalue.value[m].outelementid!=undefined){l.fieldvalue.value[m].outelementid=a[l.fieldvalue.value[m].outelementid]}}}else{if(l.fieldvalue.outelementid!=undefined){l.fieldvalue.outelementid=a[l.fieldvalue.outelementid]}}})}});if(c!=null){c.show()}}window.currMergedata=Global.Clipboard.mergefield}setMenuHeight();window.scrollTo(0,document.body.scrollHeight)}};Global.Clipboard=new Global._Clipboard();Global.IsChanged={"1":false,"2":false,"3":false,"4":false};Global.ToolbarType=0;Global._MaxShowID=0;Global.CalcMaxShowID=function(){Global._MaxShowID=0;$("div[instanceid][elementid][showid]").each(function(a,b){var c=$(b).attr("id");if(c!=undefined&&c!=""){c=parseInt(c.replace("show_",""));if(!isNaN(c)&&c>Global._MaxShowID){Global._MaxShowID=c}}})};Global.GetNextShowID=function(){Global._MaxShowID++;return Global._MaxShowID};Global.StartClientWidth;Global.downloadinfo=null;function changePage(a){if(Global.user.usertype!=1){return}if(a==undefined){a=1}var b=a.toString();Global.IsChanged[b]=true}function completeChangePage(){for(var a in Global.IsChanged){Global.IsChanged[a]=false}}function editTips(e){var d="";var c=0;for(var b in Global.IsChanged){if(Global.IsChanged[b]){if(b=="1"){c++;d+="- 模型参数<br/>"}if(b=="2"){c++;d+="- 模型的数据过滤器停靠状态<br/>"}if(b=="3"){c++;d+="- 模型的快照数据<br/>"}if(b=="4"){c++;d+="- 模型的大小和位置<br/>"}}}if(c>0){var a="本页面发生以下修改:<br/>";a+=d;a+="是否放弃保存并离开本页？";if($("#edittips").length==0){$("body").append("<div id='edittips' ></div>");$("#edittips").dialog({autoOpen:false,modal:true,width:260,close:function(){$("#edittips").css("display","none")}})}$("#edittips").empty().append(a);$("#edittips").dialog("open");$("#edittips").dialog("option","buttons",{"确定":function(){e();completeChangePage();$("#editlayer").hide();$(this).dialog("close")},"取消":function(){$(this).dialog("close");createEditTools(2)}})}else{e()}}function getShowTitleCom(b){var a="";if($(b).attr("show_title")!=undefined){a=$(b).attr("show_title");a=HTMLDecode(a)}return a}function setShowTitleCom(c,a){var b="";if($(c).length>0){b=HTMLEncode(a);$(c).attr("show_title",b)}return b}function RootShow(){var a=this;this.id;this.showid="";this.oldshowid="";this.targetID;this.show_title="";this.remark="";this.remarkstate;this.width="64%";this.height;this.parentDOMID="modelcondition";this.partRemark;this.getRemark=function(){var b="";if($(this.targetID).attr("remark")!=undefined){b=$(this.targetID).attr("remark");a.remark=b;b=HTMLDecode(b)}return b};this.setRemark=function(c){if($(this.targetID).length>0){var b=HTMLEncode(c);$(this.targetID).attr("remark",b);a.remark=b}};this.setRemarkState=function(b){if($(this.targetID).length>0){$(this.targetID).attr("remarkstate",b);a.remarkstate=b}};this.getRemarkState=function(){if($(this.targetID).attr("remarkstate")!=undefined){a.remarkstate=$(this.targetID).attr("remarkstate")}return a.remarkstate};this.createRemark=function(){createShowPartByName(config.controller+"public/part_remark.js","Remark",a,function(b){a.partRemark=b;a.partRemark.render()})};this.getShowTitle=function(){var b=getShowTitleCom(this.targetID);if(b!=""){a.show_title=b}return b};this.setShowTitle=function(b){var c=setShowTitleCom(this.targetID,b);if(c!=""){a.show_title=c}};this.onDrag=function(){a.onCancelEdit()};this.onResize=function(){if(a.aspectratio==-1&&Global.ToolbarType!=1){$("div[elementid][instanceid]").each(function(c,d){var b=$(d).data("showobj");if(b!=undefined&&b!=null){b.onCancelEdit()}})}else{a.onCancelEdit()}};this.onCancelEdit=function(){if(a.partRemark!=undefined){a.partRemark.setRemarkButtonPosition()}};this.setOtherShow=function(){$("div[instanceid][elementid]").each(function(d,c){if($(c).attr("id")!=a.id){var b=$(c).data("showobj");if(b!=undefined&&b!=null){b.onCancelEdit()}}});$("div[isgroup]").each(function(b,c){if($(c).children("div").length>0){$(c).children("div").each(function(e,f){var d=$(f).data("showobj");if(d!=undefined&&d!=null){d.onCancelEdit()}})}})}}function BaseShow(){var b=this;RootShow.call(this);this.element;this.scopeType;this.scope;this.dockfields=[];this.scopeTypeLimt;this.postDataJson;this.charttype;this.aspectratio=0.383;this.snapshotid;this.eventalertid;this.part4;this.partOnSiteFilter;this.partModelshowSwitch;this.partSnapshotHistory;this.configColumnInfo={};this.shade=null;this.allowDownload=true;this.downloadChecked=false;this.downloadFields=[];this.downloadFieldTexts=[];this.downloadDatacount=0;this.searcherbtnid;this.searcherid;this.searcherShow=false;this.showswitchbtn;this.showswitch;this.snapshothistorybtn;this.snapshothistory;this.setHtmlVersion=function(){return 1};this.exportWidget=function(){if(b.element.elementID<=0){alert("请先保存该模型");return false}if(!config.allowwidget){return false}var k="exportwidgetdiv";var l="exportwidgetwidth";var i="exportwidgetheight";var e="exportwidgetcode";var j="exportwidgetcreate";var f="exportwidgetwherror";var h="exportwidgetcopy";var d="exportwidgetselectall";var c=$("#"+k);if(c.length==0){$("body").append('<div id="'+k+'"></div>');c=$("#"+k);var g='<table style="width:97%;padding:5px;">';g+='<tr><td width="15%" align="right">尺寸：</td>';g+='<td align="left">&nbsp;宽：<input type="input" id="'+l+'" style="background-color:#FFFFFF;border:1px solid #B3CFE7;height:20px;width:50px" />';g+='&nbsp;高：<input type="input" id="'+i+'" style="background-color:#FFFFFF;border:1px solid #B3CFE7;height:20px;width:50px" />';g+='&nbsp;&nbsp;<input type="button" id="'+j+'" value="生成" />&nbsp;<span style="color:red" id="'+f+'"></span></td></tr>';g+='<tr><td width="15%" align="right">代码：</td>';g+='<td align="left">&nbsp;<textarea id="'+e+'" rows=5 style="background-color:#FFFFFF;border:1px solid #B3CFE7;width:100%;"></textarea><br/>';g+='&nbsp;<a href="javascript:void(0)" id="'+d+'">全选</a>&nbsp;&nbsp;<a href="javascript:void(0)" id="'+h+'">复制</a></td></tr></table>';c.append(g);c.dialog({title:"导出嵌入代码",width:430,height:280,autoOpen:false,modal:true,resizable:false,close:function(){$("#"+l).val("");$("#"+i).val("");$("#"+e).val("");$("#"+f).empty()},buttons:{"关闭":function(){$(this).dialog("close")}}})}$("#"+j).unbind("click");$("#"+j).bind("click",function(m){$("#"+f).empty();var v=$("#"+l).val();var s=$("#"+i).val();if(v==undefined||isNaN(v)){$("#"+f).text("请填写数字");$("#"+l).focus();return false}if(s==undefined||isNaN(s)){$("#"+f).text("请填写数字");$("#"+i).focus();return false}if(v<1){$("#"+f).text("数值不能小于1");$("#"+l).focus();return false}if(s<1){$("#"+f).text("数值不能小于1");$("#"+i).focus();return false}var p=0;var q=0;if($("#"+b.searcherid).length>0){p=$("#"+b.searcherid).outerWidth(true);q=$("#"+b.searcherid).outerHeight(true)}if($("#"+b.id+"timesearcher").length>0){p=Math.max($("#"+b.id+"timesearcher").outerWidth(true),p);q=Math.max($("#"+b.id+"timesearcher").outerHeight(true),q)}if(v<p||s<q){if(!confirm("尺寸小于实时过滤窗体的尺寸("+p+"*"+q+")，无法正常使用实时过滤，是否继续？")){var t=false;return false}else{var u=false}}var o=b_url;if(o==""){o=location.protocol+"//"+location.host+"/"}var r="inter3i_widget_frame_"+window.currNavid+"_"+b.element.instanceID+"_"+b.element.elementID+"_"+b.showid;var n='<iframe widget="inter3i" width="'+v+'" height="'+s+'" navid="'+window.currNavid+'" id="'+r+'" ';n+='instanceid="'+b.element.instanceID+'" elementid="'+b.element.elementID+'" ';n+='showid="'+b.showid+'" widgetsite="'+o+'" scrolling="no" frameborder="0"></iframe>';$("#"+e).val(n)});$("#"+d).unbind("click");$("#"+d).bind("click",function(){$("#"+e).focus();$("#"+e).select()});$("#"+h).unbind("click");$("#"+h).bind("click",function(){if(window.clipboardData){var m=window.clipboardData.setData("Text",$("#"+e).val());if(m){alert("复制成功!")}}else{alert("您使用的浏览器不支持此复制功能，请使用Ctrl+C或鼠标右键。");$("#"+e).focus();$("#"+e).select()}});c.dialog({open:function(){$("#"+l).val($("#"+b.id).outerWidth(true));$("#"+i).val($("#"+b.id).outerHeight(true))}});c.dialog("open")};this.setDownloadFields=function(c,d){b.downloadFields=c;b.downloadFieldTexts=d};this.errorCallBack=function(c){if(this.part4!=undefined){this.part4.errorCallBack(c)}};this.hideDownMenu=function(){$("div[elementid][instanceid]").each(function(){var c=$(this).data("showobj");if(c.partOnSiteFilter!=undefined&&c.partOnSiteFilter.hideTimeSearcher!=undefined){c.partOnSiteFilter.hideTimeSearcher()}if($("#"+c.searcherid).css("display")!=undefined&&$("#"+c.searcherid).css("display")!="none"){c.searcherShow=false;$("#"+c.id+"searcherbtn").children("img").attr("src",config.imagePath+"arrow_down_default.png");$("#"+c.searcherid).slideUp("slow");$("#"+c.id+"searcherbtn").attr("searchstate","folded")}})};this.onEdit=function(){b.hideOnsitefilterButton();b.hideOnsitefitlterSearcher();b.hideSnapshotElementPosition();b.hideEventAlertPosition();b.hideSnapshotHistoryPostion();b.hideSnapshotHistoryBtnPostion();if(b.partOnSiteFilter!=undefined&&b.partOnSiteFilter.hideTimeSearcher!=undefined){b.partOnSiteFilter.hideTimeSearcher()}b.hideShowSwitchBtnPostion();b.hideShowSwitchPostion()};this.onCancelEdit=function(){b.setOnsitefilterButtonPosition();b.setSnapshotElementPosition();if(b.partRemark!=undefined){b.partRemark.setRemarkButtonPosition()}b.setShowSwitchBtnPostion();if(b.shade){b.shadow()}b.setSnapshotHistoryBtnPostion();b.setEventAlertPosition()};this.getDockFields=function(){var c={};if(b.dockfields.length==0&&$(this.targetID).attr("dockfields")!=undefined){b.dockfields=$(this.targetID).attr("dockfields").split(",")}$.each(b.dockfields,function(e,d){var f=d.split(":");if(c[f[0]]==undefined){c[f[0]]={isdock:true};c[f[0]].eleid=[]}if(f[1]!=undefined){c[f[0]].eleid.push(f[1])}else{c[f[0]].eleid.push(b.element.elementID)}});return c};this.setDockFields=function(c){b.dockfields=c;$(this.targetID).attr("dockfields",c)};this.setOnsitFilterJSON=function(){this.postDataJson=deepClone(this.element.dataJson)};this.setpart=function(d,c){this.width=d;this.aspectratio=c};this.settype=function(c){this.charttype=c};this.setID=function(d,c,f){if(f!=undefined){this.parentDOMID=f}this.showid=c;if(this.oldshowid==""){b.oldshowid=c}var e=this.id;this.id="show_"+d;this.targetID="#"+this.id;if(e!=undefined&&$("#"+e).length>0){$("#"+e).attr("id",this.id)}};this.appendShowElement=function(){if($(this.targetID).length==0){var d=this.scopeType==undefined?"":this.scopeType;var f=(this.scope==undefined||this.scope==null)?"":this.scope.toString();var e=b.setHtmlVersion();var c="";if(b.dockfields.length>0&&this.parentDOMID=="modelcondition"){var g=b.dockfields;c='<div id="'+this.id+'" htmlversion="'+e+'" class="nr" instanceid="'+this.element.instanceID+'" elementid="'+this.element.elementID+'" showid="'+this.showid+'" scopetype="'+d+'" scope="'+f+'" dockfields="'+g+'" ><h1></h1></div>'}else{c='<div id="'+this.id+'" htmlversion="'+e+'" class="nr" instanceid="'+this.element.instanceID+'" elementid="'+this.element.elementID+'" showid="'+this.showid+'" scopetype="'+d+'" scope="'+f+'"></div>'}$("#"+this.parentDOMID).append(c)}if(this.parentDOMID=="modelcondition"){bindMouseEvent($(this.targetID))}if($(this.targetID).attr("aspectratio")==undefined||$(this.targetID).attr("aspectratio")==""){$(this.targetID).attr("aspectratio",this.aspectratio)}$(this.targetID).data("showobj",this)};this.hideOnsitefilterButton=function(){$("#"+this.searcherbtnid).parent().hide()};this.hideOnsitefitlterSearcher=function(){if($("#"+this.searcherid).css("display")!=undefined&&$("#"+this.searcherid).css("display")!="none"){$("#"+this.searcherbtnid).click()}};this.hasTitleHtml=function(){var c=false;if($("#"+this.id).children("h1").length>0){c=true}return c};this.leftBtnWidth=function(f){var i=0;var g=0;if($("#"+b.searcherbtnid+"").length>0){var h=$("#"+b.searcherbtnid+"").outerWidth()==0?20:$("#"+b.searcherbtnid+"").outerWidth();g=h+1}var e=0;if($("#"+b.showswitchbtn+"").length>0){var j=$("#"+b.showswitchbtn+"").outerWidth()==0?20:$("#"+b.showswitchbtn+"").outerWidth();e=j}var d=0;if($("#"+b.snapshothistorybtn).length>0){var c=$("#"+b.snapshothistorybtn).outerWidth()==0?20:$("#"+b.snapshothistorybtn).outerWidth();d=c}if(f==1){i=g}else{if(f==2){i=g+e}else{if(f==3){i=g+e+d}}}return i};this.createdSnapshotHistory=function(){if($("#"+b.snapshothistorybtn).length==0){b.snapshothistory=b.id+"snapshothistorydiv";b.snapshothistorybtn=b.id+"snapshothistorybtn";var c="<div id='"+b.id+"_snapshothistorybtndiv' style='display:none;'><a id='"+b.snapshothistorybtn+"' switcherstate='folded' href='javascript:void(0)' style='display:inline-block;' title='定时更新－选择快照' ><img src='"+config.imagePath+"clock.png' /></a></div>";$("body").append(c);b.setSnapshotHistoryBtnPostion()}$("#"+b.snapshothistorybtn).bind("mouseover",function(){$("#"+b.snapshothistorybtn).children("img").attr("src",config.imagePath+"clock_hover.png")});$("#"+b.snapshothistorybtn).bind("mouseout",function(){$("#"+b.snapshothistorybtn).children("img").attr("src",config.imagePath+"clock.png")});$("#"+b.snapshothistorybtn).unbind("click");$("#"+b.snapshothistorybtn).bind("click",function(){$("div[elementid][instanceid]").each(function(){var g=$(this).data("showobj");if(g!=undefined&&g!=null){if(g.partOnSiteFilter!=undefined&&g.partOnSiteFilter.hideTimeSearcher!=undefined){g.partOnSiteFilter.hideTimeSearcher()}if($("#"+g.searcherid).css("display")!=undefined&&$("#"+g.searcherid).css("display")!="none"){$("#"+g.id+"searcherbtn").children("img").attr("src",config.imagePath+"arrow_down_default.png");$("#"+g.searcherid).slideUp("slow");$("#"+g.id+"searcherbtn").attr("searchstate","folded")}if(g.id!=b.id){if($("#"+g.snapshothistorybtn).attr("switcherstate")=="unfolded"){$("#"+g.id+"snapshothistorydiv").hide();$("#"+g.snapshothistorybtn).attr("switcherstate","folded")}}}});var f=$(this).attr("switcherstate");if(f=="folded"){b.setSnapshotHistoryPostion();$(this).attr("switcherstate","unfolded")}else{$(this).attr("switcherstate","folded");$("#"+b.id+"snapshothistorydiv").slideUp("slow")}});var d,e;d=config.controller+"public/part_snapshothistory.js";e="PartSnapshotHistory";createShowPartByName(d,e,b,function(f){b.partSnapshotHistory=f;b.partSnapshotHistory.render()})};this.createModelshowSwitch=function(d){if($("#"+b.showswitchbtn).length==0){b.showswitch=b.id+"showswitchdiv";b.showswitchbtn=b.id+"showswitchbtn";var c="<div id='"+b.id+"_showswitchbtndiv' style='display:none;'><a id='"+b.showswitchbtn+"' switcherstate='folded' href='javascript:void(0)' style='display:inline-block;' title='切换图表' ><img src='"+config.imagePath+"shift.png' /></a></div>";if(d!=undefined){$("#"+d+"").append(c)}else{$("body").append(c)}b.setShowSwitchBtnPostion()}$("#"+b.showswitchbtn).bind("mouseover",function(){$("#"+b.showswitchbtn).children("img").attr("src",config.imagePath+"shift_hover.png")});$("#"+b.showswitchbtn).bind("mouseout",function(){$("#"+b.showswitchbtn).children("img").attr("src",config.imagePath+"shift.png")});$("#"+b.showswitchbtn).unbind("click");$("#"+b.showswitchbtn).bind("click",function(){$("div[elementid][instanceid]").each(function(){var f=$(this).data("showobj");if(f!=undefined&&f!=null){if(f.partOnSiteFilter!=undefined&&f.partOnSiteFilter.hideTimeSearcher!=undefined){f.partOnSiteFilter.hideTimeSearcher()}if($("#"+f.searcherid).css("display")!=undefined&&$("#"+f.searcherid).css("display")!="none"){$("#"+f.id+"searcherbtn").children("img").attr("src",config.imagePath+"arrow_down_default.png");$("#"+f.searcherid).slideUp("slow");$("#"+f.id+"searcherbtn").attr("searchstate","folded")}if(f.id!=b.id){if($("#"+f.showswitchbtn).attr("switcherstate")=="unfolded"){$("#"+f.id+"showswitchdiv").hide();$("#"+f.showswitchbtn).attr("switcherstate","folded")}}}});var e=$(this).attr("switcherstate");if(e=="folded"){b.setShowSwitchPostion();$(this).attr("switcherstate","unfolded")}else{$(this).attr("switcherstate","folded");$("#"+b.id+"showswitchdiv").slideUp("slow")}});createShowPart(b.element.modelID,5,b,function(e){b.partModelshowSwitch=e;b.partModelshowSwitch.render()})};this.hideShowSwitchPostion=function(){if($("#"+b.showswitchbtn).attr("switcherstate")=="unfolded"){$("#"+b.id+"showswitchdiv").hide();$("#"+b.showswitchbtn).attr("switcherstate","folded")}};this.hideSnapshotHistoryBtnPostion=function(){$("#"+b.snapshothistorybtn).parent().hide()};this.hideSnapshotHistoryPostion=function(){if($("#"+b.snapshothistorybtn).attr("switcherstate")=="unfolded"){$("#"+b.id+"snapshothistorydiv").hide();$("#"+b.snapshothistorybtn).attr("switcherstate","folded")}};this.setSnapshotHistoryPostion=function(){var d;d=$("#"+b.snapshothistorybtn).offset().left+$("#"+b.snapshothistorybtn).width()-$("#"+b.snapshothistory).outerWidth(true);var c=typeof config.onsiteFilterPositionLeft=="undefined"?223:config.onsiteFilterPositionLeft;if(d<c){d=c}$("#"+b.id+"snapshothistorydiv").slideDown("slow").css({display:"inline-block",width:"470px",position:"absolute","z-index":1003,left:d,top:$("#"+b.snapshothistorybtn).offset().top+20})};this.setShowSwitchPostion=function(){$("#"+b.id+"showswitchdiv").slideDown("slow").css({display:"inline-block",width:"28px",position:"absolute","z-index":1004,left:$("#"+b.showswitchbtn).offset().left,top:$("#"+b.showswitchbtn).offset().top+20})};this.hideShowSwitchBtnPostion=function(){$("#"+b.showswitchbtn).parent().hide()};this.setSnapshotHistoryBtnPostion=function(){if(b.snapshothistorybtn&&Global.ToolbarType!=1){var c=$("#"+b.id).offset().top;if(b.hasTitleHtml()){c+=7}$("#"+b.snapshothistorybtn).parent().css({display:"inline-block",position:"absolute",width:"20px","z-index":1001,left:$("#"+b.id).offset().left+$("#"+b.id).outerWidth()-b.leftBtnWidth(3),top:c})}};this.setShowSwitchBtnPostion=function(){if(b.showswitchbtn&&Global.ToolbarType!=1){if(b.parentDOMID=="modelcondition"){var d=$("#"+b.id).offset().top;var c=$("#"+b.id).offset().left+$("#"+b.id).outerWidth()-b.leftBtnWidth(2)}else{var d=$("#"+b.id).position().top+5;var c=$("#"+b.id).position().left+$("#"+b.id).outerWidth()-21}if(b.hasTitleHtml()){d+=7}$("#"+b.showswitchbtn).parent().css({display:"inline-block",position:"absolute",width:"20px","z-index":1001,left:c,top:d})}};this.setOnsitefilterButtonPosition=function(){if(this.searcherbtnid&&Global.ToolbarType!=1){var c=$("#"+this.id).offset().top;if(b.hasTitleHtml()){c+=7}$("#"+this.searcherbtnid).parent().css({display:"inline-block",position:"absolute",width:"20px","z-index":1001,left:$("#"+this.id).offset().left+$("#"+this.id).outerWidth()-b.leftBtnWidth(1),top:c})}};this.setSearcherPosition=function(){var d;d=$("#"+b.searcherbtnid).offset().left+$("#"+b.searcherbtnid).width()-$("#"+b.searcherid).outerWidth(true);var c=typeof config.onsiteFilterPositionLeft=="undefined"?223:config.onsiteFilterPositionLeft;if(d<c){d=c}$("#"+b.searcherid).slideDown("slow").css({display:"inline-block",position:"absolute","z-index":1003,left:d,top:$("#"+b.searcherbtnid).offset().top+20})};this.createOnsiteFilter=function(){var f="";var g="";if($("#"+this.searcherbtnid).length==0){g=this.id+"searcher";this.searcherid=g;f=this.id+"searcherbtn";this.searcherbtnid=f;var c='<div id="'+this.id+'_searcherbtndiv" style="display:none;"><a href="javascript:void(0);" id="'+f+'" searchstate="folded" style="display:inline-block;" title="快捷过滤" ><img src="'+config.imagePath+'arrow_down_default.png" /></a></div>';$("body").append(c);b.setOnsitefilterButtonPosition()}$("#"+f).bind("mouseover",function(){var h=$("#"+f).attr("searchstate");if(h=="unfolded"){$(this).children("img").attr("src",config.imagePath+"arrow_up_hover.png")}else{$(this).children("img").attr("src",config.imagePath+"arrow_down_hover.png")}});$("#"+f).bind("mouseout",function(){var h=$("#"+f).attr("searchstate");if(h=="unfolded"){$(this).children("img").attr("src",config.imagePath+"arrow_up_default.png")}else{$(this).children("img").attr("src",config.imagePath+"arrow_down_default.png")}});$("#"+f).unbind("click");$("#"+f).bind("click",function(){$("div[elementid][instanceid]").each(function(){var i=$(this).data("showobj");if(i!=undefined&&i!=null){if(i.partOnSiteFilter!=undefined&&i.partOnSiteFilter.hideTimeSearcher!=undefined){i.partOnSiteFilter.hideTimeSearcher()}if(i.id!=b.id){if($("#"+i.searcherid).css("display")!=undefined&&$("#"+i.searcherid).css("display")!="none"){$("#"+i.id+"searcherbtn").children("img").attr("src",config.imagePath+"arrow_down_default.png");$("#"+i.searcherid).slideUp("slow");$("#"+i.id+"searcherbtn").attr("searchstate","folded")}}if($("#"+i.showswitchbtn).attr("switcherstate")=="unfolded"){$("#"+i.id+"showswitchdiv").hide();$("#"+i.showswitchbtn).attr("switcherstate","folded")}}});b.searcherShow=!(b.searcherShow);var h=$("#"+b.searcherbtnid).attr("searchstate");if(h=="folded"){$(this).children("img").attr("src",config.imagePath+"arrow_up_default.png");b.setSearcherPosition();$("#"+b.searcherbtnid).attr("searchstate","unfolded");b.partOnSiteFilter.init()}else{$(this).children("img").attr("src",config.imagePath+"arrow_down_default.png");$("#"+g).slideUp("slow");$("#"+b.searcherbtnid).attr("searchstate","folded")}});var d,e;d=config.controller+"public/part_onsitefilter.js";e="PartOnsiteFilter";createShowPartByName(d,e,b,function(h){b.partOnSiteFilter=h;b.partOnSiteFilter.render()})};this.onDrag=function(){if(b.part4!=undefined&&b.part4.onDrag!=undefined){b.part4.onDrag()}b.hideOnsitefitlterSearcher();b.hideShowSwitchPostion();b.onCancelEdit()};this.onResizing=function(){if(b.part4!=undefined&&b.part4!=null){if(b.part4.onResizing!=undefined){b.part4.onResizing()}}var c=this.searcherid;$("#"+c).css("left",$("#"+this.id).width()-$("#"+c).outerWidth(true));b.hideOnsitefitlterSearcher();b.hideShowSwitchPostion();var d=checkTitleSpaceWidth($(this.targetID));toggleDockFields($(this.targetID),d)};this.onResize=function(){if(this.part4!=undefined&&this.part4.onResize!=undefined){this.part4.onResize()}if(b.aspectratio==-1&&Global.ToolbarType!=1){$("div[elementid][instanceid]").each(function(e,f){var d=$(f).data("showobj");if(d!=undefined&&d!=null){d.onCancelEdit()}})}else{b.onCancelEdit()}var c=checkTitleSpaceWidth($(this.targetID));toggleDockFields($(this.targetID),c)};this.hideSnapshotElementPosition=function(){$("#"+this.snapshotid).hide()};this.setSnapshotElementPosition=function(){if(this.snapshotid&&Global.ToolbarType!=1){var d,e,c,f;if($("#"+this.snapshotid).attr("class")=="show_brs"){c=20;f=20}else{c=60;f=60}d=$(this.targetID).offset().left+$(this.targetID).width()-c;e=$(this.targetID).offset().top+$(this.targetID).height()-f+4;$("#"+this.snapshotid).css({display:"inline-block",left:d+"px",top:e+"px",width:c+"px",height:f+"px"})}};this.hideEventAlertPosition=function(){$("#"+this.eventalertid).hide()};this.setEventAlertPosition=function(){if(this.eventalertid&&Global.ToolbarType!=1){var d,f,c,g;c=20;g=20;d=$(this.targetID).offset().left+$(this.targetID).width()-c-20;f=$(this.targetID).offset().top+$(this.targetID).height()-g+4;var e=this.element.hasalarm?"inline-block":"none";$("#"+this.eventalertid).css({display:e,position:"absolute",left:d+"px",top:f+"px",width:c+"px",height:g+"px"})}};this.snapSmallClick=function(){$("#"+b.eventalertid).hide();var c=$("#"+b.snapshotid).attr("class");if(c=="show_brs"){$("#"+b.snapshotid).attr("class","show_brb");var e=b.snapshotid+"_ut";var d="<div id='"+e+"' style='position:absolute;'>"+formatTime("yyyy-MM-dd hh:mm:ss",b.element.updateTime)+"快照</div>";$("#"+b.parentDOMID).append(d);$("#"+e).css({left:$(b.targetID).offset().left+$(b.targetID).width()-190,top:$(b.targetID).offset().top+$(b.targetID).height()-5})}else{b.element.clearSnapshot();if(b.oldshowid!=undefined&&b.oldshowid!=b.showid){b.newobj=2}b.element.show();$.each(window.instances,function(f,g){if(g.instanceID==b.element.instanceID&&g.status==1){g.preUpdate();changePage(3);createSnapLayer();return false}})}b.setSnapshotElementPosition()};this.removeSnapshotElement=function(){$("#"+this.snapshotid).remove()};this.appendSnapshotElement=function(){this.snapshotid=this.id+"_brdiv";if($("#"+this.snapshotid).length>0){return}var c="<div id='"+this.snapshotid+"' class='show_brs'></div>";$("#"+b.parentDOMID).append(c);this.setSnapshotElementPosition();$("#"+this.snapshotid).bind("click",this.snapSmallClick);$("#"+b.snapshotid).bind("mouseout",function(){if($("#"+b.snapshotid).attr("class")=="show_brb"){$("#"+b.snapshotid).attr("class","show_brs");$("#"+b.snapshotid+"_ut").remove();b.setSnapshotElementPosition();$("#"+b.eventalertid).show()}})};this.removeEventAlert=function(){$("#"+this.eventalertid).remove()};this.appendEventAlert=function(){this.eventalertid=this.id+"_alert";if($("#"+this.eventalertid+"").length==0){var c="<div id='"+this.eventalertid+"' style='display:none;'><img src='"+config.imagePath+"error.png' /></a></div>";$("#"+b.parentDOMID).append(c);this.setEventAlertPosition()}};this.checkScopeType=function(d,f){var e=true;if(d==undefined){return false}else{switch(d){case"array":e=isArray(f);break;case"all":break;case"number":e=!isNaN(f);break;default:e=false;break}if(this.scopeTypeLimt!=undefined&&this.scopeTypeLimt.length>0){var c=false;$.each(this.scopeTypeLimt,function(g,h){if(h==sot){c=true;return false}});e=c}return e}};this.setDataScope=function(d,f){if(!this.checkScopeType(d,f)){return false}this.scopeType=d;this.scope=a(d,f);if($(this.targetID).length>0){var c=this.scopeType==undefined?"":this.scopeType;var e=(this.scope==undefined||this.scope==null)?"":this.scope.toString();$(this.targetID).attr("scopetype",c).attr("scope",e)}};function a(c,d){if(c=="number"){return parseInt(d,10)}else{if(c=="array"){return JSON.parse(d)}else{return d}}}this.destroy=function(){$(this.targetID).remove();$("#"+this.snapshotid).remove();if(b.part4&&b.part4.destroy){b.part4.destroy()}};this.getShowData=function(c){if(this.scopeType==undefined||this.scopeType=="all"){return c}else{if(this.scopeType=="number"){if(c[0].datalist[this.scope]==undefined){return null}else{return c[0].datalist[this.scope]}}}};this.setOtherShow=function(){$("div[instanceid][elementid]").each(function(e,d){if($(d).attr("id")!=b.id){var c=$(d).data("showobj");if(c!=undefined&&c!=null){c.onCancelEdit()}}});$("div[isgroup]").each(function(c,d){if($(d).children("div").length>0){$(d).children("div").each(function(f,g){var e=$(g).data("showobj");if(e!=undefined&&e!=null){e.onCancelEdit()}})}})};this.shadow=function(){if(b.allowDownload){var g=$(b.targetID);var f=g.offset();var d=g.outerWidth();var e=g.outerHeight();if(!b.shade){var c='<div class="downloadshade"></div>';b.shade=$(c).css({width:d,height:e,left:f.left,top:f.top}).appendTo("body")}else{b.shade.css({width:d,height:e,left:f.left,top:f.top})}return b.shade}else{return false}};this.hideShade=function(){b.downloadChecked=false;if(b.shade){b.shade.remove();b.shade=null}}}function BasePart(){var a=this;this.randomid;this.errorCallBack=function(g){var e="#"+a.randomid;var b=$(e).height()/2;var d=$(e).width()/2;var c="error"+a.randomid;$(e).html("<span id='"+c+"' style='margin-top:"+b+"px;margin-left:"+d+"px;float:left'>"+g+"</span>");var f=$("#"+c).width();$("#"+c).css("margin-left",d-f/2)}}function formatSnapshotData(b){if(typeof(b)=="object"){delete b.parent;delete b.x;delete b.y;delete b.color;delete b.size;delete b.maxAngle;delete b.minAngle;delete b.forceLabel;delete b.r;delete b.childr;delete b.extendCount;delete b.ranking;delete b.forceFL;delete b.allforce;delete b.tempExtendNodes;if(b.children){for(var a=0;a<b.children.length;a++){formatSnapshotData(b.children[a])}}}}function mirrorModelHtml(){$("#addpageparamdiv").css("display","none");$("#editmodelselectdiv").hide();if(window.currNavid==undefined||window.currNavid==null){alert("请选择二级导航");return false}window.currInstance=null;$("#editelementdiv").empty();var j="<div style='padding:5px;border:1px solid #848484;'><input type='button' value='合并' id='mergebtn' name='mergebtn' style='border:1px solid blue;display:none;'/>&nbsp;&nbsp;<input type='button' value='拆分' id='splitbtn' name='splitbtn' style='border:1px solid red;display:none;' /></div>";$("#editmodelselectdiv").html("");var i="<div id='fieldlabels' style='overflow-y:scroll; border:1px solid #848484;border-top:0;'></div>";var e='<div id="showmirrorline" style="text-align:center;border:0; height:15px;"><span id="showmirrorspan" style="border: 1px solid #DADADA;border-radius:0 0 10px 10px;padding:0 50px;cursor:pointer;font-size:6px;"><span class="arrowdown" id="showmirrorimg" alt="folded" ></span></span></div>';var d="<div id='showmirrorhr' style='border-bottom:1px solid #848484;margin-bottom:1px;display:none;' ></div>";d+="<div id='showmirrorhr2' style='border-bottom:1px solid #848484;margin-bottom:1px;display:none;' ></div>";var b="<div id='showmirror' style='overflow-y:scroll; border:1px solid #848484;'></div>";var h="<div id='showmirrorbox'>"+e+d+b+"</div>";$("#editelementdiv").html(j+i+h);var f=getPageRightHtml();if(f==undefined||f==null||f==""){alert("未获取到页面结构，请新增");return false}$("#editdiv").dialog("open");$("#editdiv").dialog({resizable:false});var g=$("#showmirror").width();var c=$("#modelcondition").width();var a=g/c;$("#showmirror").append(f);$("#showmirror div").each(function(q,p){if($(p).attr("isgroup")||$(p).attr("instanceid")||$(p).attr("isdescribe")){var m=getShowTitleCom(p);var o=$(p).attr("title");if((m==undefined||m=="")&&(o!=undefined&&o!="")){m=o;setShowTitleCom(p,m)}if(o!=undefined){$(p).removeAttr("title")}if(m!=undefined&&m!=""){if($(p).children().length==0){$(p).append("<h1>"+m+"</h1>")}else{$(p).children(":first").before("<h1>"+m+"</h1>")}}}var l=$(p).attr("id");if($(p).attr("style").toLowerCase().indexOf("%")==-1){var n=$("#modelcondition div[id="+l+"]").width();var k=n*a*98/100;$(p).css("width",k)}if($(p).attr("style").toLowerCase().indexOf("auto")==-1){var s=$("#modelcondition div[id="+l+"]").height();var r=s*a;$(p).css("height",r)}$(p).attr("id","mirror_"+$(p).attr("id"))});$("#fieldlabels").css("max-height","450px");$("#showmirror").css("height","1px");$("#showmirror").css("visibility","hidden");showmirrorImgPosition();$("#showmirrorspan").bind("click",function(){var l=$("#showmirrorimg").attr("alt");if(l=="folded"){$("#showmirrorimg").attr("alt","unfolded");$("#showmirrorimg").removeClass().addClass("arrowup");$("#showmirror").css("visibility","visible");$("#showmirrorhr").css("display","");$("#showmirrorhr2").css("display","");var k=$("#fieldlabels").height();if(k<326){$("#showmirror").height(466-k-20)}else{$("#showmirror").css("height","120px");$("#fieldlabels").css("height","326px")}$("#showmirror").resizable("option","disabled",false);showmirrorImgPosition()}else{if(l=="unfolded"){$("#showmirrorimg").attr("alt","folded");$("#showmirrorimg").removeClass().addClass("arrowdown");$("#fieldlabels").css("height","auto");$("#showmirrorhr").css("display","none");$("#showmirrorhr2").css("display","none");$("#showmirror").css("visibility","hidden");$("#showmirror").css("height","1px");$("#showmirror").resizable("option","disabled",false);showmirrorImgPosition()}}});$("#showmirror").resizable({disabled:true,handles:"n",resize:function(){var k=$("#showmirror").height();$("#fieldlabels").height(466-k-20);showmirrorImgPosition()}})}function showmirrorImgPosition(){var a=$("#showmirror").offset();var b=$("#editdiv").offset();$("#showmirror .ui-resizable-handle").css({width:$("#showmirror").width(),left:0,height:"5px",top:a.top-b.top-10})}function createEditTools(i){if(Global.user.usertype!=1){return}Global.ToolbarType=i;var k="<a id='pastebtn' href='javascript:void(0)' style='display:none;color:#ffffff'>粘贴</a>&nbsp;&nbsp;&nbsp;&nbsp;";var j="<a id='pastebtnfrom' href='javascript:void(0)' style='color:#ffffff'>粘贴自..</a>&nbsp;&nbsp;&nbsp;&nbsp;";var q="<a id='previewbtn' href='javascript:void(0)' opt='pre' style='color:#ffffff'>预览</a>&nbsp;&nbsp;&nbsp;&nbsp;";var n="<a id='copypage' href='javascript:void(0)' style='color:#ffffff'>复制页面</a>&nbsp;&nbsp;&nbsp;&nbsp;";var p="<a id='copypageto' href='javascript:void(0)' style='color:#ffffff'>复制页面至..</a>&nbsp;&nbsp;&nbsp;&nbsp;";var e="<a id='editpageparam' href='javascript:void(0)' style='color:#ffffff'>编辑页面数据</a>&nbsp;&nbsp;&nbsp;&nbsp;";var d="<a id='addpageparam' href='javascript:void(0)' style='color:#ffffff'>编辑页面数据<span class='modelarrowdown' id='addpageparam_arrowhover' ></span></a>&nbsp;&nbsp;&nbsp;&nbsp;";var s="<a id='settab' href='javascript:void(0)' style='color:#ffffff'>设置卡片</a>&nbsp;&nbsp;&nbsp;&nbsp;";var l="<a id='bottom_canceledit' href='javascript:void(0)' style='color:#ffffff'>取消编辑</a>&nbsp;&nbsp;&nbsp;&nbsp;";var t="<a id='addmodel' href='javascript:void(0)' style='color:#ffffff'>新增<span class='modelarrowdown' id='addmodel_arrowhover' ></span></a>&nbsp;&nbsp;&nbsp;&nbsp;";var b="<a id='addviewgroup' href='javascript:void(0)' style='color:#ffffff'>新增分组</a>&nbsp;&nbsp;&nbsp;&nbsp;";var m="<a id='adddescription' href='javascript:void(0)' style='color:#ffffff'>新增描述</a>&nbsp;&nbsp;&nbsp;&nbsp;";var u="<a id='defaultsizeall' href='javascript:void(0)' style='color:#ffffff'>恢复尺寸</a>&nbsp;&nbsp;&nbsp;&nbsp;";var g="<a id='savebtn' href='javascript:void(0)' style='color:#ffffff'>保存</a>&nbsp;&nbsp;&nbsp;&nbsp;";var f="<a id='editbtn' style='color:#FFFFFF' href='javascript:void(0)'>编辑页面</a>&nbsp;&nbsp;&nbsp;&nbsp;";var o="<a id='giveupbtn' style='color:#FFFFFF' href='javascript:void(0)'>放弃保存</a>&nbsp;&nbsp;&nbsp;&nbsp;";var h="<div id='addmodeldiv' class='downmenudiv' style='display:none;background: none repeat scroll 0 0 #ffffff;'>";h+="<a id='addnormal' href='javascript:void(0)' >标准分析</a>";if(config.allowlinkage){h+="<a id='addlinkage' href='javascript:void(0)' >联动分析</a>"}if(config.allowoverlay){h+="<a id='addoverlay' href='javascript:void(0)' >叠加分析</a>"}if(config.allowvirtualdata){h+="<a id='addvirtualdata' href='javascript:void(0)' >虚拟数据</a>"}h+="</div>";var a="";if(config.allowupdatesnapshot){a+="<div id='addpageparamdiv' class='downmenudiv' style='display:none;background: none repeat scroll 0 0 #ffffff;width:96px;'>";a+="<a id='editpageparam' href='javascript:void(0)'>模型数据</a>";a+="<a id='editupdateschedule' href='javascript:void(0)'>更新计划</a>";a+="<a id='selectsnapshot' href='javascript:void(0)'>选择快照</a>";a+="</div>"}else{d=e}var r="";switch(i){case 1:r=k+q+l+j+p+n+d+s+t+b+m+u+g+h+a;break;case 2:r=f+g+o;break;default:break}$("#editlayer").html(r);var c='<div id="overlaydiv" style="display:none;width:834px;height:683px;overflow-y:scroll;">';c+='<div style="width:100%;height:10%;"><input type="button" value="添加列" id="overlayaddcolumn"></div>';c+="<div>";c+='<input type="checkbox" name="overlayxcombined" id="overlayxcombined" /><label for="overlayxcombined">x轴合并</label>';c+='<span id="overlaystackingspan" style="display:none;" ><input type="checkbox" name="overlaycolumnstacking" id="overlaycolumnstacking" /><label for="overlaycolumnstacking">柱状图叠加</label></span>';c+='<input type="checkbox" name="overlayxzreverse" id="overlayxzreverse" /><label for="overlayxzreverse">xz轴反转</label>';c+='<input type="checkbox" name="overlaysnap" id="overlaysnap" /><label for="overlaysnap">保存快照</label>';c+="</div>";c+='<table id="overlaytb" style="width:900px;height:90%">';c+='<tr id="overlaytr">';c+="</tr>";c+="</table>";c+="</div>";if($("#overlaydiv").length==0){$("body").append(c);$("#overlayxzreverse").bind("click",function(){if($(this).prop("checked")){$("#overlayxcombined").attr("checked",false);$("#overlaycolumnstacking").attr("checked",false);$("#overlaystackingspan").css("display","none")}});$("#overlayxcombined").bind("click",function(){if($(this).prop("checked")){$("#overlayxzreverse").attr("checked",false);if($("#overlaystackingspan").attr("stackavailable")){$("#overlaystackingspan").css("display","")}}else{$("#overlaycolumnstacking").attr("checked",false);$("#overlaystackingspan").css("display","none")}});$("#overlaycolumnstacking").bind("click",function(){if($(this).prop("checked")){var v=$("input[name=secondaryyaxis]:checked").length;if(v>0){alert("柱状图叠加时,不能选择次坐标!");$(this).attr("checked",false)}}});$("#overlayaddcolumn").bind("click",function(){window.overlayobj.addColumn()})}dropDownMenuMouseEvent("model");dropDownMenuMouseEvent("pageparam");$("#addoverlay").bind("click",function(){$("#addmodeldiv").css("display","none");if(window.currNavid==undefined||window.currNavid==null){alert("请选择二级导航");return false}window.datafromtype=2;window.currInstance=null;if(window.overlayobj==null){window.overlayobj=new Overlay()}window.overlayobj.show()});$("#addlinkage").bind("click",function(){window.datafromtype=2;$("#addmodeldiv").css("display","none");if(window.currNavid==undefined||window.currNavid==null){alert("请选择二级导航");return false}window.currInstance=null;if(window.linkageobj==null){window.linkageobj=new Linkage()}window.linkageobj.show()});if(Global.Clipboard.hasdata){$("#pastebtn").show()}$("#pastebtn").unbind("click");$("#pastebtn").bind("click",function(v){Global.Clipboard.paste()});$("#pastebtnfrom").unbind("click");$("#pastebtnfrom").bind("click",function(v){copyModel()});$("#editbtn").unbind("click");$("#editbtn").bind("click",function(){createEditLayer()});$("#giveupbtn").unbind("click");$("#giveupbtn").bind("click",function(){clearEditLayer()});$("#defaultsizeall").unbind("click");$("#defaultsizeall").bind("click",function(){$(window.instances).each(function(v,w){$(w.elements).each(function(A,z){if(z.allshow!=undefined&&z.allshow!=null){$(z.allshow).each(function(B,C){defaultShowSize(C)})}})});$("div[isdescribe]").each(function(z,w){var v=$(w).data("showobj");if(v!=undefined&&v!=null){defaultShowSize(v)}});$("div[isgroup]").each(function(v,w){if($(w).children("div").length>0){$(w).removeAttr("style")}})});$("#previewbtn").unbind("click");$("#previewbtn").bind("click",function(){if($(this).attr("opt")=="pre"){$(this).attr("opt","cancel_pre");$(this).text("取消预览");window.currEditStatus=false;window.preViewStatus=true;_clearEditLayer()}else{$(this).attr("opt","pre");$(this).text("预览");window.currEditStatus=true;window.preViewStatus=false;setMultiPageEdit("#modelcondition");initDrag("#editelementlayer")}});$("#bottom_canceledit").unbind("click");$("#bottom_canceledit").bind("click",function(){clearEditLayer()});$("#editlayer").show();$("#adddescription").unbind("click");$("#adddescription").bind("click",function(){changePage(4);if(!window.maxdescribeid){window.maxdescribeid=0}$("div[isdescribe]").each(function(D,B){var C=parseInt($(B).attr("id").replace("describe",""));if(C>window.maxdescribeid){window.maxdescribeid=C}});window.maxdescribeid++;var w="describe"+window.maxdescribeid;$("#modelcondition").append("<div id='"+w+"' isdescribe='1' show_title='' class='nr'><h1></h1></div>");var v="#"+w;$(v).css({width:790,height:"auto","min-height":80});bindMouseEvent(v);var A=$(v).children("h1");if(A.length>0){var z=A.width()/2;A.html("<input type='text' style='width:"+z+"' value='' maxlength='100' />");A.find("input").bind("blur",function(){setShowTitleCom(v,$(this).val())})}createShowByID("descriptionshow",v,null,function(B){$(v).data("showobj",B);B.setID(w,"#"+w)});window.scrollTo(0,document.body.scrollHeight)});$("#addviewgroup").unbind("click");$("#addviewgroup").bind("click",function(A){changePage(4);if(!window.maxgroupid){window.maxgroupid=0}window.maxgroupid++;var v="group"+window.maxgroupid;$("#modelcondition").children(":first").before("<div id='"+v+"' isgroup='1' show_title='' class='groupdiv'><h1></h1></div>");var w=$("#modelcondition").children("div[isgroup]:first");w.width(790).height(300);$("#editelementlayer").hide();bindMouseEvent(w);var D=w.children("h1");if(D.length>0){var C=D.width()/2;D.html("<input type='text' style='width:"+C+"' value='' maxlength='100' />");var B=checkTitleSpaceWidth(w);toggleDockFields(w,B);D.find("input").bind("blur",function(){setShowTitleCom(w,$(this).val())})}var z="#"+v;createShowByID("groupshow",z,null,function(E){$(z).data("showobj",E);E.setID(v,"#"+v)})});$("#addvirtualdata").unbind("click");$("#addvirtualdata").bind("click",function(){$("#addmodeldiv").css("display","none");if(window.currNavid==undefined||window.currNavid==null){alert("请选择二级导航");return false}window.currInstance=null;$("#editelementdiv").empty();$("#editdiv").dialog("open");$("#editmodelselectdiv").removeAttr("firstinit");window.datafromtype=1;createModelSelect("#editmodelselectdiv",window.currTypeID,0,0,1)});$("#addnormal").unbind("click");$("#addnormal").bind("click",function(){$("#addmodeldiv").css("display","none");if(window.currNavid==undefined||window.currNavid==null){alert("请选择二级导航");return false}window.currInstance=null;$("#editelementdiv").empty();$("#editdiv").dialog("open");window.datafromtype=2;createModelSelect("#editmodelselectdiv",window.currTypeID,0,0,1)});$("#settab").unbind("click");$("#settab").bind("click",function(){editTips(function(){myInnerNavTab(function(v){if(v.length>0){createRight(2,window.currTabsParentID,window.currPagetype,window.currTabsParentFilepath)}else{$("#modelselect").empty()}})})});$("#selectsnapshot").unbind("click");$("#selectsnapshot").bind("click",function(){mirrorModelHtml();createSnapHistoryHtml();calcMirrorShowMaxRatio();$("#fieldlabels div[connid]").die("click");$("#fieldlabels div[connid]").live("click",function(){$("#fieldlabels div[connid]").removeClass().addClass("borderhr");$("#fieldlabels div[connid]").removeAttr("splitfield");$(this).addClass("checkeddiv");$("#showmirror span[connid]").removeClass().addClass("labelbox");var A=$(this).attr("connid");$("#showmirror span[connid="+A+"]").removeClass().addClass("checkedbox");$("#showmirror span[mergeconnid="+A+"]").removeClass().addClass("checkedbox");var z=$("#showmirror").offset();var C=$("#showmirror span[connid="+A+"]").parents("div").first().offset();if(C!=null){$("#showmirror").scrollTop(C.top-$("#showmirror").scrollTop()-z.top)}var w=$("#showmirror span[connid="+A+"]").parents("div").first().attr("id");var B=w.split("mirror_");$("#modelcondition div[id="+B[1]+"]").attr("modified",true);splitBtnDisplay()});$("#showmirror span[connid]").die("click");$("#showmirror span[connid]").live("click",function(){var w=$(this).parents("div").first().attr("id");var E=w.split("mirror_");$("#modelcondition div[id="+E[1]+"]").attr("modified",true);var D=$(this).attr("connid");var B=$(this).attr("mergeconnid");var A=$(this).attr("mergefield");if(A==undefined){$("#showmirror span[connid="+D+"]").removeClass().addClass("checkedbox");var z=jQuery.parseJSON($(this).attr("labeldata"));$("#showmirror span[connid="+D+"]").attr("mergefield",z.elementid);if(B!=undefined){$("#showmirror span[mergeconnid="+B+"]").removeClass().addClass("checkedbox");$("#showmirror span[mergeconnid="+B+"]").each(function(I,G){var H=jQuery.parseJSON($(G).attr("labeldata"));$(G).attr("mergefield",H.elementid)});$("#fieldlabels div[connid="+B+"]").removeClass().addClass("checkeddiv")}$("#fieldlabels div[connid="+D+"]").removeClass().addClass("checkeddiv");$("#fieldlabels").scrollTop(0);var C=$("#fieldlabels").offset();var F=$("#fieldlabels div[connid="+D+"]").offset();if(F!=null){$("#fieldlabels").scrollTop(F.top-$("#fieldlabels").scrollTop()-C.top)}}else{$("#showmirror span[connid="+D+"]").removeClass().addClass("labelbox");$("#fieldlabels div[connid="+D+"]").removeClass().addClass("borderhr");$(this).removeClass().addClass("labelbox");$(this).removeAttr("mergefield");if(B!=undefined){$("#showmirror span[mergeconnid="+B+"]").removeClass().addClass("labelbox");$("#showmirror span[mergeconnid="+B+"]").removeAttr("mergefield");$("#fieldlabels div[connid="+B+"]").removeClass().addClass("borderhr")}}mergeBtnDisplay()});$("#fieldlabels div[mergedata]").die("click");$("#fieldlabels div[mergedata]").live("click",function(){var w=$(this).attr("splitfield");if(w==undefined){$(this).removeClass().addClass("checkeddiv");$(this).attr("splitfield","split")}else{$(this).removeClass().addClass("borderhr");$(this).removeAttr("splitfield")}splitBtnDisplay()});var v=[];$("#mergebtn").bind("click",function(){var z=[];$("#showmirror span[mergefield]").each(function(D,C){if($(C).attr("mergefield")!=undefined){var E=jQuery.parseJSON($(C).attr("labeldata"));z.push(E)}});if(z.length>0){var B=[];$.each(z,function(E,D){var F="snap"+D.connid+"obj";var C=window[F].getSnapSelectCode();B.push(C)});if(B.length>0){var A={};var w=$("#showmirror span[mergefield]:first").attr("connid");$.each(z,function(E,D){if(A.snap==undefined){A.snap=[];A.snap.push(D.elementid)}else{A.snap.push(D.elementid)}var F="snap"+w+"obj";var C=window[F].getSnapSelectCode();$.each(window.instances,function(G,H){if(H.elements.length>0){$.each(H.elements,function(J,I){if(I.elementID==D.elementid){I.updatetime=C}})}})});v.push(A)}createSnapHistoryHtml(v);calcMirrorShowMaxRatio()}mergeBtnDisplay()});$("#splitbtn").bind("click",function(){$("#fieldlabels div[splitfield]").each(function(E,w){var B=$(w).attr("splitfield");if(B!=undefined){var C=$(w).attr("mergedata");if(C!=undefined){var D=jQuery.parseJSON(C);for(var A in D){var z=D[A];$.each(z,function(G,F){$.each(window.instances,function(H,I){if(I.elements>0){$.each(I.elements,function(O,K){var T=formatTime("yyyy-MM-dd hh:mm:ss",K.updateTime);var J=Math.round(Math.random()*100000);var S="class='labelbox'";var M={elementid:K.elementid,snapparams:K.snapparams};var Q="<span connid='"+J+"' labeldata='"+JSON.stringify(M)+"' "+S+" >快照时间("+T+")</span>";$("#showmirror div[elementid="+K+"] span").each(function(V,U){$(U).remove()});$("#showmirror div[elementid="+K+"]").append(Q);var R="<div class='borderhr' connid='"+J+"' id='pagesnapshothist"+J+"'><fieldset><legend>"+T+"</legend><div id='selectpagesnapshot"+J+"'></div></fieldset></div>";$("#fieldlabels").append(R);var P,N;P=config.controller+"public/part_snapshothistory.js";N="PartSnapshotHistory";var L={};L.type="selectsnapshot";L.elementid=K.elementID;createShowPartByName(P,N,L,function(V){window["snap"+J+"obj"]=retobj;window["snap"+J+"obj"].render("selectpagesnapshot"+J+"");var U=window["snap"+J+"obj"].prefixid;$("#"+U+"snapshot_hist_selected").attr("code",K.updateTime);$("#"+U+"snapshot_hist_selected").text(T)})})}})})}$(w).remove()}}});splitBtnDisplay()});$("#editdiv").dialog("option","buttons",{"确定":function(){changePage(1);var w=[];$("#fieldlabels div[mergedata]").each(function(C,z){var A=$(z).attr("mergedata");if(A!=undefined){var B=jQuery.parseJSON(A);w.push(B)}});if(w.length==0){w=null}window.currmergedsnap=w;$("#modelcondition div[elementid][instanceid]").each(function(E,H){var G=$(H).data("showobj");if(G!=undefined&&G!=null&&$(H).attr("modified")){var C=G.element.elementID;var F=G.element.instanceID;var B=$("#showmirror div[elementid="+C+"]").find("span[connid]").attr("connid");var z="snap"+B+"obj";var D=window[z].getSnapSelectCode();var A=config.phpUrl+"modelinterface.php?type=getsnapshothistorybytime&snaptime="+D+"&eleid="+C+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:A,async:false,beforeSend:function(){},success:function(I){if(I!=null){$.each(I.children,function(J,K){if(K.elementid==C){G.element.setSnapshot(K.snapshot,K.updatetime);G.element.show()}})}}});$.each(window.instances,function(I,J){if(J.instanceID==G.element.instanceID&&J.status==1){J.preUpdate();return false}});$(H).removeAttr("modified")}});$(this).dialog("close")},"取消":function(){$(this).dialog("close")}});$("#editdiv").dialog({close:function(){$("#editelementdiv").empty();$("#editmodelselectdiv").show();$("#tabdiv").tabs("destroy")}})});$("#editupdateschedule").unbind("click");$("#editupdateschedule").bind("click",function(){var w;if(window.currMergeSched!=undefined&&window.currMergeSched!=null){w=window.currMergeSched}else{w=getMergeSched(window.currNavid)}var v=[];if(w){$.each(w,function(D,A){var E=A.sched;var C=true;var B=[];$.each(E,function(F,G){var H=false;$.each(window.instances,function(I,J){if(J.instanceID==G){H=true;if(J.schedparams){B.push(J.schedparams)}else{H=false}}});if(!H){C=false}});if(C){C=hasSameSched(B)}if(C){v.push(A)}})}mirrorModelHtml();createPageSchedHtml(v);calcMirrorShowMaxRatio();$("#fieldlabels div[connid]").die("click");$("#fieldlabels div[connid]").live("click",function(){$("#fieldlabels div[connid]").removeClass().addClass("borderhr");$("#fieldlabels div[connid]").removeAttr("splitfield");$(this).addClass("checkeddiv");$("#showmirror span[connid]").removeClass().addClass("labelbox");var B=$(this).attr("connid");$("#showmirror span[connid="+B+"]").removeClass().addClass("checkedbox");$("#showmirror span[mergeconnid="+B+"]").removeClass().addClass("checkedbox");var A=$("#showmirror").offset();var C=$("#showmirror span[connid="+B+"]").parents("div").first().offset();if(C!=null){$("#showmirror").scrollTop(C.top-$("#showmirror").scrollTop()-A.top)}splitBtnDisplay()});$("#showmirror span[connid]").die("click");$("#showmirror span[connid]").live("click",function(){var A=$(this).parents("div").first().attr("id");var G=A.split("mirror_");$("#modelcondition div[id="+G[1]+"]").attr("modified",true);var F=$(this).attr("connid");var D=$(this).attr("mergeconnid");var C=$(this).attr("mergefield");if(C==undefined){$("#showmirror span[connid="+F+"]").removeClass().addClass("checkedbox");var B=jQuery.parseJSON($(this).attr("labeldata"));$("#showmirror span[connid="+F+"]").attr("mergefield",B.instanceid);if(D!=undefined){$("#showmirror span[mergeconnid="+D+"]").removeClass().addClass("checkedbox");$("#showmirror span[mergeconnid="+D+"]").each(function(K,I){var J=jQuery.parseJSON($(I).attr("labeldata"));$(I).attr("mergefield",J.instanceid)});$("#fieldlabels div[connid="+D+"]").removeClass().addClass("checkeddiv")}$("#fieldlabels div[connid="+F+"]").removeClass().addClass("checkeddiv");$("#fieldlabels").scrollTop(0);var E=$("#fieldlabels").offset();var H=$("#fieldlabels div[connid="+F+"]").offset();if(H!=null){$("#fieldlabels").scrollTop(H.top-$("#fieldlabels").scrollTop()-E.top)}}else{$("#showmirror span[connid="+F+"]").removeClass().addClass("labelbox");$("#fieldlabels div[connid="+F+"]").removeClass().addClass("borderhr");$(this).removeClass().addClass("labelbox");$(this).removeAttr("mergefield");if(D!=undefined){$("#showmirror span[mergeconnid="+D+"]").removeClass().addClass("labelbox");$("#showmirror span[mergeconnid="+D+"]").removeAttr("mergefield");$("#fieldlabels div[connid="+D+"]").removeClass().addClass("borderhr")}}mergeBtnDisplay()});$("#fieldlabels div[mergedata]").die("click");$("#fieldlabels div[mergedata]").live("click",function(){var A=$(this).attr("splitfield");if(A==undefined){$(this).removeClass().addClass("checkeddiv");$(this).attr("splitfield","split")}else{$(this).removeClass().addClass("borderhr");$(this).removeAttr("splitfield")}splitBtnDisplay()});var z=[];$("#mergebtn").bind("click",function(){var B=[];$("#showmirror span[mergefield]").each(function(F,E){if($(E).attr("mergefield")!=undefined){var G=jQuery.parseJSON($(E).attr("labeldata"));B.push(G)}});if(B.length>0){if(!confirm("更新计划合并后将为第一项值,是否合并?")){return false}var D=[];$.each(B,function(F,E){var G=window["sched"+E.connid+"obj"].submitFun();D.push(G)});if(D.length>0){var C={};var A=$("#showmirror span[mergefield]:first").attr("connid");$.each(B,function(F,E){if(C.sched==undefined){C.sched=[];C.sched.push(E.instanceid)}else{C.sched.push(E.instanceid)}var G=window["sched"+E.connid+"obj"].submitFun();$.each(window.instances,function(H,I){if(I.instanceID==E.instanceid){I.schedparams=G}})});z.push(C)}createPageSchedHtml(z);calcMirrorShowMaxRatio()}mergeBtnDisplay()});$("#splitbtn").bind("click",function(){$("#fieldlabels div[splitfield]").each(function(G,A){var C=$(A).attr("splitfield");if(C!=undefined){var E=$(A).attr("mergedata");if(E!=undefined){var F=jQuery.parseJSON(E);for(var B in F){var D=F[B];$.each(D,function(H,I){$.each(window.instances,function(J,N){if(N.instanceID==I){var Q=getDesHtml(jQuery.parseJSON(N.schedparams.crontime));var P=Math.round(Math.random()*100000);var O="class='labelbox'";var L={instanceid:N.instanceID,schedparams:N.schedparams,connid:P};var M="<span connid='"+P+"' labeldata='"+JSON.stringify(L)+"' "+O+" >定时计划("+Q+")</span>";$("#showmirror div[instanceid="+I+"] span").each(function(S,R){$(R).remove()});$("#showmirror div[instanceid="+I+"]").append(M);var K="<div class='borderhr' connid='"+P+"' id='schedule"+P+"' incid='"+N.instanceID+"' ><fieldset><legend>"+Q+"</legend><div id='updateschedule"+P+"'></div></fieldset></div>";$("#fieldlabels").append(K);window["sched"+P+"obj"]=new myUpdateSchedule(undefined,N.schedparams,"updateschedule"+P+"")}})})}$(A).remove()}}});splitBtnDisplay()});$("#editdiv").dialog("option","buttons",{"确定":function(){changePage(1);var B=[];$("#fieldlabels div[mergedata]").each(function(F,C){var D=$(C).attr("mergedata");if(D!=undefined){var E=jQuery.parseJSON(D);B.push(E)}});if(B.length==0){B=null}window.currMergeSched=B;var A=0;$("#fieldlabels div[connid]").each(function(E,C){var G=$(C).attr("connid");var F=$(C).attr("mergedata");if(F!=undefined){var H=jQuery.parseJSON(F);$.each(H.sched,function(J,I){$.each(window.instances,function(K,L){if(I==L.instanceID){var M=window["sched"+G+"obj"].submitFun();if(M){window.instances[K].schedparams=M;window.instances[K].preUpdate();changePage(3)}else{A++}return false}});if(A>0){return false}})}else{var D=$(C).attr("incid");$.each(window.instances,function(I,J){if(J.instanceID==D){var K=window["sched"+G+"obj"].submitFun();if(K){window.instances[I].schedparams=K;window.instances[I].preUpdate();changePage(3)}else{A++}return false}})}});if(A==0){$(this).dialog("close")}},"取消":function(){$(this).dialog("close")}});$("#editdiv").dialog({close:function(){$("#editelementdiv").empty();$("#editmodelselectdiv").show();$("#tabdiv").tabs("destroy")}})});$("#editpageparam").unbind("click");$("#editpageparam").bind("click",function(){mirrorModelHtml();var v={};v.modelid={};v.elementid={};$(window.instances).each(function(B,C){if(C.status!=0&&C.instanceType!=2&&C.instanceType!=3){$(C.elements).each(function(E,D){if(v.modelid[D.modelID]==undefined){v.modelid[D.modelID]={};v.modelid[D.modelID].filter=D.dataJson.filter}if(v.elementid[D.elementID]==undefined){v.elementid[D.elementID]={};v.elementid[D.elementID].modelid=D.modelID;v.elementid[D.elementID].classifyquery=deepClone(D.dataJson.classifyquery);v.elementid[D.elementID].contrast=deepClone(D.dataJson.contrast);var F=[];$.each(D.dataJson.filtervalue,function(H,G){if(G.fromlimit==undefined||G.fromlimit==0){if(G.fieldvalue.datatype!="dynamic"){F.push(G)}}});v.elementid[D.elementID].filtervalue=F;v.elementid[D.elementID].filterrelation=deepClone(D.dataJson.filterrelation);v.elementid[D.elementID].facet=deepClone(D.dataJson.facet);v.elementid[D.elementID].output=deepClone(D.dataJson.output);v.elementid[D.elementID].version=D.dataJson.version;v.elementid[D.elementID].isdefaultrelation=D.dataJson.isdefaultrelation;v.elementid[D.elementID].select=deepClone(D.dataJson.select);v.elementid[D.elementID].distinct=deepClone(D.dataJson.distinct)}})}});var A;if(window.currMergedata!=undefined&&window.currMergedata!=null){A=window.currMergedata}else{A=getMergeField(window.currNavid)}if(A){$.each(A,function(C,B){for(var G in B){var F=B[G];for(var E=F.length-1;E>=0;E--){var D=false;for(var H in v.elementid){if(F[E]==H){D=true;break}}if(!D){F.splice(E,1)}}}})}var z=[];if(A){$.each(A,function(D,B){var F={};for(var H in B){if(H=="facetfield"){var E=B[H];var I=[];$.each(E,function(K,L){if(v.elementid[L]!=undefined){var J=v.elementid[L].facet.field;I.push(J)}});var C=hasSameFacetField(I);if(C){F[H]=E}}else{if(H=="facetrange"){var E=B[H];var I=[];$.each(E,function(J,K){if(v.elementid[K]!=undefined){var L=v.elementid[K].facet.range;I.push(L)}});var C=hasSameFacetRange(I);if(C){F[H]=E}}else{var E=B[H];var I=[];var G=false;$.each(E,function(M,N){if(v.elementid[N]!=undefined){var K=getFilter(N,v);var J=getEleFilterValue(H,N,v);var L=[];if(J[0].fieldname=="createdtime"&&J[0].fieldtype=="classifyquery"){G=true;L.push(J[0].fieldvalue.value)}else{L=J}I.push(L)}});if(G){var C=hasSameFacetRange(I)}else{var C=hasSameItem(I)}if(C){F[H]=E}}}}z.push(F)})}createFiltervalueHtml(v,z);calcMirrorShowMaxRatio();$("#fieldlabels div[connid]").die("click");$("#fieldlabels div[connid]").live("click",function(){$("#fieldlabels div[connid]").removeClass().addClass("borderhr");$("#fieldlabels div[connid]").removeAttr("splitfield");$(this).addClass("checkeddiv");$("#showmirror span[connid]").removeClass().addClass("labelbox");var D=$(this).attr("connid");$("#showmirror span[connid="+D+"]").removeClass().addClass("checkedbox");$("#showmirror span[mergeconnid="+D+"]").removeClass().addClass("checkedbox");var C=$("#showmirror").offset();var F=$("#showmirror span[connid="+D+"]").parents("div").first().offset();if(F!=null){$("#showmirror").scrollTop(F.top-$("#showmirror").scrollTop()-C.top)}var B=$("#showmirror span[connid="+D+"]").parents("div").first().attr("id");var E=B.split("mirror_");$("#modelcondition div[id="+E[1]+"]").attr("modified",true);splitBtnDisplay()});$("#showmirror span[connid]").die("click");$("#showmirror span[connid]").live("click",function(){var B=$(this).parents("div").first().attr("id");var H=B.split("mirror_");$("#modelcondition div[id="+H[1]+"]").attr("modified",true);var G=$(this).attr("connid");var E=$(this).attr("mergeconnid");var D=$(this).attr("mergefield");if(D==undefined){$("#showmirror span[connid="+G+"]").removeClass().addClass("checkedbox");var C=jQuery.parseJSON($(this).attr("labeldata"));$("#showmirror span[connid="+G+"]").attr("mergefield",C.fieldname);if(E!=undefined){$("#showmirror span[mergeconnid="+E+"]").removeClass().addClass("checkedbox");$("#showmirror span[mergeconnid="+E+"]").each(function(L,J){var K=jQuery.parseJSON($(J).attr("labeldata"));$(J).attr("mergefield",K.fieldname)});$("#fieldlabels div[connid="+E+"]").removeClass().addClass("checkeddiv")}if(C.fieldname=="facetrange"){$("#fieldlabels div[connid="+G+"]").attr("mergefield",C.facetname)}$("#fieldlabels div[connid="+G+"]").removeClass().addClass("checkeddiv");$("#fieldlabels").scrollTop(0);var F=$("#fieldlabels").offset();var I=$("#fieldlabels div[connid="+G+"]").offset();if(I!=null){$("#fieldlabels").scrollTop(I.top-$("#fieldlabels").scrollTop()-F.top)}}else{$("#showmirror span[connid="+G+"]").removeClass().addClass("labelbox");$("#fieldlabels div[connid="+G+"]").removeClass().addClass("borderhr");$(this).removeClass().addClass("labelbox");$(this).removeAttr("mergefield");if(E!=undefined){$("#showmirror span[mergeconnid="+E+"]").removeClass().addClass("labelbox");$("#showmirror span[mergeconnid="+E+"]").removeAttr("mergefield");$("#fieldlabels div[connid="+E+"]").removeClass().addClass("borderhr")}}mergeBtnDisplay()});$("#fieldlabels div[mergedata]").die("click");$("#fieldlabels div[mergedata]").live("click",function(){var B=$(this).attr("splitfield");if(B==undefined){$(this).removeClass().addClass("checkeddiv");$(this).attr("splitfield","split")}else{$(this).removeClass().addClass("borderhr");$(this).removeAttr("splitfield")}splitBtnDisplay()});var w=[];$("#mergebtn").bind("click",function(){var F=[];var H="";var C="";var M="";var J="";var I="";var B=true;$("#showmirror span[mergefield]").each(function(R,Q){if($(Q).attr("mergefield")!=undefined){var S=jQuery.parseJSON($(Q).attr("labeldata"));S.elementid=$(Q).parents("div").first().attr("elementid");var T=getModelId(S.elementid,v);if(S.fieldtype==undefined){S.fieldtype=$("#fieldlabels div[connid="+$(Q).attr("connid")+"]").attr("fieldtype")}S.connid=$(Q).attr("connid");var P=S.datatype;if(F.length==0){F.push(S);H=P;C=S.fieldname;M=S.fieldtype;I=T;J=S.facetname}else{if(M==S.fieldtype){if(H==P){if(P=="time_dynamic_state"||P=="string"||P=="int"||P=="value_text_object"||P=="blur_value_object"){if(S.fieldname==C){if(C=="source"){if(I=="1"&&(T!="31"&&T!="51")){F.push(S)}else{if((I=="31"||I=="51")&&T!="1"){F.push(S)}}}else{F.push(S)}}else{if(C=="area"||C=="areauser"){if(S.fieldname=="area"||S.fieldname=="areauser"){F.push(S)}else{alert("值含义不同不能合并!");B=false;return false}}else{if(C=="searchword"||C=="keyword"){if(S.fieldname=="searchword"||S.fieldname=="keyword"){F.push(S)}else{alert("值含义不同不能合并!");B=false;return false}}else{if(C=="source"||C=="sourceid"){if(C=="source"){if(I=="1"){if(S.fieldname=="sourceid"&&(T=="31"||T=="51")){F.push(S)}else{alert("值含义不同不能合并!");B=false;return false}}}else{if(C=="sourceid"){if(I=="31"||I=="51"){if(S.fieldname=="source"&&T=="1"){F.push(S)}else{alert("值含义不同不能合并!");B=false;return false}}}}}else{alert("值含义不同不能合并!");B=false;return false}}}}}else{if(P=="facetfield"||P=="facetrange"){if(J!=S.facetname){alert("值含义不同不能合并!");B=false;return false}else{F.push(S)}}else{F.push(S)}}}else{alert("数据类型不同不能合并!");B=false;return false}}else{alert("查询不同不能合并!");B=false;return false}}}});if(F.length>1&&B){var E=[];var N=[];var O=[];$.each(F,function(X,W){if(W.fieldname=="facetrange"){var Y=getModelId(W.elementid,v);var P=getFilter(W.elementid,v);var U=getEleParams("fieldlabels",W.connid,Y,W.fieldname,P,W.facetname);if(U){createRetEleValue(v,U,W.elementid,W.fieldname)}var Q=v.elementid[W.elementid].facet;if(Q.range!=undefined){var aa=Q.range;N.push(aa)}}else{if(W.fieldname=="facetfield"){var Y=getModelId(W.elementid,v);var P=getFilter(W.elementid,v);var U=getEleParams("fieldlabels",W.connid,Y,W.fieldname,P,W.facetname);if(U){createRetEleValue(v,U,W.elementid,W.fieldname)}var Q=v.elementid[W.elementid].facet;if(Q.field!=undefined){var R=Q.field;O.push(R)}}else{var Y=getModelId(W.elementid,v);var P=getFilter(W.elementid,v);var T=W.fieldname;var V;if(W.datatype=="classifyrange"){T="facetrange";V="created_at"}var U=getEleParams("fieldlabels",W.connid,Y,T,P,V);if(U){if(W.datatype=="classifyrange"){U.fieldtype="classifyquery";var Z=[];var S={};S.datatype="classifyrange";S.value=U.retVal;Z.push(S);U.retVal=[];U.retVal.push(createFiltervalue(W.fieldname,"array",Z))}createRetEleValue(v,U,W.elementid,W.fieldname)}var ab=getEleFilterValue(W.fieldname,W.elementid,v);E.push(ab)}}});if(E.length>0){var K=hasSameItem(E);if(!K){if(!confirm("字段值不同,是否合并?")){return false}}E=mergeValueBytype(H,E);var L=[];$.each(E,function(P,Q){if(Q.fieldtype=="classifyquery"||Q.fieldtype=="allclassifyquery"||Q.fieldtype=="featureclassifyquery"){if(L[0]==undefined){L[0]={};L[0].fieldname=Q.fieldname;L[0].fieldtype=Q.fieldtype;L[0].fieldvalue={};L[0].fieldvalue.datatype="array";L[0].fieldvalue.value=[];L[0].fieldvalue.value.push(Q.fieldvalue)}else{L[0].fieldvalue.value.push(Q.fieldvalue)}}else{L.push(Q)}});var G={};$.each(F,function(R,Q){if(G[Q.fieldname]==undefined){G[Q.fieldname]=[];G[Q.fieldname].push(Q.elementid)}else{G[Q.fieldname].push(Q.elementid)}var P={};P.fieldtype=Q.fieldtype;P.retVal=deepClone(L);createRetEleValue(v,P,Q.elementid,Q.fieldname)});w.push(G)}else{if(N.length>0){var G={};var D=$("#showmirror span[mergefield]:first").parents("div").first().attr("elementid");$.each(F,function(Q,P){if(G[P.fieldname]==undefined){G[P.fieldname]=[];G[P.fieldname].push(P.elementid)}else{G[P.fieldname].push(P.elementid)}v.elementid[P.elementid].facet.range[0].name=v.elementid[D].facet.range[0].name;v.elementid[P.elementid].facet.range[0].rangeinfo=v.elementid[D].facet.range[0].rangeinfo;v.elementid[P.elementid].facet.range[0].sides=v.elementid[D].facet.range[0].sides;v.elementid[P.elementid].facet.range[0].tag=v.elementid[D].facet.range[0].tag});w.push(G)}else{if(O.length>0){O=mergeFieldFilter(O);var G={};$.each(F,function(Q,P){if(G[P.fieldname]==undefined){G[P.fieldname]=[];G[P.fieldname].push(P.elementid)}else{G[P.fieldname].push(P.elementid)}$.each(O,function(S,R){v.elementid[P.elementid].facet.field[0].filter=R[0].filter})});w.push(G)}}}createFiltervalueHtml(v,z.concat(w));calcMirrorShowMaxRatio()}mergeBtnDisplay()});$("#splitbtn").bind("click",function(){$("#fieldlabels div[splitfield]").each(function(H,B){var E=$(B).attr("splitfield");if(E!=undefined){var F=$(B).attr("mergedata");if(F!=undefined){var G=jQuery.parseJSON(F);for(var D in G){var C=G[D];if(D=="facetfield"){$.each(C,function(O,K){if(v.elementid[K]!=undefined){var M=v.elementid[K].facet.field}var L=getFilter(K,v);var J=getDisplayName(M[0].name,L);var I=Math.round(Math.random()*100000);var Q="class='labelbox'";var N={fieldname:"facetfield",datatype:"facetfield",facetname:M[0].name};var P="<span connid='"+I+"' labeldata='"+JSON.stringify(N)+"' "+Q+">包含/去除</span>";$("#showmirror div[elementid="+K+"] span").each(function(S,R){var U=$(this).attr("labeldata");var T=jQuery.parseJSON(U);if(T.fieldname=="facetfield"){$(R).remove()}});$("#showmirror div[elementid="+K+"]").append(P);createFacetFieldHtml("fieldlabels",I,M[0],undefined,undefined,L)})}else{if(D=="facetrange"){$.each(C,function(N,K){var Q=deepClone(v.elementid[K]);var L=getFilter(K,v);Q.filter=L;if(v.elementid[K]!=undefined){var R=v.elementid[K].facet.range}var J=getDisplayName(R[0].name,L);var P="class='labelbox'";var I=Math.round(Math.random()*100000);var M={fieldname:"facetrange",datatype:"facetrange",facetname:R[0].name};var O="<span connid='"+I+"' labeldata='"+JSON.stringify(M)+"' "+P+" >统计字段-"+J+"</span>";$("#showmirror div[elementid="+K+"] span").each(function(T,S){var V=$(this).attr("labeldata");var U=jQuery.parseJSON(V);if(U.fieldname=="facetrange"){$(S).remove()}});$("#showmirror div[elementid="+K+"]").append(O);createFacetRangeHtml("fieldlabels",I,Q,R[0])})}else{$.each(C,function(N,L){var I=Math.round(Math.random()*100000);var S=getModelId(L,v);var K=getFilter(L,v);var T=getEleFilterValue(D,L,v);var J=K[D]["label"];var R=deepClone(v.elementid[L]);R.filter=K;var O=T[0].fieldvalue.datatype;var M={fieldname:D,datatype:O,fieldtype:T[0].fieldtype};var Q="<span class='labelbox' connid='"+I+"' labeldata='"+JSON.stringify(M)+"' >"+J+"</span>";$("#showmirror div[elementid="+L+"] span").each(function(V,U){if($(U).text()==J){$(U).remove()}});$("#showmirror div[elementid="+L+"]").append(Q);if(O=="classifyrange"){var P={};if(T.length>0){P=T[0]["fieldvalue"]["value"]}else{P.name="created_at"}createFacetRangeHtml("fieldlabels",I,R,P,undefined,undefined,false)}else{createFilterFieldHtml("fieldlabels",I,T,S,D,K)}})}}}$(B).remove()}}});splitBtnDisplay()});$("#editdiv").dialog("option","buttons",{"确定":function(){var D=true;$("#fieldlabels div[connid]").each(function(O,N){var L=$(N).attr("connid");var V=$(N).attr("mergedata");if(V!=undefined){var Q=jQuery.parseJSON(V);var S=$(N).attr("mergefield");var K=$(N).attr("fieldtype");for(var R in Q){var F=Q[R];$.each(F,function(Z,W){var ad=getModelId(W,v);var X=getFilter(W,v);var ae=R;if(K=="facetrange"&&R=="createdtime"){ae="facetrange"}var ab=getEleParams("fieldlabels",L,ad,ae,X,S);if(ab){if(K=="facetrange"&&R=="createdtime"){ab.fieldtype="classifyquery";var af=[];var aa={};aa.datatype="classifyrange";aa.value=ab.retVal;af.push(aa);ab.retVal=[];ab.retVal.push(createFiltervalue("createdtime","array",af))}else{if(ab.retVal.length>0){var ac=ab.retVal[0].fieldname;if(ac!=R){var Y={};Y[ac]=F;$(N).attr("mergedata",JSON.stringify(Y))}}}createRetEleValue(v,ab,W,R)}else{D=false;return false}})}}else{var T=$("#showmirror span[connid="+L+"]").parents("div").first().attr("elementid");var P=$("#showmirror span[connid="+L+"]").attr("labeldata");if(P!=undefined){var E=jQuery.parseJSON(P);var U=E.fieldname;if(E.datatype=="classifyrange"){U="facetrange";E.facetname="created_at"}var I=getModelId(T,v);var M=getFilter(T,v);var J=getEleParams("fieldlabels",L,I,U,M,E.facetname);if(J){if(E.datatype=="classifyrange"){J.fieldtype="classifyquery";U="createdtime";var H=[];var G={};G.datatype="classifyrange";G.value=J.retVal;H.push(G);J.retVal=[];J.retVal.push(createFiltervalue(U,"array",H))}createRetEleValue(v,J,T,U)}else{D=false;return false}}}});if(D){changePage(1);var B=[];$("#fieldlabels div[mergedata]").each(function(H,E){var F=$(E).attr("mergedata");if(F!=undefined){var G=jQuery.parseJSON(F);B.push(G)}});if(B.length==0){B=null}window.currMergedata=B;var C=[];$("#modelcondition div[elementid][instanceid]").each(function(F,G){var E=$(G).data("showobj");if(E!=undefined&&E!=null&&$(G).attr("modified")){var I=E.element.elementID;var H=pushDiffItem(C,I);if(v.elementid[I]!=undefined&&H.increased){C=H.itemArr;E.element.dataJson.filterrelation=v.elementid[I].filterrelation;E.element.dataJson.filtervalue=v.elementid[I].filtervalue;E.element.dataJson.contrast=v.elementid[I].contrast;E.element.dataJson.facet=v.elementid[I].facet;E.element.firstrequestData=null;if(E.element.dataJson.filterrelation==null){initFilterRelation(E.element.dataJson)}E.element.show();$.each(window.instances,function(J,K){if(K.instanceID==E.element.instanceID&&K.status==1){K.preUpdate();return false}})}$(G).removeAttr("modified")}});$(this).dialog("close")}},"取消":function(){$(this).dialog("close")}});$("#editdiv").dialog({close:function(){$("#editelementdiv").empty();$("#editmodelselectdiv").show();$("#tabdiv").tabs("destroy")}})});$("#savebtn").unbind("click");$("#savebtn").bind("click",function(){var v=getPageRightHtml();if(v==undefined||v==null||v==""){alert("未获取到页面结构，请新增");return false}var w={};w.delincids=[];w.newinc=[];w.mergeinfo={};w.mergeinfo.mergedata=window.currMergedata;w.mergeinfo.mergesched=window.currMergeSched;w.mergeinfo.navid=window.currNavid;$(window.instances).each(function(A,C){if(C.status==1){return true}if(C.status==0&&C.instanceID!=0){w.delincids.push(C.instanceID)}else{var B={instanceid:C.instanceID,navid:C.navID,instancetype:C.instanceType,title:C.title};if(C.xcombined){B.xcombined=C.xcombined}if(C.xzreverse){B.xzreverse=C.xzreverse}if(C.columnstacking){B.columnstacking=C.columnstacking}if(C.schedparams){B.schedparams=C.schedparams}B.elements=[];var z="";$(C.elements).each(function(G,F){var E={};E.instanceid=F.instanceID;E.elementid=F.elementID;E.modelid=F.modelID;E.type=F.elementType;E.content=F.dataJson;E.title=F.elementName;if(F.subInstanceType){E.subInstanceType=F.subInstanceType}if(F.overlayindex){E.overlayindex=F.overlayindex}if(F.modelname){E.modelname=F.modelname}if(F.referencedata){E.referencedata=F.referencedata}if(F.secondaryyaxis){E.secondaryyaxis=F.secondaryyaxis}$("div[instanceid="+F.instanceID+"][elementid="+F.elementID+"]").each(function(H,J){if($(J).attr("instanceid")){var L=$(J).attr("elementid");var I=getShowTitleCom(J);var M=$(J).attr("title");if((I==undefined||I=="")&&(M!=undefined&&M!="")){I=M}if(I!=""){var K=$(J).attr("showid");return false}}});E.content.showtitle=z;if(F.showIDArr){E.content.showid=F.showIDArr}if(F.displayContent){E.content.displayContent=F.displayContent}if(F.scatterXY){E.content.scatterXY=F.scatterXY}if(F.maptype){E.content.maptype=F.maptype}if(F.linetype){E.content.linetype=F.linetype}if(F.referencedataratio){E.referencedataratio=F.referencedataratio}E.snapshot=null;E.issavesnapshot=F.issnap;if(F.elementType==2&&F.issnap&&F.firstrequestData){for(var D=0;D<F.firstrequestData[0].datalist.length;D++){formatSnapshotData(F.firstrequestData[0].datalist[D].showdata);formatSnapshotData(F.firstrequestData[0].datalist[D].showdata2)}E.snapshot=F.firstrequestData}B.elements.push(E)});B.pinrelation=C.pinRelation;w.newinc.push(B)}});showFullScreenWait();$("#editlayer").hide();if(w.delincids.length>0||w.newinc.length>0){$.ajax({url:config.saveInstanceUrl,type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(w),success:function(C){if(C&&C.result==1){if(C.mergedata!=undefined&&C.mergedata.length>0){window.currMergedata=C.mergedata}for(var B=window.instances.length-1;B>-1;B--){if(window.instances[B].status==0){window.instances.splice(B,1)}else{if(window.instances[B].status!=1){for(var A=C.data.length-1;A>-1;A--){var z=C.data[A];if(z.oldinstanceid==window.instances[B].instanceID){window.instances[B].instanceID=z.newinstanceid;$(window.instances[B].elements).each(function(E,D){D.instanceID=z.newinstanceid;if(D.outputPin&&D.outputPin.length>0){$.each(D.outputPin,function(G,F){$.each(z.elements,function(H,I){if(I.oldid==F.outelementid){F.outelementid=I.newid}if(I.oldid==F.inelementid){F.inelementid=I.newid}});if(z.oldinstanceid==F.instanceid){F.instanceid=z.newinstanceid}})}if(D.inputPin&&D.inputPin.length>0){$.each(D.inputPin,function(G,F){$.each(z.elements,function(H,I){if(I.oldid==F.outelementid){F.outelementid=I.newid}if(I.oldid==F.inelementid){F.inelementid=I.newid}});if(z.oldinstanceid==F.instanceid){F.instanceid=z.newinstanceid}})}$(z.elements).each(function(G,H){if(D.dataJson.filtervalue.length>0){$.each(D.dataJson.filtervalue,function(J,I){if(I.fieldvalue.datatype=="dynamic"){if(I.fieldvalue.outelementid==H.oldid){I.fieldvalue.outelementid=H.newid}}})}if(H.oldid==D.elementID){D.elementID=H.newid;if(D.elementType==2){var F=$("div[instanceid="+z.oldinstanceid+"][elementid="+H.oldid+"]");if(F.length>0){F.attr("instanceid",z.newinstanceid);F.attr("elementid",H.newid)}}if(window.instances[B].pinRelation&&window.instances[B].pinRelation.length>0){$(window.instances[B].pinRelation).each(function(I,J){J.instanceid=window.instances[B].instanceID;if(J.inelementid==H.oldid){J.inelementid=D.elementID}if(J.outelementid==H.oldid){J.outelementid=D.elementID}})}return false}})});C.data.splice(A,1);break}}window.instances[B].completeEdit()}}}savePage();hideFullScreenWait()}else{hideFullScreenWait();alert("保存失败");$("#editlayer").show()}},error:function(){hideFullScreenWait();alert("操作异常");$("#editlayer").show()}})}else{savePage();hideFullScreenWait()}});$("#copypage").unbind("click");$("#copypage").bind("click",function(){if(Global.Clipboard.copy($("#modelcondition"))){if(window.currMergedata!=null){Global.Clipboard.mergefield=window.currMergedata}else{Global.Clipboard.mergefield=getMergeField(window.currNavid)}if(window.currMergeSched!=null){Global.Clipboard.mergesched=window.currMergeSched}else{Global.Clipboard.mergesched=getMergeSched(window.currNavid)}$("#pastebtn").show()}else{alert("复制失败")}});$("#copypageto").unbind("click");$("#copypageto").bind("click",function(){if(Global.Clipboard.copy($("#modelcondition"))){var A={};if(window.currMergedata!=null){A.mergefield=window.currMergedata}else{A.mergefield=getMergeField(window.currNavid)}if(window.currMergeSched!=null){A.mergesched=window.currMergeSched}else{A.mergesched=getMergeSched(window.currNavid)}A.hasdata=Global.Clipboard.hasdata;A.copyData=Global.Clipboard.copyData;A.copyHtml=Global.Clipboard.copyHtml;try{var w=JSON.stringify(A)}catch(z){var w=JSON.stringifyOnce(A)}var v=new Base64();var B=v.encode(w);copyModel(B)}else{alert("复制失败")}});$("#copyelementbtn").unbind("click");$("#copyelementbtn").bind("click",function(v){var w=$(this).parent().parent().data("targetele");if(Global.Clipboard.copy(w)){$("#pastebtn").show()}else{alert("复制失败")}});$("#copyelementbtnto").unbind("click");$("#copyelementbtnto").bind("click",function(z){var D=$(this).parent().parent().data("targetele");if(Global.Clipboard.copy(D)){var B={};B.hasdata=Global.Clipboard.hasdata;B.copyData=Global.Clipboard.copyData;B.copyHtml=Global.Clipboard.copyHtml;try{var w=JSON.stringify(B)}catch(A){var w=JSON.stringifyOnce(B)}var v=new Base64();var C=v.encode(w);copyModel(C)}else{alert("复制失败")}});$("#editelementbtn").die("click");$("#editelementbtn").live("click",function(A){window.datafromtype=2;if(A.target!=this){return false}if($($(this).parent().attr("targetselector")).attr("isgroup")=="1"){}else{var v=null;var w=parseInt($(this).parent().parent().attr("edit_instanceid"),10);var B=parseInt($(this).parent().parent().attr("edit_elementid"),10);var C=$(this).parent().parent().attr("targetselector");$(window.instances).each(function(D,E){if(E.instanceID==w){$(E.elements).each(function(G,F){if(F.elementID==B){$(F.allshow).each(function(H,I){if(I.targetID==C){v=I;return false}});return false}});return false}});if(v!=undefined&&v!=null){var w=v.element.instanceID;$(window.instances).each(function(D,E){if(E.instanceID==w){window.currInstance=E;return false}});if(window.currInstance.instanceType==1){$("#editdiv").dialog("open");var z=window.currInstance.elements[0].modelID;z=z==undefined?0:z;createModelSelect("#editmodelselectdiv",window.currTypeID,z,window.currChannelID,window.currInstance.instanceType);window.currInstance.edit("#editelementdiv")}else{if(window.currInstance.instanceType==3){window.currInstance.edit("#overlaydiv")}else{window.currInstance.edit("#linkagediv")}}}}});$("#delinstancebtn").unbind("click");$("#delinstancebtn").bind("click",function(A){if(A.target!=this){return false}if(confirm("确定要删除全部吗？")){changePage(4);var z=$($(this).parent().parent().attr("targetselector"));if(z.attr("isgroup")=="1"){z.children("div[elementid]").each(function(){removeElementShow(this)});z.remove()}else{var v=$(this).parent().parent().data("showobj");if(v!=undefined&&v!=null){var w=v.element.instanceID;$(window.instances).each(function(B,C){if(C.instanceID==w){if(w>0){C.preDelete()}else{window.instances.splice(B,1)}return false}});$("div[instanceid="+w+"]").remove()}}$("#editelementlayer").hide()}});$("#delelementbtn").unbind("click");$("#delelementbtn").bind("click",function(z){if(z.target!=this){return false}changePage(4);var v=$($(this).parent().parent().attr("targetselector"));if(v.attr("isgroup")=="1"){moveOutGroup(v.children("div"));v.remove();var w=v.attr("id");$("#"+w+"remarkcontent").remove();$("#"+w+"remarkimg").parent().remove()}else{removeElementShow(v)}$("#editelementlayer").hide()});$("#editdefaultsize").unbind("click");$("#editdefaultsize").bind("click",function(z){if(z.target!=this){return false}changePage(4);var w=$(this).parent().parent().data("showobj");if(w!=undefined&&w!=null){defaultShowSize(w);var v=$(this).parent().parent().data("targetele");if(v!=undefined&&v!=null){if($(v).parent().attr("isgroup")=="1"){checkGroupWidth($(v).parent())}changeEditLayerPosition(v)}}});if(config.allowwidget){$("#exportwidgetbtn").parent().show();$("#exportwidgetbtn").unbind("click");$("#exportwidgetbtn").bind("click",function(w){if(w.target!=this){return false}var v=$(this).parent().parent().data("showobj");if(v!=undefined&&v!=null){v.exportWidget()}})}}function copyModel(f){var b="copywidgetdiv";var c="copywidgetcode";var e="copywidgetcopy";var a=$("#"+b);a.remove();if($("#"+b).length==0){$("body").append('<div id="'+b+'"></div>');a=$("#"+b);var d='<table style="width:97%;padding:5px;">';d+="<tr>";d+='<td width="10%" align="right">代码：</td>';d+='<td align="left"><textarea id="'+c+'" rows=5 style="background-color:#FFFFFF;border:1px solid #B3CFE7;width:415px;height:350px;"></textarea></td>';d+="</tr>";if(f){d+='<tr><td></td><td><input type="button" value="复制" id="'+e+'"/>&nbsp;&nbsp;<input type="button" value="取消" id="canclecopy" /></td></tr>'}else{d+='<tr><td></td><td><input type="button" value="粘贴" id="pastemodel" />&nbsp;&nbsp;<input type="button" value="取消" id="canclecopy" /></td></tr>'}d+="</table>";a.append(d);a.dialog({title:"复制模型",width:530,height:480,autoOpen:false,modal:true,resizable:false,close:function(){$("#"+c).val("")}})}$("#canclecopy").unbind("click");$("#canclecopy").bind("click",function(){$("#"+c).val("");a.dialog("close")});$("#"+e).unbind("click");$("#"+e).bind("click",function(){if(window.clipboardData){var g=window.clipboardData.setData("Text",$("#"+c).val());if(g){alert("复制成功!")}}else{alert("您使用的浏览器不支持此复制功能，请使用Ctrl+C或鼠标右键。");$("#"+c).focus();$("#"+c).select()}});$("#pastemodel").unbind("click");$("#pastemodel").bind("click",function(){var j=$("#"+c).val();var g=new Base64();var i=g.decode(j);var h=jQuery.parseJSON(i);if(h.mergefield){Global.Clipboard.mergefield=h.mergefield}if(h.mergesched){Global.Clipboard.mergesched=h.mergesched}if(h.hasdata){Global.Clipboard.hasdata=h.hasdata}if(h.copyData){Global.Clipboard.copyData=h.copyData}if(h.copyHtml){Global.Clipboard.copyHtml=h.copyHtml}Global.Clipboard.paste();a.dialog("close");a.remove()});a.dialog({open:function(){if(f){$("#"+c).val(f)}}});a.dialog("open")}function setMultiPageEdit(a){createEditTools(1);$("div[instanceid][elementid]").each(function(c,d){var b=$(this).data("showobj");if(b==undefined||b==null){return true}b.onEdit();bindMouseEvent(d)});$("div[isgroup]").each(function(b,c){if(window.maxgroupid==undefined){window.maxgroupid=1}window.maxgroupid++;bindMouseEvent(c)});$("div[isdescribe]").each(function(c,b){if(window.maxdescribeid==undefined){window.maxdescribeid=1}window.maxdescribeid++;bindMouseEvent(b)})}function moveOutGroup(b){$(b).each(function(c,d){$(d).css("width",$(d).width()+"px")});$(b).appendTo(b.parent().parent());if($(b).attr("isgroup")!="1"){$(b).removeClass("childnr").addClass("nr")}var a=$(b).data("showobj");if(a!=undefined&&a!=null&&a.onDrag){a.onDrag()}changeWidthHeigh(b)}function computePartSize(b){if(b.setSize!=undefined){var c=chartHeightPercent(b.parent.targetID);var a={height:c};b.setSize(a)}}function defaultShowSize(a){if(a.defaultSize!=undefined){a.defaultSize()}else{$(a.targetID).css("width",a.width).attr("aspectratio",a.aspectratio);setShowHeigh(a);a.onResize()}a.onCancelEdit();setMenuHeight()}function chartHeightPercent(b){var d;var c=0;var a=$(b).height();if($(b).children("h1").length>0){c+=$(b).children("h1").outerHeight(true)}if($(b).children("div[id^=timetab]").length>0){c+=$(b).children("div[id^=timetab]").outerHeight(true)}if($(b).children("div[id$=remarkcontent]").length>0&&$(b).children("div[id$=remarkcontent]").css("display")!="none"){c+=$(b).children("div[id$=remarkcontent]").outerHeight(true)}if($(b).children(".pages").length>0){c+=$(b).children(".pages").outerHeight(true)}if($(b).children(".tag").length>0){c+=$(b).children(".tag").outerHeight(true)}var d=(1-c/a)*100;d=d.toString()+"%";return d}function checkGroupWidth(a){var b=0;$(a).children("div").each(function(c,e){var d=$(e).width()/0.97;if(d>b){b=d}});if($(a).width()<b){$(a).width(b)}}function removeElementShow(g){var c=parseInt($(g).attr("instanceid"),10);var b=parseInt($(g).attr("elementid"),10);var e=$(g).attr("showid");var f=$(g).attr("id");if($("div[instanceid="+c+"][elementid="+b+"]").length==1){$("div[instanceid="+c+"][elementid="+b+"]").remove();if($("div[instanceid="+c+"]").length==0){var d=config.phpUrl+"modelinterface.php?type=getsnapshothistorybyincid&incid="+c+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:d,async:false,beforeSend:function(){},success:function(h){if(h.result==1){if(h.totalcount>0){alert("保存后此模型的"+h.totalcount+"个历史快照将被删除!")}}},complete:function(){},error:function(){}});$(window.instances).each(function(h,j){if(j.instanceID==c){if(c>0){j.preDelete()}else{window.instances.splice(h,1)}return false}})}else{$(window.instances).each(function(h,j){if(j.instanceID==c){$(j.elements).each(function(l,k){if(k.elementID==b){j.elements.splice(l,1);for(var i=j.pinRelation.length-1;i>-1;i--){if(j.pinRelation[i].outelementid==b||j.pinRelation[i].inelementid==b){j.pinRelation.splice(i,1)}}j.preUpdate();return false}});return false}})}}else{$("#"+f).remove();$(window.instances).each(function(h,i){if(i.instanceID==c){$(i.elements).each(function(k,j){if(j.elementID==b){$(j.allshow).each(function(l,m){if(m.id==f){j.allshow.splice(l,1);return false}});j.showIDArr.length=0;$(j.allshow).each(function(l,m){j.showIDArr.push(m.showid)});i.preUpdate();return false}});return false}})}var a=$(g).data("showobj");if(a!=undefined&&a!=null&&a.part4!=undefined&&a.part4!=null&&a.part4.jschart!=undefined&&a.part4.jschart!=null){a.destroy()}setMenuHeight()}function checkTitleSpaceWidth(d){var g=d.children("h1");var f=g.width();var a=0;if(g.length>0){var b=0;var h="tmpspan"+d.attr("id");$("body").append("<div id='"+h+"' style='position:absolute;top:-1000px;' class='nr'><h1>"+g.html()+"</h1></div>");var e=0;var i=d.children("h1").children("input");if(i.length>0){var c=i.outerWidth(true);e=c}else{if(d.attr("show_title")!=undefined&&d.attr("show_title")!=""){var j=getShowTitleCom(d);$("#"+h).append("<h1><span id='tmptitle'>"+j+"</span></h1>");e=$("#"+h).children("h1").children("#tmptitle").width();$("#"+h).children("h1").children("#tmptitle").parent().remove()}}$("#"+h).children("h1").children("span").each(function(l,k){if($(k).css("display")==undefined||($(k).css("display")!=undefined&&$(k).css("display")!="none")){b+=$(k).outerWidth(true)}});$("#"+h).remove();a=f-e-b}return a}function toggleDockFields(c,b){var f=c.children("h1");if(f.length>0){if(b>0){var e=0;f.children("span").each(function(h,g){if($(g).css("display")!=undefined&&$(g).css("display")=="none"){e+=$(g).outerWidth(true);if(e<b){$(g).css("display","")}else{return false}}})}else{var e=0;var a=f.children("span");for(var d=a.length-1;d>=0;d--){if($(a[d]).css("display")==undefined||($(a[d]).css("display")!=undefined&&$(a[d]).css("display")!="none")){$(a[d]).css("display","none");e+=$(a[d]).outerWidth(true);if(e>(-b)){return false}}}}}}function bindMouseEvent(a){if(window.currEditStatus){var e=$(a).children("h1");if(e.length>0){var d=getShowTitleCom(a);d=d?d:"";var c="";e.children("span").each(function(g,f){c+=$(f).outerHTML()});if(c==undefined||c==null||c.length==0){c=""}e.html(c+"<input type='text' value='"+d+"' maxlength='100' />");var b=checkTitleSpaceWidth($(a));toggleDockFields($(a),b);e.find("input").bind("blur",function(){setShowTitleCom(a,$(this).val())})}$(a).unbind("mouseover");$(a).bind("mouseover",function(g){if(window.resizing||window.draging){return false}if($(this).attr("editstatus")=="editchild"&&$(this).attr("isgroup")=="1"&&$(this).children("div").length>0){return true}createUpdateSchedBtn(this);$("#editelementlayer").show();var f=this;$("#editelementlayer").unbind("mouseout");$("#editelementlayer").bind("mouseout",function(m){if(window.resizing||window.draging){return false}if(m.target!=this){return}var k,j,o,i,n,l;k=m.pageX;j=m.pageY;var h=$(f).offset();n=h.left;l=h.top;o=$(this).outerWidth(true);i=$(this).outerHeight(true);if(k>n&&k<=(n+o)&&j>l&&j<=(l+i)){return false}$(this).hide();hideGroupShade()});changeEditLayer(f);changeMoveGroupButton(f);hideGroupShade()});$(a).unbind("mouseout");$(a).bind("mouseout",function(k){if(window.resizing||window.draging){return false}var i,h,m,g,l,j;i=k.pageX;h=k.pageY;var f=$(this).offset();l=f.left;j=f.top;m=$(this).outerWidth(true);g=$(this).outerHeight(true);if(i>l&&i<=(l+m)&&h>j&&h<=(j+g)){return false}hideGroupShade();$("#editelementlayer").hide()})}else{$(a).bind("mouseover",function(f){var g=$(a).attr("id");$("#"+g+"remarkimg").parent().css("display","")});$(a).bind("mouseout",function(f){var g=$(a).attr("id");$("#"+g+"remarkimg").parent().css("display","none")})}}function changeEditLayerPosition(b){var a,e;var d=0,c=0;if($(b).attr("isgroup")!="1"){d=3;c=-5}else{d=4;c=-5}if($(b).children("h1").length>0){$("#editshowtitle").text("删除标题").attr("opt","del");a=$(b).outerHeight()-$(b).children("h1").outerHeight();e=$(b).position().top+$(b).children("h1").outerHeight()+d}else{$("#editshowtitle").text("新增标题").attr("opt","add");a=$(b).outerHeight();e=$(b).position().top+d}$("#editelementlayer").css({top:e,left:$(b).offset().left+c,width:$(b).width(),height:a})}function deleteTitle(b){$(b).children("h1").remove();var a=$("#editelementlayer").data("showobj");if($(b).attr("isgroup")!="1"){if($(b).parent().attr("isgroup")=="1"){$(b).removeClass("nr").addClass("childnr")}if(a!=undefined&&a!=null){computePartSize(a.part4);setResize(b,a)}}if(a!=undefined&&a!=null){if(a.onResize!=undefined){a.onResize()}}}function addTitle(b,d){if($(b).children().length==0){$(b).append("<h1></h1>")}else{$(b).children(":first").before("<h1></h1>")}var c="#editelementlayer";if(d!=undefined){c=$("#"+d+"").parent("div[role=dialog]")}var a=$(c).data("showobj");if($(b).attr("isgroup")!="1"){$(b).removeClass("childnr").addClass("nr");if(a!=undefined&&a!=null){computePartSize(a.part4);setResize(b,a,d)}}if(a!=undefined&&a!=null){if(a.onResize!=undefined){a.onResize()}}}function changeEditLayer(b){changeEditLayerPosition(b);var c;if($(b).attr("isgroup")=="1"){if($(b).parent().attr("isgroup")=="1"){$("#editparentgroup").parent().show()}else{$("#editparentgroup").parent().hide()}c="#"+$(b).attr("id");$("#editchildshow").text("编辑组内  |");$("#editchildshow").attr("opt","editchild")}else{$("#editparentgroup").parent().hide();if($(b).parent().attr("isgroup")=="1"){$("#editchildshow").text("编辑分组  |")}else{$("#editchildshow").text("")}$("#editchildshow").attr("opt","editgroup");c="#"+$(b).attr("id")}if($(b).attr("isgroup")=="1"||$(b).attr("isdescribe")=="1"){if($(b).attr("isdescribe")=="1"){$("#delinstancebtn").parent().hide()}$("#editdefaultsize").parent().hide()}else{$("#delinstancebtn").parent().show();$("#editdefaultsize").parent().show()}$("#editelementlayer").attr("targetselector",c);$("#editelementlayer").attr("edit_instanceid",$(b).attr("instanceid"));$("#editelementlayer").attr("edit_elementid",$(b).attr("elementid"));$("#editremark").unbind("click");$("#editremark").bind("click",function(){if($("#remarkbox").length==0){$("<div id='remarkbox' title='编辑备注'><div id='ckeditorfield'></div></div>").insertAfter("body");$("#remarkbox").dialog({autoOpen:false,modal:true,resizable:false,width:$(b).width()+28,close:function(){if(CKEDITOR!=undefined&&CKEDITOR.instances.ckeditorfield!=undefined){CKEDITOR.instances={}}$("#remarkbox").remove()}})}var e=$(b).width();if(CKEDITOR.instances.ckeditorfield==undefined){var f=CKEDITOR.replace("ckeditorfield",{width:e})}var d=$(b).data("showobj");if(d!=undefined&&d!=null){CKEDITOR.instances.ckeditorfield.setData(d.getRemark())}$("#remarkbox").dialog("open");$("#remarkbox").dialog("option","buttons",{"确定":function(){var g=CKEDITOR.instances.ckeditorfield.getData();if(g!=""){d.setRemark(g);if(d.partRemark==undefined){d.createRemark()}else{d.partRemark.remarkContentDiv()}$(this).dialog("close")}},"取消":function(){$(this).dialog("close")}})});$("#deleteremark").unbind("click");$("#deleteremark").bind("click",function(){var d=$(b).data("showobj");if(d!=undefined&&d!=null){d.setRemark("");if(d.partRemark!=undefined){d.partRemark.removeRemarkDiv()}}});$("#editshowtitle").unbind("click");$("#editshowtitle").bind("click",function(e){if(e.target!=this){return false}changePage(4);var d;if($(this).attr("opt")=="del"){setShowTitleCom(b,"");if($(b).children("h1").children("span").length==0){deleteTitle(b)}else{if($(b).children("h1").find("input").length>0){$(b).children("h1").children("input").val("")}}$(this).text("新增标题").attr("opt","add")}else{addTitle(b);var h=$(b).children("h1");if(h.length>0){var g=h.width()/2;h.html("<input type='text' style='width:"+g+"' value='' maxlength='100' />");var f=checkTitleSpaceWidth($(b));toggleDockFields($(b),f);h.children("input").bind("blur",function(){setShowTitleCom(b,$(this).val())})}$(this).text("删除标题").attr("opt","del")}changeEditLayerPosition(b);if(d!=undefined&&d!=null){if(d.onResize!=undefined){d.onResize()}}});$("#editchildshow").unbind("click");$("#editchildshow").bind("click",function(d){$("#editdefaultsize").parent().hide();if($(b).attr("isgroup")=="1"){$(b).attr("editstatus",$(this).attr("opt"));$("#editelementlayer").hide()}else{if($(b).parent().attr("isgroup")=="1"){$(b).parent().attr("editstatus",$(this).attr("opt"));$("#editelementlayer").hide()}}});$("#editparentgroup").unbind("click");$("#editparentgroup").bind("click",function(d){if($(b).attr("isgroup")=="1"&&$(b).parent().attr("isgroup")=="1"){$(b).attr("editstatus","editgroup");$(b).parent().attr("editstatus","editgroup");$("#editelementlayer").hide()}});if($(b).attr("isdescribe")!=undefined&&$(b).attr("isdescribe")=="1"){var a=$(b).data("showobj");if(a!=undefined&&a!=null){setResize(b,a)}}else{setResize(b)}}function setResize(g,j,e){var b;var a=true;var h=false;var f="#editelementlayer";if(e!=undefined){f=$("#"+e+"").parent("div[role=dialog]")}if($(g).attr("isgroup")=="1"){b=false;$(f).data("targetele",g)}else{if($(g).attr("isdescribe")=="1"){b=g;$(f).data("targetele",g)}else{if(j==undefined||j==null){var i=$(g).attr("instanceid");var d=$(g).attr("elementid");var c=$(g).attr("id");$(window.instances).each(function(k,l){if(l.instanceID==i){$(l.elements).each(function(n,m){if(m.elementID==d){$(m.allshow).each(function(o,p){if(p.id==c){$(f).data("showobj",p);$(f).data("targetele",g);$(g).data("showobj",p);j=p;return false}});return false}});return false}})}if(j.resizable!=undefined&&j.resizable==false){a=false}if(j.equalRatio!=undefined){h=j.equalRatio}if(a){b=g}}}if(a){$(f).resizable("destroy");$(f).resizable({aspectRatio:h,alsoResize:b,start:function(l,m){window.resizing=true;changePage(4);if(e==undefined){var n=m.helper.attr("targetselector");if("1"!=$(n).attr("isgroup")){var k=document.createElement("div");$(k).attr("style",$(n).attr("style"));$(k).css({width:$(n).css("width"),height:$(n).css("height")});$(k).css("display","none");$(k).css("border","1px dashed gray");$(k).attr("class",$(n).attr("class")).attr("id","temp_place");$(n).before(k);$(n).css("left",$(n).position().left+"px");$(n).css("top",$(n).position().top+"px");$(n).css("position","absolute");$(k).css("display","")}}},resize:function(l,m){var n=m.helper.attr("targetselector");var k=m.helper.data("showobj");if(k==undefined){k=$(n).data("showobj")}if(k!=undefined&&k!=null&&k.onResizing!=undefined){k.onResizing()}},stop:function(k,r){$("#temp_place").remove();var u=r.helper.attr("targetselector");$(u).css("position","");if("1"==$(u).attr("isgroup")&&$(u).children("div").length>0){$(u).css({width:r.helper.outerWidth(),height:"auto"});checkGroupWidth(u);$(u).children("div").each(function(w,z){var v=$(z).data("showobj");if(v!=undefined&&v!=null){if(v.part4!=undefined){computePartSize(v.part4)}if(v.onResize!=undefined){v.onResize()}}})}else{if("1"==$(u).attr("isdescribe")){var t=$(u).data("showobj");if(t!=undefined&&t!=null){t.onResize()}}else{var l=$(u).children("table");if(l.length>0&&l[0].tagName.toLowerCase()=="table"&&l.attr("allowresize")!="1"){var o=l.outerHeight(true);var q=$(u).children("h1");if(q.length>0){o+=q.outerHeight(true)}var m=$(u).children(".pages");if(m.length>0){o+=m.outerHeight(true)}if($(u).height()<o){$(u).height(o)}}}}var n=$(u).offset();var s=n.left+$(u).outerWidth(true);var p=$(u).parent().width()*0.97;if(s>$("body").width()||$(u).outerWidth(true)>p){$(u).width(p)}if(e==undefined){changeEditLayerPosition($(u))}else{$(f).css({height:"auto"})}var t=r.helper.data("showobj");if(t!=undefined&&t!=null){if(t.part4!=undefined){computePartSize(t.part4)}if(t.onResize!=undefined){t.onResize()}}window.resizing=false;setMenuHeight();changeWidthHeigh(u)}})}else{$(f).resizable("disable")}}function changeMoveGroupButton(a){$("#chkmovetogroup").attr("checked",false);$(a).removeAttr("movetogroup");if($(a).parent().attr("isgroup")=="1"){$("#chkmovetogroup").css("display","none");$("label[for=chkmovetogroup]").text("移出分组");$("label[for=chkmovetogroup]").unbind("click");$("label[for=chkmovetogroup]").bind("click",function(){changePage(4);$("#chkmovetogroup").attr("checked",false);var b=$(a).parent();moveOutGroup($(a));changeEditLayerPosition(a);$(a).removeAttr("movetogroup");if(b.children("div").length==0){b.css({width:"64%",height:"300px"})}})}else{$("label[for=chkmovetogroup]").unbind("click");$("label[for=chkmovetogroup]").text("移入分组");$("#chkmovetogroup").css("display","")}$("#chkmovetogroup").unbind("click");$("#chkmovetogroup").bind("click",function(b){if($(this).prop("checked")){$(a).attr("movetogroup","1");showGroupShade(this)}else{$(a).removeAttr("movetogroup");hideGroupShade()}})}function showGroupShade(a){$("div[isgroup]").each(function(d,g){if($(g).parents("div[isgroup]").length>0){return true}if($(a).parent().parent().attr("isgroup")=="1"&&$(a).parent().parent().attr("id")==$(g).attr("id")){return true}var c=$(g).css("width");var f=$(g).css("height");var b=$(g).position().left;var e=$(g).position().top;var i=parseInt(f.toString().replace("px",""))/2;$("body").append('<div style="width:'+c+";height:"+f+";left:"+b+"px;top:"+e+'px" class="groupshade"><span style="color:white;line-height:'+f+';">将模型拖入此区域加入分组</span></div>')})}function hideGroupShade(){$(".groupshade").remove()}function getFHHtml(d){var c="";c=$(d).clone().wrap("<div></div>").parent().html();c=c==undefined?"":c;var b=/(<div[^>/]*>).*/i;var a=b.exec(c);if(a){c=a[1]}return c}function getChildHtml(b){var a="";$(b).children().each(function(d,e){if($(e)[0].tagName.toLowerCase()!="div"){return true}var f=$(e).children("h1").children("input");if(f.length>0){setShowTitleCom(e,f.val())}var c=getFHHtml(e);if($(e).attr("isgroup")=="1"||$(e).attr("isdescribe")=="1"){if($(e).attr("isgroup")=="1"){c+=getChildHtml(e)}c+="</div>"}else{if($(e).attr("instanceid")!=undefined){c+="</div>"}else{return true}}a+=c});return a}function getPageRightHtml(){var a=getChildHtml($("#modelcondition"));return a}function mergeBtnDisplay(){var a=$("#showmirror span[mergefield]").length;var b=0;var c;$("#showmirror span[mergefield]").each(function(e,d){currconnid=$(d).attr("connid");if(e==0){c=currconnid}if($(d).attr("mergeconnid")==undefined&&c!=currconnid){b++}});if(a>1&&b>0){$("#mergebtn").css("display","")}else{$("#mergebtn").css("display","none")}}function splitBtnDisplay(){var a=$("#fieldlabels div[splitfield]").length;if(a>0){$("#splitbtn").css("display","")}else{$("#splitbtn").css("display","none")}}function hasSameSched(a){var b=true;$.each(a,function(c,d){if(a[c+1]!=undefined){if(a[c].length>0&&a[c+1].length>0){b=compareSched(a[c],a[c+1]);return b}}});return b}function hasSameFacetField(a){var b=true;$.each(a,function(c,d){if(a[c+1]!=undefined){if(a[c].length>0&&a[c+1].length>0){b=compareFacetField(a[c],a[c+1]);return b}}});return b}function hasSameFacetRange(a){var b=true;$.each(a,function(c,d){if(a[c+1]!=undefined){if(a[c].length>0&&a[c+1].length>0){b=compareFacetRange(a[c],a[c+1]);return b}}});return b}function hasSameItem(a){var b=true;$.each(a,function(c,d){if(a[c+1]!=undefined){if(a[c].length>0&&a[c+1].length>0){b=compareField(a[c],a[c+1]);return b}}});return b}function containSameItem(b,a){var c=false;$.each(b,function(d,e){var f=compareField([e],[a]);if(f){c=true;return false}});return c}function getItemValue(a){var b=[];$.each(a,function(f,e){var d=e.fieldvalue.datatype;var c=e.fieldvalue.value;switch(d){case"string":case"int":b.push(c);break;case"value_text_object":case"blur_value_object":b.push(c.value);break;case"range":case"gaprange":case"time_dynamic_state":case"time_dynamic_range":b={};b=c;break;default:break}});return b}function getModelId(c,a){var b=a.elementid[c];if(b!=undefined){return b.modelid}}function getFilter(d,a){var c=getModelId(d,a);if(c!=undefined){var b=a.modelid[c]["filter"];return b}}function getEleFilterValue(h,c,b){var i=[];var e=b.elementid[c];var d=b.modelid[e.modelid]["filter"];if(e.contrast!=null&&e.contrast.filtervalue.length>0&&e.contrast.filtervalue[0].fieldname==h){var a=getFilterValue(h,e.contrast.filtervalue,d[h].datatype);$.each(a,function(j,k){if(e.contrast.type==2){k.fieldtype="allclassifycontrast"}else{if(e.contrast.type==3){k.fieldtype="featureclassifycontrast"}else{k.fieldtype="classifycontrast"}}i.push(k)})}else{var f=getFilterValue(h,e.filtervalue,d[h].datatype);var g="query";if(e.classifyquery!=null&&h==e.classifyquery.fieldname){if(e.classifyquery.type==2){g="allclassifyquery"}else{if(e.classifyquery.type==3){g="featureclassifyquery"}else{g="classifyquery"}}if(f.length==0){f=getRangeClassifyValue(h,e.filtervalue)}}$.each(f,function(j,k){k.fieldtype=g;i.push(k)})}return i}function compareSched(b,a){var c=true;if(b.status!=a.status){c=false}if(b.cronstart!=a.cronstart){c=false}if(b.cronend!=a.cronend){c=false}if(b.crontime!=a.crontime){c=false}if(b.remarks!=a.remarks){c=false}if(b.history_enable!=a.history_enable){c=false}if(b.history_count&&a.history_count){if(b.history_count!=a.history_count){c=false}}else{c=false}if(b.history_duration&&a.history_duration){if(b.history_duration!=a.history_duration){c=false}}else{c=false}return c}function compareFacetField(g,b){var e=[];var k=[];var d=[];var j=[];var i=true;$.each(g,function(m,l){$.each(l.filter,function(n,o){$.each(o.value,function(p,q){if(o.type=="include"){if(typeof(q)=="string"){e.push(q)}else{e.push(q.value)}}else{if(typeof(q)=="string"){k.push(q)}else{k.push(q.value)}}})})});$.each(b,function(m,l){$.each(l.filter,function(n,o){$.each(o.value,function(p,q){if(o.type=="include"){if(typeof(q)=="string"){d.push(q)}else{d.push(q.value)}}else{if(typeof(q)=="string"){j.push(q)}else{j.push(q.value)}}})})});var h=e.sort().toString();var c=k.sort().toString();var f=d.sort().toString();var a=j.sort().toString();if(h==f&&c==a){i=true}else{i=false}return i}function compareFacetRange(e,a){var f=true;var c=e.length;var d=a.length;if(c==d){for(var b=0;b<c;b++){if(e[b].name!=a[b].name){f=false}if(e[b].sides!=a[b].sides){f=false}if(e[b].rangeinfo!=undefined||a[b].rangeinfo!=undefined){if(e[b].rangeinfo.type!=a[b].rangeinfo.type){f=false}else{if(e[b].rangeinfo.type=="gap"){if(e[b].rangeinfo.value.gap!=a[b].rangeinfo.value.gap){f=false}}else{if(e[b].rangeinfo.type=="gapcount"){if(e[b].rangeinfo.value.gapcount!=a[b].rangeinfo.value.gapcount){f=false}}}if(f){if(e[b].rangeinfo.type!="gaplist"){if(e[b].rangeinfo.value.rangevalue.type!=a[b].rangeinfo.value.rangevalue.type){f=false}else{f=compareRange(e[b].rangeinfo.value.rangevalue.type,e[b].rangeinfo.value.rangevalue.value,a[b].rangeinfo.value.rangevalue.value)}}else{if(e[b].rangeinfo.value.length!=a[b].rangeinfo.value.length){f=false}}}}}else{if(e[b].gapCount!=undefined&&a[b].gapCount!=undefined){if(e[b].gapCount!=a[b].gapCount){f=false}}if(e[b].gap!=undefined&&a[b].gap!=undefined){if(e[b].gap!=a[b].gap){f=false}if(e[b].start!=a[b].start){f=false}if(e[b].end!=a[b].end){f=false}}}if(e[b].tag!=undefined||a[b].tag!=undefined){if(e[b].tag!=undefined&&a[b].tag!=undefined){if(e[b].tag.x!=undefined||a[b].tag.x!=undefined){if(e[b].tag.x!=undefined&&a[b].tag.x!=undefined){if(e[b].tag.x.type!=a[b].tag.x.type){f=false}}else{f=false}}if(e[b].tag.y!=undefined||a[b].tag.y!=undefined){if(e[b].tag.y!=undefined&&a[b].tag.y!=undefined){if(e[b].tag.y.type!=a[b].tag.y.type){f=false}}else{f=false}}}else{f=false}}}}else{f=false}return f}function compareRange(g,e,d){var j=true;switch(g){case"range":var i=e.start;var b=e.end;var h=d.start;var a=d.end;if(i!=h){j=false}if(b!=a){j=false}break;case"gaprange":var i=e.start;var b=e.end;var c=e.gap;var h=d.start;var a=d.end;var f=d.gap;if(i!=h){j=false}if(b!=a){j=false}if(c!=f){j=false}break;case"time_dynamic_state":if(e.start!=d.start){j=false}if(e.startgap!=d.startgap){j=false}if(e.timestate!=d.timestate){j=false}if(e.datestate!=d.datestate){j=false}if(e.end!=undefined&&d.end!=undefined){if(e.end!=d.end){j=false}if(e.endgap!=d.endgap){j=false}}break;case"time_dynamic_range":if(e.start.start!=d.start.start){j=false}if(e.start.startgap!=d.start.startgap){j=false}if(e.start.startthisgap!=d.start.startthisgap){j=false}if(e.start.startto!=d.start.startto){j=false}if(e.start.starttogap!=d.start.starttogap){j=false}if(e.end.end!=d.end.end){j=false}if(e.end.endgap!=d.end.endgap){j=false}if(e.end.endthisgap!=d.end.endthisgap){j=false}if(e.end.endto!=d.end.endto){j=false}if(e.end.endtogap!=d.end.endtogap){j=false}break}return j}function compareField(e,a){var c=getItemValue(e);var h=getItemValue(a);var g=true;switch(e[0].fieldvalue.datatype){case"string":case"int":case"value_text_object":case"blur_value_object":case"array":var d=c.sort().toString();var b=h.sort().toString();if(d!=b){g=false}break;case"range":case"gaprange":case"time_dynamic_state":case"time_dynamic_range":g=compareRange(e[0].fieldvalue.datatype,c,h);break;default:var d=c.sort().toString();var b=h.sort().toString();if(d!=b){g=false}break}return g}function createRetEleValue(b,g,c,h){if(g.fieldtype=="query"){var f=b.elementid[c].filtervalue;var i=b.elementid[c].modelid;if(f.length>0){for(var l=f.length-1;l>-1;l--){var a=f[l];if(a!=undefined&&(a.fieldname=="createdtime"||a.fieldname=="nearlytime"||a.fieldname=="beforetime"||a.fieldname=="untiltime")&&a.fieldname==h){var e=g.retVal.shift();if(e!=undefined){a.fieldname=e.fieldname;a.fieldvalue=e.fieldvalue}else{f.splice(l,1);b.elementid[c].filterrelation=null}}else{if(a.fieldname=="verified"||a.fieldname=="verified_type"){var e=g.retVal;var j=e.length;if(j>0){if(a.fieldname==h){f.splice(l,1);b.elementid[c].filterrelation=null}}}else{if(a.fieldname==h){var e=g.retVal.shift();if(e!=undefined){a.fieldvalue.value=e.fieldvalue.value;a.fieldvalue.datatype=e.fieldvalue.datatype;a.isfeature=e.isfeature;if(h=="topic"){a.fieldvalue.datatype="string"}}else{f.splice(l,1);b.elementid[c].filterrelation=null}}}}}}if(g.retVal.length>0){$.each(g.retVal,function(m,n){if(n.fieldname=="area"||n.fieldname=="areauser"){if(i=="1"){n.fieldname="area";f.push(n)}else{if(i=="31"||i=="51"){n.fieldname="areauser";f.push(n)}}}else{if(n.fieldname=="searchword"||n.fieldname=="keyword"){if(i=="31"){n.fieldname="searchword";f.push(n)}else{if(i=="51"){n.fieldname="keyword";f.push(n)}}}else{if(n.fieldname=="source"||n.fieldname=="sourceid"){if(i=="1"){n.fieldname="source";f.push(n)}else{if(i=="31"||i=="51"){n.fieldname="sourceid";f.push(n)}}}else{f.push(n)}}}});b.elementid[c].filterrelation=null}}else{if(g.fieldtype=="classifyquery"||g.fieldtype=="allclassifyquery"||g.fieldtype=="featureclassifyquery"){var f=b.elementid[c].filtervalue;$.each(f,function(n,m){if(m.fieldname==h){$.each(g.retVal,function(o,p){m.fieldvalue.value=p.fieldvalue.value;m.fieldvalue.datatype=p.fieldvalue.datatype;m.isfeature=p.isfeature})}});if(g.name!=undefined){b.elementid[c].classifyquery.fieldname=g.name}}else{if(g.fieldtype=="classifycontrast"||g.fieldtype=="allclassifycontrast"||g.fieldtype=="featureclassifycontrast"){b.elementid[c].contrast.filtervalue=g.retVal}else{if(g.fieldtype=="facetfield"){var d=b.elementid[c].facet.field;$.each(d,function(n,m){m.filter=g.retVal.filter;m.feature=g.retVal.feature;m.isfeature=g.retVal.isfeature})}else{if(g.fieldtype=="facetrange"){var k=b.elementid[c].facet.range;$.each(k,function(n,m){if(m.gap!=undefined){m.gap=undefined}if(m.gapCount!=undefined){m.gapCount=undefined}m.start=undefined;m.end=undefined;m.rangeinfo=g.retVal.rangeinfo;m.sides=g.retVal.sides;m.tag=g.retVal.tag})}}}}}}function createFilterValueObj(f,b,e,d,c){var a={};a.fieldname=f;a.label=b;a.filtertype=c;a.fieldvalue={};a.fieldvalue.datatype=e;a.fieldvalue.value=d;return a}function mergeFieldFilter(e){var g=[];var c=[];var d=[];var f=[];var b=[];var a=[];$.each(e,function(i,h){$.each(h,function(j,k){if(k.feature!=undefined&&k.feature.length>0){$.each(k.feature,function(m,n){var l=pushDiffItem(a,n.value);if(l.increased){a=l.itemArr;d.push(n)}})}$.each(k.filter,function(l,m){$.each(m.value,function(r,t){var n="";var o="";if(typeof(t)=="string"){n=t;o=t}else{n=t.value;o=t.text}var s={};s.value=n;s.text=o;if(m.type=="include"){var p=pushDiffItem(f,n);if(p.increased){f=p.itemArr;g.push(s)}}else{if(m.type=="exclude"){var q=pushDiffItem(b,n);if(q.increased){b=q.itemArr;c.push(s)}}}})})})});$.each(e,function(i,h){$.each(h,function(k,l){l.feature=[];if(d.length>0){l.feature=d}l.filter=[];if(g.length>0){var j={};j.type="include";j.value=g;l.filter.push(j)}if(c.length>0){var j={};j.type="exclude";j.value=c;l.filter.push(j)}})});return e}function mergeValueBytype(h,f){switch(h){case"range":var e=Number.MAX_VALUE;var b=Number.MIN_VALUE;$.each(f,function(m,l){$.each(l,function(o,p){var n=p.fieldvalue.value;if(n.start<e){e=n.start}if(n.end>b){b=n.end}})});$.each(f,function(m,l){$.each(l,function(o,p){var n=p.fieldvalue.value;n.start=e;n.end=b})});f=f[0];break;case"gaprange":var c=Number.MIN_VALUE;var k=Number.MAX_VALUE;var g;var j;$.each(f,function(m,l){$.each(l,function(o,r){var n=r.fieldvalue.value;var p=strtotime("-"+n.start+" "+n.gap+"");var q=strtotime("-"+n.end+" "+n.gap+"");if(p>c){c=p;g=m}if(q<k){k=q;j=m}})});$.each(f,function(m,l){$.each(l,function(o,u){var n=u.fieldvalue.value;var q=f[g][o].fieldvalue.value;var s=f[j][o].fieldvalue.value;if(q.gap==s.gap){n.start=q.start;n.end=s.end;n.gap=q.gap}else{n.gap="day";var t=new Date();var p=new Date(c*1000);var r=new Date(k*1000);n.start=p.dateDiff("d",t);n.end=r.dateDiff("d",t)}})});f=f[0];break;case"time_dynamic_state":var e=Number.MAX_VALUE;var b=Number.MIN_VALUE;var d;var i;$.each(f,function(m,l){$.each(l,function(o,s){var n=s.fieldvalue.value;var q=strtotime("-"+n.start+" "+n.startgap+"");if(n.end!=undefined){var r=strtotime("-"+n.end+" "+n.endgap+"")}else{var r=strtotime("now")}var p=getStateTime(q,r,n.datestate,n.startgap,n.timestate);if(p.start<e){e=p.start;d=m}if(p.end>b){b=p.end;i=m}})});$.each(f,function(m,l){$.each(l,function(o,r){var n=r.fieldvalue.value;var q=f[d][o].fieldvalue.value;var p=f[i][o].fieldvalue.value;n.start=q.start;n.startgap=q.startgap;if(n.end!=undefined){n.end=p.end;n.endgap=p.endgap}if(q.datestate==p.datestate){n.datestate=q.datestate}else{n.datestate="beginning"}if(q.timestate==p.timestate){n.timestate=q.timestate}else{n.timestate="beginning"}})});f=f[0];break;case"time_dynamic_range":var e=Number.MAX_VALUE;var b=Number.MIN_VALUE;var d;var i;$.each(f,function(m,l){$.each(l,function(o,u){var n=u.fieldvalue.value;var t=n.start;var q=sinceToThis(t.start,t.startgap,t.startthisgap,t.startto,t.starttogap,"beginning");var r=n.end;var s=sinceToThis(r.end,r.endgap,r.endthisgap,r.endto,r.endtogap,"beginning");var p=getStateTime(q,s,"now","","now");if(p.start<e){e=p.start;d=m}if(p.end>b){b=p.end;i=m}})});$.each(f,function(m,l){$.each(l,function(o,p){var n=p.fieldvalue.value;n.start=f[d][o].fieldvalue.value.start;n.end=f[i][o].fieldvalue.value.end})});f=f[0];break;case"classifyrange":f=f[0];break;default:var a=[];$.each(f,function(m,l){$.each(l,function(n,o){if(a.length==0){a.push(o)}else{if(!containSameItem(a,o)){a.push(o)}}})});f=a;break}return f}function pushDiffItem(e,d){var c={};var a=false;if(e.length==0){e.push(d);a=true}else{var b=false;$.each(e,function(f,g){if(g==d){b=true}});if(!b){e.push(d);a=true}}c.increased=a;c.itemArr=e;return c}function mergedhtmlDisplay(c,g){var e="";var f=[];for(var a in c){$.each(c[a],function(h,i){f.push(a);f.push(i)})}var b=f.sort().toString();var d=false;$("#fieldlabels div[mergedata]").each(function(k,j){var l=$(j).attr("mergedata");var o=jQuery.parseJSON(l);var i=[];for(var h in o){$.each(o[h],function(m,p){i.push(h);i.push(p)})}if(b==i.sort().toString()){var n=$(j).attr("connid");e="mergeconnid='"+n+"'";d=true;return false}else{e="mergeconnid='"+g+"'"}});return{exist:d,mergeconnid:e}}function createSnapHistoryHtml(a){$("#fieldlabels").empty();$(window.instances).each(function(b,c){if(c.elements.length>0){$.each(c.elements,function(i,e){if(!e.issnap){return false}$("#showmirror div[elementid="+e.elementID+"] span").remove();var q=false;var j="";if(a!=undefined&&a.length>0){$.each(a,function(r,s){$.each(s.snap,function(u,t){if(t==e.elementID){j=s;q=true;return false}})})}var p=formatTime("yyyy-MM-dd hh:mm:ss",e.updateTime);var d=Math.round(Math.random()*100000);var g={elementid:e.elementID,snapshottime:e.updateTime,connid:d};var n="class='labelbox'";if(q){var o=mergedhtmlDisplay(j,d);mergeconnid=o.mergeconnid;if(mergeconnid==""){mergeconnid="mergeconnid='"+d+"'"}if(!o.exist){var m="<div class='borderhr' connid='"+d+"' id='pagesnapshothist"+d+"' mergedata='"+JSON.stringify(j)+"' ><fieldset><legend>快照时间("+p+")</legend><div id='selectpagesnapshot"+d+"'></div></fieldset></div>";$("#fieldlabels").append(m);var l,h;l=config.controller+"public/part_snapshothistory.js";h="PartSnapshotHistory";var f={};f.type="selectsnapshot";f.elementid=e.elementID;createShowPartByName(l,h,f,function(r){window["snap"+d+"obj"]=r;window["snap"+d+"obj"].render("selectpagesnapshot"+d+"");var s=window["snap"+d+"obj"].prefixid;$("#"+s+"snapshot_hist_selected").attr("code",e.updateTime);$("#"+s+"snapshot_hist_selected").text(p)})}var k="<span connid='"+d+"' labeldata='"+JSON.stringify(g)+"' "+n+" "+mergeconnid+" >快照时间("+p+")</span>"}else{var k="<span connid='"+d+"' labeldata='"+JSON.stringify(g)+"' "+n+" >快照时间("+p+")</span>";var m="<div class='borderhr' connid='"+d+"' id='pagesnapshothist"+d+"'><fieldset><legend>快照时间("+p+")</legend><div id='selectpagesnapshot"+d+"'></div></fieldset></div>";$("#fieldlabels").append(m);var l,h;l=config.controller+"public/part_snapshothistory.js";h="PartSnapshotHistory";var f={};f.type="selectsnapshot";f.elementid=e.elementID;createShowPartByName(l,h,f,function(r){window["snap"+d+"obj"]=r;window["snap"+d+"obj"].render("selectpagesnapshot"+d+"");var s=window["snap"+d+"obj"].prefixid;$("#"+s+"snapshot_hist_selected").attr("code",e.updateTime);$("#"+s+"snapshot_hist_selected").text(p)})}$("#showmirror div[elementid="+e.elementID+"]").append(k)})}})}function createPageSchedHtml(a){$("#fieldlabels").empty();$(window.instances).each(function(b,j){$("#showmirror div[instanceid="+j.instanceID+"] span").remove();if(j.schedparams){var l=false;var e="";if(a!=undefined&&a.length>0){$.each(a,function(m,n){$.each(n.sched,function(p,o){if(o==j.instanceID){e=n;l=true;return false}})})}var k=getDesHtml(jQuery.parseJSON(j.schedparams.crontime));var c=Math.round(Math.random()*100000);var d={instanceid:j.instanceID,schedparams:j.schedparams,connid:c};var h="class='labelbox'";if(l){var i=mergedhtmlDisplay(e,c);mergeconnid=i.mergeconnid;if(mergeconnid==""){mergeconnid="mergeconnid='"+c+"'"}if(!i.exist){var g="<div class='borderhr' connid='"+c+"' id='schedule"+c+"' mergedata='"+JSON.stringify(e)+"' ><fieldset><legend>"+k+"</legend><div id='updateschedule"+c+"'></div></fieldset></div>";$("#fieldlabels").append(g);window["sched"+c+"obj"]=new myUpdateSchedule(undefined,j.schedparams,"updateschedule"+c+"")}var f="<span connid='"+c+"' labeldata='"+JSON.stringify(d)+"' "+h+" "+mergeconnid+" >定时计划("+k+")</span>"}else{var f="<span connid='"+c+"' labeldata='"+JSON.stringify(d)+"' "+h+" >定时计划("+k+")</span>";var g="<div class='borderhr' connid='"+c+"' id='schedule"+c+"' incid='"+j.instanceID+"'><fieldset><legend>"+k+"</legend><div id='updateschedule"+c+"'></div></fieldset></div>";$("#fieldlabels").append(g);window["sched"+c+"obj"]=new myUpdateSchedule(undefined,j.schedparams,"updateschedule"+c+"")}$("#showmirror div[instanceid="+j.instanceID+"]").append(f)}})}function createFiltervalueHtml(f,l){$("#fieldlabels").empty();for(var p in f.elementid){$("#showmirror div[elementid="+p+"] span").remove();var d=getModelId(p,f);var i=getFilter(p,f);for(var r in i){var n=false;var o="";var t;var q="";if(l!=undefined&&l.length>0){$.each(l,function(w,v){for(var z in v){$.each(v[z],function(B,A){if(p==A&&z==r){o=v;n=true;return false}})}})}var g=getEleFilterValue(r,p,f);if(g.length>0){var k=i[r]["label"];var e=deepClone(f.elementid[p]);e.filter=i;var h=Math.round(Math.random()*100000);var c=g[0].fieldvalue.datatype;var m={fieldname:r,datatype:c,fieldtype:g[0].fieldtype};var s="class='labelbox'";if(n){var u=mergedhtmlDisplay(o,h);q=u.mergeconnid;if(q==""){q="mergeconnid='"+h+"'"}var a="<span connid='"+h+"' labeldata='"+JSON.stringify(m)+"' "+s+" "+q+" >"+k+"</span>";if(!u.exist){if(c=="classifyrange"){var j={};if(g.length>0){j=g[0]["fieldvalue"]["value"]}else{j.name="created_at"}createFacetRangeHtml("fieldlabels",h,e,j,o,j.name,false)}else{createFilterFieldHtml("fieldlabels",h,g,d,r,i,o,r)}}}else{if(c=="classifyrange"){var j={};if(g.length>0){j=g[0]["fieldvalue"]["value"]}else{j.name="created_at"}createFacetRangeHtml("fieldlabels",h,e,j,undefined,undefined,false)}else{createFilterFieldHtml("fieldlabels",h,g,d,r,i)}var a="<span connid='"+h+"' labeldata='"+JSON.stringify(m)+"' "+s+" >"+k+"</span>"}$("#showmirror div[elementid="+p+"]").append(a)}}var b=f.elementid[p]["facet"];if(b.field!=undefined&&b.field.length>0){var n=false;var o="";var t;var q="";if(l!=undefined&&l.length>0){$.each(l,function(w,v){for(var z in v){$.each(v[z],function(B,A){if(p==A&&z=="facetfield"){o=v;n=true;return false}})}})}$.each(b.field,function(F,w){var E=w.filter;var D=false;$.each(E,function(G,H){if(H.value.length>0){D=true;return false}});if(w.feature!=undefined){if(w.feature.length>0){D=true}}if(D){var v=Math.round(Math.random()*100000);var z={fieldname:"facetfield",datatype:"facetfield",facetname:w.name};var B="class='labelbox'";if(n){var C=mergedhtmlDisplay(o,v);q=C.mergeconnid;if(q==""){q="mergeconnid='"+v+"'"}var A="<span connid='"+v+"' labeldata='"+JSON.stringify(z)+"' "+B+" "+q+" >包含/去除</span>";if(!C.exist){createFacetFieldHtml("fieldlabels",v,w,o,w.name,i)}}else{var A="<span connid='"+v+"' labeldata='"+JSON.stringify(z)+"' "+B+">包含/去除</span>";createFacetFieldHtml("fieldlabels",v,w,undefined,undefined,i)}$("#showmirror div[elementid="+p+"]").append(A)}})}if(b.range!=undefined&&b.range.length>0){var n=false;var o="";var t;var q="";if(l!=undefined&&l.length>0){$.each(l,function(w,v){for(var z in v){$.each(v[z],function(B,A){if(p==A&&z=="facetrange"){o=v;n=true;return false}})}})}var e=deepClone(f.elementid[p]);e.filter=i;$.each(b.range,function(v,E){var A=getDisplayName(E.name,i);var D=Math.round(Math.random()*100000);var z={fieldname:"facetrange",datatype:"facetrange",facetname:E.name};var C="class='labelbox'";if(n){var w=mergedhtmlDisplay(o,D);q=w.mergeconnid;if(q==""){q="mergeconnid='"+D+"'"}if(!w.exist){createFacetRangeHtml("fieldlabels",D,e,E,o,E.name)}var B="<span connid='"+D+"' labeldata='"+JSON.stringify(z)+"' "+C+" "+q+" >统计字段-"+A+"</span>"}else{var B="<span connid='"+D+"' labeldata='"+JSON.stringify(z)+"' "+C+" >统计字段-"+A+"</span>";createFacetRangeHtml("fieldlabels",D,e,E)}$("#showmirror div[elementid="+p+"]").append(B)})}}}function calcMirrorShowMaxRatio(){var a=0;$("#showmirror div").each(function(e,k){if($(k).attr("style")!=undefined&&$(k).attr("style").toLowerCase().indexOf("auto")==-1){var b=$(k).width();var g=$(k).height();var c=$(k).offset();var h=c.top;var d=$(k).children("span:last").offset();var l=h;var j=0;if(d!=null){l=d.top;j=$(k).children("span:last").outerHeight(true)}else{d=$(k).children("h1").offset();if(d!=null){l=d.top;j=$(k).children("h1").outerHeight(true)}}var i=(l+j)-h;var f=i/g;if(f>a){a=f}}});$("#showmirror div").each(function(c,b){$(b).height(function(f,d){if($(b).attr("style")!=undefined&&$(b).attr("style").toLowerCase().indexOf("auto")==-1){if($(this).attr("isgroup")==1){$(this).css("height","auto")}else{if(d*a<25){$(this).css("height","auto")}else{$(this).css("height",d*a)}}var e=$(this).css("marginTop");var g=$(this).css("marginBottom");if(e!=undefined){$(this).css("marginTop",parseInt(e)*a)}if(g!=undefined){$(this).css("marginBottom",parseInt(g)*a)}}})})}function getMergeSched(b){if(b!=""){var a="";$.ajax({url:config.getmergeschedUrl,type:"post",dataType:"json",async:false,contentType:"application/json",data:JSON.stringify({navid:b}),success:function(c){if(c){a=c}},error:function(){alert("数据请求异常!")}});return a}}function getMergeField(b){if(b!=""){var a="";$.ajax({url:config.getmergedataUrl,type:"post",dataType:"json",async:false,contentType:"application/json",data:JSON.stringify({navid:b}),success:function(c){if(c){a=c}},error:function(){alert("数据请求异常!")}});return a}}function savePage(){var a=getPageRightHtml();if(a!=undefined&&a!=""){$.ajax({url:config.savePageUrl,type:"post",dataType:"json",data:{navid:window.currNavid,htmldata:a},success:function(b){if(b&&b.result==1){alert("保存成功");completeChangePage();clearEditLayer()}else{alert("保存失败");$("#editlayer").show()}},error:function(){alert("操作异常");$("#editlayer").show()}})}else{alert("请先新增模型");$("#editlayer").show()}}function createDockLayer(){createEditTools(2)}function createSnapLayer(){createEditTools(2)}function createEditLayer(){if(window.currPagetype==1){setSinglePageEdit("#modelcondition")}else{window.currEditStatus=true;$("#sys").css("visibility","hidden");setMultiPageEdit("#modelcondition");initDrag("#editelementlayer")}}function refreshOnsitePosition(){$("div[elementid][instanceid]").each(function(){var a=$(this).data("showobj");if(a==undefined||a==null){return true}a.onCancelEdit()})}function refreshOtherBtnPosition(a){$("div[instanceid][elementid]").each(function(d,c){if($(c).attr("elementid")!=a){var b=$(c).data("showobj");if(b!=undefined&&b!=null){b.onCancelEdit()}}});$("div[isgroup]").each(function(d,c){var b=$(c).data("showobj");if(b!=undefined&&b!=null){b.onCancelEdit()}});$("div[isdescribe]").each(function(d,c){var b=$(c).data("showobj");if(b!=undefined&&b!=null){b.onCancelEdit()}})}function clearEditLayer(){$("#editlayer").hide();window.currEditStatus=false;_clearEditLayer()}function _clearEditLayer(){$("#sys").css("visibility","visible");Global.ToolbarType=0;$("#editelementlayer").hide();$("#modelcondition").css("border","0px");$("div[elementid]").unbind("mouseover");$("div[elementid]").unbind("mouseout");$("div[isgroup]").unbind("mouseover");$("div[isgroup]").unbind("mouseout");$("div[isdescribe]").unbind("mouseover");$("div[isdescribe]").unbind("mouseout");hideGroupShade();$("div[elementid][instanceid]").each(function(b,c){var a=$(this).data("showobj");if(a==undefined||a==null){return true}a.onCancelEdit();var f=$(c).children("h1").children("input");if(f.length>0){var g=f.val();if(g==undefined||g==""){g=" "}var e="";$(c).children("h1").children("span").each(function(j,h){e+=$(h).outerHTML()});if(e==undefined||e==null||e.length==0){e=""}$(f).parent().html(e+g)}var d=checkTitleSpaceWidth($(c));toggleDockFields($(c),d);bindMouseEvent(c)});$("div[isgroup]").each(function(b,c){var a=$(this).data("showobj");if(a==undefined||a==null){return true}a.onCancelEdit();var d=$(c).children("h1").children("input");if(d.length>0){var e=d.val();if(e==undefined||e==""){e=" "}$(c).children("h1").text(e)}bindMouseEvent(c)});$("div[isdescribe]").each(function(b,c){var a=$(this).data("showobj");if(a==undefined||a==null){return true}a.onCancelEdit();var d=$(c).children("h1").children("input");if(d.length>0){var e=d.val();if(e==undefined||e==""){e=" "}$(c).children("h1").text(e)}bindMouseEvent(c)});freeDrag("#editelementlayer")}function Overlay(){var a=this;this.isEditWidget=false;this.currEditElement;this.currEditLinkage=false;this.currColumn;this.addColumn=function(e){var c="";if(a.isEditWidget){c='style="display:none;"'}var d;if(e==undefined){if(window.overlaytdindex!=undefined){window.overlaytdindex++}else{window.overlaytdindex=1}d=window.overlaytdindex}else{window.overlaytdindex=e.overlayindex;d=e.overlayindex}var b="";b+='<div>模型简称：<input type="text" name="modelname" id="modelname'+d+'" /></div>';b+='<div><input type="checkbox" name="referencedata" id="referencedata'+d+'" class="outborder" /><label for="referencedata'+d+'">主坐标</label></div>';b+='<div><input type="checkbox" name="secondaryyaxis" id="secondaryyaxis'+d+'" class="outborder" /><label for="secondaryyaxis'+d+'">次坐标</label></div>';b+='<div>相对主坐标比例：<input type="text" name="referencedataratio" id="referencedataratio'+d+'" /></div>';$("#overlaytr").append('<td style="width:450px;height:90%;border:dashed 1px blue" overlaytdindex='+d+">"+b+'<input type="button" value="添加标准模型" '+c+' onclick="javascript:window.overlayobj.addElement(this)">&nbsp;&nbsp;<input type="button" value="添加联动模型" '+c+' onclick="javascript:window.overlayobj.addLinkage(this)">&nbsp;&nbsp;<input type="button" '+c+' value="删除此列" onclick="javascript:window.overlayobj.removeColumn(this)"></td>');if(e!=undefined){if(e.modelname!=undefined){$("#modelname"+d+"").val(e.modelname)}if(e.referencedata){$("#referencedata"+d+"").attr("checked",e.referencedata);$("#referencedataratio"+d+"").attr("disabled","disabled")}if(e.secondaryyaxis){$("#secondaryyaxis"+d+"").attr("checked",e.secondaryyaxis)}if(e.referencedataratio){$("#referencedataratio"+d+"").val(e.referencedataratio);$("#referencedataratio"+d+"").removeAttr("disabled")}if(e.issnap!=undefined){$("#overlaysnap").attr("checked",e.issnap)}$("#overlayxcombined").attr("checked",window.currInstance.xcombined);if(window.currInstance.columnstacking){$("#overlaystackingspan").attr("stackavailable",true);$("#overlaycolumnstacking").attr("checked",window.currInstance.columnstacking);$("#overlaystackingspan").css("display","")}$("#overlayxzreverse").attr("checked",window.currInstance.xzreverse)}$("#overlaytb").css("width",($("#overlaytr td").length*450)+"px");$("#referencedata"+d+"").bind("click",function(f,g){var h=$(this).prop("checked");if(h){$("#secondaryyaxis"+d+"").attr("checked",false);$("input[name=referencedata]").attr("checked",false);$(this).attr("checked",true);$("#referencedataratio"+d+"").val("");$("input[name=referencedataratio]").removeAttr("disabled");$("#referencedataratio"+d+"").attr("disabled","disabled")}else{$("#referencedataratio"+d+"").removeAttr("disabled")}});$("#secondaryyaxis"+d+"").bind("click",function(f,g){var h=$(this).prop("checked");if(h){$("#referencedata"+d+"").attr("checked",false);$("#referencedataratio"+d+"").removeAttr("disabled");$("input[name=secondaryyaxis]").attr("checked",false);$(this).attr("checked",true)}})};this.removeColumn=function(b){if($(b).parent("td").find("div[overlay_elementid]").length>0){alert("请先删除元素");return false}$(b).parent("td").remove();$("#overlaytb").css("width",($("#overlaytr td").length*450)+"px")};this.show=function(d,e){this.isEditWidget=d==true;if(!d){$("#overlaydiv").dialog({width:800,height:600,autoOpen:true,modal:true,title:"叠加分析",close:function(){$("div .overlayelement").die("click");$("#overlayxzreverse").attr("checked",false);$("#overlayxcombined").attr("checked",false);$("#overlaycolumnstacking").attr("checked",false)},open:function(){$("div .overlayelement").live("click",a.editElement)},buttons:{"叠加":function(){var f=window.overlayobj.completeOverlay();if(f===true){$(this).dialog("close")}else{if(typeof f==="string"){alert(f)}}},"取消":function(){$(this).dialog("close")}}})}else{$("#overlaydiv").show();$("#editwidget_canceloverlay").button();$("#editwidget_canceloverlay").bind("click",function(){sendMsgTothirdPartySite("editcancel")});$("#editwidget_saveoverlay").button();$("#editwidget_saveoverlay").bind("click",function(){$("#editwidget_saveoverlay").attr("disabled","disabled");$("#editwidget_saveoverlayinfo").html("正在提交...");var f=a.completeOverlay();if(f===true){window.currInstance.save(function(g){if(g&&g.result){sendMsgTothirdPartySite("editsuccess");$("#editwidget_saveoverlayinfo").html("保存成功")}else{$("#editwidget_saveoverlayinfo").html("保存失败")}$("#editwidget_saveoverlay").removeAttr("disabled")},function(){$("#editwidget_saveoverlayinfo").html("请求发生异常");$("#editwidget_saveoverlay").removeAttr("disabled")})}else{if(typeof f=="string"){$("#editwidget_saveoverlayinfo").html(f)}else{$("#editwidget_saveoverlayinfo").html("")}$("#editwidget_saveoverlay").removeAttr("disabled")}});$("div .overlayelement").live("click",a.editElement)}$("#overlaytr").empty();if(window.currInstance==null){a.addColumn();a.addColumn()}else{if(window.currInstance.elements.length>0){window.currInstance.elements.sort(function(g,f){return parseInt(g.overlayindex,10)-parseInt(f.overlayindex,10)});var c=[];var b=0;$(window.currInstance.elements).each(function(g,h){if(h.elementType==2){var f=getShowid(h.showid);if(f=="column"){b++}}if(!c.inArray(h.overlayindex)){c.push(h.overlayindex);a.addColumn(h);var j="";if(h.subInstanceType==1){j='<div overlay_elementid="'+h.elementID+'" style="width:370px"><div class="overlayelement" ><h1 style="width:100%; margin-top:0px"><a href="javascript:void(0)"><img onclick="javascript:window.overlayobj.delElement(this)" style="float:right;border:0px" src="'+config.imagePath+'del.gif"></a></h1>'+h.elementName+"</div></div>"}else{if(h.subInstanceType==2){j='<div overlay_elementid="linkage" style="width:370px"><div class="overlayelement" ><h1 style="width:100%; margin-top:0px"><a href="javascript:void(0)"><img onclick="javascript:window.overlayobj.delElement(this)" style="float:right;border:0px" src="'+config.imagePath+'del.gif"></a></h1>联动模型</div></div>'}}$("#overlaytr td:last").append(j)}});if(b>1){$("#overlaystackingspan").attr("stackavailable",true);if(window.currInstance.xcombined){$("#overlaystackingspan").css("display","")}}else{$("#overlaystackingspan").removeAttr("stackavailable");$("#overlaystackingspan").css("display","none")}}}};this.setCurrColumn=function(b){a.currColumn=$(b).parents("td");$("#overlaytr td").removeAttr("active");a.currColumn.attr("active",true)};this.addElement=function(b){a.currEditElement=null;a.setCurrColumn(b);if(a.currColumn.find("div[overlay_elementid]").length>0){alert("同一列只能添加一个模型!");return false}$("#editelementdiv").empty();$("#editdiv").dialog("open");createModelSelect("#editmodelselectdiv",window.currTypeID,0,window.currChannelID,3)};this.addLinkage=function(b){a.setCurrColumn(b);if(a.currColumn.find("div[overlay_elementid]").length>0){alert("同一列只能添加一个模型!");return false}if(!window.currInstance){window.currInstance=new Instance(window.currNavid,window.maxInstanceID,3);window.maxInstanceID--}if(window.linkageobj==null){window.linkageobj=new Linkage()}window.linkageobj.show()};this.editElement=function(b){if(b.target!=this){return true}a.setCurrColumn(b.target);var c=$(b.target).parent().attr("overlay_elementid");if(c=="linkage"){a.currEditLinkage=true;if(window.linkageobj==null){window.linkageobj=new Linkage()}window.linkageobj.show()}else{$(window.currInstance.elements).each(function(e,d){if(d.subInstanceType==1){if(d.elementID==c){a.currEditElement=d;$("#editelementdiv").empty();$("#editdiv").dialog("open");if(!a.isEditWidget){createModelSelect("#editmodelselectdiv",window.currTypeID,d.modelID,window.currChannelID,3)}a.currEditElement.editForm("#editelementdiv",a.isEditWidget);return false}}})}};this.completeAddElement=function(l){if(l!=undefined){var g=false;var h=a.currColumn.attr("overlaytdindex");var c=$("#overlaytr td:first").attr("overlaytdindex");var d=$("#overlaytr td:last").attr("overlaytdindex");l.subInstanceType=1;l.overlayindex=h;var k=l.modelConfig.getModelShowType();l.setShowType(k);if(l.showIDArr.length==0){dialogAlert($("#modelshow_div"),"请选择可视化图表!");return false}else{if(window.currInstance.instanceType==3){if(l.showIDArr.length>1){dialogAlert($("#modelshow_div"),"叠加模型,只能选择一个图表!");return false}}if(!checkOverlayShow(l.showIDArr)){return false}}l.showid=l.showIDArr[0];l.linetype=l.linetype;var j=l.modelConfig.partFormConfig.getParams();if(j){if(l.modelConfig.partOutput){var f=l.modelConfig.partOutput.getParams();if(!f){return false}}if(l.onsitefilterDataJson){l.onsitefilterDataJson=undefined}}else{return false}l.setFormConfigData(j);if(f){l.setOutputData(f)}else{l.setOutputData(j)}if(l.modelConfig.partDistinct){l.modelConfig.partDistinct.getParams()}if(l.modelConfig&&l.modelConfig.partFormConfig&&l.modelConfig.partFormConfig.lastRelateJson!=null){l.dataJson.filterrelation=l.modelConfig.partFormConfig.lastRelateJson.filterrelation}if(l.dataJson.filterrelation==null){initFilterRelation(l.dataJson)}if(l.elementType==2&&l.modelConfig.partDataconfig){l.modelConfig.partDataconfig.getParams()}if(a.currEditElement==null){window.currInstance.elements.push(l);a.currColumn.append('<div overlay_elementid="'+l.elementID+'" style="width:370px"><div class="overlayelement" ><h1 style="width:100%; margin-top:0px"><a href="javascript:void(0)"><img onclick="javascript:window.overlayobj.delElement(this)" style="float:right;border:0px" src="'+config.imagePath+'del.gif"></a></h1>'+l.elementName+"</div></div>")}else{g=true;var e=l.modelID!=a.currEditElement.modelID;l.ischangemodel=e;if(e){l.elementID=a.currEditElement.elementID;$.each(window.currInstance.elements,function(m,n){if(n.elementID==l.elementID){if(n.allshow.length>0){l.oldallshow=n.allshow}}});a.delElement($("div[overlay_elementid="+l.elementID+"]").find(".overlayelement h1 a img"));window.currInstance.elements.push(l);a.currColumn.append('<div overlay_elementid="'+l.elementID+'" style="width:370px"><div class="overlayelement" ><h1 style="width:100%; margin-top:0px"><a href="javascript:void(0)"><img onclick="javascript:window.overlayobj.delElement(this)" style="float:right;border:0px" src="'+config.imagePath+'del.gif"></a></h1>'+l.elementName+"</div></div>")}}}else{if(!a.currEditLinkage){a.currColumn.append('<div overlay_elementid="linkage" style="width:370px"><div class="overlayelement" ><h1 style="width:100%; margin-top:0px"><a href="javascript:void(0)"><img onclick="javascript:window.overlayobj.delElement(this)" style="float:right;border:0px" src="'+config.imagePath+'del.gif"></a></h1>联动模型</div></div>')}}if(window.currInstance.instanceType==3){var i=0;$.each(window.currInstance.elements,function(o,n){if(n.elementType==2){var m=getShowid(n.showid);if(m=="column"){i++}}});if(i>1){$("#overlaystackingspan").attr("stackavailable",true);var b=$("#overlayxcombined").prop("checked");if(b){$("#overlaystackingspan").css("display","")}else{$("#overlaystackingspan").css("display","none")}}else{$("#overlaystackingspan").removeAttr("stackavailable")}}return true};this.delElement=function(f){for(var e=window.currInstance.elements.length-1;e>-1;e--){var b=window.currInstance.elements[e];if($(f).parents("div[overlay_elementid]").attr("overlay_elementid")==b.elementID){window.currInstance.elements.splice(e,1);break}else{if($(f).parents("div[overlay_elementid]").attr("overlay_elementid")=="linkage"){var d=$(f).parents("td").attr("overlaytdindex");if(b.overlayindex==d){for(var c=window.currInstance.pinRelation.length-1;c>-1;c--){if(window.currInstance.pinRelation[c].outelementid==b.elementID||window.currInstance.pinRelation[c].inelementid==b.elementID){window.currInstance.pinRelation.splice(c,1)}}window.currInstance.elements.splice(e,1)}}}}changePage(4);$(f).parents("div[overlay_elementid]").remove()};this.completeOverlay=function(){var o=true;var f=[];var n=[];if(window.currInstance==undefined||window.currInstance==null||window.currInstance.elements.length==0){return"请添加模型"}var c=$("#overlayxcombined").prop("checked");window.currInstance.xcombined=c;var i=$("#overlaycolumnstacking").prop("checked");window.currInstance.columnstacking=i;var j=$("#overlayxzreverse").prop("checked");window.currInstance.xzreverse=j;var k=$("#overlaysnap").prop("checked");var b=$("#overlaytr td:last").attr("overlaytdindex");var g=[];var h=0;var e=0;$(window.currInstance.elements).each(function(p,r){var t=$("#modelname"+r.overlayindex+"").val();if(t==""){alert("请添加模型简称!");o=false;return false}window.currInstance.elements[p].modelname=t;var v=$("#referencedata"+r.overlayindex+"").prop("checked");window.currInstance.elements[p].referencedata=v;if(v){h++}var u=$("#secondaryyaxis"+r.overlayindex+"").prop("checked");window.currInstance.elements[p].secondaryyaxis=u;if(u){e++}var q=$("#referencedataratio"+r.overlayindex+"").val();window.currInstance.elements[p].referencedataratio=q;if(r.showid){var s=getShowid(r.showid);if(!g.inArray(s)){g.push(s)}}if(r.elementType==2&&r.overlayindex==b){if(k){r.issnap=true}else{r.issnap=false}f.push(r);n.push(r.elementID)}});if(!o){return false}if(f.length==0){return"请至少选择两个模型!"}if(e>0&&h==0){return"请选择主坐标!"}if(g.length==1&&g[0]=="spline"){if(!c){return"可视化全部为线型图,请选择x轴合并!"}}if(g.length>1){if(j){var m=false;$.each(g,function(q,p){if(p=="spline"){m=true;return false}});if(m){$("#overlayxzreverse").attr("checked",false);return"xz轴反转选中,请选择相同的可视化视图!"}}}var d="div[instanceid="+window.currInstance.instanceID+"]";var l=[];$(d).each(function(r,t){var p=$(t).attr("elementid");if(p!=undefined){var s=false;for(var q=0;q<n.length;q++){if(n[q].toString()==p.toString()){s=true;break}}if(!s){l.push(p)}}});$(l).each(function(p,q){$(d+"[elementid="+q+"]").remove()});if(!a.isEditWidget){$(f).each(function(p,q){o=q.completeEdit();if(!o){return false}})}return o}}function Linkage(){var a=this;this.currColumn;this.currEditElement;this.linkelements=new Array();this.maxeleid=0;this.isEditWidget=false;this.drawInputPin=function(c,d){var b=c.find("div[linkage_elementid="+d.elementID+"]").children(".inputpindiv");if(b){b.empty();$(d.inputPin).each(function(f,e){var g=b.find("a[pinid="+e.inpinid+"]");if(g.length>0){return true}var h=e.inputdata.text+"。双击清空链接";b.append('<a href="javascript:void(0)" pinid="'+e.inpinid+'" title="'+h+'"><img src="'+config.imagePath+'put.gif" border="0" style="margin-bottom:3px"></a>');g=b.find("a[pinid="+e.inpinid+"]");g.bind("click",function(m){if(window.curroutputpin!=undefined&&window.curroutputpin!=null){if((e.inputdata.value!="include"&&e.inputdata.value!="exclude")&&window.curroutputpin.outputdata.datatype!=e.inputdata.datatype){alert("输出与输入类型不同，不能连接");return false}if(e.inputdata.value=="weibourl"||e.inputdata.value=="oristatusurl"){if(window.curroutputpin.outputdata.outputfield!="guid"&&window.curroutputpin.outputdata.outputfield!="retweeted_guid"&&e.inputdata.value=="docguid"&&e.inputdata.value=="father_guid"){alert("请选择对应字段作为输出");return false}}var j=window.curroutputpin.outputdata.isfeature==1;var l=e.inputdata.isfeature==1;if(j!=l){alert("请选择特征分类的输出或输入");return false}if(window.curroutputpin.outputdata.pintype=="dynamic"){var i=e.inputdata.value;if((e.inputdata.value=="include"||e.inputdata.value=="exclude")||(d.dataJson.filter[i]&&d.dataJson.filter[i].limit&&d.dataJson.filter[i].limit.length>0)){alert("您选择的输入字段限制不能连接动态输出，请选择静态输出");return false}}var n=a.drawOneLine(window.curroutputpin.outelementid,window.curroutputpin.outpinid,e.inelementid,e.inpinid);if(n){e.outpinid=window.curroutputpin.outpinid;e.outelementid=window.curroutputpin.outelementid;e.outputdata=window.curroutputpin.outputdata;window.curroutputpin.inpinid=e.inpinid;window.curroutputpin.inelementid=e.inelementid;window.curroutputpin.inputdata=e.inputdata;if(window.currInstance.instanceType==3){var k=$("#overlaytr td[active=true]").attr("overlaytdindex");e.overlayindex=k}window.currInstance.pinRelation.push(e);d.linkedPinValue(e)}window.curroutputpin=null;$(window.curroutputele).children("img").css("border","0px");window.curroutputele=null}});g.bind("dblclick",function(k){if(confirm("确定清空连接？")){var l="_"+e.inpinid+"_"+e.inelementid;$("div[linename$="+l+"]").remove();var m=window.currInstance.pinRelation;for(var j=m.length-1;j>-1;j--){if(m[j].inpinid==e.inpinid&&m[j].inelementid==e.inelementid){d.unlinkPinValue(m[j]);window.currInstance.pinRelation.splice(j,1)}}}})})}};this.drawOutputPin=function(b,c){var d=b.find("div[linkage_elementid="+c.elementID+"]").children(".outputpindiv");if(d){d.empty();$(c.outputPin).each(function(i,h){var l=d.find("a[pinid="+h.outpinid+"]");if(l.length>0){return true}var e="put.gif";if(h.type==2){e="put1.gif"}var g="";if(h.outputdata.pintype=="dynamic"){if(h.outputdata.value.start==null&&h.outputdata.value.end==null){g="动态输出全部数据"}else{g="动态输出第"+h.outputdata.value.start+" ~ "+h.outputdata.value.end+"条"}}else{$(h.outputdata.value).each(function(m,j){g+=j.text+" "})}if(!c.modelConfig){c.modelConfig=createCustomConfig("#editelementdiv",c)}var f="";if(h.outputdata.exclude){f="(不包含)"}var k=c.modelConfig.getOutputFieldLabel(h.outputdata.outputfield)+f+"："+g+"。双击清空链接";d.append('<a href="javascript:void(0)" pinid="'+h.outpinid+'"  title="'+k+'"><img src="'+config.imagePath+e+'" border="0" style="margin-bottom:3px"></a>');l=d.find("a[pinid="+h.outpinid+"]");l.bind("click",function(j){if(window.curroutputpin==undefined||window.curroutputpin==null){window.curroutputpin=h;window.curroutputele=this;$(this).children("img").css("border","2px solid red")}else{if(window.curroutputele==this){window.curroutputpin=null;$(window.curroutputele).children("img").css("border","0px");window.curroutputele=null}else{$(window.curroutputele).children("img").css("border","0px");window.curroutputpin=h;window.curroutputele=this;$(this).children("img").css("border","2px solid red")}}});l.bind("dblclick",function(m){if(confirm("确定清空连接？")){var n=h.outelementid+"_"+h.outpinid+"_";$("div[linename^="+n+"]").remove();var o=window.currInstance.pinRelation;for(var j=o.length-1;j>-1;j--){if(o[j].outpinid==h.outpinid&&o[j].outelementid==h.outelementid){$(window.currInstance.elements).each(function(p,q){if(h.inelementid==q.elementID){q.unlinkPinValue(h)}});window.currInstance.pinRelation.splice(j,1)}}}})})}};this.draw=function(b){if(b.length==0){return false}a.addColumn();var c="";if(a.isEditWidget){c='style="display:none"'}var d=$("#trtr td:last");$(b).each(function(e,f){d.append('<div linkage_elementid="'+f.elementID+'" style="width:370px"><div class="inputpindiv"></div><div class="linkageelement" ><h1 style="width:100%; margin-top:0px"><a '+c+' href="javascript:void(0)" ><img onclick="javascript:window.linkageobj.delElement(this)" style="float:right;border:0px" src="'+config.imagePath+'del.gif"></a></h1>'+f.elementName+'</div><div class="outputpindiv"></div></div>');a.drawInputPin(d,f);a.drawOutputPin(d,f)})};this.getRightElements=function(c,f){var e=[];for(var d=f.length-1;d>-1;d--){var b=true;$(f[d].inputPin).each(function(g,i){var h=false;$(c).each(function(k,j){if(j.elementID==i.outelementid){h=true;return false}});if(h==false){b=false;return false}});if(b){e.push(f[d]);f.splice(d,1)}}return e};this.show=function(c,b){this.isEditWidget=c==true;if(!c){$("#linkagediv").dialog({width:800,height:600,autoOpen:true,modal:true,title:"添加联动",close:function(){$("div.linkageelement").die("click");clearLine()},open:function(){$("div.linkageelement").live("click",a.editElement)},buttons:{"完成":function(){if(window.currInstance.instanceType==3){if(window.overlayobj.completeAddElement()){$(this).dialog("close")}}else{var k=window.linkageobj.completeLink();if(k===true){$(this).dialog("close")}else{if(typeof k==="string"){alert(k)}}}},"取消":function(){$(this).dialog("close")}}})}else{$("#linkagediv").show();$("#editwidget_cancellinkage").button();$("#editwidget_cancellinkage").bind("click",function(){sendMsgTothirdPartySite("editcancel")});$("#editwidget_savelinkage").button();$("#editwidget_savelinkage").bind("click",function(){$("#editwidget_savelinkage").attr("disabled","disabled");$("#editwidget_saveinfo").html("正在提交...");var k=a.completeLink();if(k===true){window.currInstance.save(function(l){if(l&&l.result){sendMsgTothirdPartySite("editsuccess");$("#editwidget_saveinfo").html("保存成功")}else{$("#editwidget_saveinfo").html("保存失败")}$("#editwidget_savelinkage").removeAttr("disabled")},function(){$("#editwidget_saveinfo").html("请求发生异常");$("#editwidget_savelinkage").removeAttr("disabled")})}else{if(typeof k=="string"){$("#editwidget_saveinfo").html(k)}else{$("#editwidget_saveinfo").html("")}$("#editwidget_savelinkage").removeAttr("disabled")}});$("div.linkageelement").live("click",a.editElement)}$("#trtr").empty();var f=$("#overlaytr td[active=true]").attr("overlaytdindex");var e=false;if(window.currInstance!=null){$.each(window.currInstance.elements,function(k,l){if(l.overlayindex==f){e=true;return false}})}if(window.currInstance==null||(window.currInstance.instanceType==3&&!e)){a.addColumn();a.addColumn()}else{if(window.currInstance.elements.length>0){var d=[];var h=[];var j=[];var i=[];$(window.currInstance.elements).each(function(l,m){var k=true;if(window.currInstance.instanceType==3){if(m.overlayindex!=f){k=false}}if(k){if(m.elementType==1){h.push(m)}else{if(m.elementType==2){if(c){m.showIDArr.push(b)}else{if(window.currInstance.instanceType!=3){var n=[];$("div[elementid="+m.elementID+"][instanceid="+m.instanceID+"]").each(function(o,p){if($(this).attr("showid").length>0){n.push($(this).attr("showid"))}});m.showIDArr=n}}j.push(m)}else{i.push(m)}}}});a.draw(h);var g=h;while(i.length>0){g=a.getRightElements(g,i);if(g.length==0){a.draw(i);break}else{a.draw(g)}}a.draw(j);a.drawLine()}}};this.drawOneLine=function(i,e,m,j){var k=i+"_"+e+"_"+j+"_"+m;var d=$("#linkagediv").scrollTop();var p=$("#linkagediv").scrollLeft();if($("div[linename="+k+"]").length==0){var g=$("div[linkage_elementid="+i+"] .outputpindiv a[pinid="+e+"]");var h=$("div[linkage_elementid="+m+"] .inputpindiv a[pinid="+j+"]");var f=g.position();var o=h.position();var q=0;if($.browser.msie){if(parseInt($.browser.version.substr(0,1),10)>7){q=-15}else{q=15}}else{q=0}if(f!=null&&o!=null){var c=f.left+p+15;var n=f.top+d+q;var b=o.left+p+15;var l=o.top+d+q;createLine("#linkagediv",c,n,b,l,"orange",k);return true}else{return false}}else{return false}};this.drawLine=function(){clearLine();$(window.currInstance.pinRelation).each(function(b,c){a.drawOneLine(c.outelementid,c.outpinid,c.inelementid,c.inpinid)})};this.addColumn=function(){var b="";if(a.isEditWidget){b='style="display:none"'}$("#trtr").append('<td style="width:450px;height:90%;border:dashed 1px blue"><input type="button" value="添加模型" '+b+' onclick="javascript:window.linkageobj.addElement(this)">&nbsp;&nbsp;<input type="button" '+b+' value="删除此列" onclick="javascript:window.linkageobj.removeColumn(this)"></td>');$("#tbtb").css("width",($("#trtr td").length*450)+"px")};this.removeColumn=function(b){if($(b).parent("td").find("div[linkage_elementid]").length>0){alert("请先删除元素");return false}$(b).parent("td").remove();$("#tbtb").css("width",($("#trtr td").length*450)+"px");a.drawLine()};this.addElement=function(b){a.currEditElement=null;a.currColumn=$(b).parents("td");$("#editelementdiv").empty();$("#editdiv").dialog("open");createModelSelect("#editmodelselectdiv",window.currTypeID,0,window.currChannelID,2)};this.editElement=function(b){if(b.target!=this){return true}var c=$(b.target).parent().attr("linkage_elementid");$(window.currInstance.elements).each(function(e,d){if(d.elementID==c){a.currEditElement=d;a.currColumn=$(b.target).parents("td");$("#editelementdiv").empty();$("#editdiv").dialog("open");if(!a.isEditWidget){createModelSelect("#editmodelselectdiv",window.currTypeID,d.modelID,window.currChannelID,2)}a.currEditElement.editLinkage("#editelementdiv",a.isEditWidget);return false}})};this.completeAddElement=function(j){if(window.currInstance.instanceType==3){var k=$("#overlaytr td[active=true]").attr("overlaytdindex");j.instanceType=3;j.subInstanceType=2;j.overlayindex=k}var l=false;var r=0,t=0;$(j.inputPin).each(function(A,B){if(!B.deleted){r++}});$(j.outputPin).each(function(A,B){if(!B.deleted){t++}});if(r>0&&t>0){j.elementType=3}else{if(t>0){j.elementType=1}else{j.elementType=2;var c=j.modelConfig.getModelShowType();j.setShowType(c);if(j.showIDArr.length==0){dialogAlert($("#modelshow_div"),"请选择可视化图表!");return false}else{if(window.currInstance.instanceType==3){if(j.showIDArr.length>1){dialogAlert($("#modelshow_div"),"叠加模型,只能选择一个图表!");return false}}if(!checkOverlayShow(j.showIDArr)){return false}}if(window.currInstance.instanceType==3){j.showid=j.showIDArr[0]}}}var d=j.modelConfig.partFormConfig.getParams();if(d){if(j.onsitefilterDataJson){j.onsitefilterDataJson=undefined}if(t>0){if(d.contrast){alert("您已创建输出字段，请取消分类对比选项。");return false}if(d.classifyquery){alert("您已创建输出字段，请取消分类查询选项。");return false}}if(d.classifyquery){var w=false;$.each(d.filtervalue,function(A,B){if(B.fieldname==d.classifyquery.fieldname&&B.fieldvalue.datatype=="array"){w=true;return false}});if(!w){var v=false;$(j.inputPin).each(function(A,B){if(!B.deleted&&B.inputdata.value==d.classifyquery.fieldname){v=true;return false}});if(!v){alert("请给分类查询字段创建输入");return false}}}if(j.modelConfig.partOutput){var u=j.modelConfig.partOutput.getParams();if(!u){return false}if((j.modelID==allmodels.topkeyword||j.modelID==allmodels.userstatistics)&&j.elementType!=2){if(u.facet.field==null||u.facet.field.length==0){alert("请选择有效的统计字段");return false}else{var f=u.facet.field[0].name;var m=u.facet.field[0].isfeature?1:0;var p;switch(j.modelID){case allmodels.topkeyword:p=(new WeiboConfig()).getSelectFields();break;case allmodels.userstatistics:p=(new FoltopConfig()).getSelectFields();break;default:break}if(p[f]!=undefined){if(p&&p[f]){$(j.outputPin).each(function(A,B){if(m){B.outputdata.datatype="value_text_object"}else{B.outputdata.datatype=p[f].type}B.outputdata.isfeature=m});$(j.inputPin).each(function(A,B){if(B.inputdata.value=="include"||B.inputdata.value=="exclude"){B.inputdata.datatype=p[f].type}})}}else{alert("区间类型的字段不能作为输出字段，请修改统计字段。");return false}}}}var b="";for(var n=window.currInstance.pinRelation.length-1;n>-1;n--){var o=window.currInstance.pinRelation[n];if(o.inputdata.datatype!=o.outputdata.datatype){window.currInstance.pinRelation.splice(n,1);var h=o.outelementid+"_"+o.outpinid+"_"+o.inpinid+"_"+o.inelementid;$("div[linename="+h+"]").remove();b+=o.outputdata.text+"与"+o.inputdata.text+" "}}if(b!=""){alert("由于数据类型不匹配，"+b+" 的连接被移除。")}}else{return false}j.setFormConfigData(d);if(u){j.setOutputData(u)}else{j.setOutputData(d)}if(j.modelConfig.partDistinct){j.modelConfig.partDistinct.getParams()}if(j.modelConfig&&j.modelConfig.partFormConfig&&j.modelConfig.partFormConfig.lastRelateJson!=null){j.dataJson.filterrelation=j.modelConfig.partFormConfig.lastRelateJson.filterrelation}if(j.dataJson.filterrelation==null){initFilterRelation(j.dataJson)}if(j.elementType==2&&j.modelConfig.partDataconfig){j.modelConfig.partDataconfig.getParams()}if(a.currEditElement==null){window.currInstance.elements.push(j);a.currColumn.append('<div linkage_elementid="'+j.elementID+'" style="width:370px"><div class="inputpindiv"></div><div class="linkageelement" ><h1 style="width:100%; margin-top:0px"><a href="javascript:void(0)"><img onclick="javascript:window.linkageobj.delElement(this)" style="float:right;border:0px" src="'+config.imagePath+'del.gif"></a></h1>'+j.elementName+'</div><div class="outputpindiv"></div></div>')}else{l=true;var z=j.modelID!=a.currEditElement.modelID;j.ischangemodel=z;if(z){j.elementID=a.currEditElement.elementID;$.each(j.inputPin,function(A,i){i.inelementid=a.currEditElement.elementID});$.each(j.outputPin,function(A,i){i.outelementid=a.currEditElement.elementID});$.each(window.currInstance.elements,function(i,A){if(A.elementID==j.elementID){if(A.allshow.length>0){j.oldallshow=A.allshow}}});a.delElement($("div[linkage_elementid="+j.elementID+"]").find(".linkageelement h1 a img"));window.currInstance.elements.push(j);a.currColumn.append('<div linkage_elementid="'+j.elementID+'" style="width:370px"><div class="inputpindiv"></div><div class="linkageelement" ><h1 style="width:100%; margin-top:0px"><a href="javascript:void(0)"><img onclick="javascript:window.linkageobj.delElement(this)" style="float:right;border:0px" src="'+config.imagePath+'del.gif"></a></h1>'+j.elementName+'</div><div class="outputpindiv"></div></div>')}}for(var n=j.outputPin.length-1;n>-1;n--){var s=j.outputPin[n];if(s.deleted){j.outputPin.splice(n,1);var h=j.elementID+"_"+s.outpinid+"_";$("div[linename^="+h+"]").remove();for(var g=window.currInstance.pinRelation.length-1;g>-1;g--){var q=window.currInstance.pinRelation[g];if(q.outpinid==s.outpinid&&q.outelementid==j.elementID){for(var e=0;e<window.currInstance.elements.length;e++){if(window.currInstance.elements[e].elementID==q.inelementid){window.currInstance.elements[e].unlinkPinValue(q)}}window.currInstance.pinRelation.splice(g,1)}}}}for(var n=j.inputPin.length-1;n>-1;n--){var s=j.inputPin[n];if(s.deleted){j.inputPin.splice(n,1);var h="_"+s.inpinid+"_"+j.elementID;$("div[linename$="+h+"]").remove();for(var g=window.currInstance.pinRelation.length-1;g>-1;g--){var q=window.currInstance.pinRelation[g];if(q.inpinid==s.inpinid&&q.inelementid==j.elementID){j.unlinkPinValue(q);window.currInstance.pinRelation.splice(g,1);j.modelConfig.partFormConfig.onFormChange()}}}}j.enableTempPin();a.drawInputPin(a.currColumn,j);a.drawOutputPin(a.currColumn,j);return true};this.delElement=function(f){for(var e=window.currInstance.elements.length-1;e>-1;e--){var b=window.currInstance.elements[e];if($(f).parents("div[linkage_elementid]").attr("linkage_elementid")==b.elementID){for(var c=window.currInstance.pinRelation.length-1;c>-1;c--){if(window.currInstance.pinRelation[c].outelementid==b.elementID||window.currInstance.pinRelation[c].inelementid==b.elementID){var g=window.currInstance.pinRelation[c].outelementid+"_"+window.currInstance.pinRelation[c].outpinid+"_"+window.currInstance.pinRelation[c].inpinid+"_"+window.currInstance.pinRelation[c].inelementid;removeLine(g);if(window.currInstance.pinRelation[c].outelementid==b.elementID){for(var d=0;d<window.currInstance.elements.length;d++){if(window.currInstance.elements[d].elementID==window.currInstance.pinRelation[c].inelementid){window.currInstance.elements[d].unlinkPinValue(window.currInstance.pinRelation[c])}}}window.currInstance.pinRelation.splice(c,1)}}window.currInstance.elements.splice(e,1);changePage(4);$(f).parents("div[linkage_elementid]").remove();break}}};this.completeLink=function(){var b=true;var e=[];var c=[];if(window.currInstance==undefined||window.currInstance==null||window.currInstance.elements.length==0){return"请添加模型"}if(window.currInstance.pinRelation.length==0){return"请创建输出和输入，并连接"}$(window.currInstance.elements).each(function(h,j){if(j.elementType==2){var g=checkClassifyQueryCount(j.dataJson);if(!g){return"分类查询、分类对比字段值超出最大限制"+config.maxClassifyQueryCount}e.push(j);c.push(j.elementID)}});if(!b){return false}if(e.length==0){return"请创建输出模型"}var d="div[instanceid="+window.currInstance.instanceID+"]";var f=[];$(d).each(function(k,m){var g=$(m).attr("elementid");if(g!=undefined){var l=false;for(var h=0;h<c.length;h++){if(c[h].toString()==g.toString()){l=true;break}}if(!l){f.push(g)}}});$(f).each(function(g,h){$(d+"[elementid="+h+"]").remove()});if(!a.isEditWidget){$(e).each(function(g,h){b=h.completeEdit();if(!b){return false}})}return b}}function createLine(k,c,l,a,j,d,f){var h=$(k);if(l==j){var b=Math.abs(a-c);var g='<div linename="'+f+'" style="left:'+c+"px;top:"+l+"px;width:"+b+"px;height:2px;background-color:"+d+';position:absolute;"></div>';h.append(g)}else{if(c==a){var m=Math.abs(j-l);var g='<div linename="'+f+'" style="left:'+c+"px;top:"+l+"px;height:"+m+"px;width:2px;background-color: "+d+';position:absolute;"></div>';h.append(g)}else{if(c<a){for(var e=c;e<=a;e+=4){x=e;y=(j-l)/(a-c)*(x-c)+l;var g='<div linename="'+f+'" style="left:'+x+"px;top:"+y+"px;height:2px;width:2px;background-color: "+d+';position:absolute;"></div>';h.append(g)}}else{for(var e=c;e>=a;e-=4){x=e;y=(j-l)/(a-c)*(x-c)+l;var g='<div linename="'+f+'" style="left:'+x+"px;top:"+y+"px;height:2px;width:2px;background-color: "+d+';position:absolute;"></div>';h.append(g)}}}}}function removeLine(a){$("div[linename="+a+"]").remove()}function clearLine(){$("div[linename]").remove()}function changeWidthHeigh(a){$(a).each(function(e,c){var d=$(c)[0].style.width;if(d==undefined||d.indexOf("%")>-1){return true}if($(this).attr("aspectratio")=="-2"){return true}var g=$(this).parent().width();var f=$(this).width();var j=f/g;j=j>0.97?0.97:j;$(this).css("width",(j*100)+"%");if($(this).attr("aspectratio")!="-1"&&$(this).attr("aspectratio")!="-2"){var b=$(this).height();var h=b/f;$(this).attr("aspectratio",h)}})}function modifyShowHeight(a){var b=0;if(a!=undefined&&a!=null){$.each($(a.targetID).children(),function(){if($(this).css("display")!=undefined&&$(this).css("display")!="none"){var c=$(this).height();b+=c}});if(b>$(a.targetID).height()){setShowHeigh(a);setMenuHeight()}}}function setShowHeigh(a){if(a.aspectratio==-1){$(a.targetID).css("height","auto")}else{if(a.aspectratio==-2){$(a.targetID).css("height",a.height)}else{$(a.targetID).css("height",$(a.targetID).width()*a.aspectratio+"px")}}}function setMenuHeight(){if(Global.StartClientWidth!=$("body")[0].clientWidth){$(window).resize()}$("#menu").css({height:"auto","min-height":"0px"});var a=$("#menu").parent().height();$("#menu").css("min-height",a)}function controllShowShade(a){$(window.instances).each(function(d,c){var b=[];$(c.elements).each(function(i,h){if(h.elementType==2){var g=h.dataJson.download_DataLimit;var e=h.dataJson.download_FieldLimit;if(e==undefined||e.length==0){return false}var f={eleid:h.elementID,modelname:h.modelname,fields:e,maxdatacount:g,downloadDatacount:h.dataJson.output.count};b.push(f);$(h.allshow).each(function(o,A){if(a){A.hideShade()}else{var u=A.shadow();if(u){u.empty();var n=$("<div></div>");var m='<a style="margin-left:10px;display:none;color:#000" href="javascript:void(0)">选择字段</a>';var t=$(m);var v='<img src="images/checkmark_64.png" border="0"><br/>';if(u.width()<100||u.height()<100){var p=u.width()/100;var w=u.height()/100;var j=Math.min(p,w);var l=64*j;v='<img width="'+l+'" height="'+l+'" src="images/checkmark_64.png" border="0"><br/>'}var k='<a hidefocus="true" style="outline:none;text-decoration:none;color:#000" href="javascript:void(0)">'+v+"<span>单击选择</span></a>";var q=$(k);n.append(q).append(t).appendTo(u);if(c.status==2||c.status==3){q.attr("disabled","disabled").children("span").text("此模型尚未保存");A.downloadChecked=false}else{q.removeAttr("disabled").children("span").text("单击选择")}var z=(u.height()-n.height())/2;n.css({position:"relative",top:z});q.bind("click",function(){if(c.status==2||c.status==3){return false}if(A.downloadChecked){A.downloadChecked=false;u.css("background","#ededed");$(this).children("img").attr("src","images/checkmark_64.png");$(this).children("span").text("单击选择");t.hide()}else{A.downloadChecked=true;if(A.downloadFields.length>0){u.css("background","#c7eae5")}else{u.css("background","#fde0ef")}$(this).children("img").attr("src","images/checkmark_64_white.png");$(this).children("span").text("单击取消");t.show()}});t.bind("click",function(){var T=$("#downloadfieldsdiv");var N="download_field";var L="download_datacount";var C="download_datacountmax";var Q="download_errorinfo";if(T.length==0){var M='<div><div id="downloadfieldsdiv" class="sigma_searcher" style="width:97%;min-height:170px;text-align:left;"></div>';$("body").append(M);T=$("#downloadfieldsdiv");T.parent().dialog({title:"选择导出的字段",width:410,height:350,autoOpen:false,modal:true,close:function(){T.empty();$("#"+Q).text("")}})}var F="";for(var O=0;O<b.length;O++){var E=b[O].fields;var r=b[O].eleid;if(b[O].modelname!=undefined){F+="<div id='modelname_"+r+"' >"+b[O].modelname+"</div>"}var K=0;F+='<div id="downloadallselect"><label>全部字段：</label><input id="downloadallselectbtn" type="checkbox"/>&nbsp;&nbsp;&nbsp;&nbsp;<label>下载最大数据量</label><span id="downloadmaxexcel">'+K+'</span>：<input id="downloadmaxexcelbtn" type="checkbox"/></div>';F+="<div></div>";F+='<table border=0 width="100%" eleid="'+r+'">';for(var P=0;P<E.length;P++){var B="";if(A.downloadFields.length>0){$.each(A.downloadFields,function(V,U){if(U.eleid==r){B=U.fields.inArray(E[P].value)?"checked":""}})}var G=N+"_child"+O+P;var J=E[P].text;if(E[P].value=="facet"&&h.dataJson.output.outputtype==2){if(h.dataJson.facet.field.length>0){J=getDisplayName(h.dataJson.facet.field[0].name,h.dataJson.filter)}else{if(h.dataJson.facet.range.length>0){J=getDisplayName(h.dataJson.facet.range[0].name,h.dataJson.filter)}}}var S=P%4;var H="margin-left:"+(S*110)+"px;";var D="";if((P==E.length-1)&&S!=0){D='colspan="'+(3-S)+'"'}var R="<td "+D+"><input "+B+' type="checkbox" id="'+G+'" name="'+N+"_"+r+'" text="'+J+'" value="'+E[P].value+'" /><label for="'+G+'">'+J+"</label></td>";if(S==0){F+="<tr>"}F+=R;if(S==3){F+="</tr>"}}K=b[O].maxdatacount;F+="</table>";F+='<div style="width:97%;text-align:left;margin-top:5px">';F+='数据量：<input type="text" id="'+L+"_"+r+'" style="background-color:#FFFFFF;border:1px solid #B3CFE7;height:20px;" value="'+b[O].downloadDatacount+'" />';F+='&nbsp;<span style="color:gray">最大数据量:<span id="'+C+"_"+r+'">'+b[O].maxdatacount+"</span></span>&nbsp;&nbsp;&nbsp;&nbsp;</div>";F+='<div style="width:97%;text-align:left;color:red" id="'+Q+"_"+r+'"></div></div>'}T.html(F);$("#downloadmaxexcel").html("").html(K);downloadallselect();$("#downloadallselectbtn").click(function(){var U=$(this).prop("checked");if(U){$("#downloadfieldsdiv table input[type='checkbox']").prop("checked",true)}else{$("#downloadfieldsdiv table input[type='checkbox']").prop("checked",false)}});$("#downloadfieldsdiv table input[type='checkbox']").click(function(){downloadallselect()});var I=$("#"+L+"_"+r).val();var s=$("#"+C+"_"+r).text();$("#downloadmaxexcelbtn").click(function(){var U=$(this).prop("checked");if(U){$("#"+L+"_"+r).val(s)}else{$("#"+L+"_"+r).val(I)}});T.parent().dialog({buttons:{"确定":function(){var X=[];var V=[];var W=[];var U=0;A.downloadDatacount={};$("#downloadfieldsdiv table").each(function(){var ab=$(this).attr("eleid");var Y=$("#"+L+"_"+ab).val();if(Y==undefined||isNaN(Y)){$("#"+Q+"_"+ab).text("请填写数字");$("#"+L+"_"+ab).focus();U++;return false}Y=parseInt(Y,10);if(Y<1){$("#"+Q+"_"+ab).text("数值不能小于1");$("#"+L+"_"+ab).focus();U++;return false}var Z=$("#"+C+"_"+ab).text();if(Y>Z){$("#"+Q+"_"+ab).text("数值不能大于于"+Z);$("#"+L+"_"+ab).focus();U++;return false}A.downloadDatacount[ab]=Y;var aa=T.find("input[name^="+N+"_"+ab+"]:checked");if(aa.length==0){$("#"+Q+"_"+ab).text("请选择字段");U++;return false}var ad={eleid:ab,fields:[]};var ac={eleid:ab,fields:[]};if($("#modelname_"+ab+"").text()!=undefined){ad.modelname=$("#modelname_"+ab+"").text();ac.modelname=$("#modelname_"+ab+"").text()}aa.each(function(ae,af){ad.fields.push($(af).val());ac.fields.push($(af).attr("text"))});if(ad.fields.length>0){X.push(ad);V.push(ac)}});if(U>0){return false}A.setDownloadFields(X,V);if(A.downloadFields.length>0){u.css("background","#c7eae5")}else{u.css("background","#fde0ef")}$(this).dialog("close")},"取消":function(){$(this).dialog("close")}}});T.parent().dialog("open")})}}})}})})}function downloadallselect(){var b=$("#downloadfieldsdiv table input[type='checkbox']").length;var a=$("#downloadfieldsdiv table input[type='checkbox']:checked").length;if(a==b){$("#downloadallselectbtn").prop("checked",true)}else{$("#downloadallselectbtn").prop("checked",false)}}function createDownloadLayer(){window.currentDownloadStatus=true;$("#editdownload").show();$("#sys").css("visibility","hidden");$("#editdownload_cancel").unbind("click");$("#editdownload_cancel").bind("click",clearDownloadLayer);$("#editdownload_download").unbind("click");$("#editdownload_download").bind("click",function(){var e=0,i=0;var k={};k.filetype="excel";k.version="2003";var b="";k.elements={};var f=0;$(window.instances).each(function(p,o){$(o.elements).each(function(r,q){if(q.elementType==2){$(q.allshow).each(function(t,v){if(v.downloadChecked){if(v.downloadFields.length>0){f++;b+='<table style="width:100%;margin-left:0px;margin-top:3px" cellspacing="0" cellpadding="0" border="0" class="tab1fixed">';var u=0;$.each(v.downloadFields,function(w,s){if(s.fields.length>u){u=s.fields.length}});if(commonFun.trim(v.getShowTitle())!=""){b+='<tr ><td colspan="'+u+'"><b>'+v.getShowTitle()+"</b></td></tr>"}$.each(v.downloadFields,function(z,A){if(k.elements[A.eleid]==undefined){var w=q.instanceType;if(q.instanceType==3){w=q.subInstanceType}k.elements[A.eleid]={instanceid:q.instanceID,instancetype:w,shows:[]};if(A.modelname!=undefined){k.elements[A.eleid].modelname=A.modelname}}var s={};s.showtitle=v.getShowTitle();s.downloadDatacount=v.downloadDatacount[A.eleid];s.downloadFields=A.fields;s.showindex=f;$.each(v.downloadFieldTexts,function(C,D){if(D.eleid==A.eleid){b+="<tr>";for(var B=0;B<D.fields.length;B++){b+='<td style="text-align:center">'+D.fields[B]+"</td>"}b+="</tr>"}});i++;k.elements[A.eleid].shows.push(s)});b+="</table>"}e++}})}})});if(e==0){alert("请先选择需要下载的模型");return false}if(i==0){alert("请选择需要输出的字段");return false}var h="download_previewdiv";var n=$("#"+h);var d="download_excel";var j="download_filename";if(n.length==0){var m='<div><div style="width:97%;padding:5px" id="'+h+'"></div>';m+='<table style="width:97%;padding:5px;"><tr><td style="width:100px;text-align:right;">文件名：</td><td><input type="text" id="'+j+'" title="文件名中不能包含\\ / : * &quot; ? &lt; &gt; |" style="background-color:#FFFFFF;border:1px solid #B3CFE7;height:20px;width:225px" />&nbsp;<span id="download_filename_error" style="color:red;display:none">文件名有误</span></td></tr>';m+='<tr><td style="width:100px;text-align:right;">选择Excel版本：</td><td><input type="radio" value="2003" id="'+d+'2003" name="'+d+'" checked /><label for="'+d+'2003">Excel 2003 (xls)</label>&nbsp;&nbsp;';m+='<input type="radio" value="2007" id="'+d+'2007" name="'+d+'" /><label for="'+d+'2007">Excel 2007 (xlsx)</label></td></tr><tr><td colspan="2" align="left"><span id="download_error" style="color:red;"></span></td></tr></table></div>';$("body").append(m);n=$("#"+h);n.parent().dialog({title:"预览效果",width:800,height:570,autoOpen:false,modal:true,resizable:false,close:function(){n.empty()}})}n.html(b);$("#"+j).bind("click",function(){$("#download_filename_error").hide()});var a="";if(window.currNavid==window.currTabsParentID){var l=$("#menu h2[navid="+window.currParentNavid+"]");var c=$("#menu li[navid="+window.currNavid+"]");if(l.length>0){a+=l.text()+" - "}if(c.length>0){a+=" - "+c.text()}}else{if(window.Level1Title){a+=window.Level1Title}if(window.Level2Title){a+=" - "+window.Level2Title}var g=$("#navtabs a[tabnavid="+window.currNavid+"]");if(g.length>0){a+=" - "+g.text()}}$("#"+j).val(a);$("#download_filename_error").hide();$("#download_error").empty();n.parent().dialog({buttons:{"确定":function(){k.version=$("input[name="+d+"]:checked").val();var o=/^[\/\\\:\*\?\<\>\|\"]{1,255}$/;k.filename=$("#"+j).val();k.filename=k.filename==undefined?"":commonFun.trim(k.filename);if(o.test(k.filename)){$("#download_filename_error").show();$("#"+j).focus();return false}$.ajax({url:config.requestData+"?downloadinfo=1",data:JSON.stringify(k),type:"post",dataType:"json",contentType:"application/json",success:function(p){if(p!=undefined&&p.key!=undefined){clearDownloadLayer();n.parent().dialog("close");if($("#downloadopen").length>0){$("#downloadopen").parent().remove()}$("body").append("<a target='_blank' href='"+config.requestData+"?downloadid="+p.key+"'><span id='downloadopen'></span></a>");$("#downloadopen").click()}else{if(p.error!=undefined&&p.error!=""){$("#download_error").text(p.error)}else{$("#download_error").text("下载失败")}n.scrollTop(n.height())}},error:function(){$("#download_error").text("请求发生异常");n.scrollTop(n.height())}})},"取消":function(){$(this).dialog("close")}}});n.parent().dialog("open")});controllShowShade(false)}function clearDownloadLayer(){controllShowShade(true);if($(".downloadshade").length>0){$(".downloadshade").remove()}$("#sys").css("visibility","visible");$("#editdownload").hide();window.currentDownloadStatus=false};function Element(g,a,j,e,d,k,h,l,c){var i=this;this.modelID=parseInt(d,10);this.elementName=k;this.dataJson=h;this.instanceID=parseInt(g,10);this.instanceType=parseInt(a,10);this.elementID=parseInt(j,10);this.elementType=parseInt(e,10);this.inputPin=l==null?new Array():l;this.outputPin=c==null?new Array():c;this.tempElement;this.maxPinID=0;this.showIDArr=[];this.displayContent=[];this.scatterXY=null;this.linetype="";this.maptype=null;this.repostpagesize=5;this.commentpagesize=5;this.allshow=[];this.firstrequestData;this.updateTime;this.requestGapArr=[];this.currentDataIndex={};this.needPostJson=true;this.issnap=false;this.hasalarm=false;$.each(this.inputPin,function(n,o){if(o.inpinid>i.maxPinID){i.maxPinID=o.inpinid}});$.each(this.outputPin,function(n,o){if(o.outpinid>i.maxPinID){i.maxPinID=o.outpinid}});this.modelShow;this.modelConfig;this.setSnapshot=function(o,n){i.firstrequestData=o;i.issnap=true;i.updateTime=n};this.clearSnapshot=function(){i.firstrequestData=null};var b=0;function f(){b++;if(b==i.allshow.length){if(!i.firstrequestData&&i.issnap==false||i.pagerefresh==false){i.firstRequest(i.dataJson,function(n){i.firstrequestData=n;i.updateTime=getTimeSec();$.each(i.allshow,function(p,o){o.requestCallBack(i.firstrequestData);if(p==i.allshow.length-1){setMenuHeight()}if(o.parentDOMID=="modelcondition"){if(i.modelID!=6){o.createOnsiteFilter()}if(o.remark!=""&&o.remark!=undefined){o.createRemark()}if(i.instanceType!=3&&i.modelID!=6){o.createModelshowSwitch()}else{}if(i.issnap&&i.modelID!=6){if(config.allowupdatesnapshot){if(i.dataJson.allowupdatesnapshot){o.createdSnapshotHistory()}}}}else{if(o.parentDOMID=="snapshot_preview_div"){if(i.instanceType!=3&&i.modelID!=6){o.createModelshowSwitch(o.parentDOMID)}}}if(i.issnap&&i.modelID!=6&&o.parentDOMID!="snapshot_preview_div"){o.appendSnapshotElement();if(config.allowupdatesnapshot){if(i.dataJson.allowupdatesnapshot){if(config.alloweventalert){if(i.dataJson.alloweventalert){o.appendEventAlert()}}}}}else{o.removeSnapshotElement()}});refreshOtherBtnPosition(i.elementID)},true,function(n){$.each(i.allshow,function(p,o){o.errorCallBack(n);if(o.parentDOMID=="modelcondition"){if(i.modelID!=6){o.createOnsiteFilter()}if(o.remark!=""&&o.remark!=undefined){o.createRemark()}if(i.instanceType!=3&&i.modelID!=6){o.createModelshowSwitch()}else{}if(i.issnap&&i.modelID!=6){if(config.allowupdatesnapshot){if(i.dataJson.allowupdatesnapshot){o.createdSnapshotHistory()}}}}else{if(o.parentDOMID=="snapshot_preview_div"){if(i.instanceType!=3&&i.modelID!=6){o.createModelshowSwitch(o.parentDOMID)}}}});refreshOtherBtnPosition(i.elementID)})}else{$.each(i.allshow,function(o,n){n.requestCallBack(i.firstrequestData);if(o==i.allshow.length-1){setMenuHeight()}if(n.parentDOMID=="modelcondition"){if(i.modelID!=6){n.createOnsiteFilter()}if(n.remark!=""&&n.remark!=undefined){n.createRemark()}if(i.instanceType!=3&&i.modelID!=6){n.createModelshowSwitch()}else{}if(i.issnap&&i.modelID!=6){if(config.allowupdatesnapshot){if(i.dataJson.allowupdatesnapshot){n.createdSnapshotHistory()}}}}else{if(n.parentDOMID=="snapshot_preview_div"){if(i.instanceType!=3&&i.modelID!=6){n.createModelshowSwitch(n.parentDOMID)}}}if(i.issnap&&i.modelID!=6&&n.parentDOMID!="snapshot_preview_div"){n.appendSnapshotElement();if(config.allowupdatesnapshot){if(i.dataJson.allowupdatesnapshot){if(config.alloweventalert){if(i.dataJson.alloweventalert){n.appendEventAlert()}}}}}else{n.removeSnapshotElement()}});refreshOtherBtnPosition(i.elementID)}}}this.show=function(o,n){b=0;i.needPostJson=n==undefined?true:n;$.each(i.allshow,function(p,q){if(q.newobj){createShowByID(q.showid,"",i,function(s){if(q.newobj==2){var r=q.id.split("show_");q.id=r[1]}s.setID(q.id,q.showid,q.parentdomid);s.setDataScope(q.scopetype,q.scopeobj);s.getDockFields();s.getRemark();s.getRemarkState();s.appendShowElement();s.setOnsitFilterJSON();s.getShowTitle();i.allshow[p]=s;s.render(function(){if(s.parentDOMID=="modelcondition"){setResize(s.targetID);changeWidthHeigh(s.targetID)}else{if(s.parentDOMID=="snapshot_preview_div"){setResize(s.targetID,undefined,"snapshot_preview_div");$(s.targetID).css({width:"98%",height:"463px"});if(s.aspectratio==-1){$(s.targetID).css({height:"auto"});var t=$(s.targetID).innerWidth();$(s.targetID).children().css({width:t*0.99,height:"auto"})}}else{$(s.targetID).css({width:"98%",height:"auto"});var t=$(s.targetID).innerWidth();$(s.targetID).children().css("width",t*0.98)}}s.beforeRender();f()})})}else{q.setOnsitFilterJSON();q.getShowTitle();q.render(function(){q.beforeRender();f()})}})};this.firstRequest=function(p,q,n,o){if(n==undefined){n=true}if(i.instanceType==2){i.linkageRequest(p,function(r){q(r)},function(r){o(r)})}else{if(i.instanceType==3){i.overlayRequest(p,function(r){q(r)},function(r){o(r)})}else{i.request(p,function(r){q(r)},n,function(r){o(r)})}}};this.setFormConfigData=function(o){i.dataJson.classifyquery=o.classifyquery;i.dataJson.contrast=o.contrast;i.dataJson.filtervalue=o.filtervalue;i.dataJson.filterrelation=o.filterrelation;if(o.fieldlist!=undefined){i.dataJson.fieldlist=o.fieldlist}for(var n in o.filter){if(i.dataJson.filter[n]!=undefined){i.dataJson.filter[n].isshow=o.filter[n].isshow}}};this.setOutputData=function(n){i.dataJson.output=n.output;i.dataJson.output.repostpagesize=i.repostpagesize;i.dataJson.output.commentpagesize=i.commentpagesize;i.dataJson.facet=n.facet};this.setShowType=function(n){i.showIDArr=[];$.each(n,function(p,o){if(!i.showIDArr.inArray(o.showtype)){i.showIDArr.push(o.showtype)}if(o.scatterXY&&o.scatterXY.x!=undefined){i.scatterXY=o.scatterXY}if(o.linetype!=undefined){i.linetype=o.linetype}if(o.maptype!=undefined){i.maptype=o.maptype;i.dataJson.maptype=o.maptype}if(o.displaycontent!=undefined&&o.displaycontent.length>0){$.each(o.displaycontent,function(q,r){if(!i.displayContent.inArray(r)){i.displayContent.push(r)}})}if(o.repostpagesize){i.repostpagesize=o.repostpagesize}if(o.commentpagesize){i.commentpagesize=o.commentpagesize}})};this.completeEdit=function(){var q;if(window.currInstance.instanceType==1){if(i.modelConfig.partFormConfig){var s=i.modelConfig.partFormConfig.getParams();if(!s){return false}if(i.onsitefilterDataJson){i.onsitefilterDataJson=undefined}}if(i.modelConfig.partOutput){var t=i.modelConfig.partOutput.getParams();if(!t||!i.modelConfig.partOutput.checkParams()){return false}}if(i.modelConfig.partShowmodel){var o=i.modelConfig.getModelShowType();i.setShowType(o);if(i.showIDArr.length==0){dialogAlert($("#modelshow_div"),"请选择可视化图表!");return false}else{if(!checkOverlayShow(i.showIDArr)){return false}}}i.setFormConfigData(s);if(t){i.setOutputData(t)}else{i.setOutputData(s)}if(i.modelConfig.partDistinct){if(!i.modelConfig.partDistinct.getParams()){return false}}if(i.modelConfig.partDataconfig){i.modelConfig.partDataconfig.getParams()}if(i.modelConfig&&i.modelConfig.partFormConfig.lastRelateJson!=null){i.dataJson.filterrelation=i.modelConfig.partFormConfig.lastRelateJson.filterrelation}if(i.dataJson.filterrelation==null){initFilterRelation(i.dataJson)}if(window.currInstance.instanceID<0&&window.currInstance.status==1){window.currInstance.preAdd();i.instanceID=window.currInstance.instanceID;window.currInstance.elements.push(i);window.instances.push(window.currInstance)}else{i.ischangemodel=false;if(window.currInstance.elements.length>0&&window.currInstance.elements[0].modelID!=i.modelID){i.ischangemodel=true;q=window.currInstance.elements[0];i.oldallshow=q.allshow;i.elementID=q.elementID}window.currInstance.elements[0]=i;if(window.currInstance.status==1){window.currInstance.preUpdate()}}}else{if(window.currInstance.instanceID<0&&window.currInstance.status==1){window.currInstance.preAdd();window.instances.push(window.currInstance)}else{if(window.currInstance.status==1){window.currInstance.preUpdate()}}}if(i.showIDArr.length>0){if(!i.ischangemodel){var r=[];for(var p=i.allshow.length-1;p>-1;p--){if(i.allshow[p].scopeType=="number"&&i.allshow[p].scope>=(i.dataJson.output.count-i.dataJson.output.data_limit)){r.push(i.allshow[p]);i.allshow.splice(p,1);continue}var n=true;$(i.showIDArr).each(function(u,v){if(i.allshow[p].showid==v&&i.allshow[p].showid==i.allshow[p].oldshowid){n=false;return false}});if(n){r.push(i.allshow[p]);i.allshow.splice(p,1)}}$(r).each(function(u,v){v.destroy()})}else{$.each(window.currInstance.elements,function(v,w){if(w.ischangemodel&&w.oldallshow!=undefined){for(var u=w.oldallshow.length-1;u>-1;u--){w.oldallshow[u].destroy()}w.oldallshow=undefined}w.ischangemodel=false});i.allshow=[]}$(i.showIDArr).each(function(v,x){if(x=="userfollowers"||x=="weiborepost"||x=="weibocomment"||x=="weixinrepost"){i.dataJson.output.count=1;for(var u=0;u<i.dataJson.output.count;u++){var w=false;$.each(i.allshow,function(z,y){if(y.showid!=undefined&&y.showid==x&&y.scope==u){w=true;return false}});if(!w){i.allshow.push({newobj:true,id:Global.GetNextShowID(),showid:x,scopetype:"number",scopeobj:u})}}}else{var w=false;$.each(i.allshow,function(z,y){if(y.showid!=undefined&&y.showid==x){y.setDownloadFields([],[]);w=true;return false}});if(!w){i.allshow.push({newobj:true,id:Global.GetNextShowID(),showid:x,scopetype:"all",scopeobj:null})}}})}if(i.modelID!=6){i.clearSnapshot()}i.show();changePage(1);setMenuHeight();return true};this.editForm=function(n,o){$("#editelementdiv").hide();if(!i.modelConfig){i.modelConfig=createCustomConfig(n,i)}if(!i.modelConfig){return false}this.tempElement=null;i.modelConfig.renderEditForm(o);if(!o||(o&&i.subInstanceType!=undefined&&i.subInstanceType==1)){$("#editdiv").dialog("option","buttons",{"确定":function(){if(i.instanceType==3){if(window.overlayobj.completeAddElement(i)){$(this).dialog("close")}}else{if(i.completeEdit()){$(this).dialog("close")}}},"取消":function(){$(this).dialog("close")}})}if(i.showIDArr.length==0){i.modelConfig.setModelShowType(["filterchart"])}else{i.modelConfig.setModelShowType(i.showIDArr,i.displayContent,i.dataJson.output.repostpagesize,i.dataJson.output.commentpagesize,i.scatterXY,i.maptype,i.linetype)}setmodelshowGroupActive(i.dataJson);setAccordionGroup(n+" div[name=accordiondiv]");$("#editelementdiv").show()};this.editAuth=function(n){if(!i.modelConfig){i.modelConfig=createCustomConfig(n,i)}if(!i.modelConfig){return false}i.modelConfig.renderEditAuth()};this.showForm=function(n){if(!i.modelConfig){i.modelConfig=createCustomConfig(n,i)}if(!i.modelConfig){return false}i.modelConfig.renderForm();i.modelConfig.setModelShowType(["filterchart"])};this.editLinkage=function(n,o){$("#editelementdiv").hide();$("#editdiv").dialog("option","close",function(){i.removeTempPin();i.undoDeletePin();$("#tabdiv").tabs("destroy")});$("#editdiv").dialog("option","buttons",{"确定":function(){var p=i.modelConfig.getModelShowType();i.setShowType(p);if(window.linkageobj.completeAddElement(i)){$(this).dialog("close")}},"取消":function(){$(this).dialog("close")}});if(!i.modelConfig){i.modelConfig=createCustomConfig(n,i)}if(!i.modelConfig){return false}this.tempElement=null;i.modelConfig.renderLinkage(o);i.modelConfig.setModelShowType(i.showIDArr,i.displayContent,i.dataJson.output.repostpagesize,i.dataJson.output.commentpagesize,i.scatterXY,i.maptype,i.linetype);setmodelshowGroupActive(i.dataJson);setAccordionGroup(n+" div[name=accordiondiv]");$("#editelementdiv").show()};this.request=function(v,r,p,q,w){if(w==undefined){w=false}if(i.instanceType==2&&(!w||i.elementType==3)){i.linkageRequest(v,function(x){r(x)},function(x){q(x)});return}if(p==undefined){p=true}if(r==undefined||r==""||r==null){r=new Function()}var t=1;var o={};if(window.currTypeID==2&&!i.needPostJson&&!window.currEditStatus){t=0}else{if(v){o=v}}var u="";$.each(i.displayContent,function(y,x){if(x=="retweeted"){u+="&returnoriginal=1"}else{if(x=="repost"){u+="&returnrepost=1"}else{if(x=="comment"){u+="&returncomment=1"}}}});var n="";if(i.isdrilldown){n="&isdrilldown=1"}var s=config.requestData+"?instanceid="+i.instanceID+"&elementid="+i.elementID+"&hasformjson="+t+u+n;$.ajax({type:"POST",dataType:"json",async:p,data:JSON.stringify(o),url:s,contentType:"application/json",success:function(y){if(y.errorcode!=undefined){q(y.error)}else{if(y.outlimit==undefined){if(!isEmptyData(y)){var x=true;if(i.dataJson.classifyquery!=null&&i.dataJson.classifyquery.xcombined){x=checkSuitableXcombined(y)}if(!x){q("x轴数据不一致!")}else{r(y)}}else{q("查询的数据不存在.")}}else{var z=getErrorLabel(y,i.dataJson);q("<b>"+z+"</b> 超出限制.")}}},error:function(x,z,y){if(q){errormsg=formatErrorMsg(x.responseText);q(errormsg)}}})};this.saveConfig=function(){};this.saveAuth=function(){};this.undoDeletePin=function(){$(i.inputPin).each(function(n,o){if(o.deleted){delete i.inputPin[n].deleted}});$(i.outputPin).each(function(n,o){if(o.deleted){delete i.outputPin[n].deleted}})};this.enableTempPin=function(){for(var n=i.inputPin.length-1;n>-1;n--){if(i.inputPin[n].istemp){delete i.inputPin[n].istemp}}for(var n=i.outputPin.length-1;n>-1;n--){if(i.outputPin[n].istemp){delete i.outputPin[n].istemp}}};this.removeTempPin=function(){for(var n=i.inputPin.length-1;n>-1;n--){if(i.inputPin[n].istemp){i.inputPin.splice(n,1)}}for(var n=i.outputPin.length-1;n>-1;n--){if(i.outputPin[n].istemp){i.outputPin.splice(n,1)}}};this.addInputPin=function(o){var n={};n.istemp=true;n.instanceid=i.instanceID;n.inelementid=i.elementID;n.inpinid=i.getNextPinID();n.inputdata=o;n.outelementid=null;n.outpinid=null;n.outputdata=null;i.inputPin.push(n);return n.inpinid};this.getNextPinID=function(){i.maxPinID++;return i.maxPinID};this.addOutputPin=function(o){var n={};n.istemp=true;n.instanceid=i.instanceID;n.inelementid=null;n.inpinid=null;n.inputdata=null;n.outelementid=i.elementID;n.outpinid=i.getNextPinID();n.outputdata=o;i.outputPin.push(n);return n.outpinid};this.linkedPinValue=function(n){if(n.outputdata.pintype=="static"){appendStaticPin2Filtervalue(i.dataJson,n)}else{appendDynamicPin2Filtervalue(i.dataJson,n)}if(i.modelConfig&&i.modelConfig.partFormConfig){i.modelConfig.partFormConfig.onFormChange()}else{i.dataJson.filterrelation=null}};this.unlinkPinValue=function(n){if(i.dataJson.contrast&&i.contrast.fieldname==n.inputdata.value){if(i.dataJson.contrast.filtervalue){for(var o=i.dataJson.contrast.filtervalue.length-1;o>-1;o--){if(fieldvalueIsInPindata(i.dataJson.contrast.filtervalue[o].fieldvalue,n)){i.dataJson.contrast.filtervalue.splice(o,1)}}}}else{if(i.dataJson.classifyquery&&i.dataJson.classifyquery.fieldname==n.inputdata.value){$(i.datajson.filtervalue).each(function(q,p){if(p.fieldname==i.dataJson.classifyquery.fieldname&&p.fieldvalue.datatype=="array"){for(m=p.fieldvalue.value.length-1;m>-1;m--){if(fieldvalueIsInPindata(p.fieldvalue.value[m],n)){p.fieldvalue.value.splice(m,1)}}return false}})}else{for(var o=i.dataJson.filtervalue.length-1;o>-1;o--){if(i.dataJson.filtervalue[o].fieldname==n.inputdata.value&&fieldvalueIsInPindata(i.dataJson.filtervalue[o].fieldvalue,n)){i.dataJson.filtervalue.splice(o,1)}}}}if(i.modelConfig&&i.modelConfig.partFormConfig){i.modelConfig.partFormConfig.onFormChange()}else{i.dataJson.filterrelation=null}};this.getIndexInGapArr=function(p,o){var n;$.each(p,function(r,q){if(q===o){n=r;return false}});return n};this.getfacetrangegap=function(o){var q="";var n;if(o==undefined){var p=getRangeValue(i.dataJson.facet);q=p.gap}else{var p=getRangeValue(o.facet);q=p.gap}if(q!=undefined){if(q.indexOf("year")!=-1){n="y"}else{if(q.indexOf("month")!=-1){n="m"}else{if(q.indexOf("day")!=-1){n="d"}else{if(q.indexOf("hour")!=-1){n="h"}else{n=""}}}}}return n};this.timeGapArr=function(s,I,q){var y=[];var E=[];var n=new Date(s*1000);var F=new Date(I*1000);var w="";var v=1;if(q!=undefined&&q!=null){if(q.indexOf("month")!=-1){var H=q.split("month");v=parseInt(H[0],10);w="m"}else{if(q.indexOf("day")!=-1){var H=q.split("day");v=parseInt(H[0],10);w="d"}else{if(q.indexOf("hour")!=-1){var H=q.split("hour");v=parseInt(H[0],10);w="h"}else{v=1;w="m"}}}}var p=i.dataJson.output.data_limit-1;if(p<0){p=0}var r=i.dataJson.output.count;var t=p+r;var x=n.dateDiff(w,F);var o=n;y.push(s);var A=true;for(var B=0;B<x;B+=v){var u=o.dateAdd(w,v);var G=Date.parse(u);var D;if(G/1000>I){D=I}else{D=G/1000}y.push(D);if(t==y.length){A=false;break}o=new Date(G)}if(A&&(y[y.length-1]<I)){y.push(I)}for(var B=0;B<y.length-1;B++){var C={};C.starttime=y[B];E.push(C)}for(var z=1;z<y.length;z++){E[z-1].endtime=y[z]}return E};this.getLinkedOutputPin=function(q){var n=[];if(i.instanceType==2||(i.instanceType==3&&i.subInstanceType==2)){var o=i.instanceID;var p=window.currInstance;if(p&&p.pinRelation&&p.pinRelation.length>0){$(p.pinRelation).each(function(r,s){if(s.inelementid==i.elementID&&s.outputdata.pintype==q){n.push(s)}})}}return n};this.isInputPin=function(n){var o=false;$(i.inputPin).each(function(q,p){if(p.inputdata.value==n){o=true;return false}});return o};this.getAllDynamicData=function(p){var n=[];var o=[];if(p){$(p.elements).each(function(r,q){var t=false;for(var s=p.pinRelation.length-1;s>-1;s--){if(p.pinRelation[s].outelementid==q.elementID&&p.pinRelation[s].outputdata.datatype=="dynamic"){t=true;break}}if(!t){return true}if(q.elementType==1){n.push(q)}else{if(q.elementType==3){o.push(q)}}});if(p.allDynamicData==null){p.allDynamicData=[];$(n).each(function(q,r){var s=config.requestData+"?instanceid="+r.instanceID+"&elementid="+r.elementID+"&hasformjson=1";$.ajax({type:"POST",dataType:"json",async:false,data:JSON.stringify(r.dataJson),url:s,contentType:"application/json",success:function(u){if(u&&u.error==undefined&&u.length>0&&u[0].datalist){var t={elementid:r.elementID,output:u[0].datalist};p.allDynamicData.push(t)}},error:function(){alert("数据请求异常!")}})});$(o).each(function(q,s){var r=deepClone(s.dataJson);i.handlePinValue(p,s.elementID,r);var t=config.requestData+"?instanceid="+s.instanceID+"&elementid="+s.elementID+"&hasformjson=1";$.ajax({type:"POST",dataType:"json",async:false,data:JSON.stringify(r),url:t,contentType:"application/json",success:function(v){if(v&&v.error==undefined&&v.length>0&&v[0].datalist){var u={elementid:s.elementID,output:v[0].datalist};p.allDynamicData.push(u)}},error:function(){alert("数据请求异常!")}})})}}};this.handlePinValue=function(r,t,q){var s=false;for(var p=r.pinRelation.length-1;p>-1;p--){if(r.pinRelation[p].inelementid==t){if(q.filtervalue==null||q.filtervalue.length==0){var u=createFiltervalue(r.pinRelation[p].inputdata.value,"array",[]);q.filtervalue.push(u);s=true}for(var o=0;o<q.filtervalue.length;o++){if(q.filtervalue[o].fieldname==r.pinRelation[p].inputdata.value){q.filtervalue[o].opt=r.pinRelation[p].inputdata.opt;var n=q.filter[q.filtervalue[o].fieldname].datatype;if(r.pinRelation[p].outputdata.pintype=="static"){$(r.pinRelation[p].outputdata.value).each(function(w,v){var y={};y.datatype=n;var z=i.getStaticPinRealValue(v,y.datatype);y.value=z;q.filtervalue[o].fieldvalue.value.push(y)})}else{$(r.allDynamicData).each(function(w,v){if(r.pinRelation[p].outelementid==v.elementid){$(r.pinRelation[p].outputdata.value).each(function(z,x){if(v.output[x]){var y=i.getDynamicRealValue(v.elementid,v.output[x],n);q.filtervalue[o].fieldvalue.value.push(y)}});return false}})}break}}}}if(s){initFilterRelation(q)}};this.linkageRequest=function(r,x,p){if(i.elementType==2){var o;$(window.instances).each(function(y,z){if(z.instanceID==i.instanceID){o=z;return false}});if(o){if(r.filterrelation==null){initFilterRelation(r)}var u={instanceid:i.instanceID,elements:[],pinrelation:[],render:{elementid:i.elementID,datajson:r}};var w=true;$(o.pinRelation).each(function(y,z){if(z.outputdata.pintype=="dynamic"){w=false;return false}});$(o.elements).each(function(y,z){if(z.dataJson.filterrelation==null){initFilterRelation(z.dataJson)}if(!w&&z.elementID!=i.elementID){u.elements.push({elementid:z.elementID,datajson:z.dataJson})}});u.pinrelation=o.pinRelation;var s="";$.each(i.displayContent,function(z,y){if(y=="retweeted"){s+="&returnoriginal=1"}else{if(y=="repost"){s+="&returnrepost=1"}else{if(y=="comment"){s+="&returncomment=1"}}}});var n="";if(i.isdrilldown){n="&isdrilldown=1"}var q=config.requestData+"?islinkage=1&hasformjson=1"+s+n;$.ajax({type:"POST",dataType:"json",async:true,data:JSON.stringify(u),url:q,contentType:"application/json",success:function(y){if(y.errorcode!=undefined){p(y.error)}else{if(y.outlimit==undefined){if(!isEmptyData(y)){x(y)}else{if(p){p("查询的数据不存在.")}}}else{if(p){var z=getErrorLabel(y,r);p("<b>"+z+"</b> 超出限制.")}}}},error:function(y,A,z){if(p){errormsg=formatErrorMsg(y.responseText);p(errormsg)}}})}}else{var o;$(window.instances).each(function(y,z){if(z.instanceID==i.instanceID){o=z;return false}});if(o){if(r.filterrelation==null){initFilterRelation(r)}var u={instanceid:i.instanceID,elements:[],pinrelation:[],render:{elementid:i.elementID,datajson:r}};var w=true;var v=[];$.each(o.pinRelation,function(z,y){if(y.outelementid<i.elementID){v.push(y)}});$(v).each(function(y,z){if(z.outputdata.pintype=="dynamic"){w=false;return false}});$(o.elements).each(function(y,z){if(z.dataJson.filterrelation==null){initFilterRelation(z.dataJson)}if(!w&&z.elementID<i.elementID){u.elements.push({elementid:z.elementID,datajson:z.dataJson})}});u.pinrelation=v;var t="";var q=config.requestData+"?islinkage=1&hasformjson=1"+t;$.ajax({type:"POST",dataType:"json",async:true,data:JSON.stringify(u),url:q,contentType:"application/json",success:function(y){if(y.errorcode!=undefined){p(y.error)}else{if(y.outlimit==undefined){if(!isEmptyData(y)){x(y)}else{if(p){p("查询的数据不存在.")}}}else{if(p){var z=getErrorLabel(y,r);p("<b>"+z+"</b> 超出限制.")}}}},error:function(y,A,z){if(p){errormsg=formatErrorMsg(y.responseText);p(errormsg)}}})}}};this.overlayRequest=function(u,y,q){var o;$(window.instances).each(function(z,A){if(A.instanceID==i.instanceID){o=A;return false}});if(o){o.elements.sort(function(A,z){return parseInt(A.overlayindex,10)-parseInt(z.overlayindex,10)});var w=[];var x=[];var p={};$.each(o.elements,function(A,D){var E={};if(u.onsitefilter&&D.onsitefilterDataJson){E=D.onsitefilterDataJson}else{E=D.dataJson}if(E.filterrelation==null){initFilterRelation(E)}if(!x.inArray(D.overlayindex)){x.push(D.overlayindex);p.datajson={instanceid:i.instanceID,elements:[],pinrelation:[],render:{elementid:i.elementID,datajson:u}}}if(D.subInstanceType==1){var C={};C.elementid=D.elementID;C.instanceid=o.instanceID;C.instancetype=1;C.modelname=D.modelname;C.referencedata=D.referencedata;C.secondaryyaxis=D.secondaryyaxis;C.showid=D.showid;C.referencedataratio=D.referencedataratio;C.datajson=E;if(D.referencedata){w.splice(0,0,C)}else{if(D.secondaryyaxis){w.splice(1,0,C)}else{w.push(C)}}}else{if(D.subInstanceType==2){if(D.overlayindex==x[x.length-1]){p.instancetype=2;var z=true;$(o.pinRelation).each(function(F,G){if(G.overlayindex==D.overlayindex){if(G.outputdata.pintype=="dynamic"){z=false;return false}}});if(!z&&D.elementType!=2){p.datajson.elements.push({elementid:D.elementID,datajson:E})}$(o.pinRelation).each(function(G,F){if(F.overlayindex==D.overlayindex){p.datajson.pinrelation.push(F)}});if(D.elementType==2){var B=deepClone(p);B.modelname=D.modelname;B.referencedata=D.referencedata;B.secondaryyaxis=D.secondaryyaxis;B.showid=D.showid;B.referencedataratio=D.referencedataratio;B.datajson.render.datajson=E;if(D.referencedata){w.splice(0,0,B)}else{if(D.secondaryyaxis){w.splice(1,0,B)}else{w.push(B)}}}}}}});var v="";if(parseInt(u.output.outputtype,10)==1){v="&returnoriginal=1"}var n="";if(o.xcombined){n="&overlayxcombined=1"}var s="";if(o.xzreverse){s="&overlayxzreverse=1"}var r="";if(o.columnstacking){r="&overlaycolumnstacking=1"}var t=config.requestData+"?isoverlay=1&hasformjson=1"+v+n+s+r;$.ajax({type:"POST",dataType:"json",async:true,data:JSON.stringify(w),url:t,contentType:"application/json",success:function(A){if(A.errorcode!=undefined){q(A.error)}else{if(A.outlimit==undefined){if(!isEmptyData(A)){var z=true;if(o.xcombined!=undefined&&o.xcombined){z=checkSuitableXcombined(A)}if(!z){q("x轴数据不一致!")}else{y(A)}}else{if(q){q("查询的数据不存在.")}}}else{if(q){var B=getErrorLabel(A,u);q("<b>"+B+"</b> 超出限制.")}}}},error:function(z,B,A){if(q){errormsg=formatErrorMsg(z.responseText);q(errormsg)}}})}};this.getStaticPinRealValue=function(p,n){var o;switch(n){case"valut_text_object":o={text:p.text,value:p.value};break;case"blur_value_object":o={blur:"tbnull",value:p.value};break;default:o=p.value;break}return o};this.getDynamicRealValue=function(q,p,o){switch(q){case allmodels.foltop:return{datatype:"string",value:p.screen_name};case allmodels.userstatistics:case allmodels.topkeyword:var s="";var r="";if(p.alias!=undefined){s=p.text;r=p.alias}else{if(p.text==undefined){for(var n in p){if(n.indexOf("text")==0){r+=p[n]+","}}if(r!=""){r=r.substr(0,r.lenth-1)}s=r;r=r}else{r=p.text;s=p.text}}var t;switch(o){case"valut_text_object":t={text:pinvalue.text,value:s};break;case"blur_value_object":t={blur:"tbnull",value:s};break;default:t=s;break}return{datatype:"string",value:t};case allmodels.weiboquery:return{datatype:"string",value:p.id};break;default:return"";break}}};function Instance(c,a,b){var d=this;this.status=1;this.navID=c;this.instanceID=a;this.instanceType=b;this.title="";this.elements=new Array();this.pinRelation=new Array();this.allDynamicData=null;this.completeEdit=function(){d.status=1};this.preAdd=function(){d.status=3};this.preUpdate=function(){d.status=2};this.preDelete=function(){d.status=0;d.elements=null;d.pinRelation=null};this.editWidget=function(e,f){if(d.instanceType==1){d.elements[0].showIDArr=[f];d.elements[0].editWidget(e)}else{if(window.linkageobj==null){window.linkageobj=new Linkage()}window.linkageobj.show(true)}};this.edit=function(e,h,f){if(d.instanceType==1){var g=[];if(f){g=[h]}else{$("div[elementid="+d.elements[0].elementID+"][instanceid="+d.instanceID+"]").each(function(j,k){if($(this).attr("showid").length>0){g.push($(this).attr("showid"))}})}d.elements[0].showIDArr=g;d.elements[0].editForm(e,f)}else{if(d.instanceType==3){$.each(d.elements,function(i,j){if(j.showid!=undefined){if(!d.elements[i].showIDArr.inArray(j.showid)){d.elements[i].showIDArr.push(j.showid)}}});if(window.overlayobj==null){window.overlayobj=new Overlay()}window.overlayobj.show(f,h)}else{if(window.linkageobj==null){window.linkageobj=new Linkage()}window.linkageobj.show(f,h)}}};this.save=function(e,f){var g={};g.delincids=[];g.newinc=[];var h={instanceid:d.instanceID,navid:d.navID,instancetype:d.instanceType,title:d.title};if(d.xcombined){h.xcombined=d.xcombined}if(d.xzreverse){h.xzreverse=d.xzreverse}if(d.columnstacking){h.columnstacking=d.columnstacking}h.elements=[];$(d.elements).each(function(l,k){var j={};j.instanceid=k.instanceID;j.elementid=k.elementID;j.modelid=k.modelID;j.type=k.elementType;j.content=k.dataJson;j.title=k.elementName;if(k.subInstanceType){j.subInstanceType=k.subInstanceType}if(k.overlayindex){j.overlayindex=k.overlayindex}if(k.modelname){j.modelname=k.modelname}if(k.referencedata){j.referencedata=k.referencedata}if(k.secondaryyaxis){j.secondaryyaxis=k.secondaryyaxis}if(k.showid){j.showid=k.showid}if(k.referencedataratio){j.referencedataratio=k.referencedataratio}j.issavesnapshot=k.issnap;if(k.elementType==2&&k.issnap&&k.firstrequestData){for(var i=0;i<k.firstrequestData[0].datalist.length;i++){formatSnapshotData(k.firstrequestData[0].datalist[i].showdata);formatSnapshotData(k.firstrequestData[0].datalist[i].showdata2)}j.snapshot=k.firstrequestData}h.elements.push(j)});h.pinrelation=d.pinRelation;g.newinc.push(h);$.ajax({url:config.saveInstanceUrl,type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(g),success:function(i){if(typeof e!="undefined"){e.call(null,i)}},error:function(){if(typeof f!="undefined"){f.call(null)}}})}};function createLeft(a,b,d,c){var a=a;var b=b;var d=d;var c=c;this.firstLevelClick=function(g){var h=a;$(h+" ul").hide();var f=$(g).next();if(f.html()!=null){if(f[0].tagName.toLowerCase()!="ul"){$(h+" h2").removeClass("menuh1");$(g).addClass("menuh1")}if(f[0].tagName.toLowerCase()=="ul"){$(h+" h2").removeClass("menuh1");$(g).addClass("menuh1");if(f.css("display")=="none"){$(g).next().show("slow")}else{$(g).next().hide("slow")}}}else{$(h+" h2").removeClass("menuh1");$(g).addClass("menuh1");var e=$(g).children("img")}};this.secondLevelClick=function(e){editTips(function(){var j=$(e).attr("navid");var h=$(e).attr("pagetype");var k=$(e).attr("filepath");var f=$(e).attr("pagetitle");f=f==undefined?"":f;window.currPagetype=h;if(window.Global!=undefined&&Global.RequestQueue!=undefined){var l=new Date();var g=l.getTime();Global.RequestQueue.setTag(g+"_"+j)}window.currNavid=j;window.currTabsParentID=j;window.currParentNavid=$(e).parent().prev().attr("navid");window.currFilepath=k;window.currTabsParentFilepath=k;window.currInstance=null;window.currMergedata=null;window.currMergeSched=null;window.instances=[];$("#modelselect").empty();$("body").find("div[id^=show_]").css("display","none");$("#lidownloadexcel").hide();$(a+" h2").removeClass("menuh1");$(e).parent().prev().addClass("menuh1");$(a+" ul li").removeClass("cho");$(a+" ul li").css("cursor","pointer");$(a+" ul li img").css("display","none");$(e).addClass("cho");$(e).css("cursor","pointer");$(e).find("img").css("display","");var i=$(e).parent().prev().text();window.Level1Title=i;window.Level2Title=f;setTopNav(i,f);document.title=(Global.webname?Global.webname+"-":"")+i+"-"+f;createRight(b,j,h,k)})};this.init=function(){window.snapid="";window.snapshotlevel1id="";window.snapshotlevel2id="";window.snapshotlevel3id="";window.snapshotincid="";window.snapshoteleid="";var f="";var e=config.phpUrl+"modelinterface.php?type=getsnapshotshowinfo";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:e,async:false,beforeSend:function(){},success:function(h){if(h!=null&&h.result){window.snapid=h.snapshotinfo.snapid;window.snapshotlevel1id=h.snapshotinfo.level1id;window.snapshotlevel2id=h.snapshotinfo.level2id;window.snapshotlevel3id=h.snapshotinfo.level3id;window.snapshotincid=h.snapshotinfo.instanceid;window.snapshoteleid=h.snapshotinfo.elementid}},complete:function(){},error:function(){}});var g=config.leftmenuUrl;if(b==1){g=config.platformLeftmenuUrl(c)}ajaxRequest(g,function(o){var p="";if(o!=null){var n;var j;var m=0;$.each(o,function(r,q){var t="";var s=b==1?"_"+m.toString():q.id;var l=b==1?q.name:q.pagetitle;if(window.snapshotlevel1id!=""){if(window.snapshotlevel1id==s){t="class='menuh1'";n=s}}else{if(q.isdefault===true){t="class='menuh1'";n=s}}if(q.icon==null||q.icon==""){q.icon="images/pot1.gif"}p+="<h2 "+t+" pagetitle = '"+l+"' navid="+s+" style='cursor:pointer;' ><img src=\""+q.icon+'" align="absmiddle" />'+q.name+"</h2>";m++;if(q.childNav!=null&&q.childNav!=""){p+="<ul class='son'>";$.each(q.childNav,function(y,x){var B=b==1?x.modelid:x.id;var A=b==1?1:x.modelType;var w=b==1?x.name:x.pagetitle;var u="";var z="style='display:none;'";if(window.snapshotlevel2id!=""){if(window.snapshotlevel2id==B){u="class='cho'";j=B;z=""}}else{if(x.isdefault==true){u="class='cho'";j=B;z=""}}p+="<li "+u+"  navid='"+B+"' pagetitle = '"+w+"' pagetype='"+A+"' filepath='"+x.filepath+"' ><img src='images/arrow.gif' align='absmiddle' "+z+"/>"+x.name+"</li>";m++});p+="</ul>"}});$(a).html(p);$(a+" ul li").bind("click",function(){secondLevelClick(this)});$(a+" h2").bind("click",function(){firstLevelClick(this)});if(j!=null&&j!=""&&j!=undefined){var h=$(a+" li[navid="+j+"]");var k=$(h).parent().prev();firstLevelClick(k);secondLevelClick(h)}else{var k=$(a+" h2:first-child");if(k.length>0){var i=k.next();if(i.length>0&&i.children().length>0){var h=i.find("li:first-child");if(h.length>0){firstLevelClick(k);secondLevelClick(h)}}}}}},"json")};this.init()};function createCustomConfig(targetID,element){var filename="";var cname="";switch(element.modelID){case allmodels.foltop:filename=config.controller+"user/foltop_config.js";cname="FoltopConfig";break;case allmodels.fritop:case allmodels.topkeyword:case allmodels.toptopic:filename=config.controller+"topic/topic_config.js";cname="TopicConfig";break;case allmodels.weiboquery:filename=config.controller+"weibo/weibo_config.js";cname="WeiboConfig";break;case allmodels.userstatistics:filename=config.controller+"userstatistics/user_config.js";cname="UserConfig";break;case allmodels.virtualdatasource:filename=config.controller+"virtualdatasource/virtualdata_config.js";cname="VirtualdataConfig";break;default:break}var result=null;if(filename!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);")}else{$.ajax({type:"GET",url:filename,async:false,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);")},error:function(){alert("数据请求异常!")}})}}return result}function createConfigPart(modelID,part,param){var result=null;var filepath;var cname;switch(modelID){case allmodels.foltop:switch(part){case"formconfig":filepath=config.controller+"user/parts/foltop_config_part_formconfig.js";cname="FlotopConfigPartFormConfig";break;case"saveform":filepath=config.controller+"user/parts/foltop_config_part_saveform.js";cname="FlotopConfigPartSaveForm";break;case"authconfig":filepath=config.controller+"user/parts/foltop_config_part_authconfig.js";cname="FlotopConfigPartAuthConfig";break;case"analysis":filepath=config.controller+"user/parts/foltop_config_part_analysis.js";cname="FlotopConfigPartAnalysis";break;case"listpart":filepath=config.controller+"public/part_list.js";cname="ListPart";break;case"outputpin":filepath=config.controller+"public/part_outputpin.js";cname="PartOutputPin";break;case"inputpin":filepath=config.controller+"public/part_inputpin.js";cname="PartInputPin";break;case"linkagesearch":filepath=config.controller+"public/part_linkagesearch.js";cname="LinkageSearch";break;case"addelement":filepath=config.controller+"public/part_addelement.js";cname="AddElementButton";break;case"modelshow":filepath=config.controller+"public/part_modelshow.js";cname="PartModelShow";break;case"dataconfig":filepath=config.controller+"public/part_dataconfig.js";cname="PartDataConfig";break;case"editwidgetbutton":filepath=config.controller+"public/part_editwidgetbutton.js";cname="EditWidgetButton";break;default:break}break;case allmodels.userstatistics:switch(part){case"formconfig":filepath=config.controller+"userstatistics/parts/user_config_part_formconfig.js";cname="UserConfigPartFormConfig";break;case"output":filepath=config.controller+"userstatistics/parts/user_config_part_output.js";cname="UserConfigPartOutput";break;case"saveform":filepath=config.controller+"userstatistics/parts/user_config_part_saveform.js";cname="UserConfigPartSaveForm";break;case"authconfig":filepath=config.controller+"userstatistics/parts/user_config_part_authconfig.js";cname="UserConfigPartAuthConfig";break;case"analysis":filepath=config.controller+"userstatistics/parts/user_config_part_analysis.js";cname="UserConfigPartAnalysis";break;case"distinct":filepath=config.controller+"public/part_distinct.js";cname="PartDistinct";break;case"listpart":filepath=config.controller+"public/part_list.js";cname="ListPart";break;case"outputpin":filepath=config.controller+"public/part_outputpin.js";cname="PartOutputPin";break;case"inputpin":filepath=config.controller+"public/part_inputpin.js";cname="PartInputPin";break;case"linkagesearch":filepath=config.controller+"public/part_linkagesearch.js";cname="LinkageSearch";break;case"addelement":filepath=config.controller+"public/part_addelement.js";cname="AddElementButton";break;case"modelshow":filepath=config.controller+"public/part_modelshow.js";cname="PartModelShow";break;case"dataconfig":filepath=config.controller+"public/part_dataconfig.js";cname="PartDataConfig";break;case"editwidgetbutton":filepath=config.controller+"public/part_editwidgetbutton.js";cname="EditWidgetButton";break;default:break}break;case allmodels.virtualdatasource:switch(part){case"formconfig":filepath=config.controller+"virtualdatasource/parts/virtualdata_config_part_formconfig.js";cname="VirtualdataConfigPartFormConfig";break;case"output":filepath=config.controller+"virtualdatasource/parts/virtualdata_config_part_output.js";cname="VirtualdataConfigPartOutput";break;case"distinct":filepath=config.controller+"public/part_distinct.js";cname="PartDistinct";break;case"listpart":filepath=config.controller+"public/part_list.js";cname="ListPart";break;case"outputpin":filepath=config.controller+"public/part_outputpin.js";cname="PartOutputPin";break;case"inputpin":filepath=config.controller+"public/part_inputpin.js";cname="PartInputPin";break;case"linkagesearch":filepath=config.controller+"public/part_linkagesearch.js";cname="LinkageSearch";break;case"addelement":filepath=config.controller+"public/part_addelement.js";cname="AddElementButton";break;case"modelshow":filepath=config.controller+"public/part_modelshow.js";cname="PartModelShow";break;case"dataconfig":filepath=config.controller+"public/part_dataconfig.js";cname="PartDataConfig";break;case"editwidgetbutton":filepath=config.controller+"public/part_editwidgetbutton.js";cname="EditWidgetButton";break;default:break}break;case allmodels.topkeyword:switch(part){case"formconfig":filepath=config.controller+"topic/parts/topic_config_part_formconfig.js";cname="TopicConfigPartFormConfig";break;case"analysis":filepath=config.controller+"topic/parts/topic_config_part_analysis.js";cname="TopicConfigPartAnalysis";break;case"output":filepath=config.controller+"topic/parts/topic_config_part_output.js";cname="TopicConfigPartOutput";break;case"modelshow":filepath=config.controller+"public/part_modelshow.js";cname="PartModelShow";break;case"distinct":filepath=config.controller+"public/part_distinct.js";cname="PartDistinct";break;case"saveform":filepath=config.controller+"user/parts/foltop_config_part_saveform.js";cname="FlotopConfigPartSaveForm";break;case"listpart":filepath=config.controller+"public/part_list.js";cname="ListPart";break;case"outputpin":filepath=config.controller+"public/part_outputpin.js";cname="PartOutputPin";break;case"inputpin":filepath=config.controller+"public/part_inputpin.js";cname="PartInputPin";break;case"linkagesearch":filepath=config.controller+"public/part_linkagesearch.js";cname="LinkageSearch";break;case"addelement":filepath=config.controller+"public/part_addelement.js";cname="AddElementButton";break;case"dataconfig":filepath=config.controller+"public/part_dataconfig.js";cname="PartDataConfig";break;case"editwidgetbutton":filepath=config.controller+"public/part_editwidgetbutton.js";cname="EditWidgetButton";break;default:break}break;case allmodels.weiboquery:switch(part){case"formconfig":filepath=config.controller+"weibo/parts/weibo_config_part_formconfig.js";cname="WeiboConfigPartFormConfig";break;case"analysis":filepath=config.controller+"weibo/parts/weibo_config_part_analysis.js";cname="WeiboConfigPartAnalysis";break;case"output":filepath=config.controller+"weibo/parts/weibo_config_part_output.js";cname="WeiboConfigPartOutput";break;case"distinct":filepath=config.controller+"public/part_distinct.js";cname="PartDistinct";break;case"modelshow":filepath=config.controller+"public/part_modelshow.js";cname="PartModelShow";break;case"saveform":filepath=config.controller+"user/parts/foltop_config_part_saveform.js";cname="FlotopConfigPartSaveForm";break;case"listpart":filepath=config.controller+"public/part_list.js";cname="ListPart";break;case"outputpin":filepath=config.controller+"public/part_outputpin.js";cname="PartOutputPin";break;case"inputpin":filepath=config.controller+"public/part_inputpin.js";cname="PartInputPin";break;case"linkagesearch":filepath=config.controller+"public/part_linkagesearch.js";cname="LinkageSearch";break;case"addelement":filepath=config.controller+"public/part_addelement.js";cname="AddElementButton";break;case"dataconfig":filepath=config.controller+"public/part_dataconfig.js";cname="PartDataConfig";break;case"editwidgetbutton":filepath=config.controller+"public/part_editwidgetbutton.js";cname="EditWidgetButton";break;default:break}break;default:break}if(filepath&&cname){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(param);")}else{$.ajax({type:"GET",url:filepath,async:false,dataType:"script",success:function(){eval("result = new "+cname+"(param);")},error:function(){alert("数据请求异常!")}})}}return result};function createModelSelect(l,m,k,b,j){var d=l;var e=m;var c=k;var i=b;if(!j){j=1}var a;var g="modelid";var h="modelname";var n;this.initModel=function(q){var r="";if(q==null){q=[]}if(q!=null){var o="blue";$.each(q,function(t,s){if(e==1&&n){var u=false;$.each(n,function(w,v){if(v[g]==s[g]){u=true;return false}});if(!u){return true}}o=s[g]==c?"red":"blue";r+="<li><a href='#editelementdiv' index='"+t+"' modelid='"+s[g]+"' title='editelementdiv' >"+s[h]+"</a></li>"});$(d).html(r);$("#tabdiv").tabs({selected:-1});var p=$(d+" a[modelid="+c+"]").attr("index");if(p!=undefined){$("#tabdiv").tabs("option","selected",parseInt(p,10))}$("#editelementdiv").css({padding:0});$("#tabdiv a[modelid]").bind("click",function(){var s=$(this).attr("modelid");changeModel(s)})}};this.changeModel=function(o){var p=config.tenantModelRule(o);$.ajax({url:p,dataType:"json",cache:false,async:false,success:function(t){if(t){var s,q,u;q=t.rulemodel;u=t.modelname;if(!window.currInstance){window.currInstance=new Instance(window.currNavid,window.maxInstanceID,j);window.maxInstanceID--}var r=--window.maxElementID;s=new Element(window.currInstance.instanceID,j,r,2,t.modelid,u,q,null,null);if(j==1||j==3){s.editForm("#"+$(d).attr("controlid"))}else{s.editLinkage("#"+$(d).attr("controlid"))}}}})};if(e==1){$.ajax({url:config.channelModels(i),async:false,dataType:"json",type:"GET",success:function(o){if(o){n=o}}})}if(window.datafromtype==1||c==6){if($(d).attr("firstinit")!="true"){$(d).attr("firstinit",true);$(d).html("");changeModel(6)}}else{if($(d).html()==""){$.ajax({url:config.tenantModels,dataType:"json",async:false,type:"GET",success:function(o){initModel(o)}})}else{$("#tabdiv").tabs({selected:-1});var f=$(d+" a[modelid="+c+"]").attr("index");if(f!=undefined){$("#tabdiv").tabs("option","selected",parseInt(f,10))}}}};function createCustomShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_show.js";cname="FoltopShow";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topkeyword_show.js";cname="TopKeywordShow";break;case allmodels.toptopic:showfile=config.controller+"topic/toptopic_show.js";cname="TopTopicShow";break;case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_show.js";cname="WeiboShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");result.setpart("64.8%",0.383);callback(result)}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");result.setpart("64.8%",0.383);callback(result)},error:function(){alert("数据请求异常!")}})}}}function createFullScreenListShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_singlelist_show.js";cname="FoltopSingleListShow";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topkeyword_singlelist_show.js";cname="TopkeywordSingleListShow";break;case allmodels.toptopic:showfile=config.controller+"topic/toptopic_singlelist_show.js";cname="ToptopiSingleListShow";break;case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_singlelist_show.js";cname="WeiboSingleListShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",-1);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",-1);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createPictureListShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_picturelist_show.js";cname="WeiboPictureListShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("37%",-1);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("37%",-1);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createSinglelistShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_singlelist_show.js";cname="FoltopSingleListShow";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topkeyword_singlelist_show.js";cname="TopkeywordSingleListShow";break;case allmodels.toptopic:showfile=config.controller+"topic/toptopic_singlelist_show.js";cname="ToptopiSingleListShow";break;case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_singlelist_show.js";cname="WeiboSingleListShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",-1);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",-1);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createSmalllistShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_singlelist_show.js";cname="FoltopSingleListShow";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topkeyword_singlelist_show.js";cname="TopkeywordSingleListShow";break;case allmodels.toptopic:showfile=config.controller+"topic/toptopic_singlelist_show.js";cname="ToptopiSingleListShow";break;case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_singlelist_show.js";cname="WeiboSingleListShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",-1);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",-1);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createPostlistShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_postlist_show.js";cname="WeiboPostListShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",-1);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",-1);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenChartShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_chart_show.js";cname="TopicChart";break;case allmodels.toptopic:showfile=config.controller+"topic/toptopic_bigchart_show.js";cname="TopTopicBigchartShow";break;case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_chart_show.js";cname="WeiboChart";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createBigchartShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_chart_show.js";cname="TopicChart";break;case allmodels.toptopic:showfile=config.controller+"topic/toptopic_bigchart_show.js";cname="TopTopicBigchartShow";break;case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_chart_show.js";cname="WeiboChart";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createSmallchartShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_chart_show.js";cname="TopicChart";break;case allmodels.toptopic:showfile=config.controller+"topic/toptopic_smallchart_show.js";cname="TopTopicSmallchartShow";break;case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_chart_show.js";cname="WeiboChart";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createGroupShow(targetID,element,callback){var showfile=config.controller+"public/show_group.js";var cname="GroupShow";var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createDescriptionShow(targetID,element,callback){var showfile=config.controller+"public/show_description.js";var cname="DescriptionShow";var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createFullscreenRadarShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_radar.js";cname="ShowRadar";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigRadarShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_radar.js";cname="ShowRadar";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallRadarShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_radar.js";cname="ShowRadar";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenChordShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_chord.js";cname="ShowChord";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigChordShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_chord.js";cname="ShowChord";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallChordShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_chord.js";cname="ShowChord";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenBoxplotShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_boxplot.js";cname="ShowBoxplot";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigBoxplotShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_boxplot.js";cname="ShowBoxplot";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallBoxplotShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_boxplot.js";cname="ShowBoxplot";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenFunnelShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_funnel.js";cname="ShowFunnel";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigFunnelShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_funnel.js";cname="ShowFunnel";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallFunnelShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_funnel.js";cname="ShowFunnel";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenScatterShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_scatter.js";cname="ShowScatter";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigScatterShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_scatter.js";cname="ShowScatter";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallScatterShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_scatter.js";cname="ShowScatter";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenGaugeShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_gauge.js";cname="ShowGauge";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigGaugeShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_gauge.js";cname="ShowGauge";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallGaugeShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_gauge.js";cname="ShowGauge";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenPieShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_pie.js";cname="FoltopPie";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigPieShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_pie.js";cname="FoltopPie";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallPieShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_pie.js";cname="FoltopPie";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreencircularPieShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_circularpie.js";cname="FoltopCircularPie";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigcircularPieShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_circularpie.js";cname="FoltopCircularPie";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallcircularPieShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:case allmodels.weiboquery:showfile=config.controller+"public/show_circularpie.js";cname="FoltopCircularPie";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenColumnShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_column3d_show.js";cname="TopicColumn3D";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigColumnShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_column3d_show.js";cname="TopicColumn3D";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallColumnShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_column3d_show.js";cname="TopicColumn3D";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createFullscreenBarShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_column3d_show.js";cname="TopicColumn3D";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.settype("bar");result.setpart("97.8%",0.2627);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.settype("bar");result.setpart("97.8%",0.2627);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createBigBarShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_column3d_show.js";cname="TopicColumn3D";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.settype("bar");result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.settype("bar");result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}return result}function createSmallBarShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_chart_show.js";cname="FoltopChart";break;case allmodels.userstatistics:case allmodels.virtualdatasource:case allmodels.topkeyword:showfile=config.controller+"topic/topic_column3d_show.js";cname="TopicColumn3D";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.settype("bar");result.setpart("31.8%",15/19.2);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.settype("bar");result.setpart("31.8%",15/19.2);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createMapShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.topkeyword:case allmodels.userstatistics:case allmodels.virtualdatasource:showfile=config.controller+"topic/topic_map_show.js";cname="TopicMap";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createHeatMapShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.topkeyword:case allmodels.userstatistics:case allmodels.virtualdatasource:showfile=config.controller+"topic/topic_heatmap_show.js";cname="TopicHeatMap";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");if(result!=null&&result!=undefined){result.setpart("64.8%",0.383);callback(result)}},error:function(){alert("数据请求异常!")}})}}}function createUserInfoShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_richlist_show.js";cname="FoltopRichListShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");result.setpart("64.8%",-1);callback(result)}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");result.setpart("64.8%",-1);callback(result)},error:function(){alert("数据请求异常!")}})}}}function createSigmaShow(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.foltop:showfile=config.controller+"user/foltop_userfollowers_show.js";cname="FoltopUserFollowersShow";break;case allmodels.weiboquery:showfile=config.controller+"weibo/weibo_repost_show.js";cname="WeiboRepostShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");result.setpart("64.8%",0.383);callback(result)}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");result.setpart("64.8%",0.383);callback(result)},error:function(){alert("数据请求异常!")}})}}}function createSigmaShow_1(targetID,element,callback){var showfile="";var cname="";switch(element.modelID){case allmodels.weiboquery:showfile=config.controller+"weibo/weixin_repost_show.js";cname="WeixinRepostShow";break;default:return false;break}var result=null;if(showfile!=""&&cname!=""){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(targetID,element);");result.setpart("64.8%",0.383);callback(result)}else{$.ajax({type:"GET",url:showfile,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(targetID,element);");result.setpart("64.8%",0.383);callback(result)},error:function(){alert("数据请求异常!")}})}}}function createShowByID(e,b,d,f){var a="";var c="";switch(e){case"filterchart":createCustomShow(b,d,f);break;case"fullscreenlist":createFullScreenListShow(b,d,f);break;case"singlelist":createSinglelistShow(b,d,f);break;case"smalllist":createSmalllistShow(b,d,f);break;case"postlist":createPostlistShow(b,d,f);break;case"picturelist":createPictureListShow(b,d,f);break;case"fullscreenmslinechart":case"fullscreenchart":createFullscreenChartShow(b,d,f);break;case"bigmslinechart":case"bigcloudchart":case"bigchart":createBigchartShow(b,d,f);break;case"smallmslinechart":case"smallcloudchart":case"smallchart":createSmallchartShow(b,d,f);break;case"fullscreenpiechart":createFullscreenPieShow(b,d,f);break;case"bigpiechart":createBigPieShow(b,d,f);break;case"smallpiechart":createSmallPieShow(b,d,f);break;case"fullscreencircularpiechart":createFullscreencircularPieShow(b,d,f);break;case"bigcircularpiechart":createBigcircularPieShow(b,d,f);break;case"smallcircularpiechart":createSmallcircularPieShow(b,d,f);break;case"fullscreenradarchart":createFullscreenRadarShow(b,d,f);break;case"bigradarchart":createBigRadarShow(b,d,f);break;case"smallradarchart":createSmallRadarShow(b,d,f);break;case"fullscreenchordchart":createFullscreenChordShow(b,d,f);break;case"bigchordchart":createBigChordShow(b,d,f);break;case"smallchordchart":createSmallChordShow(b,d,f);break;case"fullscreenboxplotchart":createFullscreenBoxplotShow(b,d,f);break;case"bigboxplotchart":createBigBoxplotShow(b,d,f);break;case"smallboxplotchart":createSmallBoxplotShow(b,d,f);break;case"fullscreenfunnelchart":createFullscreenFunnelShow(b,d,f);break;case"bigfunnelchart":createBigFunnelShow(b,d,f);break;case"smallfunnelchart":createSmallFunnelShow(b,d,f);break;case"fullscreengaugechart":createFullscreenGaugeShow(b,d,f);break;case"biggaugechart":createBigGaugeShow(b,d,f);break;case"smallgaugechart":createSmallGaugeShow(b,d,f);break;case"fullscreenscatterchart":createFullscreenScatterShow(b,d,f);break;case"bigscatterchart":createBigScatterShow(b,d,f);break;case"smallscatterchart":createSmallScatterShow(b,d,f);break;case"fullscreenmulticolumn3d":createFullscreenColumnShow(b,d,f);break;case"bigmulticolumn3d":createBigColumnShow(b,d,f);break;case"smallmulticolumn3d":createSmallColumnShow(b,d,f);break;case"fullscreenmultibar3d":createFullscreenBarShow(b,d,f);break;case"bigmultibar3d":createBigBarShow(b,d,f);break;case"smallmultibar3d":createSmallBarShow(b,d,f);break;case"userinfo":createUserInfoShow(b,d,f);break;case"weiborepost":case"weibocomment":case"userfollowers":createSigmaShow(b,d,f);break;case"weixinrepost":createSigmaShow_1(b,d,f);break;case"mapchart":createMapShow(b,d,f);break;case"heatmapchart":createHeatMapShow(b,d,f);break;case"groupshow":createGroupShow(b,d,f);break;case"descriptionshow":createDescriptionShow(b,d,f);break;default:break}}function createShowPart(modelID,part,param,callback){var result=null;var filepath;var cname;switch(modelID){case allmodels.foltop:case allmodels.userstatistics:case allmodels.virtualdatasource:switch(part){case 1:filepath=config.controller+"user/parts/foltop_part1.js";cname="FoltopPart1";break;case 2:filepath=config.controller+"user/parts/foltop_part2.js";cname="FoltopPart2";break;case 3:filepath=config.controller+"user/parts/foltop_part3.js";cname="FoltopPart3";break;case 4:filepath=config.controller+"public/part_jscolumn3d.js";cname="JSFoltopPart4";break;case 5:filepath=config.controller+"public/part_modelshowswitch.js";cname="PartModelShowSwitch";break;default:break}break;case allmodels.topkeyword:switch(part){case 1:filepath=config.controller+"user/parts/foltop_part1.js";cname="FoltopPart1";break;case 2:filepath=config.controller+"topic/parts/topkeyword_part2.js";cname="TopkeywordPart2";break;case 3:filepath=config.controller+"topic/parts/topic_part_onsitefilter.js";cname="TopicOnsiteFilter";break;case 4:filepath=config.controller+"public/part_jscloud.js";cname="TopicPart4";break;case 5:filepath=config.controller+"public/part_modelshowswitch.js";cname="PartModelShowSwitch";break;default:break}break;case allmodels.weiboquery:switch(part){case 1:filepath=config.controller+"user/parts/foltop_part1.js";cname="FoltopPart1";break;case 2:filepath=config.controller+"weibo/parts/weibo_part2.js";cname="WeiboPart2";break;case 3:filepath=config.controller+"topic/parts/topic_part_onsitefilter.js";cname="TopicOnsiteFilter";break;case 4:filepath=config.controller+"weibo/parts/weibo_part_list.js";cname="WeiboListPart";break;case 5:filepath=config.controller+"public/part_modelshowswitch.js";cname="PartModelShowSwitch";break;case 6:filepath=config.controller+"weibo/parts/weibo_post_list.js";cname="WeiboPostListPart";break;case 7:filepath=config.controller+"weibo/parts/weibo_picture_list.js";cname="WeiboPictureListPart";break;default:break}break;default:break}if(filepath&&cname){eval("var isexist = typeof("+cname+") != 'undefined';");if(isexist){eval("result = new "+cname+"(param);");callback(result)}else{$.ajax({type:"GET",url:filepath,async:true,dataType:"script",success:function(){eval("result = new "+cname+"(param);");callback(result)},error:function(a,b,c){trace(c)}})}}}function createShowPartByName(partFilepath,className,param,callback){var result=null;if(partFilepath&&className){eval("var isexist = typeof("+className+") != 'undefined';");if(isexist){eval("result = new "+className+"(param);");callback(result)}else{$.ajax({type:"GET",url:partFilepath,async:true,dataType:"script",success:function(){eval("result = new "+className+"(param);");callback(result)},error:function(){alert("数据请求异常!")}})}}};function createTypeTop(b,a){var c=this;this.structInfo=b;this.typeID=a;this.topEle=$(b.top);this.channelClick=function(d){$("#topul li").removeClass("dq");$(d).addClass("dq");$("#topul li").find("a").css("color","#fff");$(d).children().css("color","#000");channelID=$(d).attr("channelID");window.currChannelID=channelID;defaultModelID=$(d).attr("defaultModelID");$(c.structInfo.modelselect).empty();$(c.structInfo.right).empty();createModelSelect(c.structInfo.modelselect,c.typeID,defaultModelID,channelID);createLeft(c.structInfo.left,c.typeID,defaultModelID,channelID)};topEle.load(config.view+"ptop.html",function(){$("#btnlogout").bind("click",function(){$.post(config.phpUrl+"checkuser.php",{type:"logout"},function(){location.href=config.sitePath+"login.html"})});$("#topul li").bind("click",function(){c.channelClick(this)});var d=$("#topul li[channelID=1]");c.channelClick(d)})}function setTopNav(b,a){if(b!=""&&b!=undefined){$("#level1").html(b)}if(a!=""&&a!=undefined){$("#level2").html(a)}};function createRight(c,e,d,f){var g=this;var a="#modelcondition";window.maxInstanceID=-1;window.maxElementID=-1;window.maxgroupid=0;this.pagetype=parseInt(d,10);this.getRenderCallback=function(i){if(g.pagetype==2){var h=false;$.ajax({url:f+"?"+Math.random(),dataType:"html",type:"GET",async:false,success:function(j){$("body").find("div[id^=show_]").remove();if(window.currEditStatus||window.preViewStatus){clearEditLayer()}if(window.currentDownloadStatus){clearDownloadLayer()}$(a).html(j);Global.CalcMaxShowID();$(a+" div").each(function(t,q){var v=$(q).attr("htmlversion");if(v==undefined){$(q).attr("htmlversion",1);if($(q).hasClass("nr")||$(q).hasClass("childnr")){var p=$(q).attr("style");var o=/width:(\s*\d+(\.\d*)?\s*)%;/i;var s=p.match(o);var m=/width:(\s*\d+(\.\d*)?\s*)px;/i;var r=p.match(m);if(s!=null){var y=parseFloat(s[1])+0.8;$(q).css("width",y+"%")}else{if(r!=null){var x=$(q).parent().width()*0.008;var y=parseFloat(r[1])+x;$(q).css("width",y+"px")}}}}if($(q).attr("isgroup")||$(q).attr("instanceid")||$(q).attr("isdescribe")){if($(q).attr("isgroup")){var n=parseInt($(q).attr("id").replace("group",""));if(window.maxgroupid<n){window.maxgroupid=n+1}}var k=getShowTitleCom(q);var l=$(q).attr("title");if((k==undefined||k=="")&&(l!=undefined&&l!="")){k=l;setShowTitleCom(q,k)}if(l!=undefined){$(q).removeAttr("title")}var u=$(q).attr("dockfields");if((k!=undefined&&k!="")||(u!=undefined&&u!=""&&u!="weibotype"&&u!="facettype")){if(k==undefined){k=""}if($(q).children().length==0){$(q).append("<h1>"+k+"</h1>")}else{$(q).children(":first").before("<h1>"+k+"</h1>")}if($(q).attr("isgroup")){}}else{if($(q).attr("isgroup")!="1"){if($(q).parent().attr("isgroup")=="1"){$(q).removeClass("nr").addClass("childnr")}}}if($(q).attr("isgroup")){createShowByID("groupshow",q,null,function(w){$(q).data("showobj",w);w.setID($(q).attr("id"),"#"+$(q).attr("id"));if($(q).attr("remark")!=undefined&&$(q).attr("remark")!=""){w.createRemark()}});bindMouseEvent(q)}if($(q).attr("isdescribe")){createShowByID("descriptionshow",q,null,function(w){$(q).data("showobj",w);w.setID($(q).attr("id"),"#"+$(q).attr("id"));if($(q).attr("remark")!=undefined&&$(q).attr("remark")!=""){w.createRemark()}});bindMouseEvent(q)}}});h=true;if(i){g.getPageElements(i,h)}},error:function(){if(i){g.getPageElements(i,false)}}})}};this.getPageElements=function(k,i){if(i==false){alert("页面框架丢失，系统将自动重新创建默认视图。")}window.instances=[];var h=[];var j=0;$.each(k,function(m,l){var n="";if(l.instanceid==window.snapshotincid){n=window.snapid}$.ajax({url:config.elementsUrl(l.instanceid,0,n),dataType:"json",type:"GET",success:function(s){j++;if(s&&s.elements){var t=new Instance(e,l.instanceid,l.instancetype);if(s.pinrelation!=undefined){t.pinRelation=s.pinrelation}if(s.schedparams!=undefined){t.schedparams=s.schedparams}window.instances.push(t);var o=0;var p="";var u=0;$.each(s.elements,function(w,z){h.push(z.elementid);var r=z.inputpin?z.inputpin:null;var y=z.outputpin?z.outputpin:null;var A=new Element(z.instanceid,z.instancetype,z.elementid,z.type,z.modelid,z.title,z.datajson,r,y);if(z.issavesnapshot==1&&z.snapshot==undefined||z.issavesnapshot==1&&z.snapshot==null){A.setSnapshot(null,z.updatetime)}if(z.snapshot!=undefined&&z.snapshot!=null){A.setSnapshot(z.snapshot,z.updatetime);if(s.schedparams!=undefined){if(s.schedparams.eventlist!=undefined){if(s.schedparams.eventlist.alarms!=undefined){if(s.schedparams.eventlist.alarms.length>0){A.hasalarm=true}}}}}if(z.datajson.displayContent){A.displayContent=z.datajson.displayContent}if(z.datajson.repostpagesize){A.repostpagesize=z.datajson.repostpagesize}if(z.datajson.commentpagesize){A.commentpagesize=z.datajson.commentpagesize}if(z.datajson.scatterXY){A.scatterXY=z.datajson.scatterXY}if(z.datajson.maptype){A.maptype=z.datajson.maptype}if(z.datajson.linetype){A.linetype=z.datajson.linetype}if(l.instancetype==3){if(z.subInstanceType!=undefined){A.subInstanceType=z.subInstanceType}if(z.overlayindex!=undefined){A.overlayindex=z.overlayindex}if(z.modelname!=undefined){A.modelname=z.modelname}if(z.referencedata!=undefined){A.referencedata=z.referencedata}if(z.secondaryyaxis!=undefined){A.secondaryyaxis=z.secondaryyaxis}if(z.referencedataratio!=undefined){A.referencedataratio=z.referencedataratio}if(z.showid!=undefined){A.showid=z.showid}if(z.xcombined!=undefined){t.xcombined=z.xcombined}if(z.xzreverse!=undefined){t.xzreverse=z.xzreverse}if(z.columnstacking!=undefined){t.columnstacking=z.columnstacking}}t.elements.push(A);if(l.instancetype==3){if(A.elementType==2){if(z.overlayindex>=o){o=z.overlayindex;p=z.elementid;u=w}}if(A.elementID!=s.elements[s.elements.length-1].elementid){return true}}else{p=z.elementid;u=w;if(A.elementType!=2){return true}}var x;if(g.pagetype==2){x="div[elementid="+p.toString()+"][instanceid="+z.instanceid+"]"}if($(x).length==0){if(i){alert("元素ID为"+p+"的html框架丢失，系统将重建为默认视图。")}t.elements[u].allshow.push({newobj:true,id:-parseInt(p,10)*10,showid:"filterchart",scopetype:"all",scopeobj:""})}else{$(x).each(function(D,C){var G=$(C).attr("id");if(G==undefined||G==null||G==""){G=p.toString()+""+D.toString();G=-parseInt(G,10);$(C).attr("id","show_"+G)}else{G=parseInt(G.replace("show_",""),10)}var B=$(C).attr("scopetype");var F=$(C).attr("scope");var E=$(C).attr("showid");if(B==undefined||B==null||B==""){B="all"}if(E=="userfollowers"||E=="weiborepost"||E=="weibocomment"||E=="weixinrepost"){B="number"}if(F==undefined||F==null||F==""){F=""}if(E=="userfollowers"||E=="weiborepost"||E=="weibocomment"||E=="weixinrepost"){F="0"}t.elements[u].allshow.push({newobj:true,id:G,showid:$(C).attr("showid"),scopetype:B,scopeobj:F})})}t.elements[u].pagerefresh=true;t.elements[u].show("",false);t.elements[u].pagerefresh=false})}if(j==k.length){if(config.allowdownload){$("#lidownloadexcel").show();$("#adownloadexcel").bind("click",function(){createDownloadLayer()})}else{$("#lidownloadexcel").hide()}var v=null;$("#modelcondition").find("div[instanceid]").each(function(r,w){if(h.indexOf($(w).attr("elementid"))==-1){$(w).remove()}if(window.snapshoteleid==$(w).attr("elementid")){v=w;if($(w).attr("show_title")!=""){v=w}}});if(v!=null){var q=$(v).offset().top;$(window).scrollTop(q-$(window).height()/3);$(v).css("border-color","red").delay(2000).css({"border-color":"#CBCDCC"})}}},error:function(){alert("数据请求异常!")}})})};this.getModelDetailCallback=function(i){window.instances=[];var j=new Instance(e,0,1);var h=new Element(0,1,0,2,i.modelid,i.modelname,i.rulemodel,null,null);h.showForm("#modelcondition");j.elements.push(h);window.instances.push(j)};this.setRenderByNavid=function(i){var h=config.navInstancesUrl(i);var j=g.getRenderCallback;if(c==1){h=config.tenantModelRule(i);j=g.getModelDetailCallback}$.ajax({url:h,dataType:"json",cache:false,async:true,success:function(k){j(k)},error:function(){alert("数据请求异常!")}})};this.innerTabClick=function(j,i){var k=$(j).attr("tabnavid");f=$(j).attr("tabfilepath");window.currNavid=k;window.currFilepath=f;$("#navtabs a").removeClass("now");$("#navtabs a[tabnavid="+k+"]").addClass("now");if(i){if(window.Global!=undefined&&Global.RequestQueue!=undefined){var l=new Date();var h=l.getTime();Global.RequestQueue.setTag(h+"_"+k)}$("body").find("div[id^=show_]").css("display","none");g.setRenderByNavid(k)}};this.leftRightBtnClick=function(n,m){var k=10;var r=n.length;var o=parseInt($("#modelselect").attr("lefthidenum"),10);var j=0;var q=true;if(m=="right"){q=false;j=o+1}else{if(m=="left"){q=false;j=o-1}}var l=n.length>k?k:n.length;var p=j+l;$("#modelselect").attr("lefthidenum",j);var i=n.slice(j,p);var h=j>0?true:false;var s=p==r?false:true;g.tabView(i,h,s,q)};this.tabView=function(l,i,k,o){var n="";var h="";if(!i){n=l[0].id;h="style='display:none;'"}var p="";if(!k){p="style='display:none;'"}var m="<div class='tab' id='navtabs'><input type='button' class='lefttab' id='leftbtn' value='' "+h+" />";$.each(l,function(v,r){if(window.snapshotlevel3id){n=window.snapshotlevel3id}else{if(parseInt(r.defaulttab,10)){n=r.id}}var x=84;var z=parseInt($("body").css("font-size"),10);var q=r.tabname;var y=0;var w=0;for(var t=0;t<q.length;t++){y+=getStringPx(q.charAt(t),z);if(y<x){w++}else{break}}var u=q;var s="";if(w<q.length){s="title='"+q+"'";u=q.substr(0,w-1)+"..."}m+="<a tabnavid="+r.id+" tabfilepath='"+r.filepath+"' "+s+" >"+u+"</a></li>"});m+="<input type='button' class='righttab' value='' "+p+" id='rightbtn' /></div>";$("#modelselect").empty().append(m);if(n!=""){var j=$("#navtabs a[tabnavid="+n+"]");if(j.length>0){g.innerTabClick(j,o)}}$("#navtabs a[tabnavid]").bind("click",function(){var q=this;editTips(function(){g.innerTabClick(q,true)})})};if(e!=window.snapshotlevel2id){window.snapshotlevel1id="";window.snapshotlevel2id="";window.snapshotlevel3id=""}var b=config.phpUrl+"modelinterface.php?type=gettabbyparentid&navid="+e;$.ajax({url:b,type:"GET",contentType:"application/json",dataType:"json",url:b,async:false,success:function(h){if(h!=null&&h.totalcount>0){$("#modelselect").attr("lefthidenum",0);g.leftRightBtnClick(h.children);$("#rightbtn").die("click");$("#rightbtn").live("click",function(){g.leftRightBtnClick(h.children,"right")});$("#leftbtn").die("click");$("#leftbtn").live("click",function(){g.leftRightBtnClick(h.children,"left")})}else{$("#modelselect").empty();g.setRenderByNavid(e)}},error:function(){alert("数据请求异常!")}})};function createTop(a){switch(window.currTypeID){case 1:filename="ptop";break;case 2:filename="ttop";break;case 3:filename="dtop";break;default:location.href=config.sitePath+"error.html";break}if(filename!=""){if(filename=="dtop"){createDatahelperTop(a,window.currTypeID)}else{createTypeTop(a,window.currTypeID)}}};function createTypeTop(e,d){var f=$(e.top);createLeft(e.left);var c='<div id="logo"><img id="companylogo" width="0" height="0" style="float:left;" /></div>';c+='<div id="sys">';c+="<ul>";c+='<li id="lidownloadexcel" style="display:none">';c+='<a id="adownloadexcel" href="javascript:void(0)" style="color:#FFFFFF">下载数据</a>';c+="</li>";c+="<li>";c+='<a id="editnav" href="javascript:void(0)" style="color:#FFFFFF">编辑导航</a>';c+="</li>";c+="<li>";c+='<a id="aEditEle" href="javascript:void(0)" style="color:#FFFFFF">编辑页面</a>';c+="</li>";if(config.allowupdatesnapshot){c+='<li style="width:65px;">';c+='<a id="adddatahelper" href="javascript:void(0)" style="color:#FFFFFF">数据助手<span id="adddatahelper_arrowhover" class="datahelperarrowdown"></span></a>';c+="</li>"}c+="<li>";c+='<a href="javascript:void(0)" id="btnlogout" style="color:#FFFFFF">退出</a>';c+="</li>";c+="</ul>";c+="</div>";f.empty().append(c);$("#companylogo").bind("load",function(){picresize(this,134,60);var g=$(this).parent();$(this).css("padding-top",(g.height()-$(this).outerHeight(true))-8)});$("#companylogo").bind("error",function(){var g=$(this).attr("src");if(g!=""&&g!="images/inverselogo.gif"){$(this).attr("src","images/inverselogo.gif")}});if(config.selfstyle){var b="tenant/"+Global.tenantid+"/inverselogo.png";if(b!=null&&b!=""){$("#companylogo").attr("src",b)}}else{$("#companylogo").attr("src","images/inverselogo.gif")}$("<span class='STYLE5'>"+Global.webname+"</span>").insertBefore("#topnav");$("#btnlogout").bind("click",function(){editTips(function(){$.post(config.phpUrl+"checkuser.php",{type:"logout"},function(){location.href=config.sitePath+"login.html"})})});if(Global.user.usertype==2){$("#editnav").parent().remove();$("#aEditEle").parent().remove();$("#adddatahelper").parent().remove()}$("#editnav").unbind("click");$("#editnav").bind("click",function(){editTips(function(){editnavfun(e)})});$("#aEditEle").unbind("click");$("#aEditEle").bind("click",function(){createEditLayer()});if($("#adddatahelperdiv").length==0){var a="<div id='adddatahelperdiv' style='display:none;background: none repeat scroll 0 0 #8DB3D8;'>";a+="<a id='dataupdate' href='javascript:void(0)'>数据定时更新</a>";if(config.alloweventalert){a+="<a id='eventalert' href='javascript:void(0)'>事件预警</a>"}a+="<a id='managetag' href='javascript:void(0)'>管理标签</a>";a+="</div>";$("body").append(a)}dropDownMenuMouseEvent("datahelper");$("#dataupdate").unbind("click");$("#dataupdate").bind("click",function(){window.open(config.sitePath+"datahelper.html?navid=3&task=13","_blank")});$("#eventalert").unbind("click");$("#eventalert").bind("click",function(){window.open(config.sitePath+"datahelper.html?navid=3&task=14","_blank")});$("#managetag").unbind("click");$("#managetag").bind("click",function(){window.open(config.sitePath+"datahelper.html?navid=7&task=15","_blank")})}function setTopNav(b,a){if(b!=""&&b!=undefined){$("#level1").html(b)}if(a!=""&&a!=undefined){$("#level2").html(a)}}function editnavfun(a){if($("#editnavdiv").length==0){$("body").append("<div id='editnavdiv'></div>");$("#editnavdiv").dialog({title:"导航管理",width:820,height:580,modal:true,autoOpen:false,resizable:false,buttons:{"关闭":function(){$(this).dialog("close")}},close:function(){createLeft(a.left)}});$.ajax({type:"GET",url:config.sitePath+"editnavigation.html",dataType:"html",success:function(b){$("#editnavdiv").empty().append(b)}})}$("#editnavdiv").dialog("open")};