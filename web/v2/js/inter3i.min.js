var config={};function initConfig(b){if(typeof b=="undefined"||b==null||b==""){config.sitePath="/"}else{if(b.lastIndexOf("/")!=(b.length-1)){b+="/"}config.sitePath=b}var a=getSecondDir(location.pathname);if(a!=null&&a!=""){config.sitePath+=a+"/"}config.loginPageUrl=config.sitePath+"login.html";config.fusionUrl=config.sitePath+"charts/";config.phpUrl=config.sitePath+"model/";config.requestData=config.phpUrl+"requestdata.php";config.dataUrl=config.phpUrl+"getdata.php";config.solrData=config.phpUrl+"solragent.php";config.followsData=config.phpUrl+"get_followers.php";config.repostData=config.phpUrl+"get_data_for_repost_trend.php";config.bridgetraceData=config.phpUrl+"analysis_users_trace.php";config.leftmenuUrl=config.phpUrl+"modelinterface.php?type=getleftmenu";config.platformLeftmenuUrl=function(c){return config.phpUrl+"modelinterface.php?type=getplatformmenu&channelid="+c};config.navRendersUrl=function(c){return config.phpUrl+"modelinterface.php?type=getrenders&navid="+c};config.modelDetailUrl=function(d,c){return config.phpUrl+"modelinterface.php?type=getmodel&modelid="+d+"&modeltype="+c};config.navInstancesUrl=function(c){return config.phpUrl+"modelinterface.php?type=getinstance&navid="+c};config.elementsUrl=function(c,f,d){var e="";if(d){e="&snapid="+d+""}return config.phpUrl+"modelinterface.php?type=getelements&instanceid="+c+"&elementtype="+f+e};config.tenantModels=config.phpUrl+"modelinterface.php?type=getmodelbytenantid";config.tenantModelRule=function(c){return config.phpUrl+"modelinterface.php?type=gettenantmodelrule&modelid="+c};config.channelModels=function(c){return config.phpUrl+"modelinterface.php?type=getmodelbychannel&channelid="+c};config.allModels=config.phpUrl+"modelinterface.php?type=getallmodels";config.setSinglePageUrl=config.phpUrl+"modelinterface.php?type=setsinglemodel";config.addInstanceUrl=config.phpUrl+"modelinterface.php?type=addinstance";config.addElementUrl=config.phpUrl+"modelinterface.php?type=addelement";config.delElementUrl=config.phpUrl+"modelinterface.php?type=delelement";config.delInstanceUrl=config.phpUrl+"modelinterface.php?type=delinstance";config.updateElementUrl=config.phpUrl+"modelinterface.php?type=updateelement";config.updateInstanceUrl=config.phpUrl+"modelinterface.php?type=updateinstance";config.addPinRelate=config.phpUrl+"modelinterface.php?type=addpinrelate";config.delPinRelate=config.phpUrl+"modelinterface.php?type=deletepinrelate";config.getSourceUrl=config.dataUrl+"?type=getsource";config.getModelShowUrl=function(c){return config.phpUrl+"modelinterface.php?type=getmodelshow&modelid="+c};config.saveMultiModelUrl=config.phpUrl+"modelinterface.php?type=savemultimodel";config.getNavbytidallUrl=config.phpUrl+"modelinterface.php?type=getnavbytidall";config.getNavbyidUrl=config.phpUrl+"modelinterface.php?type=getnavbyid";config.getNavbyTidUrl=config.phpUrl+"modelinterface.php?type=getnavbytid";config.checkexistUrl=config.phpUrl+"modelinterface.php?type=checkexist";config.checkDrilldownUrl=config.phpUrl+"checkuser.php?type=checkdrilldown";config.checkLinkageUrl=config.phpUrl+"checkuser.php?type=checklinkage";config.savePageUrl=config.phpUrl+"modelinterface.php?type=savepage";config.saveInstanceUrl=config.phpUrl+"modelinterface.php?type=saveinstance";config.updatemergedataUrl=config.phpUrl+"modelinterface.php?type=updatemergedata";config.getmergedataUrl=config.phpUrl+"modelinterface.php?type=getmergedata";config.getmergeschedUrl=config.phpUrl+"modelinterface.php?type=getmergesched";config.getWeiboIDUrl=config.phpUrl+"modelinterface.php?type=geweibotidbymid";config.getNavHtmlUrl=config.phpUrl+"modelinterface.php?type=getnavhtml";config.userquaData=config.phpUrl+"analysis_users_quadrant.php";config.jsPath=config.sitePath+"js/";config.controller=config.jsPath+"controller/";config.view=config.sitePath;config.imagePath=config.sitePath+"images/";config.cssPath=config.sitePath+"css/";config.debug=true;config.urlParams=new Object();config.urlParams.typeid="typeid";config.timegap=12;config.defaultcloudcount=50;config.numvisibleplot=10;config.maxNavigationNamePx=150;config.allowdrilldown=false;config.allowdownload=false;config.allowupdatesnapshot=false;config.alloweventalert=false;config.allowwidget=false;config.selfstyle=false;config.updateschedule=true;config.maxClassifyQueryCount=20;config.repostShowAllowPlay=true;config.repostShowAllowSearch=true;config.maxSummaryLength=70;config.allowshowselecttag=false;config.allowshowaddtag=true;config.hotinkingImg=["http://mmbiz.qpic.cn/mmbiz/x1Jk3APKn6"];config.excludeInputPins=["oristatus","weiboid","oristatus_username","oristatus_userid","repost_url","repost_userid","repost_username"];config.minFontSize=1;if(Browser.chrome){if(parseInt(Browser.chrome,10)>26){config.minFontSize=12}}config.mapData=[{map_chart_key:"北京",map_alias_name:["北京","北京市","110000","京"]},{map_chart_key:"天津",map_alias_name:["天津","天津市","120000","津"]},{map_chart_key:"河北",map_alias_name:["河北","河北省","130000","冀"]},{map_chart_key:"山西",map_alias_name:["山西","山西省","140000","晋"]},{map_chart_key:"内蒙古",map_alias_name:["内蒙古","内蒙古自治区","150000","内蒙古"]},{map_chart_key:"辽宁",map_alias_name:["辽宁","辽宁省","210000","辽"]},{map_chart_key:"吉林",map_alias_name:["吉林","吉林省","220000","吉"]},{map_chart_key:"黑龙江",map_alias_name:["黑龙江","黑龙江省","230000","黑"]},{map_chart_key:"上海",map_alias_name:["上海","上海市","310000","沪"]},{map_chart_key:"江苏",map_alias_name:["江苏","江苏省","320000","苏"]},{map_chart_key:"浙江",map_alias_name:["浙江","浙江省","330000","浙"]},{map_chart_key:"安徽",map_alias_name:["安徽","安徽省","340000","皖"]},{map_chart_key:"福建",map_alias_name:["福建","福建省","350000","闽"]},{map_chart_key:"江西",map_alias_name:["江西","江西省","360000","赣"]},{map_chart_key:"山东",map_alias_name:["山东","山东省","370000","鲁"]},{map_chart_key:"河南",map_alias_name:["河南","河南省","410000","豫"]},{map_chart_key:"湖北",map_alias_name:["湖北","湖北省","420000","鄂"]},{map_chart_key:"湖南",map_alias_name:["湖南","湖南省","430000","湘"]},{map_chart_key:"广东",map_alias_name:["广东","广东省","440000","粤"]},{map_chart_key:"广西",map_alias_name:["广西","广西壮族自治区","450000","桂"]},{map_chart_key:"海南",map_alias_name:["海南","海南省","460000","琼"]},{map_chart_key:"重庆",map_alias_name:["重庆","重庆市","500000","渝"]},{map_chart_key:"四川",map_alias_name:["四川","四川省","510000","川蜀"]},{map_chart_key:"贵州",map_alias_name:["贵州","贵州省","520000","贵黔"]},{map_chart_key:"云南",map_alias_name:["云南","云南省","530000","云滇"]},{map_chart_key:"西藏",map_alias_name:["西藏","西藏自治区","540000","藏"]},{map_chart_key:"陕西",map_alias_name:["陕西","陕西省","610000","陕秦"]},{map_chart_key:"甘肃",map_alias_name:["甘肃","甘肃省","620000","甘陇"]},{map_chart_key:"青海",map_alias_name:["青海","青海省","630000","青"]},{map_chart_key:"宁夏",map_alias_name:["宁夏","宁夏回族自治区","640000","宁"]},{map_chart_key:"新疆",map_alias_name:["新疆","新疆维吾尔自治区","650000","新"]},{map_chart_key:"台湾",map_alias_name:["台湾","台湾省","710000","台"]},{map_chart_key:"香港",map_alias_name:["香港","香港特别行政区","810000","港"]},{map_chart_key:"澳门",map_alias_name:["澳门","澳门特别行政区","820000","澳"]},{map_chart_key:"东城区",map_alias_name:["东城区","东城区","110000"]},{map_chart_key:"西城区",map_alias_name:["西城区","西城区","110000"]},{map_chart_key:"崇文区",map_alias_name:["崇文区","崇文区","110000"]},{map_chart_key:"宣武区",map_alias_name:["宣武区","宣武区","110000"]},{map_chart_key:"朝阳区",map_alias_name:["朝阳区","朝阳区","110000"]},{map_chart_key:"丰台区",map_alias_name:["丰台区","丰台","110000"]},{map_chart_key:"石景山区",map_alias_name:["石景山区","石景山","110000"]},{map_chart_key:"海淀区",map_alias_name:["海淀区","海淀","110000"]},{map_chart_key:"门头沟区",map_alias_name:["门头沟区","门头沟","110000"]},{map_chart_key:"房山区",map_alias_name:["房山区","房山","110000"]},{map_chart_key:"通州区",map_alias_name:["通州区","通州","110000"]},{map_chart_key:"顺义区",map_alias_name:["顺义区","顺义","110000"]},{map_chart_key:"昌平区",map_alias_name:["昌平区","昌平","110000"]},{map_chart_key:"大兴区",map_alias_name:["大兴区","大兴区","110000"]},{map_chart_key:"怀柔区",map_alias_name:["怀柔区","怀柔","110000"]},{map_chart_key:"平谷区",map_alias_name:["平谷区","平谷","110000"]},{map_chart_key:"密云县",map_alias_name:["密云县","密云","110000"]},{map_chart_key:"延庆县",map_alias_name:["延庆县","延庆","110000"]},{map_chart_key:"和平区",map_alias_name:["和平区","和平区","120000"]},{map_chart_key:"河东区",map_alias_name:["河东区","河东区","120000"]},{map_chart_key:"河西区",map_alias_name:["河西区","河西区","120000"]},{map_chart_key:"南开区",map_alias_name:["南开区","南开区","120000"]},{map_chart_key:"河北区",map_alias_name:["河北区","河北区","120000"]},{map_chart_key:"红桥区",map_alias_name:["红桥区","红桥","120000"]},{map_chart_key:"塘沽区",map_alias_name:["塘沽区","塘沽","120000"]},{map_chart_key:"汉沽区",map_alias_name:["汉沽区","汉沽","120000"]},{map_chart_key:"大港区",map_alias_name:["大港区","大港","120000"]},{map_chart_key:"东丽区",map_alias_name:["东丽区","东丽","120000"]},{map_chart_key:"西青区",map_alias_name:["西青区","西青","120000"]},{map_chart_key:"津南区",map_alias_name:["津南区","津南","120000"]},{map_chart_key:"北辰区",map_alias_name:["北辰区","北辰","120000"]},{map_chart_key:"武清区",map_alias_name:["武清区","武清","120000"]},{map_chart_key:"宝坻区",map_alias_name:["宝坻区","宝坻","120000"]},{map_chart_key:"滨海新区",map_alias_name:["滨海新区","滨海","120000",""]},{map_chart_key:"保税区",map_alias_name:["保税区","保税区","120000",""]},{map_chart_key:"宁河县",map_alias_name:["宁河县","宁河","120000"]},{map_chart_key:"静海县",map_alias_name:["静海县","静海","120000"]},{map_chart_key:"蓟县",map_alias_name:["蓟县","120000"]},{map_chart_key:"黄浦区",map_alias_name:["黄浦区","黄浦区","310000"]},{map_chart_key:"卢湾区",map_alias_name:["卢湾区","卢湾","310000"]},{map_chart_key:"徐汇区",map_alias_name:["徐汇区","徐汇区","310000"]},{map_chart_key:"长宁区",map_alias_name:["长宁区","长宁","310000"]},{map_chart_key:"静安区",map_alias_name:["静安区","静安区","310000"]},{map_chart_key:"普陀区",map_alias_name:["普陀区","普陀","310000"]},{map_chart_key:"闸北区",map_alias_name:["闸北区","闸北","310000"]},{map_chart_key:"虹口区",map_alias_name:["虹口区","虹口","310000"]},{map_chart_key:"杨浦区",map_alias_name:["杨浦区","杨浦","310000"]},{map_chart_key:"闵行区",map_alias_name:["闵行区","闵行","310000"]},{map_chart_key:"宝山区",map_alias_name:["宝山区","宝山区","310000"]},{map_chart_key:"嘉定区",map_alias_name:["嘉定区","嘉定","310000"]},{map_chart_key:"浦东新区",map_alias_name:["浦东新区","浦东","310000"]},{map_chart_key:"金山区",map_alias_name:["金山区","金山区","310000"]},{map_chart_key:"松江区",map_alias_name:["松江区","松江区","310000"]},{map_chart_key:"青浦区",map_alias_name:["青浦区","青浦","310000"]},{map_chart_key:"南汇区",map_alias_name:["南汇区","南汇","310000"]},{map_chart_key:"奉贤区",map_alias_name:["奉贤区","奉贤","310000"]},{map_chart_key:"崇明县",map_alias_name:["崇明县","崇明县","310000"]},{map_chart_key:"万州区",map_alias_name:["万州区","万州","500000"]},{map_chart_key:"涪陵区",map_alias_name:["涪陵区","涪陵","500000"]},{map_chart_key:"渝中区",map_alias_name:["渝中区","渝中","500000"]},{map_chart_key:"大渡口区",map_alias_name:["大渡口区","大渡口","500000"]},{map_chart_key:"江北区",map_alias_name:["江北区","江北区","500000"]},{map_chart_key:"沙坪坝区",map_alias_name:["沙坪坝区","沙坪坝","500000"]},{map_chart_key:"九龙坡区",map_alias_name:["九龙坡区","九龙坡","500000"]},{map_chart_key:"南岸区",map_alias_name:["南岸区","南岸区","500000"]},{map_chart_key:"北碚区",map_alias_name:["北碚区","北碚","500000"]},{map_chart_key:"万盛区",map_alias_name:["万盛区","万盛区","500000"]},{map_chart_key:"双桥区",map_alias_name:["双桥区","双桥区","500000"]},{map_chart_key:"渝北区",map_alias_name:["渝北区","渝北","500000"]},{map_chart_key:"巴南区",map_alias_name:["巴南区","巴南","500000"]},{map_chart_key:"黔江区",map_alias_name:["黔江区","黔江","500000"]},{map_chart_key:"长寿区",map_alias_name:["长寿区","长寿","500000"]},{map_chart_key:"江津区",map_alias_name:["江津区","江津","500000"]},{map_chart_key:"合川区",map_alias_name:["合川区","合川","500000"]},{map_chart_key:"永川区",map_alias_name:["永川区","永川","500000"]},{map_chart_key:"南川区",map_alias_name:["南川区","南川","500000"]},{map_chart_key:"綦江县",map_alias_name:["綦江县","綦江","500000"]},{map_chart_key:"潼南县",map_alias_name:["潼南县","潼南","500000"]},{map_chart_key:"铜梁县",map_alias_name:["铜梁县","铜梁","500000"]},{map_chart_key:"大足县",map_alias_name:["大足县","大足县","500000"]},{map_chart_key:"荣昌县",map_alias_name:["荣昌县","荣昌县","500000"]},{map_chart_key:"璧山县",map_alias_name:["璧山县","璧山","500000"]},{map_chart_key:"梁平县",map_alias_name:["梁平县","梁平","500000"]},{map_chart_key:"城口县",map_alias_name:["城口县","城口县","500000"]},{map_chart_key:"丰都县",map_alias_name:["丰都县","丰都县","500000"]},{map_chart_key:"垫江县",map_alias_name:["垫江县","垫江","500000"]},{map_chart_key:"武隆县",map_alias_name:["武隆县","武隆","500000"]},{map_chart_key:"忠县",map_alias_name:["忠县","500000"]},{map_chart_key:"开县",map_alias_name:["开县","500000"]},{map_chart_key:"云阳县",map_alias_name:["云阳县","云阳","500000"]},{map_chart_key:"奉节县",map_alias_name:["奉节县","奉节","500000"]},{map_chart_key:"巫山县",map_alias_name:["巫山县","巫山县","500000"]},{map_chart_key:"巫溪县",map_alias_name:["巫溪县","巫溪","500000"]},{map_chart_key:"石柱土家族自治县",map_alias_name:["石柱土家族自治县","石柱县","500000"]},{map_chart_key:"秀山土家族苗族自治县",map_alias_name:["秀山土家族苗族自治县","秀山县","500000"]},{map_chart_key:"酉阳土家族苗族自治县",map_alias_name:["酉阳土家族苗族自治县","酉阳","500000"]},{map_chart_key:"彭水苗族土家族自治县",map_alias_name:["彭水苗族土家族自治县","彭水","500000"]},{map_chart_key:"石家庄市",map_alias_name:["石家庄市","石家庄","130000"]},{map_chart_key:"唐山市",map_alias_name:["唐山市","唐山","130000"]},{map_chart_key:"秦皇岛市",map_alias_name:["秦皇岛市","秦皇岛","130000"]},{map_chart_key:"邯郸市",map_alias_name:["邯郸市","邯郸","130000"]},{map_chart_key:"邢台市",map_alias_name:["邢台市","邢台","130000"]},{map_chart_key:"保定市",map_alias_name:["保定市","保定","130000"]},{map_chart_key:"张家口市",map_alias_name:["张家口市","张家口","130000"]},{map_chart_key:"承德市",map_alias_name:["承德市","承德","130000"]},{map_chart_key:"沧州市",map_alias_name:["沧州市","沧州","130000"]},{map_chart_key:"廊坊市",map_alias_name:["廊坊市","廊坊","130000"]},{map_chart_key:"衡水市",map_alias_name:["衡水市","衡水","130000"]},{map_chart_key:"太原市",map_alias_name:["太原市","太原","140000"]},{map_chart_key:"大同市",map_alias_name:["大同市","大同","140000"]},{map_chart_key:"阳泉市",map_alias_name:["阳泉市","阳泉","140000"]},{map_chart_key:"长治市",map_alias_name:["长治市","长治","140000"]},{map_chart_key:"晋城市",map_alias_name:["晋城市","晋城","140000"]},{map_chart_key:"朔州市",map_alias_name:["朔州市","朔州","140000"]},{map_chart_key:"晋中市",map_alias_name:["晋中市","晋中","140000"]},{map_chart_key:"运城市",map_alias_name:["运城市","运城","140000"]},{map_chart_key:"忻州市",map_alias_name:["忻州市","忻州","140000"]},{map_chart_key:"临汾市",map_alias_name:["临汾市","临汾","140000"]},{map_chart_key:"吕梁市",map_alias_name:["吕梁市","吕梁","140000"]},{map_chart_key:"呼和浩特市",map_alias_name:["呼和浩特市","呼和浩特","150000"]},{map_chart_key:"包头市",map_alias_name:["包头市","包头","150000"]},{map_chart_key:"乌海市",map_alias_name:["乌海市","乌海","150000"]},{map_chart_key:"赤峰市",map_alias_name:["赤峰市","赤峰","150000"]},{map_chart_key:"通辽市",map_alias_name:["通辽市","通辽","150000"]},{map_chart_key:"鄂尔多斯市",map_alias_name:["鄂尔多斯市","鄂尔多斯","150000"]},{map_chart_key:"呼伦贝尔市",map_alias_name:["呼伦贝尔市","呼伦贝尔","150000"]},{map_chart_key:"巴彦淖尔市",map_alias_name:["巴彦淖尔市","巴彦淖尔","150000"]},{map_chart_key:"乌兰察布市",map_alias_name:["乌兰察布市","乌兰察布","150000"]},{map_chart_key:"兴安盟",map_alias_name:["兴安盟","150000"]},{map_chart_key:"锡林郭勒盟",map_alias_name:["锡林郭勒盟","150000"]},{map_chart_key:"阿拉善盟",map_alias_name:["阿拉善盟","150000"]},{map_chart_key:"沈阳市",map_alias_name:["沈阳市","沈阳","210000"]},{map_chart_key:"大连市",map_alias_name:["大连市","大连","210000"]},{map_chart_key:"鞍山市",map_alias_name:["鞍山市","鞍山","210000"]},{map_chart_key:"抚顺市",map_alias_name:["抚顺市","抚顺","210000"]},{map_chart_key:"本溪市",map_alias_name:["本溪市","本溪","210000"]},{map_chart_key:"丹东市",map_alias_name:["丹东市","丹东","210000"]},{map_chart_key:"锦州市",map_alias_name:["锦州市","锦州","210000"]},{map_chart_key:"营口市",map_alias_name:["营口市","营口","210000"]},{map_chart_key:"阜新市",map_alias_name:["阜新市","阜新","210000"]},{map_chart_key:"辽阳市",map_alias_name:["辽阳市","辽阳","210000"]},{map_chart_key:"盘锦市",map_alias_name:["盘锦市","盘锦","210000"]},{map_chart_key:"铁岭市",map_alias_name:["铁岭市","铁岭","210000"]},{map_chart_key:"朝阳市",map_alias_name:["朝阳市","朝阳","210000"]},{map_chart_key:"葫芦岛市",map_alias_name:["葫芦岛市","葫芦岛","210000"]},{map_chart_key:"长春市",map_alias_name:["长春市","长春","220000"]},{map_chart_key:"吉林市",map_alias_name:["吉林市","吉林","220000"]},{map_chart_key:"四平市",map_alias_name:["四平市","四平","220000"]},{map_chart_key:"辽源市",map_alias_name:["辽源市","辽源","220000"]},{map_chart_key:"通化市",map_alias_name:["通化市","通化","220000"]},{map_chart_key:"白山市",map_alias_name:["白山市","白山","220000"]},{map_chart_key:"松原市",map_alias_name:["松原市","松原","220000"]},{map_chart_key:"白城市",map_alias_name:["白城市","白城","220000"]},{map_chart_key:"延边朝鲜族自治州",map_alias_name:["延边朝鲜族自治州","延边","220000"]},{map_chart_key:"哈尔滨市",map_alias_name:["哈尔滨市","哈尔滨","230000"]},{map_chart_key:"齐齐哈尔市",map_alias_name:["齐齐哈尔市","齐齐哈尔","230000"]},{map_chart_key:"鸡西市",map_alias_name:["鸡西市","鸡西","230000"]},{map_chart_key:"鹤岗市",map_alias_name:["鹤岗市","鹤岗","230000"]},{map_chart_key:"双鸭山市",map_alias_name:["双鸭山市","双鸭山","230000"]},{map_chart_key:"大庆市",map_alias_name:["大庆市","大庆","230000"]},{map_chart_key:"伊春市",map_alias_name:["伊春市","伊春","230000"]},{map_chart_key:"佳木斯市",map_alias_name:["佳木斯市","佳木斯","230000"]},{map_chart_key:"七台河市",map_alias_name:["七台河市","七台河","230000"]},{map_chart_key:"牡丹江市",map_alias_name:["牡丹江市","牡丹江","230000"]},{map_chart_key:"黑河市",map_alias_name:["黑河市","黑河","230000"]},{map_chart_key:"绥化市",map_alias_name:["绥化市","绥化","230000"]},{map_chart_key:"大兴安岭地区",map_alias_name:["大兴安岭地区","大兴安岭","230000"]},{map_chart_key:"南京市",map_alias_name:["南京市","南京","320000"]},{map_chart_key:"无锡市",map_alias_name:["无锡市","无锡","320000"]},{map_chart_key:"徐州市",map_alias_name:["徐州市","徐州","320000"]},{map_chart_key:"常州市",map_alias_name:["常州市","常州","320000"]},{map_chart_key:"苏州市",map_alias_name:["苏州市","苏州","320000"]},{map_chart_key:"南通市",map_alias_name:["南通市","南通","320000"]},{map_chart_key:"连云港市",map_alias_name:["连云港市","连云港","320000"]},{map_chart_key:"淮安市",map_alias_name:["淮安市","淮安","320000"]},{map_chart_key:"盐城市",map_alias_name:["盐城市","盐城","320000"]},{map_chart_key:"扬州市",map_alias_name:["扬州市","扬州","320000"]},{map_chart_key:"镇江市",map_alias_name:["镇江市","镇江","320000"]},{map_chart_key:"泰州市",map_alias_name:["泰州市","泰州","320000"]},{map_chart_key:"宿迁市",map_alias_name:["宿迁市","宿迁","320000"]},{map_chart_key:"杭州市",map_alias_name:["杭州市","杭州","330000"]},{map_chart_key:"宁波市",map_alias_name:["宁波市","宁波","330000"]},{map_chart_key:"温州市",map_alias_name:["温州市","温州","330000"]},{map_chart_key:"嘉兴市",map_alias_name:["嘉兴市","嘉兴","330000"]},{map_chart_key:"湖州市",map_alias_name:["湖州市","湖州","330000"]},{map_chart_key:"绍兴市",map_alias_name:["绍兴市","绍兴","330000"]},{map_chart_key:"金华市",map_alias_name:["金华市","金华","330000"]},{map_chart_key:"衢州市",map_alias_name:["衢州市","衢州","330000"]},{map_chart_key:"舟山市",map_alias_name:["舟山市","舟山","330000"]},{map_chart_key:"台州市",map_alias_name:["台州市","台州","330000"]},{map_chart_key:"丽水市",map_alias_name:["丽水市","丽水","330000"]},{map_chart_key:"合肥市",map_alias_name:["合肥市","合肥","340000"]},{map_chart_key:"芜湖市",map_alias_name:["芜湖市","芜湖","340000"]},{map_chart_key:"蚌埠市",map_alias_name:["蚌埠市","蚌埠","340000"]},{map_chart_key:"淮南市",map_alias_name:["淮南市","淮南","340000"]},{map_chart_key:"马鞍山市",map_alias_name:["马鞍山市","马鞍山","340000"]},{map_chart_key:"淮北市",map_alias_name:["淮北市","淮北","340000"]},{map_chart_key:"铜陵市",map_alias_name:["铜陵市","铜陵","340000"]},{map_chart_key:"安庆市",map_alias_name:["安庆市","安庆","340000"]},{map_chart_key:"黄山市",map_alias_name:["黄山市","黄山","340000"]},{map_chart_key:"滁州市",map_alias_name:["滁州市","滁州","340000"]},{map_chart_key:"阜阳市",map_alias_name:["阜阳市","阜阳","340000"]},{map_chart_key:"宿州市",map_alias_name:["宿州市","宿州","340000"]},{map_chart_key:"巢湖市",map_alias_name:["巢湖市","巢湖","340000"]},{map_chart_key:"六安市",map_alias_name:["六安市","六安","340000"]},{map_chart_key:"亳州市",map_alias_name:["亳州市","亳州","340000"]},{map_chart_key:"池州市",map_alias_name:["池州市","池州","340000"]},{map_chart_key:"宣城市",map_alias_name:["宣城市","宣城","340000"]},{map_chart_key:"福州市",map_alias_name:["福州市","福州","350000"]},{map_chart_key:"厦门市",map_alias_name:["厦门市","厦门","350000"]},{map_chart_key:"莆田市",map_alias_name:["莆田市","莆田","350000"]},{map_chart_key:"三明市",map_alias_name:["三明市","三明","350000"]},{map_chart_key:"泉州市",map_alias_name:["泉州市","泉州","350000"]},{map_chart_key:"漳州市",map_alias_name:["漳州市","漳州","350000"]},{map_chart_key:"南平市",map_alias_name:["南平市","南平","350000"]},{map_chart_key:"龙岩市",map_alias_name:["龙岩市","龙岩","350000"]},{map_chart_key:"宁德市",map_alias_name:["宁德市","宁德","350000"]},{map_chart_key:"南昌市",map_alias_name:["南昌市","南昌","360000"]},{map_chart_key:"景德镇市",map_alias_name:["景德镇市","景德镇","360000"]},{map_chart_key:"萍乡市",map_alias_name:["萍乡市","萍乡","360000"]},{map_chart_key:"九江市",map_alias_name:["九江市","九江","360000"]},{map_chart_key:"新余市",map_alias_name:["新余市","新余","360000"]},{map_chart_key:"鹰潭市",map_alias_name:["鹰潭市","鹰潭","360000"]},{map_chart_key:"赣州市",map_alias_name:["赣州市","赣州","360000"]},{map_chart_key:"吉安市",map_alias_name:["吉安市","吉安","360000"]},{map_chart_key:"宜春市",map_alias_name:["宜春市","宜春","360000"]},{map_chart_key:"抚州市",map_alias_name:["抚州市","抚州","360000"]},{map_chart_key:"上饶市",map_alias_name:["上饶市","上饶","360000"]},{map_chart_key:"济南市",map_alias_name:["济南市","济南","370000"]},{map_chart_key:"青岛市",map_alias_name:["青岛市","青岛","370000"]},{map_chart_key:"淄博市",map_alias_name:["淄博市","淄博","370000"]},{map_chart_key:"枣庄市",map_alias_name:["枣庄市","枣庄","370000"]},{map_chart_key:"东营市",map_alias_name:["东营市","东营","370000"]},{map_chart_key:"烟台市",map_alias_name:["烟台市","烟台","370000"]},{map_chart_key:"潍坊市",map_alias_name:["潍坊市","潍坊","370000"]},{map_chart_key:"济宁市",map_alias_name:["济宁市","济宁","370000"]},{map_chart_key:"泰安市",map_alias_name:["泰安市","泰安","370000"]},{map_chart_key:"威海市",map_alias_name:["威海市","威海","370000"]},{map_chart_key:"日照市",map_alias_name:["日照市","日照","370000"]},{map_chart_key:"莱芜市",map_alias_name:["莱芜市","莱芜","370000"]},{map_chart_key:"临沂市",map_alias_name:["临沂市","临沂","370000"]},{map_chart_key:"德州市",map_alias_name:["德州市","德州","370000"]},{map_chart_key:"聊城市",map_alias_name:["聊城市","聊城","370000"]},{map_chart_key:"滨州市",map_alias_name:["滨州市","滨州","370000"]},{map_chart_key:"菏泽市",map_alias_name:["菏泽市","菏泽","370000"]},{map_chart_key:"郑州市",map_alias_name:["郑州市","郑州","410000"]},{map_chart_key:"开封市",map_alias_name:["开封市","开封","410000"]},{map_chart_key:"洛阳市",map_alias_name:["洛阳市","洛阳","410000"]},{map_chart_key:"平顶山市",map_alias_name:["平顶山市","平顶山","410000"]},{map_chart_key:"安阳市",map_alias_name:["安阳市","安阳","410000"]},{map_chart_key:"鹤壁市",map_alias_name:["鹤壁市","鹤壁","410000"]},{map_chart_key:"新乡市",map_alias_name:["新乡市","新乡","410000"]},{map_chart_key:"焦作市",map_alias_name:["焦作市","焦作","410000"]},{map_chart_key:"濮阳市",map_alias_name:["濮阳市","濮阳","410000"]},{map_chart_key:"许昌市",map_alias_name:["许昌市","许昌","410000"]},{map_chart_key:"漯河市",map_alias_name:["漯河市","漯河","410000"]},{map_chart_key:"三门峡市",map_alias_name:["三门峡市","三门峡","410000"]},{map_chart_key:"南阳市",map_alias_name:["南阳市","南阳","410000"]},{map_chart_key:"商丘市",map_alias_name:["商丘市","商丘","410000"]},{map_chart_key:"信阳市",map_alias_name:["信阳市","信阳","410000"]},{map_chart_key:"周口市",map_alias_name:["周口市","周口","410000"]},{map_chart_key:"驻马店市",map_alias_name:["驻马店市","驻马店","410000"]},{map_chart_key:"武汉市",map_alias_name:["武汉市","武汉","420000"]},{map_chart_key:"黄石市",map_alias_name:["黄石市","黄石","420000"]},{map_chart_key:"十堰市",map_alias_name:["十堰市","十堰","420000"]},{map_chart_key:"宜昌市",map_alias_name:["宜昌市","宜昌","420000"]},{map_chart_key:"襄樊市",map_alias_name:["襄樊市","襄樊","420000"]},{map_chart_key:"鄂州市",map_alias_name:["鄂州市","鄂州","420000"]},{map_chart_key:"荆门市",map_alias_name:["荆门市","荆门","420000"]},{map_chart_key:"孝感市",map_alias_name:["孝感市","孝感","420000"]},{map_chart_key:"荆州市",map_alias_name:["荆州市","荆州","420000"]},{map_chart_key:"黄冈市",map_alias_name:["黄冈市","黄冈","420000"]},{map_chart_key:"咸宁市",map_alias_name:["咸宁市","咸宁","420000"]},{map_chart_key:"随州市",map_alias_name:["随州市","随州","420000"]},{map_chart_key:"恩施土家族苗族自治州",map_alias_name:["恩施土家族苗族自治州","420000"]},{map_chart_key:"长沙市",map_alias_name:["长沙市","长沙","430000"]},{map_chart_key:"株洲市",map_alias_name:["株洲市","株洲","430000"]},{map_chart_key:"湘潭市",map_alias_name:["湘潭市","湘潭","430000"]},{map_chart_key:"衡阳市",map_alias_name:["衡阳市","衡阳","430000"]},{map_chart_key:"邵阳市",map_alias_name:["邵阳市","邵阳","430000"]},{map_chart_key:"岳阳市",map_alias_name:["岳阳市","岳阳","430000"]},{map_chart_key:"常德市",map_alias_name:["常德市","常德","430000"]},{map_chart_key:"张家界市",map_alias_name:["张家界市","张家界","430000"]},{map_chart_key:"益阳市",map_alias_name:["益阳市","益阳","430000"]},{map_chart_key:"郴州市",map_alias_name:["郴州市","郴州","430000"]},{map_chart_key:"永州市",map_alias_name:["永州市","永州","430000"]},{map_chart_key:"怀化市",map_alias_name:["怀化市","怀化","430000"]},{map_chart_key:"娄底市",map_alias_name:["娄底市","娄底","430000"]},{map_chart_key:"湘西土家族苗族自治州",map_alias_name:["湘西土家族苗族自治州","430000"]},{map_chart_key:"广州市",map_alias_name:["广州市","广州","440000"]},{map_chart_key:"韶关市",map_alias_name:["韶关市","韶关","440000"]},{map_chart_key:"深圳市",map_alias_name:["深圳市","深圳","440000"]},{map_chart_key:"珠海市",map_alias_name:["珠海市","珠海","440000"]},{map_chart_key:"汕头市",map_alias_name:["汕头市","汕头","440000"]},{map_chart_key:"佛山市",map_alias_name:["佛山市","佛山","440000"]},{map_chart_key:"江门市",map_alias_name:["江门市","江门","440000"]},{map_chart_key:"湛江市",map_alias_name:["湛江市","湛江","440000"]},{map_chart_key:"茂名市",map_alias_name:["茂名市","茂名","440000"]},{map_chart_key:"肇庆市",map_alias_name:["肇庆市","肇庆","440000"]},{map_chart_key:"惠州市",map_alias_name:["惠州市","惠州","440000"]},{map_chart_key:"梅州市",map_alias_name:["梅州市","梅州","440000"]},{map_chart_key:"汕尾市",map_alias_name:["汕尾市","汕尾","440000"]},{map_chart_key:"河源市",map_alias_name:["河源市","河源","440000"]},{map_chart_key:"阳江市",map_alias_name:["阳江市","阳江","440000"]},{map_chart_key:"清远市",map_alias_name:["清远市","清远","440000"]},{map_chart_key:"东莞市",map_alias_name:["东莞市","东莞","440000"]},{map_chart_key:"中山市",map_alias_name:["中山市","中山","440000"]},{map_chart_key:"潮州市",map_alias_name:["潮州市","潮州","440000"]},{map_chart_key:"揭阳市",map_alias_name:["揭阳市","揭阳","440000"]},{map_chart_key:"云浮市",map_alias_name:["云浮市","云浮","440000"]},{map_chart_key:"南宁市",map_alias_name:["南宁市","南宁","450000"]},{map_chart_key:"柳州市",map_alias_name:["柳州市","柳州","450000"]},{map_chart_key:"桂林市",map_alias_name:["桂林市","桂林","450000"]},{map_chart_key:"梧州市",map_alias_name:["梧州市","梧州","450000"]},{map_chart_key:"北海市",map_alias_name:["北海市","北海","450000"]},{map_chart_key:"防城港市",map_alias_name:["防城港市","防城港","450000"]},{map_chart_key:"钦州市",map_alias_name:["钦州市","钦州","450000"]},{map_chart_key:"贵港市",map_alias_name:["贵港市","贵港","450000"]},{map_chart_key:"玉林市",map_alias_name:["玉林市","玉林","450000"]},{map_chart_key:"百色市",map_alias_name:["百色市","百色","450000"]},{map_chart_key:"贺州市",map_alias_name:["贺州市","贺州","450000"]},{map_chart_key:"河池市",map_alias_name:["河池市","河池","450000"]},{map_chart_key:"来宾市",map_alias_name:["来宾市","来宾","450000"]},{map_chart_key:"崇左市",map_alias_name:["崇左市","崇左","450000"]},{map_chart_key:"海口市",map_alias_name:["海口市","海口","460000"]},{map_chart_key:"三亚市",map_alias_name:["三亚市","三亚","460000"]},{map_chart_key:"成都市",map_alias_name:["成都市","成都","510000"]},{map_chart_key:"自贡市",map_alias_name:["自贡市","自贡","510000"]},{map_chart_key:"攀枝花市",map_alias_name:["攀枝花市","攀枝花","510000"]},{map_chart_key:"泸州市",map_alias_name:["泸州市","泸州","510000"]},{map_chart_key:"德阳市",map_alias_name:["德阳市","德阳","510000"]},{map_chart_key:"绵阳市",map_alias_name:["绵阳市","绵阳","510000"]},{map_chart_key:"广元市",map_alias_name:["广元市","广元","510000"]},{map_chart_key:"遂宁市",map_alias_name:["遂宁市","遂宁","510000"]},{map_chart_key:"内江市",map_alias_name:["内江市","内江","510000"]},{map_chart_key:"乐山市",map_alias_name:["乐山市","乐山","510000"]},{map_chart_key:"南充市",map_alias_name:["南充市","南充","510000"]},{map_chart_key:"眉山市",map_alias_name:["眉山市","眉山","510000"]},{map_chart_key:"宜宾市",map_alias_name:["宜宾市","宜宾","510000"]},{map_chart_key:"广安市",map_alias_name:["广安市","广安","510000"]},{map_chart_key:"达州市",map_alias_name:["达州市","达州","510000"]},{map_chart_key:"雅安市",map_alias_name:["雅安市","雅安","510000"]},{map_chart_key:"巴中市",map_alias_name:["巴中市","巴中","510000"]},{map_chart_key:"资阳市",map_alias_name:["资阳市","资阳","510000"]},{map_chart_key:"阿坝藏族羌族自治州",map_alias_name:["阿坝藏族羌族自治州","510000"]},{map_chart_key:"甘孜藏族自治州",map_alias_name:["甘孜藏族自治州","510000"]},{map_chart_key:"凉山彝族自治州",map_alias_name:["凉山彝族自治州","510000"]},{map_chart_key:"贵阳市",map_alias_name:["贵阳市","贵阳","520000"]},{map_chart_key:"六盘水市",map_alias_name:["六盘水市","六盘水","520000"]},{map_chart_key:"遵义市",map_alias_name:["遵义市","遵义","520000"]},{map_chart_key:"安顺市",map_alias_name:["安顺市","安顺","520000"]},{map_chart_key:"铜仁地区",map_alias_name:["铜仁地区","铜仁","520000"]},{map_chart_key:"黔西南布依族苗族自治州",map_alias_name:["黔西南布依族苗族自治州","520000"]},{map_chart_key:"毕节地区",map_alias_name:["毕节地区","毕节","520000"]},{map_chart_key:"黔东南苗族侗族自治州",map_alias_name:["黔东南苗族侗族自治州","520000"]},{map_chart_key:"黔南布依族苗族自治州",map_alias_name:["黔南布依族苗族自治州","520000"]},{map_chart_key:"昆明市",map_alias_name:["昆明市","昆明","530000"]},{map_chart_key:"曲靖市",map_alias_name:["曲靖市","曲靖","530000"]},{map_chart_key:"玉溪市",map_alias_name:["玉溪市","玉溪","530000"]},{map_chart_key:"保山市",map_alias_name:["保山市","保山","530000"]},{map_chart_key:"昭通市",map_alias_name:["昭通市","昭通","530000"]},{map_chart_key:"丽江市",map_alias_name:["丽江市","丽江","530000"]},{map_chart_key:"普洱市",map_alias_name:["普洱市","普洱","530000"]},{map_chart_key:"临沧市",map_alias_name:["临沧市","临沧","530000"]},{map_chart_key:"楚雄彝族自治州",map_alias_name:["楚雄彝族自治州","楚雄","530000"]},{map_chart_key:"红河哈尼族彝族自治州",map_alias_name:["红河哈尼族彝族自治州","红河","530000"]},{map_chart_key:"文山壮族苗族自治州",map_alias_name:["文山壮族苗族自治州","文山","530000"]},{map_chart_key:"西双版纳傣族自治州",map_alias_name:["西双版纳傣族自治州","西双版纳","530000"]},{map_chart_key:"大理白族自治州",map_alias_name:["大理白族自治州","大理","530000"]},{map_chart_key:"德宏傣族景颇族自治州",map_alias_name:["德宏傣族景颇族自治州","德宏","530000"]},{map_chart_key:"怒江傈僳族自治州",map_alias_name:["怒江傈僳族自治州","怒江","530000"]},{map_chart_key:"迪庆藏族自治州",map_alias_name:["迪庆藏族自治州","迪庆","530000"]},{map_chart_key:"拉萨市",map_alias_name:["拉萨市","拉萨","540000"]},{map_chart_key:"昌都地区",map_alias_name:["昌都地区","昌都","540000"]},{map_chart_key:"山南地区",map_alias_name:["山南地区","山南","540000"]},{map_chart_key:"日喀则地区",map_alias_name:["日喀则地区","日喀则","540000"]},{map_chart_key:"那曲地区",map_alias_name:["那曲地区","那曲","540000"]},{map_chart_key:"阿里地区",map_alias_name:["阿里地区","阿里","540000"]},{map_chart_key:"林芝地区",map_alias_name:["林芝地区","林芝","540000"]},{map_chart_key:"西安市",map_alias_name:["西安市","西安","610000"]},{map_chart_key:"铜川市",map_alias_name:["铜川市","铜川","610000"]},{map_chart_key:"宝鸡市",map_alias_name:["宝鸡市","宝鸡","610000"]},{map_chart_key:"咸阳市",map_alias_name:["咸阳市","咸阳","610000"]},{map_chart_key:"渭南市",map_alias_name:["渭南市","渭南","610000"]},{map_chart_key:"延安市",map_alias_name:["延安市","延安","610000"]},{map_chart_key:"汉中市",map_alias_name:["汉中市","汉中","610000"]},{map_chart_key:"榆林市",map_alias_name:["榆林市","榆林","610000"]},{map_chart_key:"安康市",map_alias_name:["安康市","安康","610000"]},{map_chart_key:"商洛市",map_alias_name:["商洛市","商洛","610000"]},{map_chart_key:"兰州市",map_alias_name:["兰州市","兰州","620000"]},{map_chart_key:"嘉峪关市",map_alias_name:["嘉峪关市","嘉峪关","620000"]},{map_chart_key:"金昌市",map_alias_name:["金昌市","金昌","620000"]},{map_chart_key:"白银市",map_alias_name:["白银市","白银","620000"]},{map_chart_key:"天水市",map_alias_name:["天水市","天水","620000"]},{map_chart_key:"武威市",map_alias_name:["武威市","武威","620000"]},{map_chart_key:"张掖市",map_alias_name:["张掖市","张掖","620000"]},{map_chart_key:"平凉市",map_alias_name:["平凉市","平凉","620000"]},{map_chart_key:"酒泉市",map_alias_name:["酒泉市","酒泉","620000"]},{map_chart_key:"庆阳市",map_alias_name:["庆阳市","庆阳","620000"]},{map_chart_key:"定西市",map_alias_name:["定西市","定西","620000"]},{map_chart_key:"陇南市",map_alias_name:["陇南市","陇南","620000"]},{map_chart_key:"临夏回族自治州",map_alias_name:["临夏回族自治州","临夏","620000"]},{map_chart_key:"甘南藏族自治州",map_alias_name:["甘南藏族自治州","甘南","620000"]},{map_chart_key:"西宁市",map_alias_name:["西宁市","西宁","630000"]},{map_chart_key:"海东地区",map_alias_name:["海东地区","海东","630000"]},{map_chart_key:"海北藏族自治州",map_alias_name:["海北藏族自治州","630000"]},{map_chart_key:"黄南藏族自治州",map_alias_name:["黄南藏族自治州","630000"]},{map_chart_key:"海南藏族自治州",map_alias_name:["海南藏族自治州","630000"]},{map_chart_key:"果洛藏族自治州",map_alias_name:["果洛藏族自治州","630000"]},{map_chart_key:"玉树藏族自治州",map_alias_name:["玉树藏族自治州","630000"]},{map_chart_key:"海西蒙古族藏族自治州",map_alias_name:["海西蒙古族藏族自治州","630000"]},{map_chart_key:"银川市",map_alias_name:["银川市","银川","640000"]},{map_chart_key:"石嘴山市",map_alias_name:["石嘴山市","石嘴山","640000"]},{map_chart_key:"吴忠市",map_alias_name:["吴忠市","吴忠","640000"]},{map_chart_key:"固原市",map_alias_name:["固原市","固原","640000"]},{map_chart_key:"中卫市",map_alias_name:["中卫市","中卫","640000"]},{map_chart_key:"乌鲁木齐市",map_alias_name:["乌鲁木齐市","乌鲁木齐","650000"]},{map_chart_key:"克拉玛依市",map_alias_name:["克拉玛依市","克拉玛依","650000"]},{map_chart_key:"吐鲁番地区",map_alias_name:["吐鲁番地区","吐鲁番","650000"]},{map_chart_key:"哈密地区",map_alias_name:["哈密地区","哈密","650000"]},{map_chart_key:"昌吉回族自治州",map_alias_name:["昌吉回族自治州","650000"]},{map_chart_key:"博尔塔拉蒙古自治州",map_alias_name:["博尔塔拉蒙古自治州","650000"]},{map_chart_key:"巴音郭楞蒙古自治州",map_alias_name:["巴音郭楞蒙古自治州","650000"]},{map_chart_key:"阿克苏地区",map_alias_name:["阿克苏地区","阿克苏","650000"]},{map_chart_key:"克孜勒苏柯尔克孜自治州",map_alias_name:["克孜勒苏柯尔克孜自治州","650000"]},{map_chart_key:"喀什地区",map_alias_name:["喀什地区","喀什","650000"]},{map_chart_key:"和田地区",map_alias_name:["和田地区","和田","650000"]},{map_chart_key:"伊犁哈萨克自治州",map_alias_name:["伊犁哈萨克自治州","650000"]},{map_chart_key:"塔城地区",map_alias_name:["塔城地区","塔城","650000"]},{map_chart_key:"阿勒泰地区",map_alias_name:["阿勒泰地区","阿勒泰","650000"]}]};function trace(b){try{if(config.debug){alert(b)}}catch(a){}}function errorOutPut(a,b){return{errorcode:a,error:b}}function HexRandom(){var a=Math.round(Math.random()*16777216);return a.toString(16)}function getTimeSec(a){var g;if(undefined==a){g=new Date();g=g.getTime()}else{a=commonFun.trim(a);var f=a.replace(/-/g,"/");var b=f.split(" ");var c=b[0].split("/");if(b[1]!=undefined){var e=c[1]+"/"+c[2]+"/"+c[0]+" "+b[1]}else{var e=c[1]+"/"+c[2]+"/"+c[0]}g=Date.parse(e)}return Math.round(g/1000)}function timeToStr(a){if(a==null||a==0){return""}return formatTime("yyyy-MM-dd hh:mm:ss",a)}function formatTime(d,c){var a=new Date(c*1000);var e={"M+":a.getMonth()+1,"d+":a.getDate(),"w+":a.getDay(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};if(/(y+)/.test(d)){d=d.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in e){if(new RegExp("("+b+")").test(d)){d=d.replace(RegExp.$1,RegExp.$1.length==1?e[b]:("00"+e[b]).substr((""+e[b]).length))}}return d}function getFormatTime(b){var e=new Date(b*1000);var d=new Array();var a="";var g="";var f=":";a+=e.getFullYear()+"/";a+=(e.getMonth()+1)+"/";a+=e.getDate();if(e.getHours()<=9){g+="0"+e.getHours()+f}else{g+=e.getHours()+f}if(e.getMinutes()<=9){g+="0"+e.getMinutes()}else{g+=e.getMinutes()}d.date=a;d.time=g;return d}function getWeek(e){var b=(new Date(e*1000));var d=(new Date(e*1000));var c={};var a=b.getDay();if(a==0){a=7}c.monday=b.dateAdd("d",1-a)/1000;c.sunday=d.dateAdd("d",7-a)/1000;return c}function getLastDay(c){var a=(new Date(c*1000));var b="";b+=a.getFullYear()+"/";b+=(a.getMonth()+2)+"/";b+="01";var e=Date.parse(b)-24*60*60*1000;return(new Date(e)).getDate()}Date.prototype.lastDay=function(){var b=this;var a="";a+=b.getFullYear()+"/";a+=(b.getMonth()+2)+"/";a+="01";return formatTime("yyyy-MM-dd hh:mm",Math.round(Date.parse(a)/1000)-24*60*60)};Date.prototype.dateAdd=function(interval,number){var d=this;var k={y:"FullYear",q:"Month",m:"Month",w:"Date",d:"Date",h:"Hours",n:"Minutes",s:"Seconds",ms:"MilliSeconds"};var n={q:3,w:7};eval("d.set"+k[interval]+"(d.get"+k[interval]+"()+"+((n[interval]||1)*number)+")");return d};Date.prototype.dateDiff=function(b,a){var g=this,e={},c=g.getTime(),f=a.getTime();e.y=a.getFullYear()-g.getFullYear();e.q=e.y*4+Math.floor(a.getMonth()/4)-Math.floor(g.getMonth()/4);e.m=e.y*12+a.getMonth()-g.getMonth();e.ms=a.getTime()-g.getTime();e.w=Math.floor((f+345600000)/(604800000))-Math.floor((c+345600000)/(604800000));e.d=Math.floor(f/86400000)-Math.floor(c/86400000);e.h=Math.floor(f/3600000)-Math.floor(c/3600000);e.n=Math.floor(f/60000)-Math.floor(c/60000);e.s=Math.floor(f/1000)-Math.floor(c/1000);return e[b]};function ajaxRequest(c,f,b,h,g,e,d,a){if(d==undefined||d==""||d==null){d="GET"}if(a==undefined||a==""||a==null){a={sid:Math.random()}}if(b==undefined||b==""||b==null){b="json"}if(g==undefined||g==""||g==null){g=new Function()}if(e==undefined||e==""||e==null){e=new Function()}if(h==undefined||h==""||h==null){h=new Function()}$.ajax({type:d,url:c,async:true,data:a,cache:true,dataType:b,contentType:"application/json",beforeSend:function(){g()},success:function(j,l){if(j!=null){if(j.errorcode==undefined&&j.error==undefined){f(j)}else{var k=[{totalcount:0,datalist:[]}];f(k)}}else{errorOutPut("2001","数据为空")}},complete:function(j,k){e()},error:function(j,l,k){h(j.responseText,k)}})}var commonFun={queryString:function(d){var c=window.location.search;var a=new RegExp("(^|&)"+d+"=([^&]*)(&|$)","i");var b=c.substr(1).match(a);return b?b[2]:null},trim:function(b){b=b.toString().replace(/^\s+/,"");for(var a=b.length-1;a>=0;a--){if(/\S/.test(b.charAt(a))){b=b.substring(0,a+1);break}}return b},ltrim:function(a){return a.toString().replace(/(^\s*)/g,"")},rtrim:function(a){return a.toString().replace(/(\s*$)/g,"")},arrytrim:function(b){for(var a=0;a<b.length;a++){if(b[a]==""||typeof(b[a])=="undefined"){b.splice(a,1);a=a-1}}return b},arryunique:function(e){var d={},b=e.length,a=[];for(var c=0;c<b;c++){if(!d[e[c]]){d[e[c]]=true;a.push(e[c])}}return a},strsplit:function(d){var c=d.split("#");var b=[];for(var a=0;a<c.length;a++){if(c[a]!=0){b.push(c[a])}}return b[b.length-1]}};function Base64(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=_utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+_keyStr.charAt(j)+_keyStr.charAt(g)+_keyStr.charAt(e)+_keyStr.charAt(d)}return a};this.decode=function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=_keyStr.indexOf(c.charAt(b++));g=_keyStr.indexOf(c.charAt(b++));e=_keyStr.indexOf(c.charAt(b++));d=_keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=_utf8_decode(a);return a};_utf8_encode=function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a};_utf8_decode=function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}}function isEmptyObject(a){for(var b in a){return false}return true}function isArray(a){return Object.prototype.toString.call(a)==="[object Array]"}function arrayAppend(a,b){if(!a.inArray(b)){a.push(b)}return a}function arrayDelete(a,d){if(a.length>0){var c;for(var b=0;b<a.length;b++){if(a[b]==d){c=b}}a.splice(c,1)}return a}Array.prototype.inArray=function(a){for(i=0;i<this.length;i++){if(this[i]==a){return true}}return false};var Utils={units:"个十百千万@#%亿^&~",chars:"零一二三四五六七八九",numberToChinese:function(g){var b=(g+"").split(""),f=[],e=this;if(b.length>12){throw new Error("too big")}else{for(var d=0,c=b.length-1;d<=c;d++){if(c==1||c==5||c==9){if(d==0){if(b[d]!="1"){f.push(e.chars.charAt(b[d]))}}else{f.push(e.chars.charAt(b[d]))}}else{f.push(e.chars.charAt(b[d]))}if(d!=c){f.push(e.units.charAt(c-d))}}}return f.join("").replace(/零([十百千万亿@#%^&~])/g,function(h,j,a){a=e.units.indexOf(j);if(a!=-1){if(j=="亿"){return j}if(j=="万"){return j}if(b[c-a]=="0"){return"零"}}return""}).replace(/零+/g,"零").replace(/零([万亿])/g,function(h,a){return a}).replace(/亿[万千百]/g,"亿").replace(/[零]$/,"").replace(/[@#%^&~]/g,function(a){return{"@":"十","#":"百","%":"千","^":"十","&":"百","~":"千"}[a]}).replace(/([亿万])([一-九])/g,function(h,j,a,k){k=e.units.indexOf(j);if(k!=-1){if(b[c-k]=="0"){return j+"零"+a}}return h})}};function pageDisplay(n,k,h,m,l,g,b){var j=5;$("#"+h).empty();if(l!=1){$("<a/>",{text:"上一页 ",style:"padding:2px;border:1px solid #cccccc;cursor:pointer;margin:1px;",click:function(){var o=parseInt(l-1);k(m,o,h,g,b)}}).appendTo("#"+h)}var a=Math.ceil(n/m);if(a>10){if(l>a){l=a}var d;var c;d=parseInt(j/2);c=j%2==0?d-1:d;if(l<=j-c){startpage=1;endpage=j}else{startpage=parseInt(l,10)-parseInt(d,10);endpage=parseInt(l,10)+parseInt(c,10)}if(endpage>a){startpage=(a-j)+1;endpage=a}for(var f=startpage;f<=endpage;f++){if(l==f){$("<a/>",{text:f,style:"background-color:#EA3D3D;padding:2px;border:1px solid #cccccc;cursor:pointer;margin:1px;",click:function(){var o=$(this).text()}}).appendTo("#"+h)}else{$("<a/>",{text:f,style:"padding:2px;border:1px solid #cccccc;cursor:pointer;margin:1px;",click:function(){var o=parseInt($(this).text());k(m,o,h,g,b)}}).appendTo("#"+h)}}}else{for(var f=1;f<=a;f++){if(l==f){$("<a/>",{text:f,style:"background-color:#EA3D3D;padding:2px;border:1px solid #cccccc;cursor:pointer;margin:1px;",click:function(){var o=$(this).text()}}).appendTo("#"+h)}else{$("<a/>",{text:f,style:"padding:2px;border:1px solid #cccccc;cursor:pointer;margin:1px;",click:function(){var o=parseInt($(this).text());k(m,o,h,g,b)}}).appendTo("#"+h)}}}if(l!=a){$("<a/>",{text:" 下一页",style:"padding:2px;border:1px solid #cccccc;cursor:pointer;margin:1px;",click:function(){var o=parseInt(l+1);k(m,o,h,g,b)}}).appendTo("#"+h)}var e="<span><input type='text' id='"+h+"_page_goto' style='width:35px;'><input type='button' id='"+h+"_page_btn' value='GO'>共"+a+"页 共"+n+"条</span>";$("#"+h).append(e);$("#"+h+"_page_btn").die("click");$("#"+h+"_page_btn").live("click",function(){var o=$("#"+h+"_page_goto").val();if(!o||parseInt(o,10)>parseInt(a,10)){alert("请输入正确页码!")}else{k(m,o,h,g,b)}})}function deepClone(f){if(f===null){return null}if(f===undefined){return undefined}if(typeof(f)!="object"){return f}if(f.constructor==Array){var b=[];for(var c=0;c<f.length;c++){b[c]=arguments.callee(f[c])}}else{var b={};for(var h in f){if(f[h]===null){b[h]=null;continue}if(f[h]===undefined){b[h]=undefined;continue}if(typeof(f[h])!="object"){b[h]=f[h];continue}if(f[h].constructor==Array){b[h]=[];for(var a=0;a<f[h].length;a++){if(f[h][a]===null){b[h][a]=null;continue}if(f[h][a]===undefined){b[h][a]=undefined;continue}if(typeof(f[h][a])!="object"){b[h][a]=f[h][a];continue}if(f[h][a].constructor==Array){b[h][a]=arguments.callee(f[h][a]);continue}if(f[h][a]===f){b[h][a]=b}else{var e=null;for(var g in f[h][a]){if(f[h][a][g]===f){e=g;break}}if(e){f[h][a][e]=null}b[h][a]=arguments.callee(f[h][a]);if(e){f[h][a][e]=f;b[h][a][e]=b}}}}else{b[h]=arguments.callee(f[h])}}}return b}function getSecondDir(a){if(a==null||a==""){return null}var c=/^\/(\w+)($|\/+.*)/i;var b=a.match(c);if(b!=null){return b[1]}else{return null}}function syncAjax(d,c,e,g,a,b){var f={};f.url=d;f.dataType=c;f.data=e?e:{};f.type=g?g:"get";f.async=false;f.success=a?a:function(){};f.error=b?b:function(){};$.ajax(f)}function testPositiveInt(c,a){if(c.length>a){return false}var b=new RegExp(/^\d*$/g);return b.test(c)}function isUrl(c){var b="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-zA-Z_!~*'().&=+$%-]+: )?[0-9a-zA-Z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-zA-Z_!~*'()-]+.)*([0-9a-zA-Z][0-9a-zA-Z-]{0,61})?[0-9a-zA-Z].[a-zA-Z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-zA-Z_!~*'().;?:@&=+$,%#-]+)+/?)$";var a=new RegExp(b);return a.test(c)}var WeiboUtility={};WeiboUtility.str62keys="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";WeiboUtility.int10to62=function(c){var a="";var b=0;while(c!=0){b=c%62;a=this.str62keys.charAt(b)+a;c=Math.floor(c/62)}return a};WeiboUtility.mid2url=function(c){if(typeof(c)!="string"){return false}var b="";for(var d=c.length-7;d>-7;d=d-7){var f=d<0?0:d;var e=d+7;var a=c.substring(f,e);var g=this.int10to62(a);if(a.length==7){while(g.length<4){g="0"+g}}b=g+b}return b};WeiboUtility.str62to10=function(d){var a=0;for(var b=0;b<d.length;b++){var e=d.length-b-1;var c=d.substr(b,1);a+=this.str62keys.indexOf(c)*Math.pow(62,e)}return a};WeiboUtility.url2mid=function(b){var a="";for(var c=b.length-4;c>-4;c=c-4){var e=c<0?0:c;var d=c+4;var f=b.substring(e,d);f=this.str62to10(f).toString(10);if(e>0){while(f.length<7){f="0"+f}}a=f+a}return a};WeiboUtility.weibomid2url=function(e,a,c){var b="";switch(parseInt(e,10)){case 1:var d=WeiboUtility.mid2url(c);b="http://weibo.com/"+a+"/"+d;break;default:break}return b};function getHighIntegrity(d){var b=parseInt(d,10).toString();var a="";for(var c=0;c<b.length;c++){if(c==0){var e=b.substr(c,1);a+=parseInt(e,10)+1}else{a+="0"}}return parseInt(a,10)}function getStringMaxHeight(b,e){var f=b.length;var c=0;for(var d=0;d<f;d++){var a=0;if((b.charCodeAt(d)>=19968&&b.charCodeAt(d)<=40869)||(b.charCodeAt(d)>=65280&&b.charCodeAt(d)<=65535)){a=e}else{if(b.charCodeAt(d)>=65&&b.charCodeAt(d)<=90){a=e*2/3}else{if(b.charCodeAt(d)>=97&&b.charCodeAt(d)<=122){a=e/2}else{if(b.charCodeAt(d)>=48&&b.charCodeAt(d)<=57){a=e*2/3}else{a=e*2/3}}}}if(a>c){c=a}}return c}function getStringPx(b,d){var a=0;if(typeof b==="string"){var e=b.length;for(var c=0;c<e;c++){if((b.charCodeAt(c)>=19968&&b.charCodeAt(c)<=40869)||(b.charCodeAt(c)>=65280&&b.charCodeAt(c)<=65535)){a+=d}else{if(b.charCodeAt(c)>=65&&b.charCodeAt(c)<=90){a+=d*2/3}else{if(b.charCodeAt(c)>=97&&b.charCodeAt(c)<=122){a+=d/2}else{if(b.charCodeAt(c)>=48&&b.charCodeAt(c)<=57){a+=d*0.625}else{a+=d*0.4}}}}}}return a}function getCirclePoint(d,c,b,e){var a={x:0,y:0};a.x=d+b*Math.cos(Math.PI*e/180);a.y=c-b*Math.sin(Math.PI*e/180);return a}function debounce(e,a,b){if(typeof(e)!=="function"){return}a=a||150;b=b||null;var c;var d=function(){e.apply(b)};return(function(){window.clearTimeout(c);c=window.setTimeout(d,a)})}function HTMLEncode(c){var a="";for(var b=0;b<c.length;b++){try{a+=encodeURIComponent(c.charAt(b))}catch(d){console.log(c.charAt(b))}}return a}function HTMLDecode(a){return decodeURIComponent(a)}$.fn.outerHTML=function(){return(!this.length)?this:(this[0].outerHTML||(function(a){var c=document.createElement("div");c.appendChild(a.cloneNode(true));var b=c.innerHTML;c=null;return b})(this[0]))};(function(a){a.extend(a.fn,{longPress:function(e,d,f){e=e||1000;var g=null;var b=false;var c=function(){b=true;typeof d=="function"&&d.call(this)};a(this).mousedown(function(h){b=false;g=setInterval(c,e)}).mouseup(function(){clearTimeout(g);if(!b){c()}typeof f=="function"&&f.call(this)}).mouseout(function(){clearTimeout(g);typeof f=="function"&&f.call(this)})}})})(jQuery);function loadImage(b,c){var a=new Image();a.onload=function(){a.onload=null;c(a)};a.src=b}function GetUrlParams(c){if(typeof c=="undefined"||c==null||c==""){return null}var a=null;if(c.indexOf("?")!=-1){var b=c.split("?");if(b.length==2){a=new Object();var g=b[1];var f=g.split("&");for(var d=0;d<f.length;d++){var e=f[d].split("=");if(e.length==2){a[e[0]]=decodeURIComponent(e[1])}}}}return a}var by=function(a,b){return function(f,e){var d,c;if(f&&e&&typeof f==="object"&&typeof e==="object"){d=f[a];c=e[a];if(d===c){return typeof b==="function"?b(f,e):0}if(typeof d===typeof c){return d<c?-1:1}return typeof d<typeof c?-1:1}else{thro("error")}}};function addTabTitle(a,b){$("."+a).html(b)}function deleteFilterValue(c,a){for(var b=a.length-1;b>-1;b--){if(a[b].fieldname==c){a.splice(b,1)}}}function excludeItemFun(b){var c=$(b).next();var a=$(c).attr("exclude");if(a==undefined){$(c).attr("exclude",1);$(b).css("color","#000000")}else{$(c).removeAttr("exclude");$(b).css("color","#DADADA")}}function emoval2text(a){var b=parseInt(a,10);var c="";switch(b){case 1:c="反对";break;case 2:c="负面";break;case 3:c="中立";break;case 4:c="正面";break;case 5:c="赞赏";break;default:break}return c}function emotype2text(a){var b=[];if(a.split(",").length==5){b.push("全部")}else{$.each(a.split(","),function(d,c){var e="";if(c=="*"){e="全部"}else{e=emoval2text(c)}b.push(e)})}return b}function weiboUrl2mid(b,d){if(b==undefined||b==""){return""}switch(parseInt(d,10)){case 1:if(b.substr(b.length-1,1)=="/"){b=b.substr(0,substr.length-1)}var a=b.lastIndexOf("/");if(a>-1){var c=b.substring(a+1);return WeiboUtility.url2mid(c)}else{return""}case 2:return"";default:return""}}function strtotime(h,g){var b;if(g!=undefined){b=new Date(g*1000)}else{b=new Date()}var e="";if(h=="now"){e=Date.parse(b)}else{var a=h.split(" ");var d=a[1];var c="";if(d.indexOf("year")!=-1){c="y"}else{if(d.indexOf("month")!=-1||d.indexOf("q")!=-1){c="m"}else{if(d.indexOf("day")!=-1){c="d"}else{if(d.indexOf("hour")!=-1){c="h"}else{if(d.indexOf("minute")!=-1){c="n"}else{if(d.indexOf("second")!=-1){c="s"}else{if(d.indexOf("week")!=-1){c="w"}}}}}}}var f=b.dateAdd(c,a[0]);e=Date.parse(f)}return e/1000}function timeSelectOption(a,b){var c="";if(a==undefined){c='<option value="year">年</option><option value="month">月</option><option value="week">周</option><option value="day" selected="selected">天</option><option value="hour">时</option><option value="minute">分</option><option value="second">秒</option>'}else{if(a.length>0){$.each(a,function(f,e){var d="";if(b==undefined){if(f==0){d="selected='selected'"}}else{if(e.value==b){d="selected='selected'"}}c+="<option value='"+e.value+"' "+d+">"+e.text+"</option>"})}}return c}function isShowSplitmark(f,e,a,c){if(c){$(a).css("display","")}else{var d=$(f).text();var b=$(e).text();if(d!=""&&b!=""){$(a).css("display","")}else{$(a).css("display","none")}}}function setTimeSelectMsg(e,d,c,b){if(c===undefined){$("#"+e+"_timeselect_start").html("<span style='color:red'>"+d+"</span>");$("#"+e+"_timeselect_end").text("");isShowSplitmark("#"+e+"_timeselect_start","#"+e+"_timeselect_end","#"+e+"_splitmark")}else{var a=d==null?"":d;$("#"+e+"_timeselect_start").text(a);$("#"+e+"_timeselect_end").html(c);isShowSplitmark("#"+e+"_timeselect_start","#"+e+"_timeselect_end","#"+e+"_splitmark",b)}}function changeTimeBorderColor(b,a){$("#"+b+" div[timetype]").css({border:"0"});$("#"+b+" div[timetype="+a+"]").css({border:"1px solid #ff0000"});$("#"+b+" div[timetype!="+a+"] input").attr("checked",false)}function setThisTime(a,c){$(a).css("display","");if(c=="beginning"){$(a).text("00时00分00秒")}else{if(c=="now"){var b=formatTime("hh时mm分ss秒",strtotime("now"));$(a).text(b)}}$(a).attr("timestate",c)}function getStateTime(a,h,m,b,k){var f={};if(!isNaN(parseInt(a,10))&&!isNaN(parseInt(h,10))){var c="";var n="";if(k=="beginning"){c="00:00:00";n="23:59:59"}else{c="hh:mm:ss";n="hh:mm:ss"}if(m=="beginning"){var o="";var j="";switch(b){case"year":o="yyyy-01-01 "+c+"";j="yyyy-12-31 "+n+"";break;case"month":o="yyyy-MM-01 "+c+"";var l=getLastDay(h);j="yyyy-MM-"+l+" "+n+"";break;case"week":var p=getWeek(a);var d=formatTime("yyyy-MM-dd "+c+"",p.monday);var i=getWeek(h);var g=formatTime("yyyy-MM-dd "+n+"",i.sunday);o=d;j=g;break;default:o="yyyy-MM-dd "+c+"";j="yyyy-MM-dd "+n+"";break}f.start=formatTime(o,a);f.end=formatTime(j,h)}else{if(m=="now"){f.start=formatTime("yyyy-MM-dd "+c+"",a);f.end=formatTime("yyyy-MM-dd "+n+"",h)}}f.start=getTimeSec(f.start);f.end=getTimeSec(f.end)}return f}function setDateSelect(i,a,f,e,h,b,g,c){var d=getStateTime(a,e,h,b,g);$(i).text(formatTime("yyyy-MM-dd hh:mm:ss",d.start));$(f).text(formatTime("yyyy-MM-dd hh:mm:ss",d.end));isShowSplitmark(i,f,c)}function nearlytimeTagClick(d,f){var b=$("#"+d+"_nearlytime").val();var a=$("#"+d+"_nearlytime_gap").val();var c=strtotime("-"+b+" "+a+"");var e=strtotime("now");if(f=="now"){setThisTime("#"+d+"_nearlytime_thistime","beginning");setDateSelect("#"+d+"_timeselect_start",c,"#"+d+"_timeselect_end",e,"now","","beginning","#"+d+"_splitmark")}else{setThisTime("#"+d+"_nearlytime_thistime","now");setDateSelect("#"+d+"_timeselect_start",c,"#"+d+"_timeselect_end",e,"now","","now","#"+d+"_splitmark")}}function getGapNumDate(b){var a={};if(b!=undefined){if(b.indexOf("year")!=-1){a.num=b.substr(0,b.length-4);a.unit="year"}else{if(b.indexOf("month")!=-1){a.num=b.substr(0,b.length-5);a.unit="month"}else{if(b.indexOf("week")!=-1){a.num=b.substr(0,b.length-4);a.unit="week"}else{if(b.indexOf("day")!=-1){a.num=b.substr(0,b.length-3);a.unit="day"}else{if(b.indexOf("hour")!=-1){a.num=b.substr(0,b.length-4);a.unit="hour"}else{if(b.indexOf("minute")!=-1){a.num=b.substr(0,b.length-6);a.unit="minute"}else{if(b.indexOf("second")!=-1){a.num=b.substr(0,b.length-6);a.unit="second"}else{a.num=b;a.unit=""}}}}}}}}if(a.num==""){a.num=1}return a}function nearlytimeShortCutBtnClick(c,d){var a=getGapNumDate(d);$("#"+c+"_nearlytime").val(a.num);$("#"+c+"_nearlytime_gap").val(a.unit);setThisTime("#"+c+"_nearlytime_thistime","now");var b=strtotime("-"+a.num+" "+a.unit+"");var e=strtotime("now");setDateSelect("#"+c+"_timeselect_start",b,"#"+c+"_timeselect_end",e,"now","","now","#"+c+"_splitmark")}function nearlytimeInputChange(d){var b=$("#"+d+"_nearlytime").val();var a=$("#"+d+"_nearlytime_gap").val();var c=strtotime("-"+b+" "+a+"");var e=strtotime("now");if(b!=""){setThisTime("#"+d+"_nearlytime_thistime","now");setDateSelect("#"+d+"_timeselect_start",c,"#"+d+"_timeselect_end",e,"now","","now","#"+d+"_splitmark");$("input[name="+d+"_nearlytime_shortcut][nearly]").attr("checked",false);$("input[name="+d+"_nearlytime_shortcut][nearly="+b+a+"]").attr("checked",true)}else{$("#"+d+"_nearlytime").focus()}}function getnearlytimeValue(a){value={};value.start=$("#"+a+"_nearlytime").val();value.startgap=$("#"+a+"_nearlytime_gap").val();value.timestate=$("#"+a+"_nearlytime_thistime").attr("timestate");return value}function beforetimeTagTimeClick(e,h){var c=$("#"+e+"_beforetime_start").val();var d=$("#"+e+"_beforetime_end").val();var b=$("#"+e+"_beforetime_end_gap").val();var f=strtotime("-"+c+" "+b+"");var a=strtotime("-"+d+" "+b+"");var g=$("#"+e+"_beforetime_thisdate").attr("datestate");if(h=="now"){setThisTime("#"+e+"_beforetime_thistime","beginning");setDateSelect("#"+e+"_timeselect_start",f,"#"+e+"_timeselect_end",a,g,b,"beginning","#"+e+"_splitmark")}else{setThisTime("#"+e+"_beforetime_thistime","now");setDateSelect("#"+e+"_timeselect_start",f,"#"+e+"_timeselect_end",a,g,b,"now","#"+e+"_splitmark")}}function setThisDate(a,f,e){$(a).css("display","");var c="";var b="";switch(e){case"year":c="1月1号";b="MM月dd号";break;case"month":c="1号";b="dd号";break;case"week":c="周1";b="周w";break;default:break}if(f=="beginning"){$(a).text(c)}else{if(f=="now"){var d=formatTime(b,strtotime("now"));if(d=="周0"){d="周日"}$(a).text(d)}}$(a).attr("datestate",f)}function beforetimeTagDateClick(e,g){var c=$("#"+e+"_beforetime_start").val();var d=$("#"+e+"_beforetime_end").val();var b=$("#"+e+"_beforetime_end_gap").val();var f=strtotime("-"+c+" "+b+"");var a=strtotime("-"+d+" "+b+"");var h=$("#"+e+"_beforetime_thistime").attr("timestate");if(g=="now"){setThisDate("#"+e+"_beforetime_thisdate","beginning",b);setDateSelect("#"+e+"_timeselect_start",f,"#"+e+"_timeselect_end",a,"beginning",b,h,"#"+e+"_splitmark")}else{setThisDate("#"+e+"_beforetime_thisdate","now",b);setDateSelect("#"+e+"_timeselect_start",f,"#"+e+"_timeselect_end",a,"now",b,h,"#"+e+"_splitmark")}}function beforetimeInputChange(e){var c=$("#"+e+"_beforetime_start").val();var d=$("#"+e+"_beforetime_end").val();var b=$("#"+e+"_beforetime_end_gap").val();if(c!=""&&d!=""){var f=strtotime("-"+c+" "+b+"");var a=strtotime("-"+d+" "+b+"");setDateSelect("#"+e+"_timeselect_start",f,"#"+e+"_timeselect_end",a,"now","","now","#"+e+"_splitmark");setThisTime("#"+e+"_beforetime_thistime","now");if(b=="year"||b=="month"||b=="week"){setThisDate("#"+e+"_beforetime_thisdate","now",b)}else{$("#"+e+"_beforetime_datetime").css("display","none")}}else{if(d==""){$("#"+e+"_beforetime_end").focus()}if(c==""){$("#"+e+"_beforetime_start").focus()}}}function getbeforeTimeValue(b){var a={};a.start=$("#"+b+"_beforetime_start").val();a.startgap=$("#"+b+"_beforetime_end_gap").val();a.end=$("#"+b+"_beforetime_end").val();a.endgap=$("#"+b+"_beforetime_end_gap").val();a.timestate=$("#"+b+"_beforetime_thistime").attr("timestate");a.datestate=$("#"+b+"_beforetime_thisdate").attr("datestate");return a}function dateUnitDisplay(f,a){var e=[{value:"year",text:"年"},{value:"month",text:"月"},{value:"week",text:"周"},{value:"day",text:"天"},{value:"hour",text:"时"},{value:"minute",text:"分"},{value:"second",text:"秒"}];var h;$.each(e,function(j,i){if(f==i.value){h=j;return false}});var g=[];if(a=="up"){for(var d=0;d<=h;d++){g.push(e[d])}}else{var b;if(a=="down"){b=h+1}else{if(a=="containdown"){b=h}}for(var c=b;c<e.length;c++){g.push(e[c])}}return g}function untiltimeShortCutBtnClick(d,f,c){if(f!=undefined){var a=getGapNumDate(f);var b=a.num;var e=a.unit;$("#"+d+"_untiltime_"+c+"").val(b);$("#"+d+"_untiltime_"+c+"_gap").val(e);$("#"+d+"_untiltime_"+c+"_to").val(1);$("#"+d+"_untiltime_"+c+"_gap").change()}}function untiltimeGapChange(d,b,g){var c=dateUnitDisplay(b,"containdown");var i=timeSelectOption(c,b);$("#"+d+"_untiltime_"+g+"_this_gap").empty().append(i);var h=$("#"+d+"_untiltime_"+g+"").val();var e=$("#"+d+"_untiltime_"+g+"_gap").val();$("input[name="+d+"_untiltime_"+g+"_shortcut][untiltime="+g+"]").attr("checked",false);$("input[name="+d+"_untiltime_"+g+"_shortcut][untiltime="+g+"][until"+g+"="+h+e+"]").attr("checked",true);var f=dateUnitDisplay(b,"down");var a=timeSelectOption(f,b);$("#"+d+"_untiltime_"+g+"_to_gap").empty().append(a)}function untiltimeInputChange(d,c){var b=$("#"+d+"_untiltime_"+c+"").val();var a=$("#"+d+"_untiltime_"+c+"_gap").val();$("input[name="+d+"_untiltime_"+c+"_shortcut][untiltime="+c+"]").attr("checked",false);$("input[name="+d+"_untiltime_"+c+"_shortcut][untiltime="+c+"][until"+c+"="+b+a+"]").attr("checked",true)}function untiltimeValueChange(h){var n=$("#"+h+"_untiltime_start").val();var i=$("#"+h+"_untiltime_start_gap").val();var f=$("#"+h+"_untiltime_start_this_gap").val();var m=$("#"+h+"_untiltime_start_to").val();var c=$("#"+h+"_untiltime_start_to_gap").val();var j=$("#"+h+"_untiltime_end").val();var g=$("#"+h+"_untiltime_end_gap").val();var b=$("#"+h+"_untiltime_end_this_gap").val();var k=$("#"+h+"_untiltime_end_to").val();var a=$("#"+h+"_untiltime_end_to_gap").val();if(n!=""&&m!=""&&j!=""&&k!=""){var d=sinceToThis(n,i,f,m,c,"beginning");var l=sinceToThis(j,g,b,k,a,"ending");setDateSelect("#"+h+"_timeselect_start",d,"#"+h+"_timeselect_end",l,"now","","now","#"+h+"_splitmark")}else{if(k==""){$("#"+h+"_untiltime_end_to").focus()}if(j==""){$("#"+h+"_untiltime_end").focus()}if(m==""){$("#"+h+"_untiltime_start_to").focus()}if(n==""){$("#"+h+"_untiltime_start").focus()}}}function getuntiltimeValue(a){value={};value.start={};value.start.start=$("#"+a+"_untiltime_start").val();value.start.startgap=$("#"+a+"_untiltime_start_gap").val();value.start.startthisgap=$("#"+a+"_untiltime_start_this_gap").val();value.start.startto=$("#"+a+"_untiltime_start_to").val();value.start.starttogap=$("#"+a+"_untiltime_start_to_gap").val();value.end={};value.end.end=$("#"+a+"_untiltime_end").val();value.end.endgap=$("#"+a+"_untiltime_end_gap").val();value.end.endthisgap=$("#"+a+"_untiltime_end_this_gap").val();value.end.endto=$("#"+a+"_untiltime_end_to").val();value.end.endtogap=$("#"+a+"_untiltime_end_to_gap").val();return value}function getMaxDate(b,e,a){var c;var d=1;switch(b){case"year":d=366;break;case"month":d=getLastDay(a);break;case"week":d=7;break;default:break}switch(e){case"month":c=12;break;case"day":c=d;break;case"week":if(b=="year"){c=52}else{if(b=="month"){c=4}}break;case"hour":c=d*24;break;case"minute":if(b=="hour"){c=d*60}else{c=d*24*60}break;case"second":if(b=="hour"){c=d*60*60}else{if(b=="minute"){c=d*60}else{c=d*24*60*60}}break;default:break}return c}function sinceToThis(k,i,d,j,h,f){var m=strtotime("-"+k+" "+i+"");var b="";var c;switch(d){case"year":b="yyyy-01-01 00:00:00";c=getMaxDate(d,h,m);break;case"month":b="yyyy-MM-01 00:00:00";c=getMaxDate(d,h,m);break;case"day":c=getMaxDate(d,h,m);b="yyyy-MM-dd 00:00:00";break;case"hour":c=getMaxDate(d,h,m);b="yyyy-MM-dd hh:00:00";break;case"minute":c=getMaxDate(d,h,m);b="yyyy-MM-dd hh:mm:00";break;case"second":c=getMaxDate(d,h,m);b="yyyy-MM-dd hh:mm:ss";break;case"week":c=getMaxDate(d,h,m);var l=strtotime("-"+k+" "+i+"");var n=getWeek(l);var a=formatTime("yyyy-MM-dd 00:00:00",n.monday);b=a;break;default:b="yyyy-MM-dd hh:mm:ss";break}var g=formatTime(b,m);if(j>c){j=c}if(f=="beginning"){j=j-1}var e=strtotime("+"+j+" "+h+"",getTimeSec(g));if(f=="ending"){return e-1}else{return e}}function getTimeUintAlias(b){var a="";switch(b){case"month":a="月";break;case"day":a="日";break;case"hour":a="时";break;case"minute":a="分";break;case"weekday":a="星期";break;case"week":a="第";break;default:break}return a}function getTimeValAlias(c,a){var b="";if(c==-1){b="最后一"}else{if(a=="weekday"||a==3){switch(parseInt(c,10)){case 1:case 2:case 3:case 4:case 5:case 6:b=Utils.numberToChinese(parseInt(c,10));break;case 7:b="日";break;default:break}}else{b=c}}return b}function getDesHtml(e){var c=getCrontimeDes(e);var d=12;var b=100;var a=getPartDes(c,b,d);var f="";if(a.truncation){f="<a title='"+c+"'>"+a.retstr+"</a>"}else{f=c}return f}function getCrontimeDes(g){var e="";for(var k in g){if(k=="repeat"){var d="";switch(parseInt(g[k],10)){case 1:d="每分钟";break;case 2:d="每小时";break;case 3:d="每天";break;case 4:d="每周";break;case 6:case 7:d="每月";break;default:break}e+="重复类型:"+d+" \n"}if(g[k]!=null&&g[k].length>0){if(getTimeUintAlias(k)!=""){var h=false;var l=true;if(k=="week"){var b=g[k];if(b.length==1&&b[0]==-1){l=false}}if(l){e+=getTimeUintAlias(k)}if(k!="weekday"&&k!="week"){e+=":"}e+=getTimeValAlias(g[k][0],k);var c=[];for(var a=1;a<g[k].length;a++){var j=g[k][a]-g[k][a-1];if(j==1){var f="~";if(!c.inArray(f)){c.push(f);e+="~"}if(a==g[k].length-1){e+=getTimeValAlias(g[k][a],k)}h=true}else{c.length=0;if(h){e+=getTimeValAlias(g[k][a-1],k);h=false}e+=", "+getTimeValAlias(g[k][a],k)}}if(k=="week"){e+="个"}else{e+="\n"}}}}return e}function getPartDes(f,a,j){var c={};var h=getStringPx(f,j);c.truncation=false;c.retstr="";if(h>a){var b=0;var i=0;var e=a-15;for(var g=0;g<f.length;g++){b+=getStringPx(f.charAt(g),j);if(b<e){i++}else{break}}c.truncation=true;c.retstr=f.substr(0,i-1)+"..."}else{c.truncation=false;c.retstr=f}return c}function getGaptext(b){var a="";switch(b){case"year":case"y":a="年";break;case"month":case"m":a="月";break;case"week":case"w":a="周";break;case"day":case"d":a="天";break;case"hour":case"h":a="小时";break;case"minute":a="分";break;case"second":a="秒";break;default:break}return a}function getFacetname(b){var a="";switch(b){case"searchword":case"keyword":a="text";break;case"verifiedreason":a="verified_reason";break;case"hostdomain":a="host_domain";break;case"weibotopic":a="wb_topic";break;case"weibotopickeyword":a="wb_topic_keyword";break;case"weibotopiccombinword":a="wb_topic_combinWord";break;case"topic":a="combinWord";break;case"weiboid":a="id";break;case"father_id":a="father_id";break;case"oristatus":a="retweeted_status";break;case"repostsnum":a="reposts_count";break;case"commentsnum":a="comments_count";break;case"createdtime":a="created_at";break;case"weibotype":a="content_type";break;case"username":a="screen_name";break;case"verified":a="verify";break;case"haspicture":a="has_picture";break;default:a=b;break}return a}function getRetweetDisplayName(d,b){var a="";if(d.indexOf("retweeted_")!=-1){var c=d.split("retweeted_");if(c.length>1){var e=getDisplayName(c[1],b);if(e!=""){a="原创"+e}}}else{a=getDisplayName(d,b)}return a}function getLogicExpDes(h,a){var f="";var c=[];var d=[];var g="";for(var i in h){if(i=="bop"){switch(h[i]){case"&&":g="并且";color="#ff0000";break;case"||":g="或";color="#00ff00";break;case"!":g="非";color="#0000ff";break;case"N/A":g="";color="#CCCCCC";break;default:break}}else{if(i!="type"){if("bop" in h[i]){c.push(getLogicExpDes(h[i],a))}else{var e="<span style='border:1px "+color+" solid;padding:2px;margin:2px;display:inline-block;'>"+getCondExpDes(h[i],a)+"</span>";c.push(e)}}}}var b=g=="非"?g:"";if(b!=""){f="<span style='border:1px #0000ff solid;padding:2px;margin:2px;display:inline-block;'>"+b+"<span style='border:1px #A6C9E2 solid;padding:2px;margin:2px;display:inline-block;'>"+c.join(g)+"</span></span>"}else{if(c.length>1){f="<span style='border:1px #A6C9E2 solid;padding:2px;margin:2px;display:inline-block;'>"+c.join(g)+"</span>"}else{f=c.join(g)}}return f}function getCondExpDes(b,a){var c="";if(b.obj1!=null){c+=getCalExpDes(b.obj1,a);if(b.obj2){switch(b.rop){case"==":c+="等于";break;case"!=":c+="不等于";break;case">":c+="大于";break;case">=":c+="大于等于";break;case"<":c+="小于";break;case"<=":c+="小于等于";break;case"[]":c+="包含";break;default:break}c+=getCalExpDes(b.obj2)}}return c}function getLogicConds(e,h,a){var d=[];var g="";for(var i in h){if(i!="type"&&i!="bop"){if("bop" in h[i]){getLogicConds(e,h[i],a)}else{var b=getCondExpDes(h[i],a);var f=h[i];var c={};c.expdes=b;c.exp=f;e.push(c)}}}}function getCalExpDes(c,a){var b=" ";b+=getAtomicExpDes(c.arg1,a);if(c.arg2){switch(c.cop){case"+":b+="加";break;case"-":b+="减";break;case"×":b+="乘";break;case"÷":b+="除";break;default:break}b+=getAtomicExpDes(c.arg2,a)}return b}function getAtomicExpDes(f,a){var e="";if(f.table!=undefined){var c=parseInt(f.table,10)+1;if(f.tablename){e+=" "+f.tablename+"组 "}else{e+="第"+c+"组 "}}if(f.column!=undefined){var h="";h=parseInt(f.column,10)+1;var d="";if(f.field){if(f.field=="text"||f.field=="alias"){var b="";var i;if(window.currInstance){i=getCurrSnapshotData();if(i!=null&&i[0].facet!=undefined){b=i[0].facet.name}}else{if(a){i=a.firstrequestData;if(i!=null&&i[0].facet!=undefined){b=i[0].facet.name}}}if(i){if(b==""){d="正文"}else{d=getDisplayName(b)}}}else{if(f.field=="range"){d="区间起始"}else{if(f.field=="rangeend"){d="区间结束"}else{d=getRetweetDisplayName(f.field)}}}}if(d){e+="第"+h+"("+d+")列"}else{e+="第"+h+"列"}}if(f.row!=undefined){switch(f.row){case"totalnum":e="记录个数";break;case"all":e+="任意值";break;case"count":e+="计数";break;case"sum":e+="和";break;case"max":e+="最大值";break;case"min":e+="最小值";break;case"average":e+="平均值";break;default:var g=parseInt(f.row,10)+1;e+="第"+g+"行";break}}if(f.constant){e+=""+f.constant}return e}function getDisplayName(c,b){var a;switch(c){case"text":a="关键词";break;case"created_at":a="创建时间";break;case"nearlytime":a="相对今天";break;case"beforetime":a="时间段";break;case"untiltime":a="日历时间段";break;case"combinWord":a="短语";break;case"business":a="行业";break;case"areauser":case"users_location":a="用户地区";break;case"users_city_code":case"city_code":a="用户城市";break;case"users_district_code":case"district_code":a="用户县区";break;case"users_province_code":case"province_code":a="用户省份";break;case"users_country_code":case"country_code":a="用户国家";break;case"areamentioned":a="提及地区";break;case"city":a="提及城市";break;case"district":a="提及县区";break;case"province":a="提及省份";break;case"country":a="提及国家";break;case"ancestor_city":a="上层转发提及城市";break;case"ancestor_district":a="上层转发提及县区";break;case"ancestor_province":a="上层转发提及省份";break;case"ancestor_country":a="上层转发提及国家";break;case"account":a="@用户";break;case"userid":case"users_id":a="用户名";break;case"url":a="URL";break;case"original_url":a="页面地址";break;case"NRN":a="人名";break;case"organization":a="机构";break;case"wb_topic":a="微博话题";break;case"wb_topic_keyword":a="微博话题关键词";break;case"wb_topic_combinWord":a="微博话题短语";break;case"reply_comment":a="父评论";break;case"screen_name":case"users_screen_name":a="作者昵称";break;case"users_verified_reason":case"verified_reason":a="认证原因";break;case"users_verified_type":case"verified_type":a="认证类型";break;case"originalText":a="原文内容";break;case"similar":a="摘要内容";break;case"source":a="应用来源";break;case"users_description":case"description":a="简介";break;case"emotion":a="情感关键词";break;case"emoCombin":a="情感短语";break;case"emoNRN":a="情感人名";break;case"emoOrganization":a="情感机构";break;case"emoTopic":a="情感微博话题";break;case"emoTopicKeyword":a="情感微博话题关键词";break;case"emoTopicCombinWord":a="情感微博话题短语";break;case"emoAccount":a="情感@用户";break;case"emoBusiness":a="行业情感";break;case"emoCountry":a="提及国家情感";break;case"emoProvince":a="提及省份情感";break;case"emoCity":a="提及城市情感";break;case"emoDistrict":a="提及县区情感";break;case"ancestor_emoCountry":a="上层转发提及国家情感";break;case"ancestor_emoProvince":a="上层转发提及省份情感";break;case"ancestor_emoCity":a="上层转发提及城市情感";break;case"ancestor_emoDistrict":a="上层转发提及县区情感";break;case"sex":case"users_gender":a="性别";break;case"users_allow_all_act_msg":a="允许私信";break;case"users_allow_all_comment":a="允许评论";break;case"users_verified":case"verify":a="认证";break;case"users_level":a="用户级别";break;case"father_guid":a="上层文章唯一标识";break;case"retweeted_guid":a="原创唯一标识";break;case"retweeted_status":a="原创ID";break;case"id":a="微博ID";break;case"reposts_count":case"repostsnum":a="转发数";break;case"comments_count":case"commentsnum":a="评论数";break;case"direct_comments_count":a="直接评论数";break;case"praises_count":a="赞";break;case"total_reposts_count":a="总转发数";break;case"followers_count":a="直接到达数";break;case"total_reach_count":a="总到达数";break;case"repost_trend_cursor":a="转发所处层级";break;case"direct_reposts_count":a="直接转发数";break;case"register_time":case"users_created_at":a="博龄";break;case"content_type":a="类型";break;case"has_picture":a="含有图片";break;case"host_domain":a="主机域名";break;case"users_followers_count":a="粉丝数";break;case"users_friends_count":a="关注数";break;case"users_friends_id":a="关注";break;case"users_statuses_count":a="文章数";break;case"users_replys_count":a="回复数";break;case"users_recommended_count":a="精华帖数";break;case"users_favourites_count":a="收藏数";break;case"users_bi_followers_count":a="互粉数";break;case"users_sourceid":case"sourceid":case"users_source_host":a="数据来源";break;case"discuss_count":a="讨论数";break;default:a="";break}if(a==""){if(b!=null&&b[c]!=undefined){a=b[c].label}}return a}function getSourceHostName(b){var a=b;$.ajax({url:config.dataUrl+"?type=getsourcehostname",type:"GET",dataType:"json",data:{host:b},async:false,success:function(c){if(c&&c[0].datalist){$.each(c[0].datalist,function(e,d){if(d.code==b){a=d.name;return false}})}},error:function(){alert("数据请求异常!")}});return a}function getSourceUrl(a){var b=a;$.ajax({url:config.dataUrl+"?type=getsourceurlbyid",type:"GET",dataType:"json",data:{sourceid:a},async:false,success:function(c){b=c[0].datalist}});return b}function getSourceName(a){var b=a;$.ajax({url:config.dataUrl+"?type=getsourcenamebyid",type:"GET",dataType:"json",data:{sourceid:a},async:false,success:function(c){sourcename=c[0].datalist}});return sourcename}function getSource(a){$.ajax({url:config.phpPath+"taskmanager.php",async:false,data:{type:"getaccountsource"},type:"get",dataType:"json",success:function(b){if(jQuery.isFunction(a)){a(b)}}})}function getVerifiedType(a,c){var b=[];if(a==undefined){a=""}if(c==undefined){c=""}$.ajax({url:config.dataUrl+"?type=getverifiedtype",type:"GET",dataType:"json",data:{sourceid:c,verified:a},async:false,success:function(d){b=d[0].datalist},error:function(){alert("数据请求异常!")}});if(b.length>0){config.verifiedlist=b}return b}function getVerified(b){var a=[];if(b==undefined){b=""}$.ajax({url:config.dataUrl+"?type=getverified",type:"GET",dataType:"json",data:{sourceid:b},async:false,success:function(c){a=c[0].datalist},error:function(){alert("数据请求异常!")}});if(a.length>0){config.verified=a}return a}function getVerifiedTypeName(b){var c=[];var a="未知";if(!config.verifiedlist){c=getVerifiedType()}else{c=config.verifiedlist}$.each(c,function(d,e){$.each(e,function(g,f){if(f.code==b){a=f.name;return false}})});return a}function getVerifiedName(b){var c=[];var a="未知";if(!config.verified){c=getVerified()}else{c=config.verified}$.each(c,function(e,d){if(d.code==b){a=d.name;return false}});return a}function getEleFilterItem(c,b,d){var a;if(c){if(c.filter){a=getFilterItem(c.filter,b,d)}}return a}function getFilterItem(b,c,d){var a;if(b!=null&&b[c]){if(d){if(b[c][d]){a=b[c][d]}else{a=""}}else{a=b[c]}}else{switch(d){case"label":a=c;break;default:a="";break}}return a}function showHotlinkingImg(b,e,c,i,f){var h=Math.round(Math.random()*100000);var g="frameimg"+h;window.img='<html><head></head><body><img src="'+b+"?"+h+'" onerror="javascript:this.name=1;" width="'+c+'" height="'+i+'" imgindex="'+f+'"/></body></html>';var d=c+10;var a=i+10;$(e).html('<iframe id="'+g+'" src="javascript:parent.img;" frameBorder="0" scrolling="no" width="'+d+'" height="'+a+'"></iframe>');$("#"+g+"").load(function(){var j=$(document.getElementById(g).contentWindow.document.body).find("img").attr("name");if(j){$("#"+g).css("display","none")}})};function myCrontimeSelect(g,d){var b={monthly:[["monthly","daily","hourly","minutely"],["monthly","monthweek","weekly","hourly","minutely"]],weekly:[["weekly","hourly","minutely"]],daily:[["daily","hourly","minutely"]],hourly:[["hourly","minutely"]],minutely:[["minutely"]]};var a={daily:["monthly","weekly","monthweek"],weekly:["monthly","daily","monthweek"],hourly:["monthly","daily","weekly","monthweek"],minutely:["monthly","daily","weekly","monthweek","hourly"]};var c={monthly:["monthly"],daily:["monthly","weekly","monthweek","daily"],weekly:["monthly","daily","monthweek"],hourly:["monthly","daily","monthweek","weekly","hourly"],minutely:["monthly","daily","monthweek","weekly","hourly","minutely"]};var f=function(){var k="";k+="<fieldset style='padding-right:0px;'>";k+="<legend>重复类型</legend>";k+='<div id="cronshortcut" repeattype="">';k+='<div id="cronshortcut_every_div">';k+='<span><input type="checkbox" id="crontime_repeat_monthly" name="crontime_repeat" /><label for="crontime_repeat_monthly">每月</label></span>';k+='<span><input type="checkbox" id="crontime_repeat_daily" name="crontime_repeat" /><label for="crontime_repeat_daily">每天</label></span>';k+='<span><input type="checkbox" id="crontime_repeat_monthweek" name="crontime_repeat" /><label for="crontime_repeat_monthweek">每周</label></span>';k+='<span><input type="checkbox" id="crontime_repeat_hourly" name="crontime_repeat" /><label for="crontime_repeat_hourly">每小时</label></span>';k+='<span><input type="checkbox" id="crontime_repeat_minutely" name="crontime_repeat" /><label for="crontime_repeat_minutely">每分钟</label></span>';k+='<span><input type="checkbox" id="crontime_repeat_custom" name="crontime_repeat" /><label for="crontime_repeat_custom">定制</label></span>';k+="</div>";k+="</div>";k+="</fieldset>";k+='<table class="list" id="crontime_table" width="98%" cellspacing="0" cellpadding="0" border="0" style="text-align:left;">';k+="<tr>";k+='<td colspan="2" style="height:17px;">月</td><td style="height:17px;">';k+='<div id="crontime_monthly_div" groupnametext="月">';for(var l=1;l<=12;l<l++){k+='<span><input type="checkbox" name="crontime_monthly" value="'+l+'" groupname="monthly" id="crontime_monthly_'+l+'" /><label for="crontime_monthly_'+l+'">'+l+"</label></span>"}k+="</div>";k+='<div id="all_crontime_monthly_div">';k+='<span class="helpbtn"><input type="button" id="all_crontime_monthly_select_btn" value="全选" /></span>';k+='<span class="helpbtn"><input type="button" id="all_crontime_monthly_empty_btn" value="清空" /></span>';k+="</div>";k+="</td>";k+="</tr>";k+="<tr>";k+='<td rowspan="2">天</td><td style="width:40px;" >日历天</td><td>';k+='<div id="crontime_daily_div" groupnametext="日历天">';for(var l=1;l<=31;l++){k+='<span><input type="checkbox" name="crontime_daily" value="'+l+'" groupname="daily" id="crontime_daily_'+l+'" /><label for="crontime_daily_'+l+'">'+l+"</label></span>";if(l%12==0){k+="<br/>"}}k+="</div>";k+='<div id="all_crontime_daily_div">';k+='<span class="helpbtn"><input type="button" id="all_crontime_daily_select_btn" value="全选"/></span>';k+='<span class="helpbtn"><input type="button" id="all_crontime_daily_empty_btn" value="清空" /></span>';k+="</div>";k+="</td>";k+="</tr>";k+="<tr>";k+='<td style="width:40px;" >星期</td><td>';k+='<div id="crontime_monthweek_div" groupnametext="第几周">第';for(var l=1;l<=4;l++){k+='<span><input type="checkbox" id="crontime_monthweek_'+l+'" value="'+l+'" groupname="monthweek" name="crontime_monthweek" /><label for="crontime_monthweek_'+l+'">'+l+"</label></span>"}k+='<span><input type="checkbox" id="crontime_monthweek_last" value="-1" groupname="monthweek" name="crontime_monthweek" /><label for="crontime_monthweek_last">最后一</label></span>&nbsp;&nbsp;';k+="个</div>";k+='<div id="crontime_weekly_div" groupnametext="星期几">周';for(var l=1;l<=7;l++){var j="";switch(l){case 1:case 2:case 3:case 4:case 5:case 6:j=Utils.numberToChinese(l);break;case 7:j="日";break;default:break}k+='<span><input type="checkbox" name="crontime_weekly" value="'+l+'" groupname="weekly" id="crontime_weekly_'+l+'" /><label for="crontime_weekly_'+l+'">'+j+"</label></span>"}k+="</div>";k+="</td>";k+="</tr>";k+="<tr>";k+='<td colspan="2" >时</td><td>';k+='<div id="crontime_hourly_div" groupnametext="时">';for(var l=0;l<=23;l++){k+='<span><input type="checkbox" name="crontime_hourly" value="'+l+'" groupname="hourly" id="crontime_hourly_'+l+'" /><label for="crontime_hourly_'+l+'">'+l+"</label></span>";if((l+1)%12==0&&l!=23){k+="<br/>"}}k+="</div>";k+='<div id="all_crontime_hourly_div">';k+='<span class="helpbtn"><input type="button" id="all_crontime_hourly_select_btn" value="全选"/></span>';k+='<span class="helpbtn"><input type="button" id="all_crontime_hourly_empty_btn" value="清空"/></span>';k+="</div>";k+="</td>";k+="</tr>";k+="<tr>";k+='<td colspan="2" >分</td><td>';k+='<div id="crontime_minutely_div" groupnametext="分">';for(var l=0;l<=59;l++){k+='<span><input type="checkbox" name="crontime_minutely" value="'+l+'" groupname="minutely" id="crontime_minutely_'+l+'" /><label for="crontime_minutely_'+l+'">'+l+"</label></span>";if((l+1)%12==0&&l!=59){k+="<br/>"}}k+="</div>";k+='<div id="all_crontime_minutely_div">';k+='<span class="helpbtn"><input type="button" id="all_crontime_minutely_select_btn" value="全选"/></span>';k+='<span class="helpbtn"><input type="button" id="all_crontime_minutely_empty_btn" value="清空"/></span>';k+="</div>";k+="</td>";k+="</tr>";k+="</table>";if($("#crontimeDiv").length==0){$("<div id='crontimeDiv'></div>").insertAfter("body");$("#crontimeDiv").append(k)}$("#crontimeDiv").dialog({title:"制定计划",autoOpen:true,modal:true,height:443,width:442,close:function(){},buttons:{"提交":function(){var x=0;var A={};var q=$("#cronshortcut").attr("repeattype");if(q){var m="";switch(q){case"minutely":m=1;break;case"hourly":m=2;break;case"daily":m=3;break;case"weekly":m=4;break;case"monthly":m=6;break;default:break}A.repeat=m}var B=[];$("input[name=crontime_monthly]:checked").each(function(E,D){B.push($(D).val())});if(B.length>0){x++;A.month=B}var v=[];$("input[name=crontime_daily]:checked").each(function(E,D){v.push($(D).val())});if(v.length>0){x++;A.day=v}var u=[];$("input[name=crontime_monthweek]:checked").each(function(E,D){u.push($(D).val())});if(u.length>0){x++;A.week=u}var i=[];$("input[name=crontime_weekly]:checked").each(function(D,E){i.push($(E).val())});if(i.length>0){x++;A.weekday=i}if(u.length>0&&i.length==0){alert("请选择星期几");return false}if(q&&v.length>0&&i.length>0){alert("不能同时选择星期和日历天!");return false}if(u.length>0){var t=[];$.each(u,function(D,F){if(F==-1){t.push(22,23,24,25,26,27,28,29,30,31)}else{for(var E=1;E<=7;E++){t.push(((F-1)*7)+E)}}});if(v.length>0){var w=[];$.each(v,function(E,D){if(!t.inArray(D)){w.push(D)}});if(w.length>0){alert("日历天"+w.join(",")+"和星期冲突!");return false}}}var o=[];$("input[name=crontime_hourly]:checked").each(function(E,D){o.push($(D).val())});if(o.length>0){x++;A.hour=o}var s=[];$("input[name=crontime_minutely]:checked").each(function(E,D){s.push($(D).val())});if(s.length>0){x++;A.minute=s}if(q in b){var y=false;var C=b[q];var r=[];$.each(C,function(D,F){if(C.length==1){$.each(F,function(G,J){var I=$("input[name=crontime_"+J+"]:checked").length;if(I==0){var H=$("#crontime_table input[groupname="+J+"]").parents("div").attr("groupnametext");alert("请选择"+H+"!");y=true;return false}})}else{var E=[];$.each(F,function(G,J){var I=$("input[name=crontime_"+J+"]:checked").length;if(I==0){var H=$("#crontime_table input[groupname="+J+"]").parents("div").attr("groupnametext");E.push(H)}});if(E.length>0){r.push(E)}}});if(r.length>1){var p="请选择";$.each(r,function(E,D){p+=D.join(",");if(E!=(r.length-1)){p+="或"}});alert(p);y=true}if(y){return false}}for(var z in a){if(z==q){var y=false;var n=a[z];$.each(n,function(D,E){var G=$("input[name=crontime_"+E+"]:checked").length;if(G!=0&&E!=q){var F=$("#crontime_table td[groupnametext="+E+"]").text();alert("不能选择"+F+"!");y=true;return false}});if(y){return false}}}if(q=="monthly"){if(u.length>0){A.repeat=7}}g(A);$(this).dialog("close")},"取消":function(){$(this).dialog("close")}}});$("#cronshortcut").attr("repeattype","");$("#crontimeDiv input[type=checkbox]").attr("checked",false);h();$.each(["monthly","daily","hourly","minutely","monthweek","custom"],function(m,n){$("#crontime_repeat_"+n+"").bind("click",function(){if($("#crontime_repeat_"+n+"").prop("checked")){$("input[type=checkbox][name=crontime_repeat]").attr("checked",false);$("#crontime_repeat_"+n+"").attr("checked",true);if(n!="custom"){$("#cronshortcut").attr("repeattype",n)}else{$("#cronshortcut").attr("repeattype","")}if(n!="monthweek"){$("input[name=crontime_"+n+"]").attr("checked",true)}else{$("input[name=crontime_monthweek]").attr("checked",true)}if(n in a){$.each(a[n],function(o,i){$("input[name=crontime_"+i+"]").attr("checked",false)})}}else{$("#cronshortcut").attr("repeattype","");if(n!="monthweek"){$("input[name=crontime_"+n+"]").attr("checked",false)}else{$("input[name=crontime_monthweek]").attr("checked",false)}if(n!="custom"){$("#crontime_repeat_custom").attr("checked",true)}}e()})});$("#crontime_table input[type=checkbox][name^=crontime_]").bind("click",function(){var m=$(this).attr("groupname");var i=$("#cronshortcut").attr("repeattype");if(i==""){$("#crontime_repeat_custom").attr("checked",true)}if(i in c){if(c[i].inArray(m)){$("#crontime_repeat_"+i+"").attr("checked",false);$("#cronshortcut").attr("repeattype","");$("#crontime_repeat_custom").attr("checked",true)}}e()});$.each(["monthly","daily","monthweek","hourly","minutely"],function(m,n){$("#all_crontime_"+n+"_select_btn").bind("click",function(){$("input[name=crontime_"+n+"]").attr("checked",true);var i=$("input[name=crontime_repeat]:checked").length;if(i==0){$("#crontime_repeat_custom").attr("checked",true)}e()});$("#all_crontime_"+n+"_empty_btn").bind("click",function(){$("input[name=crontime_"+n+"]").attr("checked",false);if($("#crontime_repeat_"+n+"").prop("checked")){$("#crontime_repeat_"+n+"").attr("checked",false);$("#crontime_repeat_custom").attr("checked",true)}e()})});$("#crontime_table input[name=crontime_daily]").bind("click",function(){var i=$("#cronshortcut").attr("repeattype");var m=$("#crontime_table input[name=crontime_daily]:checked").length;if(m>0){if(i){$("#crontime_table input[name=crontime_weekly]").attr("checked",false);$("#crontime_table input[name=crontime_monthweek]").attr("checked",false)}e()}});$("#crontime_table input[name=crontime_weekly]").bind("click",function(){var m=$("#crontime_table input[name=crontime_weekly]:checked").length;var i=$("#cronshortcut").attr("repeattype");if(m>0&&i){$("#crontime_table input[name=crontime_daily]").attr("checked",false);e()}});$("#crontime_table input[name=crontime_monthweek]").bind("click",function(){var m=$("#crontime_table input[name=crontime_monthweek]:checked").length;var i=$("#cronshortcut").attr("repeattype");if(m>0&&i){$("#crontime_table input[name=crontime_daily]").attr("checked",false);e()}});e()};var e=function(){var i={width:"48px",display:"inline-block"};var j={width:"20px",display:"inline-block"};$("#cronshortcut_every_div").children("span").css(i);$("#cronshortcut_every_div").children("span").last().css({"float":"right"});$("#cronshortcut_every_div").find("label").css({width:"100%"});$("#cronshortcut_every_div").buttonset();$("#crontime_monthweek_div").children("span").css(j);$("#crontime_monthweek_div").children("span").last().css({width:"48px"});$("#crontime_monthweek_div").find("label").css({width:"100%"});$("#crontime_monthweek_div").buttonset();$.each(["monthly","daily","weekly","hourly","minutely"],function(k,l){$("#crontime_"+l+"_div").css({"float":"left"});$("#crontime_"+l+"_div").children("span").css(j);$("#crontime_"+l+"_div").find("label").css({width:"100%"});$("#crontime_"+l+"_div").buttonset()});$.each(["monthly","daily","weekly","hourly","minutely"],function(k,l){$("#all_crontime_"+l+"_div").css({"float":"right"});$("#all_crontime_"+l+"_div").children("span").css({"margin-right":"4px"});$("#all_crontime_"+l+"_div").buttonset()})};var h=function(){for(var j in d){if("repeat" in d){if(j=="repeat"){var k=d[j];var i="";switch(parseInt(k,10)){case 1:i="minutely";break;case 2:i="hourly";break;case 3:i="daily";break;case 4:i="monthweek";break;case 6:case 7:i="monthly";break;default:break}$("#crontime_repeat_"+i+"").attr("checked",true);$("#cronshortcut").attr("repeattype",i)}}else{$("#crontime_repeat_custom").attr("checked",true)}if(d[j].length>0){$.each(d[j],function(m,l){var n="";switch(j){case"month":n="monthly";break;case"day":n="daily";break;case"weekday":n="weekly";break;case"week":n="monthweek";break;case"hour":n="hourly";break;case"minute":n="minutely";break;default:break}if(l==-1){$("#crontime_"+n+"_last").attr("checked",true)}else{$("#crontime_"+n+"_"+l+"").attr("checked",true)}})}}};f()}function myCommonSelect(k,w,H,d,a,M,m,y,s,e,t,K){var c;var z=20;var x;var G=false;var o=k;var l=[];var v=false;var f;var n;var C="";var J;var L=function(){if(d==undefined){d=""}$("#choicebox").remove();var N="";N="搜索:<input type='text' id='searchtxt' name='searchtxt' /><input type='button' name='searchbtn' id='searchbtn' value='搜索' />(使用*模糊搜索)";N+="<fieldset>";N+="<legend>"+d+"列表</legend>";N+="<div id='groupcommon'><img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='waitimg'/></div>";N+="<div id='commonpage' style='margin-top:2px;float:left;width:100%;margin:5px;'></div>";if(t){N+="<div class='search' id='commonselectallbtndiv' style='float:left;width:100%;'><input id='commonselectallbtn' name='commonselectallbtn' type='button' value='全选' /> <input id='commonunselectallbtn' name='commonunselectallbtn' type='button' value='反选' /> <input id='commonunselectnonebtn' name='commonunselectnonebtn' type='button' value='清空' /></div>"}N+="</fieldset>";N+="<fieldset>";N+="<legend>已选择的"+d+"</legend>";N+="<div id='selectedcommons'></div>";N+="</fieldset>";N+="<div class='search'><input id='commonsubmit' name='commonsubmit' type='button' value='确定' />   <input id='canclesubmit' name='canclesubmit' type='button' value='取消' /></div>";var Q='<div id="choicebox" title="'+d+'列表" style="position:absolute;display:none;z-index:9999;background-color:white;border:1px solid blue;font-size: 12px; width:490px;"></div>';if(M!=undefined){$("body").append(Q);$("#choicebox").append(N)}else{$("<div id='choicebox' title='"+d+"列表'></div>").insertAfter("body");$("#choicebox").append(N);$("#choicebox").dialog({autoOpen:false,modal:true,width:550,close:function(){$("#commonemotiondiv").css("display","none")}})}b();if(!isArray(o)){this.sendItem("<a haschild='"+o+"' code='' name=''></a>")}else{var R={};R.name="";R.code="";R.searchurl="";l.push(R);A(z,1,"#groupcommon")}if(M!=undefined){var P,O;P=$(M).offset().left+130;if(P>($(document.body).width()-$("#choicebox").width())){P=$(document.body).width()-$("#choicebox").width()-10}O=$(M).offset().top;$("#choicebox").slideDown("slow").css({display:"block",left:P+"px",top:O+"px"})}else{$("#choicebox").dialog("open")}$("#searchbtn").bind("click",function(){C=$("#searchtxt").val();A(z,1,"#groupcommon")});$("#commonunselectallbtn").bind("click",function(){$("#groupcommon").find("a").each(function(S,T){sendItem($(T))})});$("#commonselectallbtn").bind("click",function(){$("#selectedcommons").empty();$("#groupcommon").find("a").each(function(S,T){sendItem($(T))})});$("#commonunselectnonebtn").bind("click",function(S,T){$("#selectedcommons .cancleitem").each(function(V,U){cancleItem($(U))})});$("#commonsubmit").unbind("click");$("#commonsubmit").bind("click",function(){var S=[];S=getSelectedVal();w(S);$("#commonemotiondiv").css("display","none");if(M!=undefined){$("#choicebox").slideUp("slow")}else{$("#choicebox").dialog("close")}});$("#canclesubmit").bind("click",function(){$("#commonemotiondiv").css("display","none");$("#selectedcommons").empty();if(M!=undefined){$("#choicebox").slideUp("slow")}else{$("#choicebox").dialog("close")}})};this.cancleItem=function(P){$(P).parent().remove();var N=$(P).attr("code");var O=$(P).attr("emotype");if(O!=undefined&&!a){$("#groupcommon a[code='"+N+"'][emotype='"+O+"']").removeClass().addClass("notselected");q(N,O)}else{$("#groupcommon a[code='"+N+"']").removeClass().addClass("notselected");q(N)}};var q=function(N,Q){var R=E(N);var O=true;$("#selectedcommons .sltitem").each(function(T,S){var U=$(S).attr("code");if(U==R){if(Q!=undefined){var V=$(S).attr("emotype");if(V==Q){O=1;return false}else{O=3}}else{O=1;return false}}else{if(r(U,R)){O=2;return false}else{O=3}}});if(O===1){$("#groupcommon a[code='"+R+"']").removeClass().addClass("selected")}else{if(O==2){$("#groupcommon a[code='"+R+"']").removeClass().addClass("halfselected")}else{if(O==3){if(Q!=undefined&&!a){$("#groupcommon a[code='"+R+"'][emotype="+Q+"]").removeClass().addClass("notselected");var P=$("#groupcommon a[code='"+R+"'][emotype="+Q+"]").hasClass("notselected")}else{$("#groupcommon a[code='"+R+"']").removeClass().addClass("notselected");var P=$("#groupcommon a[code='"+R+"']").hasClass("notselected")}if(J=="area"&&R!="CN"&&!P){q(R,Q)}}}}};this.getSelectedVal=function(){var N=[];$("#selectedcommons .sltitem").each(function(Q,O){var P={};P.code=$(this).attr("code");P.name=$(this).text();if($(this).attr("emotype")!=undefined){P.emotype=$(this).attr("emotype")}if($(this).attr("exclude")!=undefined){P.exclude=$(this).attr("exclude")}N.push(P)});return N};this.sendItem=function(S,Q){H=getSelectedVal();var T=$(S).attr("name");var N=$(S).attr("code");var O=$(S).attr("emotype");var U=$(S).attr("haschild");if(U!="false"){if($(S).attr("goparent")!=undefined&&$(S).attr("goparent")){l.splice(l.length-1,1)}else{var R={};R.name=T;R.code=N;R.searchurl=U;l.push(R)}o=l[l.length-1].searchurl;if(o==""){o=k}A(z,1,"#groupcommon");$(S).removeClass().addClass("halfselected")}else{if(a!=undefined&&(a==true||a=="true")){myCommonEmotionChk("",S,function(V){var W=T+=V.name;I(S,W,N,V.code);$("#commonemotiondiv").css({display:"none"})})}else{var P=T;if(O!=undefined){P=T+"("+emoval2text(O)+")"}I(S,P,N,O)}}};var I=function(T,Q,S,P){$(T).removeClass().addClass("selected");var R=E(S);if(R!=S){$("#groupcommon a[code='"+R+"']").removeClass().addClass("halfselected")}var N=true;$("#selectedcommons .sltitem").each(function(V,U){if(P!=undefined){var W=$(this).attr("code");var X=$(this).attr("emotype");if(S==W&&P==X){$(this).parent().remove();$(T).removeClass().addClass("notselected");q(S,X);N=false}}else{var W=$(this).attr("code");if(S==W){$(this).parent().remove();$(T).removeClass().addClass("notselected");q(S);N=false}}});if(N){var O=createUtilSpanHtml("sltitem",Q,S,m,undefined,"cancleItem",undefined,P);$("#selectedcommons").append(O)}};var b=function(){var N="";if(m==undefined){m=true}$.each(H,function(P,O){N+=createUtilSpanHtml("sltitem",O.name,O.code,m,O.exclude,"cancleItem",undefined,O.emotype)});$("#selectedcommons").append(N)};var A=function(P,T,N){if(N==undefined||N=="commonpage"){N="#groupcommon"}if(!isArray(o)){var Q="";if(T==""||T==null||T==undefined){x=1}else{x=T}switch(o){case"countryUrl":Q=config.dataUrl+"?type=selectcountry";G="provinceUrl";J="area";break;case"provinceUrl":var O=l[l.length-1].code;if(O==""||O==undefined){O="CN"}Q=config.dataUrl+"?type=selectprovince&countrycode="+O;G="cityUrl";J="area";break;case"cityUrl":var O=l[l.length-2].code;if(O==""||O==undefined){O="CN"}var S=l[l.length-1].code;if(S=="110000"||S=="120000"||S=="310000"||S=="500000"){citycode=S.substr(0,3)+"100,"+S.substr(0,3)+"200";Q=config.dataUrl+"?type=selectdistrict&countrycode="+O+"&provincecode="+S+"&citycode="+citycode;G=false}else{Q=config.dataUrl+"?type=selectcity&countrycode="+O+"&provincecode="+S;G="districtUrl"}J="area";break;case"districtUrl":if(l[l.length-3]!=undefined){var O=l[l.length-3].code}if(O==""||O==undefined){O="CN"}var S=l[l.length-2].code;if(S==""||S==undefined){S=l[l.length-1].code.substr(0,2)+"0000"}Q=config.dataUrl+"?type=selectdistrict&countrycode="+O+"&provincecode="+S+"&citycode="+l[l.length-1].code;G=false;J="area";break;case"searchnameUrl":Q=config.solrData+"?type=kwblur&fieldname=users_screen_name&keyword="+encodeURIComponent(username)+"&page="+x+"&pagesize="+P;G=false;break;case"sourceidUrl":var R=e;if(e==undefined){R="source_host"}Q=config.dataUrl+"?type=getsource&queryfield="+R+"&srchostid="+K+"&searchtxt="+encodeURIComponent(C)+"&page="+x+"&pagesize="+P;G=false;break;case"businessUrl":Q=config.dataUrl+"?type=getbusiness";G=false;break;case"verifiedTypeUrl":Q=config.dataUrl+"?type=getverifiedtype";J="verifiedtype";G=false;break;case"verifiedUrl":Q=config.dataUrl+"?type=getverified";G=true;J="verified";break;case"selectverified":Q=config.dataUrl+"?type=selectverified";G=false;J="verified";break;case"selectwelluser":Q=config.dataUrl+"?type=selectwelluser";G=false;J="verified";break;case"selectwellorg":Q=config.dataUrl+"?type=selectwellorg";G=false;J="verified";break;case"selectwellother":Q=config.dataUrl+"?type=selectwellother";G=false;J="verified";break;default:Q=o;G=false;break}ajaxRequest(Q,function(W){if(W!=null&&W.length>0&&W[0].datalist!=null&&W[0].datalist.length>0){if(o=="verifiedTypeUrl"){var V=[];$.each(W[0].datalist,function(Y,X){$.each(X,function(Z,aa){if(aa.verified!=0){V.push(aa)}})});p(V,N,V.length)}else{p(W[0].datalist,N,W[0].totalcount)}}else{var U=i();if(U!=""){$(N).empty().append(U)}else{$(N).text("查询数据不存在！")}}},"json",function(){},function(){$(N).html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='waitimg'/>")},function(){$("#waitimg").css({display:"none"})})}else{p(o,N)}};var i=function(){var P="";if(l.length>0&&l[l.length-1].name!=""&&l[l.length-1].name!=undefined&&G!="false"){var O=g(l[l.length-1].code);var N=l[l.length-1].name;if(y!=undefined&&y==1){N="全部"}P="<a "+O+" onclick='sendItem(this, event)' haschild='false' code="+l[l.length-1].code+" name="+l[l.length-1].name+">"+N+"</a><span style='cursor:pointer;float:left;margin:2px;width: 60%;' onclick='sendItem(this, event)' goparent=true haschild="+l[l.length-1].searchurl+" code="+l[l.length-1].code+" name="+l[l.length-1].name+">[返回上一级]</span>"}return P};var h=function(P,O){var N=false;if(H!=undefined&&H.length>0){$.each(H,function(R,Q){if(Q.code==P){if(O!=undefined){if(Q.emotype==O){N=1;return false}}else{N=1;return false}}else{if(r(Q.code,P)){N=2}}})}return N};var g=function(Q,P){var N=h(Q,P);var O="";if(N==1){O="class='selected'"}else{if(N==2){O="class='halfselected'"}else{O="class='notselected'"}}return O};var p=function(Q,N,P){var O="";O+=i();$.each(Q,function(T,R){var S=g(R.code,R.emotype);if(s==undefined||s==true){if(R.haschild==undefined){G=B(R.code)}else{G=R.haschild}}else{G=false}var V=R.name;var W="";if(R.emotype!=undefined){W="emotype='"+R.emotype+"'";V=R.name+"("+emoval2text(R.emotype)+")"}var U="";if(getStringPx(V,12)>120){U="style='overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block;' title='"+V+"' "}O+="<a "+S+" onclick='sendItem(this, event)' haschild="+G+" "+W+" code='"+R.code+"' "+U+" name='"+R.name+"'>"+V+"</a>"});$(N).empty().append(O);$("#waitimg").css({display:"none"});if(P!=undefined&&P>z){pageDisplay(P,A,"commonpage",z,x)}else{$("#commonpage").empty()}};var E=function(N){if(J=="verified"){return D(N)}else{if(J=="area"){return j(N)}else{return N}}};var D=function(O){var N="";if(O.toString().indexOf("verify_")>-1){N=O}else{var P=parseInt(O,10);if(P>=0&&P<=7){N="verify_1"}else{if(P>=200&&P<=280){N="verify_2"}else{if(P==-2||(P>=0&&P<=7)){N="verify_3"}else{N="verify_4"}}}}return N};var j=function(P){var R=P;if(P.length==6){var Q=P.substr(0,2);var O=P.substr(2,2);var N=P.substr(4,2);if(O!="00"&&N!="00"){if(Q=="11"||Q=="12"||Q=="31"||Q=="50"){R=P.substr(0,2)+"0000"}else{R=P.substr(0,4)+"00"}}else{if(O!="00"&&N=="00"){R=P.substr(0,2)+"0000"}else{if(O=="00"&&N=="00"){R="CN"}}}}return R};var r=function(N,O){if(J=="verified"){return F(N,O)}else{if(J=="area"){return u(N,O)}else{return false}}};var F=function(O,P){var N=false;if(O.toString().indexOf("verify_")>-1){N=false}else{if(P.toString().indexOf("verify_")>-1){var Q=P.split("verify_");if(0==Q[1]){N=false}else{if(1==Q[1]){var R=parseInt(O,10);if(R>=0&&R<=7){N=true}}else{if(2==Q[1]){var R=parseInt(O,10);if(R>=200&&R<=280){N=true}}else{if(3==Q[1]){var R=parseInt(O,10);if(R==-2||(R>=1&&R<=7)){N=true}}}}}}}return N};var u=function(P,Q){var U=false;var T=Q.substr(0,2);var N=Q.substr(2,2);var V=Q.substr(4,2);var O=P.substr(0,2);var S=P.substr(2,2);var R=P.substr(4,2);if(T==O){if(N==S){if(V==R){U=true}else{if(V=="00"){U=true}}}else{if(N=="00"){U=true}}}else{if(Q=="CN"){U=true}}return U};var B=function(S){var U=false;if(S.length==6){var T=S.substr(0,2);var R=S.substr(2,2);var Q=S.substr(4,2);if(R=="00"&&Q=="00"){U="cityUrl"}else{if(R!="00"&&Q=="00"){U="districtUrl"}else{if(R!="00"&&Q!="00"){U=false}}}}else{if(S.length==2){var N=S.length;var O=true;for(var P=0;P<N;P++){if(!(S.charCodeAt(P)>=65&&S.charCodeAt(P)<=90)){O=false}}if(O){U="provinceUrl"}else{U=false}}}return U};L()}function myCommonEmotionChk(c,b,a){var d=this;this.target=c;this.ele=b;this.commonemotionChk=function(){var e="";if(d.target){e+='<div id="commonemotiondiv"  style="font-size: 12px;" class="search">'}else{e+='<div id="commonemotiondiv" style="position:absolute;display:none;z-index:9999;background-color:white;border:1px solid blue;font-size: 12px; width:264px;">'}e+='<span id="commonemotionspan">';e+='<input type="checkbox" name="commonemotion" id="commonemotion1" value="1" class="outborder" /><label for="commonemotion1">反对</label>';e+='<input type="checkbox" name="commonemotion" id="commonemotion2" value="2" class="outborder" /><label for="commonemotion2">负面</label>';e+='<input type="checkbox" name="commonemotion" id="commonemotion3" value="3" class="outborder" /><label for="commonemotion3">中性</label>';e+='<input type="checkbox" name="commonemotion" id="commonemotion4" value="4" class="outborder" /><label for="commonemotion4">正面</label>';e+='<input type="checkbox" name="commonemotion" id="commonemotion5" value="5" class="outborder" /><label for="commonemotion5">赞赏</label>';e+='<input type="checkbox" name="commonemotion" id="commonemotionall" value="*" class="outborder" /><label for="commonemotionall">全部</label>';if(!d.target){e+='<br/><a id="itememo" style="cursor:pointer;">确定</a>'}e+="</span></div>";if($("#commonemotiondiv").length==0){if(!d.target){$("body").append(e)}else{$(d.target).before(e)}}$("#commonemotiondiv input[name=commonemotion]").bind("click",function(){var h=$(this).attr("id");if(h=="commonemotionall"){if($(this).prop("checked")==true){$("#commonemotiondiv input[name=commonemotion]").attr("checked",true)}else{$("#commonemotiondiv input[name=commonemotion]").attr("checked",false)}}else{var i=$("#commonemotiondiv input[name=commonemotion]:checked").length;var j=$("#commonemotiondiv input[name=commonemotion]").length;if($(this).prop("checked")==true){if(i==j-1){$("#commonemotiondiv input[name=commonemotion]").attr("checked",true)}}else{$("#commonemotiondiv input[name=commonemotion][id=commonemotionall]").attr("checked",false)}}});if(!d.target){var g,f;g=$(d.ele).offset().left+30;f=$(d.ele).offset().top-$("#commonemotiondiv").height();$("#commonemotiondiv").css({top:f+"px",left:g+"px",display:"block"})}$("#commonemotionspan input[name=commonemotion]").attr("checked",false);$("#itememo").unbind("click");$("#itememo").bind("click",function(){var h=d.commonemotionResult();if(h!=false){a(h)}})};this.commonemotionResult=function(){var f={};var e=[];var g=[];var h=$("#commonemotionspan input[name=commonemotion]:checked").length;if(h==0){alert("请选择情感!");return false}$("#commonemotionspan input[name=commonemotion]:checked").each(function(){var k=$(this).attr("id");if(k!="commonemotionall"){var j=$("#commonemotiondiv label[for="+k+"]").text();e.push(j);var l=$(this).val();g.push(l)}});var i=$("#commonemotionspan input[name=commonemotion]").length;if(g.length>0){if(g.length==i-1){f.name="(全部)";f.code="*"}else{f.name="("+e.join(",")+")";f.code=""+g.join(",")}}return f};this.commonemotionClose=function(){$("#commonemotiondiv").css("display","none")};d.commonemotionChk()}function myBatchAdd(b){var a=function(){$("#batchbox").remove();var c="";c+="<div>";c+='<textarea rows="20" cols="50" id="batchdata"></textarea>';c+='<div><input class="buttono" type="button" value="添加" id="batchaddbtn" /></div>';c+="</div>";$("<div id='batchbox'></div>").insertAfter("body");$("#batchbox").append(c);$("#batchbox").dialog({autoOpen:true,modal:true,width:500,close:function(){}});$("#batchaddbtn").bind("click",function(){var d=$("#batchdata").val();commonFun.trim(d);var e=d.split("\n");b(commonFun.arrytrim(e));$("#batchbox").dialog("close")})};a()}function addNewTag(E,q,p,e,f,l,F){var k;var w=20;var z;var s=false;var u=E;var D=[];var j=false;var b;var c;var g="";var v;var B=function(){if(q==undefined){q=""}$("#choicebox").remove();var J="";J="请选择种类:<span id='searchtxt' name='searchtxt'></span>";J+="<fieldset>";J+="<legend>"+q+"</legend>";J+="<div id='groupnewtag'><img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='waitimg'/></div>";J+="<div id='newtagpage' style='margin-top:2px;float:left;width:100%;margin:5px;'></div>";if(F){J+="<div class='search' id='newtagselectallbtndiv' style='float:left;width:100%;'><input id='newtagselectallbtn' name='newtagselectallbtn' type='button' value='全选' /> <input id='newtagunselectallbtn' name='newtagunselectallbtn' type='button' value='反选' /> <input id='newtagunselectnonebtn' name='newtagunselectnonebtn' type='button' value='清空' /></div>"}J+="</fieldset>";J+="<div class='search'><input id='newtagsubmit' name='newtagsubmit' type='button' value='确定' style='display:none'/>   <input id='canclesubmit' name='canclesubmit' type='button' value='取消' /></div>";var G='<div id="choicebox" title="'+q+'列表" style="position:absolute;display:none;z-index:9999;background-color:white;border:1px solid blue;font-size: 12px; width:490px;"></div>';if(p!=undefined){$("body").append(G);$("#choicebox").append(J)}else{$("<div id='choicebox' title='"+q+"列表'></div>").insertAfter("body");$("#choicebox").append(J);$("#choicebox").dialog({autoOpen:false,modal:true,width:550,close:function(){$("#newtagemotiondiv").css("display","none")}})}y();if(!isArray(u)){this.sendItemTag("<a haschild='"+u+"' code='' name=''></a>")}else{var K={};K.name="";K.code="";K.searchurl="";D.push(K);x(w,1,"#groupnewtag")}if(p!=undefined){var I,H;I=$(p).offset().left+130;if(I>($(document.body).width()-$("#choicebox").width())){I=$(document.body).width()-$("#choicebox").width()-10}H=$(p).offset().top;$("#choicebox").slideDown("slow").css({display:"block",left:I+"px",top:H+"px"})}else{$("#choicebox").dialog("open")}$("#searchbtn").bind("click",function(){g=$("#searchtxt").val();x(w,1,"#groupnewtag")});$("#newtagunselectallbtn").bind("click",function(){$("#groupnewtag").find("a").each(function(L,M){sendItem($(M))})});$("#newtagselectallbtn").bind("click",function(){$("#selectednewtags").empty();$("#groupnewtag").find("a").each(function(L,M){sendItem($(M))})});$("#newtagunselectnonebtn").bind("click",function(L,M){$("#selectednewtags .cancleitem").each(function(O,N){cancleItem($(N))})});$("#newtagsubmit").unbind("click");$("#newtagsubmit").bind("click",function(){var L=$("#myaddnewtag").attr("feature_father_guid");var M=$("#myaddnewtag").val();if(M==""){$("#myaddnewtag").css("border-color","red");return false}var N={type:"addfeatureword",feature_father_guid:L,feature_keyword:[M],feature_field:["text"]};$.ajax({url:config.solrData,type:"post",data:JSON.stringify(N),dataType:"json",contentType:"application/json",success:function(O){if(O.flag){alert("添加成功")}else{alert("添加失败")}},error:function(){alert("数据请求异常")}});$("#newtagemotiondiv").css("display","none");if(p!=undefined){$("#choicebox").slideUp("slow")}else{$("#choicebox").dialog("close")}});$("#canclesubmit").bind("click",function(){$("#newtagemotiondiv").css("display","none");$("#selectednewtags").empty();if(p!=undefined){$("#choicebox").slideUp("slow")}else{$("#choicebox").dialog("close")}})};this.getSelectedVal=function(){var G=[];$("#selectednewtags .sltitem").each(function(J,H){var I={};I.code=$(this).attr("code");I.name=$(this).text();if($(this).attr("emotype")!=undefined){I.emotype=$(this).attr("emotype")}if($(this).attr("exclude")!=undefined){I.exclude=$(this).attr("exclude")}G.push(I)});return G};this.sendItemTag=function(J,H){var K=$(J).attr("name");var G=$(J).attr("father_id");var L=$(J).attr("haschild");if($(J).text()!="[返回上一级]"){if($("#searchtxt").text()!="请选择"&&$("#searchtxt").text()!=""){$("#searchtxt").append("<span>-"+$(J).text()+"</span>")}else{if($("#searchtxt").text()==""){$("#searchtxt").html("请选择")}else{$("#searchtxt").html("").html("<span oldlevel="+$(J).text()+">"+$(J).text()+"</span>")}}}else{if($("#searchtxt").children("span").length>1){$("#searchtxt").children("span").last().remove()}else{if($("#searchtxt").children("span").length==1){$("#searchtxt").html("").html("请选择")}}}if(L!="false"){if($(J).attr("goparent")!=undefined&&$(J).attr("goparent")){D.splice(D.length-1,1)}else{var I={};I.name=K;I.parent=G;I.searchurl=L;D.push(I)}u=D[D.length-1].searchurl;if(u==""){u=E}x(w,1,"#groupnewtag")}};var A=function(M,J,L,I){$(M).removeClass().addClass("selected");var K=n(L);if(K!=L){$("#groupnewtag a[code='"+K+"']").removeClass().addClass("halfselected")}var G=true;$("#selectednewtags .sltitem").each(function(O,N){if(I!=undefined){var P=$(this).attr("code");var Q=$(this).attr("emotype");if(L==P&&I==Q){$(this).parent().remove();$(M).removeClass().addClass("notselected");deleteParent(L,Q);G=false}}else{var P=$(this).attr("code");if(L==P){$(this).parent().remove();$(M).removeClass().addClass("notselected");deleteParent(L);G=false}}});if(G){var H=createUtilSpanHtml("sltitem",J,L,e,undefined,"cancleItem",undefined,I);$("#selectednewtags").append(H)}};var y=function(){var G="";if(e==undefined){e=true}$("#selectednewtags").append(G)};var x=function(H,J,G){if(G==undefined){G="#groupnewtag"}if(!isArray(u)){var I="";if(J==""||J==null||J==undefined){z=1}else{z=J}switch(u){case"addnewtags":I=config.solrData+"?type=selectfeaturepclass&fieldname=text";break;default:I=config.solrData+"?type=addnewtags&feature_father_guid="+u;break}ajaxRequest(I,function(M){if(M!=null&&M.length>0&&M[0].datalist!=null&&M[0].datalist.length>0){h(M[0].datalist,G,M[0].totalcount)}else{var L=i();if(L!=""){$(G).empty().append(L).append("您查询数据不存在！")}else{var K="<div style='margin-bottom:6px;' onclick='sendItemTag(this, event)' goparent=true haschild="+D[D.length-1].parent+" father_id="+D[D.length-1].parent+" name="+D[D.length-1].name+"><span style='cursor:pointer'>[返回上一级]</span></div>";if(D[D.length-1].parent!=undefined){$(G).html(K+"查询数据不存在！")}else{$(G).html("查询数据不存在！")}}}},"json",function(){},function(){$(G).html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='waitimg'/>")},function(){$("#waitimg").css({display:"none"}),null,"true"})}else{h(u,G)}};var i=function(){var I="";if(D.length>0&&D[D.length-1].name!=""&&D[D.length-1].name!=undefined&&s!="false"){var H=r(D[D.length-1].code);var G=D[D.length-1].name;if(f!=undefined&&f==1){G="全部"}I="<div style='margin-bottom:6px;' onclick='sendItemTag(this, event)' goparent=true haschild="+D[D.length-1].parent+" father_id="+D[D.length-1].parent+" name="+D[D.length-1].name+"><span style='cursor:pointer'>[返回上一级]</span></div>"}return I};var r=function(J,I){var G="";var H="";if(G==1){H="class='selected'"}else{if(G==2){H="class='halfselected'"}else{H="class='notselected'"}}return H};var h=function(L,G,J){var I="";I+=i();var K=false;var H="";$.each(L,function(P,M){var O=r(M.code,M.emotype);if(l==undefined||l==true){if(M.feature_field==undefined){s=M.guid}else{s=false}}else{s=false}var R=M.feature_class;var S="";var Q="";if(getStringPx(R,12)>120){Q="style='overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block;' title='"+R+"' "}if("feature_keyword" in M){K=true;var N="style='margin:2px;width:150px;float:left'";H=M.feature_father_guid;I+="<a "+N+" haschild="+s+" name="+R+" feature_field="+M.feature_field+" "+S+" "+Q+" father_id='"+M.feature_father_guid+"'>"+R+"</a>"}else{I+="<a "+O+" onclick='sendItemTag(this, event)' haschild="+s+" name="+R+" "+S+" "+Q+" father_id='"+M.feature_father_guid+"'>"+R+"</a>"}});if(K){I+="<div style='clear:both;padding-top:6px'>请填写新标签:<input name='myaddnewtag' id='myaddnewtag' feature_father_guid='"+H+"' type='text'/></div>";$("#newtagsubmit").show()}else{$("#newtagsubmit").hide()}$(G).empty().append(I);$("#waitimg").css({display:"none"});if(J!=undefined&&J>w){pageDisplay(J,x,"newtagpage",w,z)}else{$("#newtagpage").empty()}};var n=function(G){if(v=="verified"){return d(G)}else{if(v=="area"){return m(G)}else{return G}}};var d=function(H){var G="";if(H.toString().indexOf("verify_")>-1){G=H}else{var I=parseInt(H,10);if(I>=0&&I<=7){G="verify_1"}else{if(I>=200&&I<=280){G="verify_2"}else{if(I==-2||(I>=0&&I<=7)){G="verify_3"}else{G="verify_4"}}}}return G};var m=function(I){var K=I;if(I.length==6){var J=I.substr(0,2);var H=I.substr(2,2);var G=I.substr(4,2);if(H!="00"&&G!="00"){if(J=="11"||J=="12"||J=="31"||J=="50"){K=I.substr(0,2)+"0000"}else{K=I.substr(0,4)+"00"}}else{if(H!="00"&&G=="00"){K=I.substr(0,2)+"0000"}else{if(H=="00"&&G=="00"){K="CN"}}}}return K};var o=function(G,H){if(v=="verified"){return a(G,H)}else{if(v=="area"){return C(G,H)}else{return false}}};var a=function(H,I){var G=false;if(H.toString().indexOf("verify_")>-1){G=false}else{if(I.toString().indexOf("verify_")>-1){var J=I.split("verify_");if(0==J[1]){G=false}else{if(1==J[1]){var K=parseInt(H,10);if(K>=0&&K<=7){G=true}}else{if(2==J[1]){var K=parseInt(H,10);if(K>=200&&K<=280){G=true}}else{if(3==J[1]){var K=parseInt(H,10);if(K==-2||(K>=1&&K<=7)){G=true}}}}}}}return G};var C=function(I,J){var N=false;var M=J.substr(0,2);var G=J.substr(2,2);var O=J.substr(4,2);var H=I.substr(0,2);var L=I.substr(2,2);var K=I.substr(4,2);if(M==H){if(G==L){if(O==K){N=true}else{if(O=="00"){N=true}}}else{if(G=="00"){N=true}}}else{if(J=="CN"){N=true}}return N};var t=function(L){var N=false;if(L.length==6){var M=L.substr(0,2);var K=L.substr(2,2);var J=L.substr(4,2);if(K=="00"&&J=="00"){N="cityUrl"}else{if(K!="00"&&J=="00"){N="districtUrl"}else{if(K!="00"&&J!="00"){N=false}}}}else{if(L.length==2){var G=L.length;var H=true;for(var I=0;I<G;I++){if(!(L.charCodeAt(I)>=65&&L.charCodeAt(I)<=90)){H=false}}if(H){N="provinceUrl"}else{N=false}}}return N};B()};if(!window.Global){window.Global=new Object()}Global.oldajaxfun;if(typeof($)!="undefined"&&typeof($.ajax)!="undefined"){Global.oldajaxfun=$.ajax;$.ajax=function(b){if(typeof(b.success)=="function"){var a=b.success;b.success=function(c){if(!checkSession(c)){return false}a(c)}}Global.oldajaxfun(b)}}Global.checkedsession=false;var Browser={};var ua=navigator.userAgent.toLowerCase();var s;(s=ua.match(/msie ([\d.]+)/))?Browser.ie=s[1]:(s=ua.match(/firefox\/([\d.]+)/))?Browser.firefox=s[1]:(s=ua.match(/chrome\/([\d.]+)/))?Browser.chrome=s[1]:(s=ua.match(/opera.([\d.]+)/))?Browser.opera=s[1]:(s=ua.match(/version\/([\d.]+).*safari/))?Browser.safari=s[1]:0;function checkSession(b){if(b!=undefined&&b.errorcode=="nosession"){if(!Global.checkedsession){Global.checkedsession=true;var a=b.error;a=(a==undefined||a==null||a=="")?"登录超时":a;alert(a);window.location.href=config.loginPageUrl}return false}else{return true}}function picresize(c,b,a){c.onload=null;img=new Image();img.src=c.src;if(img.height>a){c.width=a*img.width/img.height;c.height=a}else{c.width=img.width;c.height=img.height}img=null}function picresize80(c,b,a){c.width=b;c.height=a}function showWaitImg(b){var c=$(b).height()/2-33;var a=$(b).width()/2-33;$(b).html('<img style="padding-left:'+a+"px;padding-top:"+c+'px" src="'+config.imagePath+'wait.gif" />')};function getRangeClassifyValue(b,a){var c=[];$.each(a,function(d,e){if(e!=undefined&&e.fieldname==b){if(e.fieldvalue.datatype=="array"){$.each(e.fieldvalue.value,function(g,f){if(f.datatype=="classifyrange"){c.push({fieldname:e.fieldname,fieldvalue:{datatype:f.datatype,value:f.value}})}})}}});return c}function rangeDisplayHtml(d,f){if(f=="created_at"){var e=""+d+"_facet_range";var b="";b+='<span id="'+e+'_timeselect_start">全部时间</span><span id="'+e+'_splitmark" style="display:none;"> ~ </span><span id="'+e+'_timeselect_end"></span>';b+=createRangeOnsiteFieldHtml(e,true);$("#"+d+"_facet_range_html").empty().append(b);$("#"+e+"_createdtime_start, #"+e+"_createdtime_end").die("click");$("#"+e+"_createdtime_start, #"+e+"_createdtime_end").live("click",function(){WdatePicker({onpicked:function(){var h=$("#"+e+"_createdtime_start").val();var k=$("#"+e+"_createdtime_end").val();if(h.length!=0||k.length!=0){$("#"+e+"_timeselect_start").text(h);$("#"+e+"_timeselect_end").text(k);isShowSplitmark("#"+e+"_timeselect_start","#"+e+"_timeselect_end","#"+e+"_splitmark",true);$("#"+e+"_createdtime_all").attr("checked",false)}gapUnitDisplay(d,f)},oncleared:function(){if($("#"+e+"_createdtime_start").val().length==0&&$("#"+e+"_createdtime_end").val().length==0){$("#"+e+"_timeselect_start").text("全部时间");$("#"+e+"_timeselect_end").text("");isShowSplitmark("#"+e+"_timeselect_start","#"+e+"_timeselect_end","#"+e+"_splitmark");$("#"+e+"_createdtime_all").attr("checked",true)}else{if($("input[name="+e+"_createdtime_start]").val().length==0){$("#"+e+"_timeselect_start").text("")}if($("input[name="+e+"_createdtime_end]").val().length==0){$("#"+e+"_timeselect_end").text("")}}gapUnitDisplay(d,f)},dateFmt:"yyyy-MM-dd HH:mm:ss"})});$("#"+d+"_facet_range_html div[timetype] input, #"+d+"_facet_range_html div[timetype] select").unbind("click");$("#"+d+"_facet_range_html div[timetype] input, #"+d+"_facet_range_html div[timetype] select").bind("click",function(){var h=$(this).parent().attr("timetype");$("#"+d+"_facet_range_html").attr("checkedtimetype",h);changeTimeBorderColor(d+"_facet_range_html",h)});$("#"+d+"_facet_range_createdtime_all").bind("click",function(){if($(this).prop("checked")){$(this).attr("checked",true);setTimeSelectMsg(""+d+"_facet_range","全部时间","")}else{$(this).attr("checked",false);var h=$("#"+d+"_facet_range_createdtime_start").val();var k=$("#"+d+"_facet_range_createdtime_end").val();if(h==""&&k==""){setTimeSelectMsg(""+d+"_facet_range","请填写时间")}else{if(h==""||h==undefined){setTimeSelectMsg(""+d+"_facet_range","",k)}else{if(k==""||k==undefined){setTimeSelectMsg(""+d+"_facet_range",h,"")}}}}gapUnitDisplay(d,f)});$("#"+d+"_facet_range_nearlytime_thistime").bind("click",function(){var h=$(this).attr("timestate");nearlytimeTagClick(""+d+"_facet_range",h)});$("#"+d+"_facet_range_nearlytime_div input[nearly]").bind("click",function(){var h=$(this).attr("nearly");nearlytimeShortCutBtnClick(""+d+"_facet_range",h);gapUnitDisplay(d,f)});$("#"+d+"_facet_range_nearlytime, #"+d+"_facet_range_nearlytime_gap").bind("change",function(){nearlytimeInputChange(""+d+"_facet_range")});$("#"+d+"_facet_range_beforetime_thistime").bind("click",function(){var h=$(this).attr("timestate");beforetimeTagTimeClick(""+d+"_facet_range",h)});$("#"+d+"_facet_range_beforetime_thisdate").bind("click",function(){var h=$(this).attr("datestate");beforetimeTagDateClick(""+d+"_facet_range",h)});$("#"+d+"_facet_range_beforetime_start, #"+d+"_facet_range_beforetime_end, #"+d+"_facet_range_beforetime_end_gap").bind("change",function(){beforetimeInputChange(""+d+"_facet_range");gapUnitDisplay(d,f)});$("#"+d+"_facet_range_untiltime_div input[untiltime]").bind("click",function(){var h=$(this).attr("untiltime");var k=$(this).attr("until"+h+"");untiltimeShortCutBtnClick(""+d+"_facet_range",k,h);gapUnitDisplay(d,f)});$.each(["start","end"],function(h,l){$("#"+d+"_facet_range_untiltime_"+l+"_gap").bind("change",function(){var k=$(this).val();untiltimeGapChange(""+d+"_facet_range",k,l);untiltimeValueChange(d+"_facet_range")});$("#"+d+"_facet_range_untiltime_"+l+"_this_gap").bind("change",function(){var n=$(this).val();var m=dateUnitDisplay(n,"down");var k=timeSelectOption(m);$("#"+d+"_facet_range_untiltime_"+l+"_to_gap").empty().append(k);untiltimeValueChange(d+"_facet_range")});$("#"+d+"_facet_range_untiltime_"+l+"_to_gap").bind("change",function(){untiltimeValueChange(d+"_facet_range")});$("#"+d+"_facet_range_untiltime_"+l+"").bind("change",function(){untiltimeInputChange(""+d+"_facet_range",l);untiltimeValueChange(d+"_facet_range")});$("#"+d+"_facet_range_untiltime_"+l+"_to").bind("change",function(){untiltimeValueChange(d+"_facet_range")})});var g="<option value='month'>月</option><option value='day'>天</option><option value='hour'>小时</option>";$("#"+d+"_facet_gap_measure").empty().append(g)}else{if(f=="register_time"){var c='<input type="text" name="'+d+'_facet_range" id="'+d+'_facet_range_start"/> 至 <input type="text" name="'+d+'_facet_range" id="'+d+'_facet_range_end"/>';$("#"+d+"_facet_range_html").empty().append(c);var g="<option value='year'>年</option><option value='month'>月</option><option value='day'>天</option>";$("#"+d+"_facet_gap_measure").empty().append(g);var a='<span id="'+d+'_facet_range_registertime_all"><input id="'+d+"_facet_range_"+f+'_all" type="checkbox" checked="checked" name="'+d+'_facet_range_all"><label for="'+d+"_facet_range_"+f+'_all">全部</label></span>';$("#"+d+"_facet_range_unit").after(a)}else{if(f=="users_created_at"){var c='<input type="text" name="'+d+'_facet_range" id="'+d+'_facet_range_start"/> 至 <input type="text" name="'+d+'_facet_range" id="'+d+'_facet_range_end"/>';$("#"+d+"_facet_range_html").empty().append(c);var g="<option value='year'>年</option><option value='month'>月</option><option value='day'>天</option>";$("#"+d+"_facet_gap_measure").empty().append(g);var a='<span id="'+d+'_facet_range_registertime_all"><input id="'+d+"_facet_range_"+f+'_all" type="checkbox" checked="checked" name="'+d+'_facet_range_all"><label for="'+d+"_facet_range_"+f+'_all">全部</label></span>';$("#"+d+"_facet_range_unit").after(a)}else{var c='<input type="text" name="'+d+'_facet_range" id="'+d+'_facet_range_start"/> 至 <input type="text" name="'+d+'_facet_range" id="'+d+'_facet_range_end"/><input id="'+d+"_facet_range_"+f+'_all" type="checkbox" checked="checked" name="'+d+'_facet_range_all"><label for="'+d+"_facet_range_"+f+'_all">全部</label>';$("#"+d+"_facet_range_html").empty().append(c)}}}$("#"+d+"_facet_range_html input[name="+d+"_facet_range]").bind("blur",function(){gapUnitDisplay(d,f)});$("#"+d+"_facet_range_html input[name="+d+"_facet_range]").bind("focus",function(){$("#"+d+"_facet_range_register_time_all").attr("checked",false);$("#"+d+"_facet_range_users_created_at_all").attr("checked",false);$("input[name="+d+"_facet_range_all]").attr("checked",false)});$("input[name="+d+"_facet_range_all]").bind("click",function(){$("#"+d+"_facet_range_start").val("");$("#"+d+"_facet_range_end").val("")});$("input[name="+d+"_facet_gap_type][value=gap]").attr("checked",true);gapUnitDisplay(d,f)}function createRangeOnsiteFieldHtml(f,d){var e="";var c="";if(d){c='<span class="rightalign">相对今天：</span>'}e+='<div style="margin:7px;" id="'+f+'_nearlytime_div" timetype="nearlytime">'+c+'<input type="radio" name="'+f+'_nearlytime_shortcut" id="'+f+'_nearlytime_day" class="outborder" nearly="1day" /><label for="'+f+'_nearlytime_day">近一天</label>&nbsp;&nbsp;<input type="radio" name="'+f+'_nearlytime_shortcut" id="'+f+'_nearlytime_week" class="outborder" nearly="1week" /><label for="'+f+'_nearlytime_week">近一周</label>&nbsp;&nbsp;<input type="radio" name="'+f+'_nearlytime_shortcut" id="'+f+'_nearlytime_month" class="outborder" nearly="1month" /><label for="'+f+'_nearlytime_month">近一月</label>&nbsp;&nbsp;<input type="radio" name="'+f+'_nearlytime_shortcut" id="'+f+'_nearlytime_year" class="outborder" nearly="1year" /><label for="'+f+'_nearlytime_year">近一年</label>&nbsp;&nbsp;近<input type="text" class="smallinput"  style="border:1px solid #ccc;" id="'+f+'_nearlytime" name="'+f+'_nearlytime" /><select id="'+f+'_nearlytime_gap">'+timeSelectOption()+'</select>&nbsp;&nbsp;<a id="'+f+'_nearlytime_thistime" timestate="now" style="display:none;"></a></div>';var b="";if(d){b='<span class="rightalign">时间段：</span>'}e+='<div style="margin:7px;" id="'+f+'_beforetime_div" timetype="beforetime">'+b+' 前<input type="text" value=""  id="'+f+'_beforetime_start" name="'+f+'_beforetime_start" class="smallinput" style="border:1px solid #ccc;"/>到前<input type="text" value="" class="smallinput" style="border:1px solid #ccc;" id="'+f+'_beforetime_end" name="'+f+'_beforetime_end" /><select id="'+f+'_beforetime_end_gap">'+timeSelectOption()+'</select>&nbsp;&nbsp; <a style="display:none;" id="'+f+'_beforetime_thisdate" datestate="now"></a> &nbsp;&nbsp; <a style="display:none;" id="'+f+'_beforetime_thistime" timestate="now"></a></div>';var a="";if(d){a='<span class="rightalign">绝对时间：</span>'}e+="<div style='margin:7px;' id='"+f+"_createdtime_div' timetype='createdtime'>"+a+"<input type='text' id='"+f+"_createdtime_start'  name='"+f+"_createdtime_start' style='border:1px solid #ccc;'> 至 <input type='text' id='"+f+"_createdtime_end' name='"+f+"_createdtime_end' style='border:1px solid #ccc;'>&nbsp;&nbsp;<input type='checkbox' name='"+f+"_all' id='"+f+"_createdtime_all' checked='checked' /><label for='"+f+"_createdtime_all'>全部</label></div>";var g="";e+='<div style="margin:7px;" id="'+f+'_untiltime_div" timetype="untiltime">';$.each(["start","end"],function(l,h){if(d&&h=="start"){g='<span class="rightalign">日历时间段：</span>'}else{if(d&&h=="end"){g='<span class="rightalign"></span>'}}e+=""+g+'<input type="radio" name="'+f+"_untiltime_"+h+'_shortcut" id="'+f+"_untiltime_"+h+'_shortcut1" class="outborder" untiltime="'+h+'" until'+h+'="1day" /><label for="'+f+"_untiltime_"+h+'_shortcut1">昨天</label>&nbsp;&nbsp;<input type="radio" name="'+f+"_untiltime_"+h+'_shortcut" id="'+f+"_untiltime_"+h+'_shortcut2" class="outborder" untiltime="'+h+'" until'+h+'="1week" /><label for="'+f+"_untiltime_"+h+'_shortcut2">上周</label>&nbsp;&nbsp;<input type="radio" name="'+f+"_untiltime_"+h+'_shortcut" id="'+f+"_untiltime_"+h+'_shortcut3" class="outborder" untiltime="'+h+'" until'+h+'="1month" /><label for="'+f+"_untiltime_"+h+'_shortcut3">上个月</label>&nbsp;&nbsp;';e+='至今<input type="text" value="" class="smallinput" style="border:1px solid #ccc;" id="'+f+"_untiltime_"+h+'" name="'+f+"_untiltime_"+h+'" untiltime="'+h+'" /><select id="'+f+"_untiltime_"+h+'_gap" untiltime="'+h+'" >'+timeSelectOption()+'</select>该<select id="'+f+"_untiltime_"+h+'_this_gap">'+timeSelectOption()+'</select>的第<input type="text" value="" class="smallinput" style="border:1px solid #ccc;" id="'+f+"_untiltime_"+h+'_to" name="'+f+"_untiltime_"+h+'_to"  untiltime="'+h+'" /><select id="'+f+"_untiltime_"+h+'_to_gap"  untiltime="'+h+'" >'+timeSelectOption()+"</select><br/>"});e+="</div>";return e}function initFilterRelation(a,c){if(c==undefined){c=0}var e={opt:"and",filterlist:[],fields:[]};var b={};$.each(a.filtervalue,function(h,l){var g="";if(l.fieldname=="verified"||l.fieldname=="verified_type"){g="verified_type"}else{g=l.fieldname}var k;if(l.isfeature==undefined){k=0}else{k=l.isfeature}g=g+"_"+k;if(typeof(b[g])=="undefined"){b[g]=[]}b[g].push(h+c)});for(var d in b){if(b[d].length==1){e.fields.push(b[d][0])}else{var f={opt:"or",filterlist:[],fields:b[d]};e.filterlist.push(f)}}a.isdefaultrelation=true;a.filterrelation=e}function getFilterValue(c,a,b){var d=[];$.each(a,function(g,h){if(h!=undefined&&h.fieldname==c){var k;if(h.fromlimit!=undefined){k=h.fromlimit}else{k=0}var f;if(h.isfeature!=undefined){f=h.isfeature}else{f=0}var e;if(h.exclude!=undefined){e=h.exclude}else{e=0}if(h.fieldvalue.datatype=="array"){$(h.fieldvalue.value).each(function(m,l){if(b!=undefined&&b!=l.datatype&&l.datatype=="value_text_object"&&!f){d.push({fieldname:h.fieldname,fieldvalue:{datatype:b,value:l.value.value},fromlimit:k,isfeature:f,exclude:e})}else{if(l.datatype!=undefined&&l.datatype!="classifyrange"){d.push({fieldname:h.fieldname,fieldvalue:{datatype:l.datatype,value:l.value},fromlimit:k,isfeature:f,exclude:e})}}})}else{if(b!=undefined&&b!=h.fieldvalue.datatype&&h.fieldvalue.datatype=="value_text_object"&&!f){d.push({fieldname:h.fieldname,fieldvalue:{datatype:b,value:h.fieldvalue.value.value},fromlimit:k,isfeature:f,exclude:e})}else{d.push({fieldname:h.fieldname,fieldvalue:h.fieldvalue,fromlimit:k,isfeature:f,exclude:e})}}}});return d}function createFiltervalue(d,f,g,a,h,c){var e={};e.fieldname=d;if(a!=undefined){e.fromlimit=a}else{e.fromlimit=0}if(h!=undefined){e.isfeature=h}else{e.isfeature=0}if(c!=undefined){e.exclude=c}else{e.exclude=0}var b={};b.datatype=f;b.value=g;e.fieldvalue=b;return e}function createFormConfigSpanHtml(u,y,c,e,b,s,n,k,w,g,v,r){var h="";if(n!=undefined&&n!=""){h="emotype='"+n+"'"}var p="";if(v!=undefined&&v.length>0){var o=[];$.each(v,function(z,A){o.push(""+A.name+"='"+A.value+"'")});p=o.join(" ")}var t="";if(s!=undefined&&s!=""){t="isfeature='"+s+"'"}var m="";if(k!=undefined&&k!=""){m="marktype='"+k+"'"}var f="";if(w!=undefined&&w!=""){f="blurtype='"+w+"'"}var x="";if(c!=undefined){c=commonFun.trim(c);x="code='"+c+"'"}if(g!=false&&(g==undefined||g=="")){g="cancleselectedvaluetextobj"}var q="";if(typeof r==="string"&&r!==""){q="guid='"+r+"'"}if(y!=undefined){y=commonFun.trim(y)}var l="";l+="<span class='selwordsbox'>";var d="";if(e){var a="";if(b!=undefined&&b!=0){d="exclude='"+b+"'";a="style='color:#000000;'"}l+="<a class='excludeitem' onclick='excludeItemFun(this)' "+a+" >不</a>"}l+="<span class='"+u+"item' "+x+" "+d+" "+t+" "+h+" "+p+" "+m+" "+f+" "+q+">"+y+"</span>";if(g!==false){l+="<a name='"+g+"' value='"+u+"' class='cancleitem'>×</a>"}l+="</span>";return l}function getFiltervalueFromlimit(c,b,d){if(d==undefined){d=false}var a=[];$.each(b.filter,function(f,e){if(c==f){switch(e.datatype){case"range":if(d){$.each(e.limit,function(h,g){var k={};k.datatype=e.datatype;var l={};l.start=g.value.minvalue;l.end=g.value.maxvalue;k.value=l;a.push(k)})}else{$.each(e.limit,function(h,g){var k={};k.start=g.value.minvalue;k.end=g.value.maxvalue;a.push(k)})}break;case"value_text_object":case"blur_value_object":case"string":case"int":if(d){$.each(e.limit,function(h,g){var k={};k.datatype=e.datatype;k.value=g.value;a.push(k)})}else{$.each(e.limit,function(h,g){a.push(g.value)})}break;default:break}}});return a}function withRecommendForm(o,h,d,u,l,v,m,f){var n=l[u].label;var q="myfilter"+h;var y="";var k="";var r="";if(v!=undefined&&v!=""){y="mergedata='"+JSON.stringify(v)+"'"}var w="";if(f!=undefined&&f!=""){w="mergefield='"+f+"'"}var e="";e+="<div connid="+h+" "+y+" "+k+" "+r+" "+w+' class="borderhr" >';if(m&&l[u].limit.length==0){e+='<div class="search">';e+='<span class="rightalign2">情感：</span>';e+='<span id="'+q+"_"+u+'">';e+='<input type="checkbox" name="'+q+"_"+u+'_val" id="'+q+"_"+u+'1" value="1" class="outborder"/><label for="'+q+"_"+u+'1">反对</label>';e+='<input type="checkbox" name="'+q+"_"+u+'_val" id="'+q+"_"+u+'2" value="2" class="outborder"/><label for="'+q+"_"+u+'2">负面</label>';e+='<input type="checkbox" name="'+q+"_"+u+'_val" id="'+q+"_"+u+'3" value="3" class="outborder"/><label for="'+q+"_"+u+'3">中性</label>';e+='<input type="checkbox" name="'+q+"_"+u+'_val" id="'+q+"_"+u+'4" value="4" class="outborder"/><label for="'+q+"_"+u+'4">正面</label>';e+='<input type="checkbox" name="'+q+"_"+u+'_val" id="'+q+"_"+u+'5" value="5" class="outborder"/><label for="'+q+"_"+u+'5">赞赏</label>';e+="</span>";e+='<span><input class="outborder" type="checkbox" name="'+q+"_"+u+'_emotype_all" id="'+q+"_"+u+'_emotype_all" target="'+u+'" /><label for="'+q+"_"+u+'_all">全部</label></span>';e+="</div>"}e+='<div class="search">';e+='<span class="rightalign2">'+n+"：</span>";if(l[u].limit.length>0){e+='<span><input id="'+q+"_"+u+'_limit_btn" type="button" name="'+q+'_limit_btn" filtername="'+u+'" value="选择'+n+'">&nbsp;&nbsp;<input id="'+q+"_"+u+'_all" type="checkbox" name="'+q+"_"+u+'_all" class="outborder" checked="checked"><label for="'+q+"_"+u+'_all">全部</label></span>'}else{e+='<span><input id="'+q+"_"+u+'_text" type="text" name="'+q+"_"+u+'_text">&nbsp;&nbsp;<input id="'+q+"_"+u+'_recommend" type="button" value="推荐" name="'+q+"_"+u+'_recommend">&nbsp;&nbsp;<input id="'+q+"_"+u+'_add" type="button" value="添加" name="'+q+"_"+u+'_add"></span>'}switch(u){case"hostdomain":case"ancestor_host_domain":case"verifiedreason":case"description":case"keyword":case"searchword":case"pg_text":case"ancestor_text":case"organization":case"ancestor_organization":case"weibotopic":case"post_title":case"productType":case"impress":case"commentTags":case"proClassify":case"promotionInfos":case"productFullName":case"productColor":case"productSize":case"productDesc":case"productComb":case"detailParam":case"compName":case"compAddress":case"phoneNum":case"compURL":case"serviceProm":case"logisticsInfo":case"payMethod":case"apdComment":case"serviceComment":case"nowLocation":case"column":case"column1":case"ancestor_weibotopic":case"NRN":case"ancestor_NRN":case"weibotopickeyword":case"ancestor_wb_topic_keyword":case"source":case"topic":case"ancestor_combinWord":case"username":case"usersfollower":case"usersfriend":case"weibotopiccombinword":case"ancestor_weibotopiccombinword":e+=' &nbsp;&nbsp; <span id="'+q+"_"+u+'_check" featurecheckname="'+u+'" featurechecktype="folded" ><a href="javascript:void(0);">分类</a><span class="checkarrowdown" id="'+q+"_"+u+'_arrowcheck" ></span></span>';break;default:break}e+="</div>";e+='<div class="search"><span class="rightalign"></span><span id="'+q+"_"+u+'_selected"></span></div>';e+='<div class="search"  id="'+q+"_"+u+'_feature" style="display:none" ><span class="rightalign">分类：</span><span><input type="button" id="'+q+"_"+u+'_feature_recommend" value="选择分类" featurename="'+u+'" /></span></div>';e+='<div class="search" style="display:none;"><span class="rightalign"></span><span id="'+q+"_"+u+'_feature_selected"></span></div>';e+="</div>";$("#"+o).append(e);var b=d[0].fieldtype;$("#"+o+" div[connid="+h+"]").attr("fieldtype",b);$("input[name="+q+"_"+u+"_val]").bind("click",function(){var z=$("input[name="+q+"_"+u+"_val]:checked").length;if(z==$("input[name="+q+"_"+u+"_val]").length){$("input[name="+q+"_"+u+"_emotype_all]").attr("checked",true)}else{$("input[name="+q+"_"+u+"_emotype_all]").attr("checked",false)}});$("input[name="+q+"_"+u+"_emotype_all]").bind("click",function(){if($(this).prop("checked")){$("input[name="+q+"_"+u+"_val]").attr("checked",true)}else{$("input[name="+q+"_"+u+"_val]").attr("checked",false)}});$("span[featurecheckname][id^="+q+"]").bind("click",function(){var B=$(this).attr("featurecheckname");var A=$(this).attr("featurechecktype");if(A=="folded"){$("#"+q+"_"+B+"_feature").css("display","");$(this).attr("featurechecktype","unfolded");$("#"+q+"_"+B+"_arrowcheck").removeClass().addClass("checkarrowup")}else{if(A=="unfolded"){var z=$("#"+q+"_"+B+"_feature_selected ."+B+"item").length;if(z==0){$("#"+q+"_"+B+"_feature").css("display","none");$(this).attr("featurechecktype","folded");$("#"+q+"_"+B+"_arrowcheck").removeClass().addClass("checkarrowdown")}}}});var g="";if(m){if(l[u].limit.length==0){var x=stringemofilterhtml(d);g=x.emohtml}else{var a=initFiltervalueHtml(d,u);g=a.valuehtml}}else{var p=splitFiltervalueFeature(d);d=p.values;var t=p.featurevalues;var a=initFiltervalueHtml(d,u);g=a.valuehtml;var s=initFiltervalueHtml(t,u);var c=s.valuehtml;if(c!=""){$("#"+q+"_"+u+"_feature_selected").parents("div").first().css("display","");$("#"+q+"_"+u+"_feature_selected").append(c);featureUnfoldedFun(q,u);$("#"+q+"_"+u+"_feature_selected .cancleitem").die("click");$("#"+q+"_"+u+"_feature_selected .cancleitem").live("click",function(){$(this).parent().remove()})}}if(g!=""){$("#"+q+"_"+u+"_all").attr("checked",false);$("#"+q+"_"+u+"_selected").parents("div").first().css("display","");$("#"+q+"_"+u+"_selected").append(g);$("#"+q+"_"+u+"_selected .cancleitem").die("click");$("#"+q+"_"+u+"_selected .cancleitem").live("click",function(){$(this).parent().remove();if($("#"+q+"_"+u+"_selected").text()==""){$("#"+q+"_"+u+"_all").attr("checked",true)}})}}function withCheckboxForm(k,e,b,p,g,q,m,d){var o=m;if(g[p].limit.length>0){var o={};$.each(g[p].limit,function(u,v){o[v.value]={name:m[v.value].name}})}var s="";var f="";var n="";var r="";if(q!=undefined&&q!=""){s="mergedata='"+JSON.stringify(q)+"'";r="mergefield='"+d+"'"}var h=g[p].label;var l="myfilter"+e;var c="";c+="<div connid="+e+" "+s+" "+f+" "+n+" "+r+' class="borderhr" >';c+='<div class="search">';c+='<span class="rightalign2">'+h+"：</span>";c+="<span>";for(var t in o){c+='<input id="'+l+"_"+p+t+'" type="checkbox" name="'+l+"_"+p+'" value="'+t+'"><label for="'+l+"_"+p+t+'">'+o[t].name+"</label>"}c+='<input id="'+l+"_"+p+'_all" type="checkbox" name="'+l+"_"+p+'_all" checked="checked" ><label for="'+l+"_"+p+'_all">全部</label>';c+="</span>";c+="</div>";c+="</div>";$("#"+k).append(c);$("input[name="+l+"_"+p+"]").bind("click",function(){var u=$("input[name="+l+"_"+p+"]:checked").length;if(u>0){$("input[name="+l+"_"+p+"_all]").attr("checked",false)}else{$("input[name="+l+"_"+p+"_all]").attr("checked",true)}});$("input[name="+l+"_"+p+"_all]").bind("click",function(){if($(this).prop("checked")){$("input[name="+l+"_"+p+"]").attr("checked",false)}else{dialogAlert($("input[name="+l+"_"+p+"_all]").parents("div").first(),"请至少选择一项!");$(this).attr("checked",true)}});var a=b[0].fieldtype;$("#"+k+" div[connid="+e+"]").attr("fieldtype",a);if(b.length>0){$("input[name="+l+"_"+p+"_all]").attr("checked",false);$.each(b,function(w,u){$("input[name="+l+"_"+p+"][value="+u.fieldvalue.value+"]").attr("checked",true)})}}function withRadioForm(e,b,r,n,g,a){var c="";if(n=="weibourl"||n=="weiboid"){c="weiboid"}if(n=="oristatusurl"||n=="oristatus"){c="oristatus"}var d=g[n].label;var m="myfilter"+b;var o="";var p="";var f="";if(a!=undefined&&a!=""){o="mergedata='"+JSON.stringify(a)+"'"}var q="";q+="<div connid="+b+" "+o+" "+p+" "+f+' class="borderhr" >';q+='<div class="search">';q+='<span class="rightalign2">'+d+"：</span>";if(g[n].limit.length>0){q+='<span><input id="'+m+"_"+c+'_limit_btn" type="button" name="'+m+'_limit_btn" filtername="'+c+'" value="选择'+d+'">&nbsp;&nbsp;<input id="'+m+"_"+c+'_all" type="checkbox" name="'+m+"_"+c+'_all" class="outborder" checked="checked"><label for="'+m+"_"+c+'_all">全部</label></span>'}else{q+="<span>";q+='<input id="'+m+"_"+c+'_text" type="text" name="'+m+"_"+c+'_text">';q+='<input id="'+m+"_"+c+'_add" type="button" value="添加" filtername="'+c+'" name="'+m+"_"+c+'_add">';q+="</span>"}q+="</div>";q+='<div class="search"><span class="rightalign"></span><span id="'+m+"_"+c+'_selected"></span></div>';q+="</div>";$("#"+e).append(q);var l=r[0].fieldtype;$("#"+e+" div[connid="+b+"]").attr("fieldtype",l);var k="";var h=initFiltervalueHtml(r,c,n);k=h.valuehtml;if(k!=""){$("#"+m+"_"+c+"_all").attr("checked",false)}$("#"+m+"_"+c+"_selected").append(k);$("#"+m+"_"+c+"_selected .cancleitem").die("click");$("#"+m+"_"+c+"_selected .cancleitem").live("click",function(){$(this).parent().remove();if($("#"+m+"_"+c+"_selected").text()==""){$("#"+m+"_"+c+"_all").attr("checked",true)}})}function withCheckBtnForm(o,k,e,u,m,v,g){var n=m[u].label;var q="myfilter"+k;var y="";var l="";var r="";var w="";if(v!=undefined&&v!=""){y="mergedata='"+JSON.stringify(v)+"'";w="mergefield='"+g+"'"}var d=u;if(u=="verified_type"){d="verified"}if(u=="sourceid"){d="source_host"}if(u=="source"){d="users_source_host"}var f="";f+="<div connid="+k+" "+y+" "+l+" "+r+" "+w+' class="borderhr" >';f+='<div class="search">';f+='<span class="rightalign2">'+n+"：</span>";f+="<span>";f+='<input type="button" value="请选择'+n+'" id="'+q+"_"+d+'_btn" name="'+q+"_"+d+'_btn"/>';f+='<input id="'+q+"_"+d+'_all" type="checkbox" name="'+q+"_"+d+'_all" ><label for="'+q+"_"+d+'_all">全部</label>';f+="</span>";switch(u){case"account":case"ancestor_account":case"userid":f+=' &nbsp;&nbsp; <span id="'+q+"_"+u+'_check" featurecheckname="'+u+'" featurechecktype="folded" ><a href="javascript:void(0);">分类</a><span class="checkarrowdown" id="'+q+"_"+u+'_arrowcheck" ></span></span>';break;default:break}f+="</div>";f+='<div class="search"><span class="rightalign"></span><span id="'+q+"_"+d+'_selected"></span></div>';f+='<div class="search"  id="'+q+"_"+u+'_feature" style="display:none" ><span class="rightalign">分类：</span><span><input type="button" id="'+q+"_"+u+'_feature_recommend" value="选择分类" featurename="'+u+'" /></span></div>';f+='<div class="search" style="display:none;"><span class="rightalign"></span><span id="'+q+"_"+u+'_feature_selected"></span></div>';f+="</div>";$("#"+o).append(f);$("#"+q+"_"+d+"_all").bind("click",function(){$("#"+q+"_"+d+"_selected").empty()});$("span[featurecheckname][id^="+q+"]").bind("click",function(){var B=$(this).attr("featurecheckname");var A=$(this).attr("featurechecktype");if(A=="folded"){$("#"+q+"_"+B+"_feature").css("display","");$(this).attr("featurechecktype","unfolded");$("#"+q+"_"+B+"_arrowcheck").removeClass().addClass("checkarrowup")}else{if(A=="unfolded"){var z=$("#"+q+"_"+B+"_feature_selected ."+B+"item").length;if(z==0){$("#"+q+"_"+B+"_feature").css("display","none");$(this).attr("featurechecktype","folded");$("#"+q+"_"+B+"_arrowcheck").removeClass().addClass("checkarrowdown")}}}});var b=e[0].fieldtype;$("#"+o+" div[connid="+k+"]").attr("fieldtype",b);var h="";if((u=="emoAreamentioned"||u=="ancestor_emoAreamentioned"||u=="emoAccount"||u=="ancestor_emoAccount"||u=="emoBusiness"||u=="ancestor_emoBusiness")&&m[u].limit==0){var x=emofilterhtml(e);h=x.emohtml}else{if(u=="verified_type"||u=="verified"){var a=initFiltervalueHtml(e,"verified",u);h=a.valuehtml}else{var p=splitFiltervalueFeature(e);e=p.values;var t=p.featurevalues;var a=initFiltervalueHtml(e,d,u);h=a.valuehtml;var s=initFiltervalueHtml(t,u);var c=s.valuehtml;if(c!=""){$("#"+q+"_"+u+"_feature_selected").parents("div").first().css("display","");$("#"+q+"_"+u+"_feature_selected").append(c);featureUnfoldedFun(q,u);$("#"+q+"_"+u+"_feature_selected .cancleitem").die("click");$("#"+q+"_"+u+"_feature_selected .cancleitem").live("click",function(){$(this).parent().remove();var z=$("#"+q+"_"+d+"_selected ."+d+"item").length;if(z==0){$("#"+q+"_"+d+"_all").attr("checked",true)}})}}}if(h!=""){$("#"+q+"_"+d+"_selected").parents("div").first().css("display","");$("#"+q+"_"+d+"_selected").append(h);$("#"+q+"_"+d+"_selected .cancleitem").die("click");$("#"+q+"_"+d+"_selected .cancleitem").live("click",function(){$(this).parent().remove();var z=$("#"+q+"_"+d+"_selected ."+d+"item").length;if(z==0){$("#"+q+"_"+d+"_all").attr("checked",true)}})}}function withRangeForm(o,h,e,s,m,t,d,g){var n;if(t){var a=[];for(var p in t){if(m[p]!=undefined){a.push(m[p].label)}}n=a.join("|")}else{n=m[s].label}var q="myfilter"+h;var v="";var l="";var r="";var u="";if(t!=undefined&&t!=""){v="mergedata='"+JSON.stringify(t)+"'";u="mergefield='"+g+"'"}var f="";f+="<div connid="+h+" "+v+" "+l+" "+r+" "+u+' class="borderhr" >';f+='<div class="search">';f+='<span class="rightalign2">'+n+"：</span>";f+="<span>";f+='<input id="'+q+"_"+s+'_start" class="shortinput" type="text" name="'+q+"_"+s+'_start"> 到 <input id="'+q+"_"+s+'_end" class="shortinput" type="text" name="'+q+"_"+s+'_end">';if(d){f+='<select id="'+q+"_"+s+'_gap"> <option value="year">年</option> <option value="month">月</option> <option selected="selected" value="day">天</option> </select>'}f+='<input id="'+q+"_"+s+'_all" type="checkbox" name="'+q+"_"+s+'_all" ><label for="'+q+"_"+s+'_all">全部</label>';f+="</span>";f+="</div>";f+='<div class="search"><span class="rightalign"></span><span id="'+q+"_"+s+'_selected"></span></div>';f+="</div>";$("#"+o).append(f);$("#"+q+"_"+s+"_all").bind("click",function(){if($(this).prop("checked")){$("#"+q+"_"+s+"_start").val("");$("#"+q+"_"+s+"_end").val("")}else{dialogAlert($("#"+q+"_"+s+"_start").parents("div").first(),"请输入起止数值");$(this).attr("checked",true)}});$("#"+q+"_"+s+"_start, #"+q+"_"+s+"_end").bind("focus blur",function(){var k=$("#"+q+"_"+s+"_start").val();var w=$("#"+q+"_"+s+"_end").val();if(k!=""||w!=""){$("#"+q+"_"+s+"_all").attr("checked",false)}else{$("#"+q+"_"+s+"_all").attr("checked",true)}});var b=e[0].fieldtype;$("#"+o+" div[connid="+h+"]").attr("fieldtype",b);var c=e[0].fieldvalue.value;if(c.start!=null){$("input[name="+q+"_"+s+"_start]").val(c.start)}if(c.end!=null){$("input[name="+q+"_"+s+"_end]").val(c.end)}if(s=="registertime"){if(c.gap!=null){$("#"+q+"_registertime_gap").val(c.gap)}}}function withDynamicTimeForm(m,G,H,v,A,c){var C="myfilter"+G;var J="";var q="";var B="";var l="";if(c!=undefined&&c!=""){q="mergedata='"+JSON.stringify(c)+"'"}J+="<div connid="+G+'  id="'+C+'timetype" checkedtimetype="" '+q+" "+B+" "+l+' class="borderhr" >';J+="<fieldset>";J+='<legend>时间选择 --------- <span id="'+C+'_timeselect_start">全部时间</span><span id="'+C+'_splitmark" style="display:none;"> ~ </span><span id="'+C+'_timeselect_end"></span></legend>';J+=createRangeOnsiteFieldHtml(C,true);J+="</fieldset>";J+="</div>";$("#"+m).append(J);var t=H[0].fieldtype;$("#"+m+" div[connid="+G+"]").attr("fieldtype",t);switch(v){case"createdtime":if(H.length>0){var k=H[0].fieldvalue.value;if(k.start!=null){$("input[name="+C+"_"+v+"_start]").val(formatTime("yyyy-MM-dd hh:mm:ss",k.start))}if(k.end!=null){$("input[name="+C+"_"+v+"_end]").val(formatTime("yyyy-MM-dd hh:mm:ss",k.end))}$("#"+C+"timetype").attr("checkedtimetype","createdtime");changeTimeBorderColor(C+"timetype","createdtime")}break;case"nearlytime":if(H.length>0){if(0==H[0].fromlimit){var f=H[0].fieldvalue.value.start;var E=H[0].fieldvalue.value.startgap;var e=H[0].fieldvalue.value.timestate;setThisTime("#"+C+"_nearlytime_thistime",e);var g=strtotime("-"+f+" "+E+"");var p=strtotime("now");setDateSelect("#"+C+"_timeselect_start",g,"#"+C+"_timeselect_end",p,"now","",e,"#"+C+"_splitmark");$("#"+C+"_nearlytime").val(f);$("#"+C+"_nearlytime_gap").val(E);$("input[name="+C+"_nearlytime_shortcut][nearly="+f+E+"]").attr("checked",true);$("#"+C+"timetype").attr("checkedtimetype","nearlytime");changeTimeBorderColor(C+"timetype","nearlytime");$("#"+C+"_createdtime_all").attr("checked",false)}}break;case"beforetime":if(H.length>0){if(0==H[0].fromlimit){var a=H[0].fieldvalue.value.start;var w=H[0].fieldvalue.value.end;var u=H[0].fieldvalue.value.endgap;var b=H[0].fieldvalue.value.timestate;var x=H[0].fieldvalue.value.datestate;if(x!=undefined){setThisDate("#"+C+"_beforetime_thisdate",x,u)}setThisTime("#"+C+"_beforetime_thistime",b,u);var M=strtotime("-"+a+" "+u+"");var F=strtotime("-"+w+" "+u+"");setDateSelect("#"+C+"_timeselect_start",M,"#"+C+"_timeselect_end",F,x,u,b,"#"+C+"_splitmark");$("#"+C+"_beforetime_start").val(a);$("#"+C+"_beforetime_end").val(w);$("#"+C+"_beforetime_end_gap").val(u);$("#"+C+"timetype").attr("checkedtimetype","beforetime");changeTimeBorderColor(C+"timetype","beforetime");$("#"+C+"_createdtime_all").attr("checked",false)}}break;case"untiltime":if(H.length>0){if(0==H[0].fromlimit){var I=H[0].fieldvalue.value.start.start;var d=H[0].fieldvalue.value.start.startgap;var r=H[0].fieldvalue.value.start.startthisgap;var h=H[0].fieldvalue.value.start.startto;var K=H[0].fieldvalue.value.start.starttogap;$("#"+C+"_untiltime_start").val(I);$("#"+C+"_untiltime_start_gap").val(d);$("#"+C+"_untiltime_start_this_gap").val(r);$("#"+C+"_untiltime_start_to").val(h);$("#"+C+"_untiltime_start_to_gap").val(K);$("#"+C+"_untiltime_span input[untilstart="+I+d+"]").attr("checked",true);var s=H[0].fieldvalue.value.end.end;var o=H[0].fieldvalue.value.end.endgap;var n=H[0].fieldvalue.value.end.endthisgap;var L=H[0].fieldvalue.value.end.endto;var z=H[0].fieldvalue.value.end.endtogap;$("#"+C+"_untiltime_end").val(s);$("#"+C+"_untiltime_end_gap").val(o);$("#"+C+"_untiltime_end_this_gap").val(n);$("#"+C+"_untiltime_end_to").val(L);$("#"+C+"_untiltime_end_to_gap").val(z);$("#"+C+"_untiltime_span input[untilend="+s+o+"]").attr("checked",true);if(I!=""&&h!=""&&s!=""&&L!=""){var y=sinceToThis(I,d,r,h,K,"beginning");var D=sinceToThis(s,o,n,L,z,"ending");setDateSelect("#"+C+"_timeselect_start",y,"#"+C+"_timeselect_end",D,"now","","now","#"+C+"_splitmark")}$("#"+C+"timetype").attr("checkedtimetype","untiltime");changeTimeBorderColor(C+"timetype","untiltime");$("#"+C+"_createdtime_all").attr("checked",false)}}break;default:break}}function emotionChkHtml(b){var a='<div id="filteremotiondiv" style="font-size: 12px;" class="search"><span class="rightalign">选择情感：</span><span id="filteremotionspan">';a+='<input type="checkbox" name="filteremotion" id="filteremotion1" value="1" class="outborder" /><label for="filteremotion1">反对</label>';a+='<input type="checkbox" name="filteremotion" id="filteremotion2" value="2" class="outborder" /><label for="filteremotion2">负面</label>';a+='<input type="checkbox" name="filteremotion" id="filteremotion3" value="3" class="outborder" /><label for="filteremotion3">中性</label>';a+='<input type="checkbox" name="filteremotion" id="filteremotion4" value="4" class="outborder" /><label for="filteremotion4">正面</label>';a+='<input type="checkbox" name="filteremotion" id="filteremotion5" value="5" class="outborder" /><label for="filteremotion5">赞赏</label>';a+='<input type="checkbox" name="filteremotion" id="filteremotionall" value="*" class="outborder" /><label for="filteremotionall">全部</label></span></div>';if($("#filteremotiondiv").length==0){$("#"+b+"").before(a)}$("#filteremotiondiv input[name=filteremotion]").bind("click",function(){var c=$(this).attr("id");if(c=="filteremotionall"){if($(this).prop("checked")==true){$("#filteremotiondiv input[name=filteremotion]").attr("checked",true)}else{$("#filteremotiondiv input[name=filteremotion]").attr("checked",false)}}else{var d=$("#filteremotiondiv input[name=filteremotion]:checked").length;var e=$("#filteremotiondiv input[name=filteremotion]").length;if($(this).prop("checked")==true){if(d==e-1){$("#filteremotiondiv input[name=filteremotion]").attr("checked",true)}}else{$("#filteremotiondiv input[name=filteremotion][id=filteremotionall]").attr("checked",false)}}})}function filteremotionChk(){var b={};var a=[];var c=[];var d=$("#filteremotionspan input[name=filteremotion]:checked").length;if(d==0){alert("请选择情感!");return false}$("#filteremotionspan input[name=filteremotion]:checked").each(function(){var g=$(this).attr("id");if(g!="filteremotionall"){var f=$("#filteremotiondiv label[for="+g+"]").text();a.push(f);var h=$(this).val();c.push(h)}});var e=$("#filteremotionspan input[name=filteremotion]").length;if(c.length>0){if(c.length==e-1){b.name="(全部)";b.code="*"}else{b.name="("+a.join(",")+")";b.code=c.join(",")}}return b}function gapUnitDisplay(d,c){if(c=="register_time"){$("#"+d+"_facet_range_unit").css("display","")}else{if(c=="users_created_at"){$("#"+d+"_facet_range_unit").css("display","")}else{if(c=="created_at"){$("#"+d+"_facet_range_unit").css("display","none");$("#"+d+"_facet_range_registertime_all").remove();$("#"+d+"_facet_gap_measure").css("display","")}else{$("#"+d+"_facet_range_unit").css("display","none");$("#"+d+"_facet_range_registertime_all").remove();$("#"+d+"_facet_gap_measure").css("display","none");$("#"+d+"_facet_gap_measure").val("")}}}var a=$("input[name="+d+"_facet_gap_type]:checked").val();if(a=="gapCount"){$("#"+d+"_facet_gap_measure").css("display","none");$("#"+d+"_facet_gap_measure").val("");var g=getFacetRangeValue(d,c);if(g){if(g.type=="range"){rangeSideDisplay(d,g.value.start,g.value.end)}else{if(g.type=="time_dynamic_state"){var b=g.value.start;var f=g.value.end;if(f==undefined){f=""}rangeSideDisplay(d,b,f)}else{if(g.type=="time_dynamic_range"){rangeSideDisplay(d,g.value.start.start,g.value.end.end)}}}}}else{if(c=="register_time"){$("#"+d+"_facet_gap_measure").css("display","")}else{if(c=="users_created_at"){$("#"+d+"_facet_gap_measure").css("display","")}}rangeSideDisplay(d,-1,-1)}}function getFacetRangeValue(k,e){var q={};var h=$("input[name="+k+"_facet_gap_type]:checked").val();if(e=="created_at"){var l=$("#"+k+"_facet_range_html").attr("checkedtimetype");var g={};switch(l){case"createdtime":var c=$("#"+k+"_facet_range_createdtime_start").val();var o=$("#"+k+"_facet_range_createdtime_end").val();var b=$("#"+k+"_facet_range_createdtime_all").prop("checked");if(!b){if(c==""&&o==""){dialogAlert($("#"+k+"_facet_range_createdtime_start").parents("div").first(),"请输入区间!");return false}if(c!=""){g.start=getTimeSec(c)}if(o!=""){g.end=getTimeSec(o)}}else{g={}}q.type="range";break;case"nearlytime":g=getnearlytimeValue(""+k+"_facet_range");if(h=="gap"&&g.start==""){dialogAlert($("#"+k+"_facet_range_nearlytime").parents("div").first(),"请输入区间!");return false}g.name="nearlytime";q.type="time_dynamic_state";break;case"beforetime":g=getbeforeTimeValue(""+k+"_facet_range");if(h=="gap"&&(g.start==""||g.end=="")){dialogAlert($("#"+k+"_facet_range_beforetime_start").parents("div").first(),"请输入区间!");return false}g.name="beforetime";q.type="time_dynamic_state";break;case"untiltime":g=getuntiltimeValue(""+k+"_facet_range");if(h=="gap"&&(g.start.start==""||g.start.startto==""||g.end.end==""||g.end.endto=="")){dialogAlert($("#"+k+"_facet_range_untiltime_start").parents("div").first(),"请输入区间!");return false}q.type="time_dynamic_range";break;default:break}q.value=g}else{var n={};var f=$("#"+k+"_facet_range_start").val();var r=$("#"+k+"_facet_range_end").val();if(e=="register_time"){if(!$("#"+k+"_facet_range_register_time_all").prop("checked")){if(f==""&&r==""){dialogAlert($("#"+k+"_facet_range_start").parents("div").first(),"请输入区间!");return false}}}else{if(e=="users_created_at"){if(!$("#"+k+"_facet_range_users_created_at_all").prop("checked")){if(f==""&&r==""){dialogAlert($("#"+k+"_facet_range_start").parents("div").first(),"请输入区间!");return false}}}else{var a=$("#"+k+"_facet_range_custom").prop("checked");if(a){if(f==""||r==""){dialogAlert($("#"+k+"_facet_range_start").parents("div").first(),"请输入起止区间!");return false}}var d=$("input[name="+k+"_facet_range_all]").prop("checked");if(!d){if(f==""&&r==""&&!a){dialogAlert($("#"+k+"_facet_range_start").parents("div").first(),"请输入区间!");return false}}}}n.start=f;n.end=r;var m="range";if(e=="register_time"){m="time_dynamic_state";var p=$("#"+k+"_facet_range_unit").val();n.startgap=p;n.endgap=p;n.name="register_time"}else{if(e=="users_created_at"){m="time_dynamic_state";var p=$("#"+k+"_facet_range_unit").val();n.startgap=p;n.endgap=p;n.name="users_created_at"}}q.type=m;q.value=n}return q}function rangeSideDisplay(b,c,a){if((c==""||c==null)&&(a==""||a==null)){$("#"+b+"_facet_range_sides_div").css("display","none");$("#"+b+"_facet_range_sides_left").attr("checked",false);$("#"+b+"_facet_range_sides_right").attr("checked",false)}else{if(c==""||c==null){$("#"+b+"_facet_range_sides_div").css("display","");$("#"+b+"_facet_range_sides_left").css("display","none");$("label[for="+b+"_facet_range_sides_left]").css("display","none");$("#"+b+"_facet_range_sides_left").attr("checked",false);$("#"+b+"_facet_range_sides_right").css("display","");$("label[for="+b+"_facet_range_sides_right]").css("display","")}else{if(a==""||a==null){$("#"+b+"_facet_range_sides_div").css("display","");$("#"+b+"_facet_range_sides_right").css("display","none");$("label[for="+b+"_facet_range_sides_right]").css("display","none");$("#"+b+"_facet_range_sides_right").attr("checked",false);$("#"+b+"_facet_range_sides_left").css("display","");$("label[for="+b+"_facet_range_sides_left]").css("display","")}else{$("#"+b+"_facet_range_sides_div").css("display","");$("#"+b+"_facet_range_sides_left").css("display","");$("label[for="+b+"_facet_range_sides_left]").css("display","");$("#"+b+"_facet_range_sides_right").css("display","");$("label[for="+b+"_facet_range_sides_right]").css("display","")}}}}function createCustomRangeTag(d,b,e,a){var c=rangeValueName(e,a);$("#"+d+"_facet_range_tag").append("<span class='selwordsbox'><span class='customrangeitem' title='"+c+"' rangevalue='"+JSON.stringify(e)+"'>"+b+"</span><a class='cancleitem' name='canclecustomrangeitem' >×</a></span>");$("#"+d+"_facet_range_name").val("");$("#"+d+"_facet_range_start").val("");$("#"+d+"_facet_range_end").val("")}function rangeValueName(h,a){var c="";switch(h.type){case"range":var f=h.value.start;var g=h.value.end;if(f==undefined&&g==undefined){c="全部";if(a=="absolutetime"){c="全部时间"}}else{if(f==undefined&&g!=undefined){c="小于"+g;if(a=="absolutetime"){g=formatTime("yyyy-MM-dd hh:mm:ss",g);c="早于"+g}}else{if(f!=undefined&&g==undefined){c="大于"+f;if(a=="absolutetime"){f=formatTime("yyyy-MM-dd hh:mm:ss",f);c="晚于"+f}}else{if(a=="absolutetime"){f=formatTime("yyyy-MM-dd hh:mm:ss",f);g=formatTime("yyyy-MM-dd hh:mm:ss",g)}c=f+"到"+g}}}break;case"time_dynamic_state":if(h.value.name=="nearlytime"){c="近"+h.value.start+getGaptext(h.value.startgap)}else{if(h.value.name=="beforetime"){c="前"+h.value.start+"至"+h.value.end+getGaptext(h.value.endgap)}else{if(h.value.name=="register_time"){c="前"+h.value.start+"至"+h.value.end+getGaptext(h.value.endgap)}}}break;case"time_dynamic_range":var d=h.value.start;var b=h.value.end;c="至今"+d.start+getGaptext(d.startgap)+"该"+getGaptext(d.startthisgap)+"的第"+d.startto+getGaptext(d.starttogap);c+="到至今"+b.end+getGaptext(b.endgap)+"该"+getGaptext(b.endthisgap)+"的第"+b.endto+getGaptext(b.endtogap);break;default:break}return c}function setFacetRangeValue(z,a,b){switch(a.type){case"range":var r=a.value.start;var F=a.value.end;if(b=="absolutetime"){if((r!=null&&r!=undefined&&r!="")||r==0){r=formatTime("yyyy-MM-dd hh:mm:ss",r);$("#"+z+"_facet_range_createdtime_start").val(r)}else{r=null}if(F!=null&&F!=undefined&&F!=""){F=formatTime("yyyy-MM-dd hh:mm:ss",F);$("#"+z+"_facet_range_createdtime_end").val(F)}else{F=null}if(!r&&!F){$("#"+z+"_facet_range_createdtime_all").attr("checked",true);$("#"+z+"_facet_range_createdtime_start").val("");$("#"+z+"_facet_range_createdtime_end").val("")}else{$("#"+z+"_facet_range_createdtime_all").attr("checked",false)}setTimeSelectMsg(""+z+"_facet_range",r,F,true);changeTimeBorderColor(z+"_facet_range_html","createdtime");$("#"+z+"_facet_range_html").attr("checkedtimetype","createdtime")}else{if(r!=null&&r!=""&&r!=undefined){$("#"+z+"_facet_range_start").val(r)}if(F!=null&&F!=""&&F!=undefined){$("#"+z+"_facet_range_end").val(F)}if(r||F){$("input[name="+z+"_facet_range_all]").attr("checked",false)}}break;case"time_dynamic_state":var G=""+z+"_facet_range";if(a.value.name=="nearlytime"){var C=a.value.start;var A=a.value.startgap;var D=a.value.timestate;$("#"+G+"_nearlytime").val(C);$("#"+G+"_nearlytime_gap").val(A);$("input[name="+G+"_nearlytime_shortcut][nearly="+C+A+"]").attr("checked",true);setThisTime("#"+G+"_nearlytime_thistime",D);var H=strtotime("-"+C+" "+A+"");var f=strtotime("now");setDateSelect("#"+G+"_timeselect_start",H,"#"+G+"_timeselect_end",f,"now","",D,"#"+G+"_splitmark");changeTimeBorderColor(z+"_facet_range_html","nearlytime");$("#"+z+"_facet_range_html").attr("checkedtimetype","nearlytime")}else{if(a.value.name=="beforetime"){var n=a.value.start;var u=a.value.end;var d=a.value.endgap;$("#"+G+"_beforetime_start").val(n);$("#"+G+"_beforetime_start_gap").val(d);$("#"+G+"_beforetime_end").val(u);$("#"+G+"_beforetime_end_gap").val(d);var y=a.value.timestate;var c=a.value.datestate;setThisDate("#"+G+"_beforetime_thisdate",c,d);setThisTime("#"+G+"_beforetime_thistime",y,d);var k=strtotime("-"+n+" "+d+"");var q=strtotime("-"+u+" "+d+"");setDateSelect("#"+G+"_timeselect_start",k,"#"+G+"_timeselect_end",q,c,d,y,"#"+G+"_splitmark");changeTimeBorderColor(z+"_facet_range_html","beforetime");$("#"+z+"_facet_range_html").attr("checkedtimetype","beforetime")}else{if(a.value.name=="register_time"){var r=a.value.start;var F=a.value.end;$("#"+z+"_facet_range_start").val(r);$("#"+z+"_facet_range_end").val(F);var x=a.value.endgap;$("#"+z+"_facet_range_unit").val(x);if(r||F){$("#"+z+"_facet_range_register_time_all").attr("checked",false)}}else{if(a.value.name=="users_created_at"){var r=a.value.start;var F=a.value.end;$("#"+z+"_facet_range_start").val(r);$("#"+z+"_facet_range_end").val(F);var x=a.value.endgap;$("#"+z+"_facet_range_unit").val(x)}}}}break;case"time_dynamic_range":var G=""+z+"_facet_range";var h=a.value.start.start;var w=a.value.start.startgap;var E=a.value.start.startthisgap;var g=a.value.start.startto;var B=a.value.start.starttogap;$("#"+G+"_untiltime_start").val(h);$("#"+G+"_untiltime_start_gap").val(w);$("#"+G+"_untiltime_start_this_gap").val(E);$("#"+G+"_untiltime_start_to").val(g);$("#"+G+"_untiltime_start_to_gap").val(B);$("#"+G+"_untiltime_div input[untilstart="+h+w+"]").attr("checked",true);var p=a.value.end.end;var t=a.value.end.endgap;var l=a.value.end.endthisgap;var o=a.value.end.endto;var I=a.value.end.endtogap;$("#"+G+"_untiltime_end").val(p);$("#"+G+"_untiltime_end_gap").val(t);$("#"+G+"_untiltime_end_this_gap").val(l);$("#"+G+"_untiltime_end_to").val(o);$("#"+G+"_untiltime_end_to_gap").val(I);$("#"+G+"_untiltime_div input[untilend="+p+t+"]").attr("checked",true);if(h!=""&&g!=""&&p!=""&&o!=""){var m=sinceToThis(h,w,E,g,B,"beginning");var v=sinceToThis(p,t,l,o,I,"ending");setDateSelect("#"+G+"_timeselect_start",m,"#"+G+"_timeselect_end",v,"now","","now","#"+G+"_splitmark")}changeTimeBorderColor(z+"_facet_range_html","untiltime");$("#"+z+"_facet_range_html").attr("checkedtimetype","untiltime");break;default:break}}function setRangeTagValue(c,b,a){if(b.x!=undefined){setTagAxisValue(c,b.x,"x",a)}if(b.y!=undefined){setTagAxisValue(c,b.y,"y",a)}}function setTagAxisValue(d,b,c,a){if(b.type=="exp"){setTagExpValue(d,b.value,c,a)}else{if(b.type=="reg"){setTagRegValue(d,b.value,c)}}}function setTagExpValue(c,b,f,a){var e="";if(f=="x"){e=""+c+"_facet_range_label_exp_x"}else{e=""+c+"_facet_range_label_exp_y"}var d="";$.each(b,function(k,h){var g=expressDisplay(h.condition,a);d+="<span class='selwordsbox'><span class='customlabelitem' title='"+g+"' labeltype='exp' conditionvalue='"+JSON.stringify(h)+"'>"+h.label+"</span><a class='cancleitem' name='canclecustomrangeitem' >×</a></span>"});$("#"+e+"").empty().append(d);addLabelDisplay(c)}function setTagRegValue(b,a,d){var c="";if(d=="x"){c=""+b+"_facet_range_label_exp_x"}else{c=""+b+"_facet_range_label_exp_y"}$("#"+c+"").empty().append("<span class='selwordsbox'><span class='customlabelitem' labeltype='reg' >"+a+"</span><a class='cancleitem' name='canclecustomrangeitem' >×</a></span>");addLabelDisplay(b)}function addLabelDisplay(c){if(!$("#"+c+"_facet_range_custom").prop("checked")){$("#"+c+"_facet_range_label_axis").css("display","");var b=$("#"+c+"_facet_range_label_exp_x .customlabelitem").length;if(b>0){$("#"+c+"_facet_range_exp_div_x").css("display","")}else{$("#"+c+"_facet_range_exp_div_x").css("display","none")}var a=$("#"+c+"_facet_range_label_exp_y .customlabelitem").length;if(a>0){$("#"+c+"_facet_range_exp_div_y").css("display","")}else{$("#"+c+"_facet_range_exp_div_y").css("display","none")}}else{$("#"+c+"_facet_range_label_axis").css("display","none");$("#"+c+"_facet_range_exp_div_x").css("display","none");$("#"+c+"_facet_range_exp_div_y").css("display","none");$("#"+c+"_facet_range_label_exp_x").empty();$("#"+c+"_facet_range_label_exp_y").empty()}}function customHtmlDisplay(a){if($("#"+a+"_facet_range_custom").prop("checked")){$("#"+a+"_facet_range_is_custom_name").css("display","");$("#"+a+"_facet_range_is_custom_tag").css("display","");$("#"+a+"_facet_range_not_custom_type").css("display","none");$("input[name="+a+"_facet_gap_type]").attr("checked",false);$("#"+a+"_facet_gap_measure").val("");$("#"+a+"_facet_range_not_custom_num").css("display","none");$("input[name="+a+"_facet_range_all]").css("display","none");var b=$("input[name="+a+"_facet_range_all]").attr("id");$("label[for="+b+"]").css("display","none")}else{$("#"+a+"_facet_range_is_custom_name").css("display","none");$("#"+a+"_facet_range_is_custom_tag").css("display","none");$("#"+a+"_facet_range_not_custom_type").css("display","");$("#"+a+"_facet_range_not_custom_num").css("display","");$("input[name="+a+"_facet_range_all]").css("display","");var b=$("input[name="+a+"_facet_range_all]").attr("id");$("label[for="+b+"]").css("display","");$("#"+a+"_facet_range_name").val("");$("#"+a+"_facet_range_tag").empty()}}function setFacetRangeSides(b,a){switch(parseInt(a,10)){case 0:$("input[name="+b+"_facet_range_sides][value=leftside]").attr("checked",false);$("input[name="+b+"_facet_range_sides][value=rightside]").attr("checked",false);break;case 1:$("input[name="+b+"_facet_range_sides][value=leftside]").attr("checked",true);$("input[name="+b+"_facet_range_sides][value=rightside]").attr("checked",true);break;case 2:$("input[name="+b+"_facet_range_sides][value=leftside]").attr("checked",true);$("input[name="+b+"_facet_range_sides][value=rightside]").attr("checked",false);break;case 3:$("input[name="+b+"_facet_range_sides][value=leftside]").attr("checked",false);$("input[name="+b+"_facet_range_sides][value=rightside]").attr("checked",true);break;default:break}}function getTagAxisValue(e,d){var c=null;var a=$("#"+e+"_facet_range_label_exp_"+d+" .customlabelitem").length;if(a>0){var b={};b.type="exp";b.value=[];$("#"+e+"_facet_range_label_exp_"+d+" .customlabelitem").each(function(f,g){if($(g).attr("labeltype")=="reg"){b={};b.type="reg";b.value=$(g).text();return false}else{b.value.push(jQuery.parseJSON($(g).attr("conditionvalue")))}});c=b}return c}function getFacetRangeSides(d){var b;var c=$("input[name="+d+"_facet_range_sides][value=leftside]").prop("checked");var a=$("input[name="+d+"_facet_range_sides][value=rightside]").prop("checked");if(!c&&!a){b=0}else{if(c&&a){b=1}else{if(c&&!a){b=2}else{b=3}}}return b}function createFacetRangeHtml(o,g,d,m,t,f,c){var q="myfilter"+g;var w="";var h="";var s="";if(t!=undefined&&t!=""){w="mergedata='"+JSON.stringify(t)+"'"}var v="";if(f!=undefined&&f!=""){v="mergefield='"+f+"'"}if(c==undefined){c=true}var e="";e+="<div connid="+g+" "+w+" "+h+" "+v+" "+s+' class="borderhr" >';e+='<div class="search"><span class="rightalign"></span><input type="checkbox" id="'+q+'_facet_range_custom" />自定义区间</div>';e+='<div class="search"><span class="rightalign">区间推荐：</span><span><input type="button" name="'+q+'_facet_range_recommend" id="'+q+'_facet_range_recommend" value="推荐" /><span id="'+q+'_facet_range_txt" style="display:none;">最小值:<span id="'+q+'_facet_range_min"></span>&nbsp;最大值:<span id="'+q+'_facet_range_max"></span> </span></span></div>';e+='<div class="search">';e+='<span class="rightalign">区间：</span><span id="'+q+'_facet_range_html" checkedtimetype="createdtime">';e+='<input type="text" id="'+q+'_facet_range_start" name="'+q+'_facet_range" /><input type="text" id="'+q+'_facet_range_end" name="'+q+'_facet_range" />';e+="</span>";e+='<select id="'+q+'_facet_range_unit" style="display:none;">';e+='<option value="year">年</option>';e+='<option value="month" selected="selected">月</option>';e+='<option value="day">天</option>';e+="</select>";e+="</div>";e+='<div class="search" id="'+q+'_facet_range_not_custom_type"><span class="rightalign">区间类型：</span><span><input type="radio" name="'+q+'_facet_gap_type" value="gap" /> 区间长度 <input type="radio" name="'+q+'_facet_gap_type" value="gapCount" />区间个数</span></div>';e+='<div class="search" id="'+q+'_facet_range_not_custom_num"><span class="rightalign">数值：</span>';e+="<span>";e+='<input type="text" id="'+q+'_facet_gap_text" name="'+q+'_facet_gap_text" style="border:1px solid #ccc;"/>';e+='<select id="'+q+'_facet_gap_measure" style="display:none;">';e+='<option value="hour">小时</option>';e+='<option value="day">天</option>';e+='<option value="month" selected="selected">月</option>';e+="</select>";e+="</span>";e+="</div>";e+='<div class="search" id="'+q+'_facet_range_is_custom_name"><span class="rightalign">区间名称：</span><input type="text" name="'+q+'_facet_range_name" id="'+q+'_facet_range_name" style="border:1px solid #CCC;"/><input type="button" value="添加" name="'+q+'_facet_range_name_add" id="'+q+'_facet_range_name_add"></div>';e+='<div class="search" id="'+q+'_facet_range_is_custom_tag"><span class="rightalign"></span><span id="'+q+'_facet_range_tag"></span></div>';var a="X轴";var p="X轴标签：";if(!c){a="分类名称";p="分类名称："}e+='<div class="search" id="'+q+'_facet_range_label_axis"><span class="rightalign">添加标签：</span><span><input type="button" name="'+q+'_facet_range_label_axis_x" id="'+q+'_facet_range_label_axis_x" value="'+a+'" />';if(c){e+='&nbsp;&nbsp; <input type="button" name="'+q+'_facet_range_label_axis_y" id="'+q+'_facet_range_label_axis_y" value="Y轴" /></span></div>'}e+='<div class="search" id="'+q+'_facet_range_exp_div_x"><span class="rightalign">'+p+'</span><span id="'+q+'_facet_range_label_exp_x"></span></div>';e+='<div class="search" id="'+q+'_facet_range_exp_div_y"><span class="rightalign">Y轴标签：</span><span id="'+q+'_facet_range_label_exp_y"></span></div>';if(c){e+='<div class="search" id="'+q+'_facet_range_sides_div"><span class="rightalign">返回设置：</span><span><input type="checkbox" name="'+q+'_facet_range_sides" value="leftside" id="'+q+'_facet_range_sides_left"  /><label for="'+q+'_facet_range_sides_left">左边其他 </label><input type="checkbox" name="'+q+'_facet_range_sides" id="'+q+'_facet_range_sides_right" value="rightside" /><label for="'+q+'_facet_range_sides_right">右边其他</label></span></div>'}e+="</div>";$("#"+o).append(e);$("#"+o+" div[connid="+g+"]").attr("fieldtype","facetrange");var l=m.name;rangeDisplayHtml(q,l);$("#"+q+"_facet_range_custom").bind("click",function(){if(m!=undefined&&m.length>0){$.each(m,function(x,y){if(y.tag!=undefined){setRangeTagValue(q,y.tag)}})}customHtmlDisplay(q);addLabelDisplay(q)});$("#"+q+"_facet_range_recommend").bind("click",function(){var x=this;var z=l;var y=d;if(y!=false){$(x).attr("disabled","disabled");myFacetRangeRecommend(z,y,function(E){$(x).removeAttr("disabled");var A=E.max;var D=E.min;if(z=="created_at"){A=formatTime("yyyy-MM-dd hh:mm:ss",A);D=formatTime("yyyy-MM-dd hh:mm:ss",D)}else{if(z=="register_time"){var F=new Date();var B=new Date(D*1000);var C=new Date(A*1000);var A=B.dateDiff("d",F)+"天";var D=C.dateDiff("d",F)+"天"}}$("#"+q+"_facet_range_txt").css("display","");$("#"+q+"_facet_range_max").text(A);$("#"+q+"_facet_range_min").text(D)},function(A){$(x).removeAttr("disabled")},""+q+"_facet_range_recommend")}});$("#"+q+"_facet_range_name_add").bind("click",function(){var y=$("#"+q+"_facet_range_name").val();var z=l;switch(z){case"created_at":case"created_year":case"created_month":case"created_day":case"created_hour":case"created_weekday":case"reposts_count":case"comments_count":case"direct_comments_count":case"praises_count":case"paragraphid":case"trample_count":case"satisfaction":case"godRepPer":case"midRepPer":case"wosRepPer":case"godRepNum":case"midRepNum":case"wosRepNum":case"apdRepNum":case"showPicNum":case"cmtStarLevel":case"proOriPrice":case"proCurPrice":case"proPriPrice":case"stockNum":case"salesNumMonth":case"operateTime":case"compDesMatch":case"logisticsScore":case"serviceScore":case"purchDate":case"question_id":case"answer_id":case"child_post_id":case"question_father_id":case"answer_father_id":case"floor":case"level":case"read_count":case"register_time":case"reply_comment":case"total_reposts_count":case"direct_reposts_count":case"total_reach_count":case"followers_count":case"users_created_at":case"users_followers_count":case"users_friends_count":case"users_statuses_count":case"users_replys_count":case"users_recommended_count":case"users_level":var A=getFacetRangeValue(q,z);if(!A){return false}var x=false;if(z=="created_at"){x="absolutetime"}else{if(z=="register_time"||z=="users_created_at"){x="relativetime"}}if(y!=""){createCustomRangeTag(q,y,A,x)}else{dialogAlert($("#"+q+"_facet_range_name").parents("div").first(),"请填写区间名称!");return false}break;default:break}});$("input[name="+q+"_facet_gap_type]").bind("click",function(){gapUnitDisplay(q,m.name)});$("#"+q+"_facet_range_label_axis_x, #"+q+"_facet_range_label_axis_y").bind("click",function(){var A=$(this).attr("name");var z;var x="";if(A==""+q+"_facet_range_label_axis_x"){z=getTagAxisValue(q,"x");x="x"}else{z=getTagAxisValue(q,"y");x="y"}var y=false;if(l=="created_at"){y="absolutetime"}else{if(l=="register_time"||l=="users_created_at"){y="relativetime"}}myExpressionLabel(function(C){var B={};if(x=="x"){B.x={};B.x=C}else{B.y={};B.y=C}setRangeTagValue(q,B,y)},z,y)});$("a[name=canclecustomrangeitem]").die("click");$("a[name=canclecustomrangeitem]").live("click",function(){$(this).parent().remove();addLabelDisplay(q)});$("a[name=cancleselectedfilterword]").die("click");$("a[name=cancleselectedfilterword]").live("click",function(){var y=$(this).attr("value");$(this).parent().remove();var x=$("#selected"+y+" ."+y+"item").length;if(x==0){$("#selected"+y).parent().css("display","none")}});if(m.rangeinfo==undefined){if(m.start!==undefined&&m.start!==""&&m.start!==null){var k=m.start;if(m.name=="created_at"){k=formatTime("yyyy-MM-dd hh:mm:ss",m.start);$("#"+q+"_facet_range_createdtime_start").val(k)}else{$("#"+q+"_facet_range_start").val(k)}}if(m.end!==undefined&&m.end!==""&&m.end!==null){var r=m.end;if(m.name=="created_at"){r=formatTime("yyyy-MM-dd hh:mm:ss",m.end);$("#"+q+"_facet_range_createdtime_end").val(r)}else{$("#"+q+"_facet_range_end").val(r)}}if(m.gap!=undefined){$("input[name="+q+"_facet_gap_type][value=gap]").attr("checked",true);var u=getGapNumDate(m.gap);$("#"+q+"_facet_range_unit").val(u.unit);$("#"+q+"_facet_gap_text").val(u.num);$("#"+q+"_facet_gap_measure").val(u.unit)}else{if(m.gapCount!=undefined){$("input[name="+q+"_facet_gap_type][value=gapCount]").attr("checked",true);$("#"+q+"_facet_gap_text").val(m.gapCount);if(!m.start&&!m.end){$("#"+q+"_facet_range_createdtime_all").attr("checked",true);$("#"+q+"_facet_range_createdtime_start").val("");$("#"+q+"_facet_range_createdtime_end").val("")}}}}else{var n=m.rangeinfo.type;switch(n){case"gap":$("input[name="+q+"_facet_gap_type][value=gap]").attr("checked",true);var u=getGapNumDate(m.rangeinfo.value.gap);$("#"+q+"_facet_gap_text").val(u.num);$("#"+q+"_facet_gap_measure").val(u.unit);break;case"gapcount":$("input[name="+q+"_facet_gap_type][value=gapCount]").attr("checked",true);$("#"+q+"_facet_gap_text").val(m.rangeinfo.value.gapcount);break;case"gaplist":$("#"+q+"_facet_range_custom").attr("checked",true);$.each(m.rangeinfo.value,function(y,A){var z=m.tag.x.value[y];var x=false;if(m.name=="created_at"){x="absolutetime"}createCustomRangeTag(q,z,A,x)});break;default:break}if(n=="gap"||n=="gapcount"){var b=false;if(m.name=="created_at"){b="absolutetime"}setFacetRangeValue(q,m.rangeinfo.value.rangevalue,b)}}if(m.tag!=undefined){var b=false;if(m.name=="created_at"){b="absolutetime"}setRangeTagValue(q,m.tag,b)}customHtmlDisplay(q);addLabelDisplay(q);gapUnitDisplay(q,m.name);if(m.sides!=undefined){setFacetRangeSides(q,m.sides)}}function createFacetFeatureHtml(c,b,m,a,k){var f="myfilter"+b;var l="";var n="";var d="";if(a!=undefined&&a!=""){l="mergedata='"+JSON.stringify(a)+"'"}var h="";if(k!=undefined&&k!=""){h="mergefield='"+k+"'"}var e=m.name;var o="";o+="<div connid="+b+" "+l+" "+n+" "+h+" "+d+' class="borderhr" >';o+="<div class='search'><span class='rightalign'>包含：</span><span><input type='button' name='"+f+"_facet_"+e+"_feature_include_recommend' id='"+f+"_facet_"+e+"_feature_include_recommend' value='选择分类' facetfeaturetype='include' facetfeaturename="+e+" /><input type='checkbox' id='"+f+"_facet_"+e+"_feature_include_config' /><label for='"+f+"_facet_"+e+"_feature_include_config' >显示其他&nbsp;&nbsp;</label>名称：<input type='text' id='"+f+"_facet_"+e+"_feature_include_alias' name='"+f+"_facet_"+e+"_feature_include_alias' /></span></div>";o+="<div class='search' style='display:none;'><span class='rightalign'>已添加：</span><span id='"+f+"selectedfacetfeatureinclude"+e+"'></span></div>";o+="<div class='search'><span class='rightalign'>去除：</span><span><input type='button' name='"+f+"_facet_"+e+"_feature_exclude_recommend' id='"+f+"_facet_"+e+"_feature_exclude_recommend' value='选择分类' facetfeaturetype='exclude' facetfeaturename="+e+" /></span></div>";o+="<div class='search' style='display:none;'><span class='rightalign'>已添加：</span><span id='"+f+"selectedfacetfeatureexclude"+e+"'></span></div>";o+="</div>";$("#"+c).append(o);$("#"+c+" div[connid="+b+"]").attr("fieldtype","facetfield");$("input[type=button][facetfeaturename][id^="+f+"_facet]").die("click");$("input[type=button][facetfeaturename][id^="+f+"_facet]").live("click",function(){var q=$(this).attr("facetfeaturename");var r=$(this).attr("facetfeaturetype");var p=[];$("#"+f+"selectedfacetfeature"+r+""+q+" .facetfeature"+q+"item").each(function(){var s={};s.code=$(this).attr("code");s.name=$(this).text();p.push(s)});myFeatureRecommend(q,function(t){var s="";$.each(t,function(v,u){s+="<span class='selwordsbox'><span class='facetfeature"+q+"item' code='"+u.code+"'>"+u.name+"</span><a name='cancleselectedfilterword' value='facetfeature"+q+"' class='cancleitem'>×</a></span>"});if(t.length>0){$("#"+f+"selectedfacetfeature"+r+""+q).parents("div").first().css("display","");$("#"+f+"selectedfacetfeature"+r+""+q).empty().append(s)}},"",p,false,false)});if(m.feature!=undefined&&m.feature.length>0){$("#"+f+"selectedfacetfeatureinclude"+m.name+"").parent().css("display","");$.each(m.feature,function(p,q){$("#"+f+"selectedfacetfeatureinclude"+m.name).append("<span class='selwordsbox'><span class='facetfeature"+m.name+"item' code='"+q.value+"'>"+q.text+"</span><a name='cancleselectedfilterword' value='facetfeature"+m.name+"' class='cancleitem'>×</a></span>")})}if(m.featureconfig!=undefined){var g=m.featureconfig.showother==1?true:false;$("#"+f+"_facet_"+m.name+"_feature_include_config").attr("checked",g);$("#"+f+"_facet_"+m.name+"_feature_include_alias").val(m.featureconfig.alias)}if(m.filter!=undefined&&m.filter.length>0){$.each(m.filter,function(q,p){if(p.type=="exclude"){$("#"+f+"selectedfacetfeatureexclude"+m.name+"").parent().css("display","");$.each(p.value,function(s,r){$("#"+f+"selectedfacetfeatureexclude"+m.name).append("<span class='selwordsbox'><span class='facetfeature"+m.name+"item' code='"+r.value+"'>"+r.text+"</span><a name='cancleselectedfilterword' value='facetfeature"+m.name+"' class='cancleitem'>×</a></span>")})}})}$.each(["include","exclude"],function(p,q){$("#"+f+"selectedfacetfeature"+q+" a[name=cancleselectedfilterword]").die("click");$("#"+f+"selectedfacetfeature"+q+" a[name=cancleselectedfilterword]").live("click",function(){$(this).parent().remove()})})}function createFacetFieldHtml(d,c,q,a,o,f){if(parseInt(q.isfeature,10)==1){createFacetFeatureHtml(d,c,q,a,o);return}var k="myfilter"+c;var p="";var r="";var e="";if(a!=undefined&&a!=""){p="mergedata='"+JSON.stringify(a)+"'"}var n="";if(o!=undefined&&o!=""){n="mergefield='"+o+"'"}var s="";s+="<div connid="+c+" "+p+" "+r+" "+n+" "+e+' class="borderhr" >';s+='<div class="search" id="'+k+'_filter_div"><span class="rightalign">包含：</span><span id="'+k+'_filter_include_span">';s+='<input type="text" id="'+k+'_filter_include" name="'+k+'_filter_include" />';s+='<input type="button" id="'+k+'_filter_include_add" name="'+k+'_filter_include_add" value="添加" />';s+='<input type="checkbox" name="'+k+'_filter_include_config" id="'+k+'_filter_include_config" /><label for="'+k+'_filter_include_config">显示其他&nbsp;&nbsp;</label> 名称：<input type="text" name="'+k+'_filter_include_alias" id="'+k+'_filter_include_alias" />';s+="</span></div>";s+='<div class="search"><span class="rightalign">已添加：</span><span id="'+k+'selectedincludeword"></span></div>';s+='<div class="search"><span class="rightalign">去除：</span><span id="'+k+'_filter_exclude_span">';s+='<input type="text" id="'+k+'_filter_exclude" name="'+k+'_filter_exclude" />';s+='<input type="button" id="'+k+'_filter_exclude_add" name="'+k+'_filter_exclude_add" value="添加" />';s+="</span></div>";s+='<div class="search"><span class="rightalign">已添加：</span><span id="'+k+'selectedexcludeword"></span></div>';s+="</div>";$("#"+d).append(s);$("#"+d+" div[connid="+c+"]").attr("fieldtype","facetfield");var h=q.name;var b=getDisplayName(h,f);switch(h){case"sex":case"users_gender":$.each(["include","exclude"],function(v,u){var t="<input type='checkbox' class='outborder' name='"+k+"_filter_"+u+"_"+h+"' value='m' />男<input type='checkbox' class='outborder' name='"+k+"_filter_"+u+"_"+h+"' value='f'/>女";$("#"+k+"_filter_"+u+"_span").empty().append(t)});break;case"recommended":$.each(["include","exclude"],function(v,u){var t="<input type='checkbox' class='outborder' name='topic_config_filter_"+u+"_recommended' value='1' />精华帖<input type='checkbox' class='outborder' name='topic_config_filter_"+u+"_recommended' value='0'/>普通帖";$("#topic_config_filter_"+u+"_span").empty().append(t)});break;case"users_allow_all_act_msg":case"users_allow_all_comment":$.each(["include","exclude"],function(v,u){var t="<input type='checkbox' class='outborder' name='"+k+"_filter_"+u+"_"+h+"' value='1' />是<input type='checkbox' class='outborder' name='"+k+"_filter_"+u+"_"+h+"' value='0'/>否";$("#"+k+"_filter_"+u+"_span").empty().append(t)});break;case"has_picture":$.each(["include","exclude"],function(v,u){var t="<input type='checkbox' class='outborder' name='"+k+"_filter_"+u+"_has_picture' value='1' />含有图片<input type='checkbox' class='outborder' name='"+k+"_filter_"+u+"_has_picture' value='0'/>不含图片";$("#"+k+"_filter_"+u+"_span").empty().append(t)});break;case"content_type":$.each(["include","exclude"],function(u,t){var v="<input type='checkbox' class='outborder' name='"+k+"_filter_"+t+"_content_type' value='0' />原创<input type='checkbox' class='outborder' name='"+k+"_filter_"+t+"_content_type' value='1'/>转发<input type='checkbox' class='outborder' name='"+k+"_filter_"+t+"_content_type' value='2'/>评论";$("#"+k+"_filter_"+t+"_span").empty().append(v)});break;case"verify":case"users_verified":$.each(["include","exclude"],function(u,t){var v="<input type='checkbox' class='outborder' name='"+k+"_filter_"+t+"_verify' value='1' />个人认证<input type='checkbox' class='outborder' name='"+k+"_filter_"+t+"_verify' value='0'/>非认证<input type='checkbox' class='outborder' name='"+k+"_filter_"+t+"_verify' value='2'/>达人";$("#"+k+"_filter_"+t+"_span").empty().append(v)});break;case"verified_type":case"users_verified_type":case"source_host":case"users_source_host":case"account":case"ancestor_account":case"userid":case"repost_userid":case"oristatus_userid":case"users_id":case"country_code":case"users_country_code":case"province_code":case"users_province_code":case"city_code":case"users_city_code":case"district_code":case"users_district_code":case"country":case"province":case"city":case"district":case"ancestor_country":case"ancestor_province":case"ancestor_city":case"ancestor_district":case"business":case"ancestor_business":var l="<input type='button' facetfield='"+h+"' filtertype='include' name='"+k+"_filter_btn' value='请选择"+b+"'>";l+='<input type="checkbox" name="'+k+'_filter_include_config" id="'+k+'_filter_include_config" /><label for="'+k+'_filter_include_config">显示其他&nbsp;&nbsp;</label> 名称：<input type="text" name="'+k+'_filter_include_alias" name="'+k+'_filter_include_alias" />';$("#"+k+"_filter_include_span").empty().append(l);var g="<input type='button' facetfield='"+h+"' filtertype='exclude' name='"+k+"_filter_btn' value='请选择"+b+"'>";$("#"+k+"_filter_exclude_span").empty().append(g);break;case"emotion":case"ancestor_emotion":emotionChkHtml(k+"_filter_div");break;case"emoAccount":case"ancestor_emoAccount":case"emoCountry":case"emoProvince":case"emoCity":case"emoDistrict":case"ancestor_emoCountry":case"ancestor_emoProvince":case"ancestor_emoCity":case"ancestor_emoDistrict":case"emoBusiness":case"ancestor_emoBusiness":var l="<input type='button' facetfield='"+h+"' isemo=true filtertype='include' name='"+k+"_filter_btn' value='请选择"+b+"'><input type='checkbox' name='"+k+"_filter_include_config' id='"+k+"_filter_include_config' /><label for='"+k+"_filter_include_config'>显示其他&nbsp;&nbsp;</label> 名称：<input type='text' name='"+k+"_filter_include_alias' name='"+k+"_filter_include_alias' />";$("#"+k+"_filter_include_span").empty().append(l);var g="<input type='button' facetfield='"+h+"' isemo=true filtertype='exclude' name='"+k+"_filter_btn' value='请选择"+b+"'>";$("#"+k+"_filter_exclude_span").empty().append(g);break;default:break}$("#"+k+"_filter_exclude_add").die("click");$("#"+k+"_filter_exclude_add").live("click",function(){var x=$("input[name="+k+"_filter_exclude]").val();var w=x;var t="";if(h=="emotion"||h=="ancestor_emotion"){var v=filteremotionChk();if(!v){return false}if(v.code!=undefined){var u="";u=v.code;w=w+v.name;t="emotype ='"+u+"'"}}if(w!=""){$("#"+k+"selectedexcludeword").append("<span><span class='excludeworditem' style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;' "+t+" code='"+x+"'>"+w+"</span><a style='border:1px solid #cccccc;padding:1.5px;color:red; cursor:pointer;' name='cancleselectedfilterword' value='excludeword'>×</a></span>");$("input[name="+k+"_filter_exclude]").val("")}});$("#"+k+"_filter_include_add").die("click");$("#"+k+"_filter_include_add").live("click",function(){var t=$("input[name="+k+"_filter_include]").val();var u=t;var v="";if(h=="emotion"||h=="ancestor_emotion"){var w=filteremotionChk();if(!w){return false}if(w.code!=undefined){var x="";x=w.code;u=u+w.name;v="emotype='"+x+"'"}}if(u!=""){$("#"+k+"selectedincludeword").append("<span><span class='includeworditem' style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;' "+v+" code ='"+t+"' >"+u+"</span><a style='border:1px solid #cccccc;padding:1.5px;color:red; cursor:pointer;' name='cancleselectedfilterword' value='includeword'>×</a></span>");$("input[name="+k+"_filter_include]").val("")}});$("input[name="+k+"_filter_btn]").die("click");$("input[name="+k+"_filter_btn]").live("click",function(){var w=$(this).attr("facetfield");var y=$(this).attr("filtertype");var x=false;if($(this).attr("isemo")!=undefined){x=$(this).attr("isemo")}var v=[];$("#"+k+"selected"+y+"word ."+y+"worditem").each(function(C,z){var A={};A.name=$(z).text();A.code=$(z).attr("code");if($(z).attr("emotype")!=undefined){A.emotype=$(z).attr("emotype")}var B=$(z).attr("exclude");if(B!=undefined){A.exclude=B}v.push(A)});var u="";switch(w){case"account":case"ancestor_account":case"userid":case"users_id":case"emoAccount":case"ancestor_emoAccount":myAccountSelect(function(z){$("#"+k+"selected"+y+"word").empty();if(z!=""){v=z;var A="";$.each(z,function(D,B){var C="";if(B.emotype!=undefined){C="emotype='"+B.emotype+"'"}A+="<span><span class='"+y+"worditem' code='"+B.code+"' "+C+" style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;'>"+B.name+"</span><a name='cancleselectedfilterword' value='"+y+"word' style='border:1px solid #cccccc;padding:1.5px;color:red; cursor:pointer;' >×</a></span>"});$("#"+k+"selected"+y+"word").append(A);$("#"+k+"selected"+y+"word").parent().css("display","")}else{$("#"+k+"selected"+y+"word").parent().css("display","none")}},v,[],x,false);break;case"country_code":case"users_country_code":case"province_code":case"users_province_code":case"city_code":case"users_city_code":case"district_code":case"users_district_code":case"country":case"province":case"city":case"district":case"ancestor_country":case"ancestor_province":case"ancestor_city":case"ancestor_district":case"business":case"ancestor_business":case"emoCountry":case"emoProvince":case"emoCity":case"emoDistrict":case"ancestor_emoCountry":case"ancestor_emoProvince":case"ancestor_emoCity":case"ancestor_emoDistrict":case"emoBusiness":case"ancestor_emoBusiness":case"verified_type":case"users_verified_type":case"users_source_host":case"source_host":if(w=="business"||w=="ancestor_business"||w=="emoBusiness"||w=="ancestor_emoBusiness"){u="businessUrl"}else{if(w=="verified_type"||w=="users_verified_type"){u="verifiedTypeUrl";var t=1}else{if(w=="source_host"||w=="users_source_host"){u="sourceidUrl"}else{u="countryUrl"}}}myCommonSelect(u,function(z){$("#"+k+"selected"+y+"word").empty();if(z!=""){v=z;var A="";$.each(z,function(D,B){var C="";if(B.emotype!=undefined){C="emotype='"+B.emotype+"'"}A+="<span><span class='"+y+"worditem' code='"+B.code+"' "+C+" style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;'>"+B.name+"</span><a name='cancleselectedfilterword' value='"+y+"word' style='border:1px solid #cccccc;padding:1.5px;color:red; cursor:pointer;' >×</a></span>"});$("#"+k+"selected"+y+"word").append(A);$("#"+k+"selected"+y+"word").parent().css("display","")}else{$("#"+k+"selected"+y+"word").parent().css("display","none")}},v,b,x,undefined,false,t,undefined,w);break;default:break}});if(q.includeconfig!=undefined){var m=q.includeconfig.showother==1?true:false;$("#"+k+"_filter_include_config").attr("checked",m);$("#"+k+"_filter_include_alias").val(q.includeconfig.alias)}if(q.filter!=undefined&&q.filter.length>0){$.each(q.filter,function(t,x){var u={};u.field=q;if("emotion"==checkfacetfield(u)){var v=outputfieldfilter(x.value,x.type);$("#"+k+"selected"+x.type+"word").append(v)}else{$.each(x.value,function(w,B){var z="";var A="";if(typeof(B)=="string"){z=B;A=B}else{z=B.value;if(h=="verified_type"&&B.value==B.text){A=getVerifiedTypeName(B.value)}else{A=B.text}}switch(h){case"sex":case"recommended":case"has_picture":case"content_type":case"verify":case"users_gender":case"users_allow_all_act_msg":case"users_allow_all_comment":case"users_verified":$("input[name="+k+"_filter_"+x.type+"_"+h+"][value="+z+"]").attr("checked",true);break;default:$("#"+k+"selected"+x.type+"word").append("<span><span class='"+x.type+"worditem' style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;' code='"+z+"'>"+A+"</span><a style='border:1px solid #cccccc;padding:1.5px;color:red; cursor:pointer;' name='cancleselectedfilterword' value='"+x.type+"word'>×</a></span>");break}})}})}$.each(["include","exclude"],function(t,u){$("#"+k+"selected"+u+"word a[name=cancleselectedfilterword]").die("click");$("#"+k+"selected"+u+"word a[name=cancleselectedfilterword]").live("click",function(){$(this).parent().remove()})})}function createFilterFieldHtml(e,d,s,q,o,f,a,p){if(a==undefined){a=""}var c="";if(a!=""){var m=[];for(var l in a){if(f[l]!=undefined){m.push(f[l].label)}}c=m.join("|")}else{c=f[o].label}var n="myfilter"+d;if(parseInt(q,10)==1){switch(o){case"username":case"usersfollower":case"usersfriend":case"users_url":case"users_page_url":case"users_domain":case"description":case"verifiedreason":withRecommendForm(e,d,s,o,f,a);$("#"+n+"_"+o+"_recommend").bind("click",function(){var k=$("input[name="+n+"_"+o+"_text]").val();if(k!=""){myUserRecommend(k,function(t){$.each(t,function(v,u){if(u.name!=""){$("#"+n+"_"+o+"_selected").append("<span class='selwordsbox'><span class='"+o+"item' >"+u.name+"</span><a name='cancleselectedstring' value='"+o+"' class='cancleitem' >×</a></span>")}});if(t.length>0){$("input[name="+n+"_"+o+"_text]").val("")}},false)}else{dialogAlert($("#"+n+"_"+o+"_text").parents("div").first(),"请输入作者昵称!")}});$("#"+n+"_"+o+"_add").bind("click",function(){var k=$("input[name="+n+"_"+o+"_text]").val();if(k!=""){$("#"+n+"_"+o+"_selected").append("<span class='selwordsbox'><span class='"+o+"item' >"+k+"</span><a name='cancleselectedstring' value='"+o+"' class='cancleitem'>×</a></span>");$("input[name="+n+"_"+o+"_text]").val("")}});break;case"followerrank":case"friendrank":case"statusesrank":case"users_favourites_count":case"users_bi_followers_count":case"users_replys_count":case"users_recommended_count":case"users_level":withRangeForm(e,d,s,o,f,a,false,p);break;case"registertime":withRangeForm(e,d,s,o,f,a,true);break;case"verified":case"verified_type":case"users_source_host":case"source":case"area":var r=o;if(o=="verified_type"){r="verified"}if(o=="source"){r="users_source_host"}withCheckBtnForm(e,d,s,o,f,a,p);$("#"+n+"_"+r+"_btn").bind("click",function(){var k="";if(r=="verified"){k="认证";var u=1}if(r=="users_source_host"){k="来源"}else{k="地区"}var v=[];$("#"+n+"_"+r+"_selected ."+r+"item").each(function(y,w){var x={};x.name=$(this).text();x.code=$(this).attr("code");v.push(x)});if(f[r].limit.length==0){var t="";if(r=="verified"){t="verifiedUrl"}else{if(r=="users_source_host"){t="sourceidUrl"}else{t="countryUrl"}}}else{var t=[];if(o=="verified"||o=="verified_type"){$(f.verified.limit).each(function(x,y){var w="verify_"+y.value;t.push({name:getVerifiedName(w),code:w})});$(f.verified_type.limit).each(function(w,x){t.push({name:getVerifiedTypeName(x.value),code:x.value})})}else{if(o="source"||o=="users_source_host"){$(f.users_source_host.limit).each(function(w,x){t.push({name:getSourceHostName(x.value),code:x.value})})}else{$(f[o].limit).each(function(w,x){t.push({name:x.value.text,code:x.value.value})})}}}myCommonSelect(t,function(x){$("#"+n+"_"+r+"_selected").empty();if(x!=""){var y="";var w=x.length;$.each(x,function(A,z){y+="<span class='selwordsbox'><span code="+z.code+" class='"+r+"item'>"+z.name+"</span><a name='cancleselectedarea' class='cancleitem'>×</a></span>"});$("#"+n+"_"+r+"_selected").append(y)}else{$("#"+n+"_"+r+"_btn").val("请选择"+k+"");$("#"+n+"_"+r+"_selected").empty()}},v,undefined,undefined,undefined,false,u,undefined,r)});break;case"sex":var h={f:{name:"女"},m:{name:"男"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"users_allow_all_act_msg":case"haspicture":case"isNewPro":case"isFavorite":case"isAttention":var h={"1":{name:"是"},"0":{name:"否"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"users_allow_all_comment":var h={"1":{name:"是"},"0":{name:"否"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"userid":withCheckBtnForm(e,d,s,o,f,a);$("#"+n+"_"+o+"_btn").bind("click",function(){var u=false;var t=[];$("#"+n+"_"+o+"_selected ."+o+"item").each(function(y,v){if($(this).attr("isfeature")!=1){var w={};w.name=$(this).text();w.code=$(this).attr("code");if($(this).attr("emotype")!=undefined){w.emotype=$(this).attr("emotype")}var x=$(this).attr("exclude");if(x!=undefined){w.exclude=x}t.push(w)}});var k=[];$(f[o].limit).each(function(v,w){k.push({name:w.value.text,code:w.value.value})});myAccountSelect(function(x){var w="";if(x.length>0){$("#"+n+"_"+o+"_selected ."+o+"item").each(function(z,y){if($(this).attr("isfeature")!=1){$(this).parents("span").first().remove()}});var v=x.length;$.each(x,function(A,y){var B=y.name;var z=y.code;w+=createFormConfigSpanHtml(o,B,z,true,y.exclude,undefined,y.emotype)});$("#"+n+"_"+o+"_selected").append(w)}else{$("#"+n+"_"+o+"_selected").empty()}},t,k,u)});break;default:break}}else{switch(o){case"hostdomain":case"ancestor_host_domain":case"verifiedreason":case"description":case"keyword":case"searchword":case"pg_text":case"ancestor_text":case"organization":case"ancestor_organization":case"weibotopic":case"post_title":case"productType":case"impress":case"commentTags":case"proClassify":case"promotionInfos":case"productFullName":case"productColor":case"productSize":case"productDesc":case"productComb":case"detailParam":case"compName":case"compAddress":case"phoneNum":case"compURL":case"serviceProm":case"logisticsInfo":case"payMethod":case"apdComment":case"serviceComment":case"nowLocation":case"column":case"column1":case"ancestor_weibotopic":case"NRN":case"ancestor_NRN":case"weibotopickeyword":case"ancestor_wb_topic_keyword":case"source":case"users_url":case"users_page_url":case"users_domain":withRecommendForm(e,d,s,o,f,a,undefined,p);$("#"+n+"_"+o+"_recommend").bind("click",function(){var k=$("input[name="+n+"_"+o+"_text]").val();if(k!=""){myKeywordRecommend(k,function(t){$.each(t,function(v,u){if(u.name!=""){var w=createFormConfigSpanHtml(o,u.name,undefined,true,u.exclude);$("#"+n+"_"+o+"_selected").append(w)}});if(t.length>0){$("input[name="+n+"_"+o+"_text]").val("")}},getFacetname(o),c,false)}});$("#"+n+"_"+o+"_add").bind("click",function(){var t=$("input[name="+n+"_"+o+"_text]").val();if(t!=""){var k=createFormConfigSpanHtml(o,t,undefined,true);$("#"+n+"_"+o+"_selected").append(k)}$("input[name="+n+"_"+o+"_text]").val("")});break;case"emotion":case"ancestor_emotion":case"emoCombin":case"ancestor_emoCombin":case"emoNRN":case"ancestor_emoNRN":case"emoOrganization":case"ancestor_emoOrganization":case"emoTopic":case"ancestor_emoTopic":case"emoTopicKeyword":case"ancestor_emoTopicKeyword":case"emoTopicCombinWord":case"ancestor_emoTopicCombinWord":withRecommendForm(e,d,s,o,f,a,true);$("#"+n+"_"+o+"_recommend").bind("click",function(){var k=$("input[name="+n+"_"+o+"_text]").val();if(k!=""){myTopicRecommend(k,function(t){$.each(t,function(x,u){if(u.topic!=""){var w=u.topic;if(u.emotype!=undefined){var v=u.emotype;w+="("+emotype2text(v)+")"}var y=createFormConfigSpanHtml(o,w,u.topic,true,u.exclude,undefined,v);$("#"+n+"_"+o+"_selected").append(y)}});if(t.length>0){$("input[name="+n+"_"+o+"_text]").val("")}},getFacetname(o),c,true)}});$("#"+n+"_"+o+"_add").bind("click",function(){if($("input[name="+n+"_"+o+"_text]").val().length>0){var t=$("input[name="+n+"_"+o+"_text]").val();var w=t;var k=t;var u=$("input[name="+n+"_"+o+"_emotype_all]").prop("checked");var z=$("input[name="+n+"_"+o+"_val]:checked").length;if(!u&&z==0){dialogAlert($("#"+n+"_"+o+"").parents("div").first(),"请选择情感!");return false}if(u){w+="(全部)";k="*"}else{var v=[];var y=[];$("input[name="+n+"_"+o+"_val]:checked").each(function(B,A){v.push(emoval2text($(this).val()));y.push($(this).val())});var z=$("input[name="+n+"_"+o+"_val]:checked").length;if(z<$("input[name="+n+"_"+o+"_val]").length){w+="("+v.join(",")+")";k=y.join(",")}else{w+="(全部)";k="*"}}if(w!=""){$("#"+n+"_"+o+"_selected").parents("div").first().css("display","");var x=createFormConfigSpanHtml(o,w,t,true,undefined,undefined,k);$("#"+n+"_"+o+"_selected").append(x)}}else{dialogAlert($("#"+n+"_"+o+"_text").parents("div").first(),"请添加对应词!")}$("input[name="+n+"_"+o+"_text]").val("")});break;case"weibotopiccombinword":case"ancestor_weibotopiccombinword":case"topic":case"ancestor_combinWord":withRecommendForm(e,d,s,o,f,a);$("#"+n+"_"+o+"_recommend").bind("click",function(){var k=$("input[name="+n+"_"+o+"_text]").val();if(k!=""){myTopicRecommend(k,function(t){$.each(t,function(v,u){if(u.topic!=""){var w=createFormConfigSpanHtml(o,u.topic,undefined,true,u.exclude,undefined,undefined,undefined,u.btype);$("#"+n+"_"+o+"_selected").append(w)}});if(t.length>0){$("input[name="+n+"_"+o+"_text]").val("")}},getFacetname(o),c,false)}});$("#"+n+"_"+o+"_add").bind("click",function(){if($("input[name="+n+"_"+o+"_text]").val().length>0){var k=$("input[name="+n+"_"+o+"_text]").val();if(k!=""){var t=createFormConfigSpanHtml(o,k,undefined,true);$("#"+n+"_"+o+"_selected").append(t)}}$("input[name="+n+"_"+o+"_text]").val("")});break;case"username":case"oristatus_username":case"repost_username":case"usersfriend":case"usersfollower":withRecommendForm(e,d,s,o,f,a);$("#"+n+"_"+o+"_recommend").bind("click",function(){var k=$("input[name="+n+"_"+o+"_text]").val();if(k!=""){myUserRecommend(k,function(t){$.each(t,function(v,u){if(u.name!=""){var w=createFormConfigSpanHtml(o,u.name,undefined,true);$("#"+n+"_"+o+"_selected").append(w)}});if(t.length>0){$("input[name="+n+"_"+o+"_text]").val("")}})}else{dialogAlert($("#"+n+"_"+o+"_text").parents("div").first(),"请输入作者昵称!")}});$("#"+n+"_"+o+"_add").bind("click",function(){var t=$("input[name="+n+"_"+o+"_text]").val();if(t!=""){var k=createFormConfigSpanHtml(o,t,undefined,true);$("#"+n+"_"+o+"_selected").append(k);$("input[name="+n+"_"+o+"_text]").val("")}});break;case"weiboid":case"original_url":case"weibourl":case"oristatus":case"oristatusurl":withRadioForm(e,d,s,o,f,a);var b="";if(o=="weibourl"||o=="weiboid"){b="weiboid"}if(o=="oristatusurl"||o=="oristatus"){b="oristatus"}$("#"+n+"_"+b+"_add").bind("click",function(){var u=$(this).attr("filtername");var t=$("input[name="+n+"_"+u+"_text]").val();var v="url";if(t!=""){var k=createFormConfigSpanHtml(u,t,t,false,undefined,undefined,undefined,v);$("#"+n+"_"+u+"_selected").append(k+" ");$("input[name="+n+"_"+u+"_text]").val("");if(u=="oristatus"){$("input[name="+n+"_weibotype][value=100]").css("display","none");$("label[for="+n+"_weibotype100]").css("display","none");$("input[name="+n+"_weibotype][value=100]").attr("checked",false)}else{$("input[name="+n+"_weibotype][value=100]").css("display","");$("label[for="+n+"_weibotype100]").css("display","")}}else{$("input[name="+n+"_weibotype][value=100]").css("display","");$("label[for="+n+"_weibotype100]").css("display","")}});break;case"weibotype":var h={"100":{name:"原创"},"101":{name:"转发"},"102":{name:"评论"},"104":{name:"提问"},"105":{name:"回答"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"sex":var h={f:{name:"女"},m:{name:"男"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"recommended":var h={"1":{name:"精华帖"},"0":{name:"普通帖"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"haspicture":case"isNewPro":case"isFavorite":case"isAttention":var h={"1":{name:"是"},"0":{name:"否"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"users_allow_all_act_msg":var h={"1":{name:"是"},"0":{name:"否"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"users_allow_all_comment":var h={"1":{name:"是"},"0":{name:"否"}};withCheckboxForm(e,d,s,o,f,a,h);break;case"account":case"ancestor_account":case"userid":case"repost_userid":case"oristatus_userid":case"emoAccount":case"ancestor_emoAccount":withCheckBtnForm(e,d,s,o,f,a);$("#"+n+"_"+o+"_btn").bind("click",function(){var u=false;if(o=="emoAccount"||o=="ancestor_emoAccount"){u=true}var t=[];$("#"+n+"_"+o+"_selected ."+o+"item").each(function(y,v){if($(this).attr("isfeature")!=1){var w={};w.name=$(this).text();w.code=$(this).attr("code");if($(this).attr("emotype")!=undefined){w.emotype=$(this).attr("emotype")}var x=$(this).attr("exclude");if(x!=undefined){w.exclude=x}t.push(w)}});var k=[];if(f[o].limit.length>0){switch(o){case"account":case"ancestor_account":case"oristatus_userid":case"repost_userid":case"userid":$(f[o].limit).each(function(v,w){k.push({name:w.value.text,code:w.value.value})});break;case"emoAccount":case"ancestor_emoAccount":u=false;$(f[o].limit).each(function(x,z){var B=z.value.value;var y=z.value.text;var A=B.substr(0,B.length-2).toString();var w=B.substr(B.length-1,1);var x=y.indexOf("(");var v=y.substr(0,x);k.push({name:v,code:A,emotype:w})});break;default:break}}myAccountSelect(function(x){var w="";if(x.length>0){$("#"+n+"_"+o+"_selected ."+o+"item").each(function(z,y){if($(this).attr("isfeature")!=1){$(this).parents("span").first().remove()}});var v=x.length;$.each(x,function(A,y){var B=y.name;var z=y.code;w+=createFormConfigSpanHtml(o,B,z,true,y.exclude,undefined,y.emotype)});$("#"+n+"_"+o+"_selected").append(w)}else{$("#"+n+"_"+o+"_selected").empty()}},t,k,u)});break;case"verified":case"verified_type":case"business":case"ancestor_business":case"areauser":case"areamentioned":case"ancestor_areamentioned":case"emoBusiness":case"ancestor_emoBusiness":case"emoAreamentioned":case"ancestor_emoAreamentioned":case"sourceid":case"source_host":withCheckBtnForm(e,d,s,o,f,a,p);var g=o;if(o=="verified_type"){g="verified"}if(o=="sourceid"){g="source_host"}$("#"+n+"_"+g+"_btn").bind("click",function(){var x=false;if(o=="emoBusiness"||o=="ancestor_emoBusiness"||o=="emoAreamentioned"||o=="ancestor_emoAreamentioned"){x=true}var k="";if(o=="business"||o=="ancestor_business"||o=="emoBusiness"||o=="ancestor_emoBusiness"){k="行业"}else{if(o=="verified"||o=="verified_type"){k="认证";var v=1}else{if(g=="source_host"){k="来源"}else{k="地区"}}}var w=[];$("#"+n+"_"+g+"_selected ."+g+"item").each(function(B,y){var z={};z.name=$(this).text();z.code=$(this).attr("code");if($(this).attr("emotype")!=undefined){z.emotype=$(this).attr("emotype")}var A=$(this).attr("exclude");if(A!=undefined){z.exclude=A}w.push(z)});if(f[o].limit.length==0){var u="";if(o=="business"||o=="ancestor_business"||o=="emoBusiness"||o=="ancestor_emoBusiness"){u="businessUrl"}else{if(o=="verified"||o=="verified_type"){u="verifiedUrl"}else{if(g=="source_host"){u="sourceidUrl"}else{u="countryUrl"}}}}else{var u=[];if(o=="verified"||o=="verified_type"){$(f.verified.limit).each(function(z,A){var y="verify_"+A.value;u.push({name:getVerifiedName(y),code:y})});$(f.verified_type.limit).each(function(y,z){u.push({name:getVerifiedTypeName(z.value),code:z.value})})}else{if(g=="source_host"){$(f.source_host.limit).each(function(y,z){u.push({name:getSourceHostName(z.value),code:z.value})})}else{if(o=="emoBusiness"||o=="ancestor_emoBusiness"||o=="emoAreamentioned"||o=="ancestor_emoAreamentioned"){x=false;var t=false;$(f[o].limit).each(function(A,C){var E=C.value.value;var B=C.value.text;var D=E.substr(0,E.length-2).toString();var z=E.substr(E.length-1,1);var A=B.indexOf("(");var y=B.substr(0,A);u.push({name:y,code:D,emotype:z})})}else{$(f[o].limit).each(function(y,z){u.push({name:z.value.text,code:z.value.value})})}}}}myCommonSelect(u,function(A){$("#"+n+"_"+g+"_selected").empty();if(A!=""){w=A;var B="";var z="";var y=A.length;$.each(A,function(D,C){B+=createFormConfigSpanHtml(g,C.name,C.code,true,C.exclude,undefined,C.emotype)});$("#"+n+"_"+g+"_selected").append(B)}else{$("#"+n+"_"+g+"_btn").val("请选择"+k)}},w,k,x,undefined,undefined,v,t,g)});break;case"registertime":withRangeForm(e,d,s,o,f,a,true);break;case"repostsnum":case"commentsnum":case"direct_comments_count":case"praises_count":case"post_title":case"productType":case"impress":case"commentTags":case"proClassify":case"promotionInfos":case"productFullName":case"productColor":case"productSize":case"productDesc":case"productComb":case"detailParam":case"compName":case"compAddress":case"phoneNum":case"compURL":case"serviceProm":case"logisticsInfo":case"payMethod":case"apdComment":case"serviceComment":case"nowLocation":case"column":case"column1":case"created_year":case"created_month":case"created_day":case"created_hour":case"created_weekday":case"total_reposts_count":case"direct_reposts_count":case"total_reach_count":case"followers_count":case"repost_trend_cursor":case"followerrank":case"friendrank":case"statusesrank":case"paragraphid":case"trample_count":case"satisfaction":case"godRepPer":case"midRepPer":case"wosRepPer":case"godRepNum":case"midRepNum":case"wosRepNum":case"apdRepNum":case"showPicNum":case"cmtStarLevel":case"proOriPrice":case"proCurPrice":case"proPriPrice":case"stockNum":case"salesNumMonth":case"operateTime":case"compDesMatch":case"logisticsScore":case"serviceScore":case"question_id":case"answer_id":case"child_post_id":case"question_father_id":case"answer_father_id":case"floor":case"level":case"read_count":case"users_favourites_count":case"users_bi_followers_count":case"users_replys_count":case"users_recommended_count":case"users_level":withRangeForm(e,d,s,o,f,a,false,p);break;case"createdtime":case"nearlytime":case"beforetime":case"untiltime":withDynamicTimeForm(e,d,s,o,f,a);$("#"+e+" #"+n+"_createdtime_start, #"+e+" #"+n+"_createdtime_end").die("click");$("#"+e+" #"+n+"_createdtime_start, #"+e+" #"+n+"_createdtime_end").live("click",function(){WdatePicker({onpicked:function(){var k=$("#"+n+"_createdtime_start").val();var t=$("#"+n+"_createdtime_end").val();if(k.length!=0||t.length!=0){$("#"+n+"_timeselect_start").text(k);$("#"+n+"_timeselect_end").text(t);isShowSplitmark("#"+n+"_timeselect_start","#"+n+"_timeselect_end","#"+n+"_splitmark",true);$("#"+n+"_createdtime_all").attr("checked",false)}},oncleared:function(){if($("#"+n+"_createdtime_start").val().length==0&&$("#"+n+"_createdtime_end").val().length==0){$("#"+n+"_timeselect_start").text("全部时间");$("#"+n+"_timeselect_end").text("");isShowSplitmark("#"+n+"_timeselect_start","#"+n+"_timeselect_end","#"+n+"_splitmark");$("#"+n+"_createdtime_all").attr("checked",true)}else{if($("input[name="+n+"_createdtime_start]").val().length==0){$("#"+n+"_timeselect_start").text("")}if($("input[name="+n+"_createdtime_end]").val().length==0){$("#"+n+"_timeselect_end").text("")}}},dateFmt:"yyyy-MM-dd HH:mm:ss"})});$("#"+n+"timetype div[timetype] input, #"+n+"timetype div[timetype] select").unbind("click");$("#"+n+"timetype div[timetype] input, #"+n+"timetype div[timetype] select").bind("click",function(){var k=$(this).parent().attr("timetype");$("#"+n+"timetype").attr("checkedtimetype",k);changeTimeBorderColor(n+"timetype",k)});$("#"+n+"_createdtime_all").bind("click",function(){if($(this).prop("checked")){$(this).attr("checked",true);setTimeSelectMsg(n,"全部时间","")}else{$(this).attr("checked",false);var k=$("#"+n+"_createdtime_start").val();var t=$("#"+n+"_createdtime_end").val();if(k==""&&t==""){setTimeSelectMsg(n,"请填写时间")}else{if(k==""||k==undefined){setTimeSelectMsg(n,"",t)}else{if(t==""||t==undefined){setTimeSelectMsg(n,k,"")}}}}});$("#"+n+"_nearlytime_thistime").bind("click",function(){var k=$(this).attr("timestate");nearlytimeTagClick(n,k)});$("#"+n+"_nearlytime_div input[nearly]").bind("click",function(){var k=$(this).attr("nearly");nearlytimeShortCutBtnClick(n,k)});$("#"+n+"_nearlytime, #"+n+"_nearlytime_gap").bind("change",function(){nearlytimeInputChange(n)});$("#"+n+"_beforetime_thistime").bind("click",function(){var k=$(this).attr("timestate");beforetimeTagTimeClick(n,k)});$("#"+n+"_beforetime_thisdate").bind("click",function(){var k=$(this).attr("datestate");beforetimeTagDateClick(n,k)});$("#"+n+"_beforetime_start, #"+n+"_beforetime_end, #"+n+"_beforetime_end_gap").bind("change",function(){beforetimeInputChange(n)});$("#"+n+"_untiltime_div input[untiltime]").bind("click",function(){var k=$(this).attr("untiltime");var t=$(this).attr("until"+k+"");untiltimeShortCutBtnClick(n,t,k)});$.each(["start","end"],function(t,u){$("#"+n+"_untiltime_"+u+"_gap").bind("change",function(){var k=$(this).val();untiltimeGapChange(n,k,u);untiltimeValueChange(n)});$("#"+n+"_untiltime_"+u+"_this_gap").bind("change",function(){var w=$(this).val();var v=dateUnitDisplay(w,"down");var k=timeSelectOption(v);$("#"+n+"_untiltime_"+u+"_to_gap").empty().append(k);untiltimeValueChange(n)});$("#"+n+"_untiltime_"+u+"_to_gap").bind("change",function(){untiltimeValueChange(n)});$("#"+n+"_untiltime_"+u+"").bind("change",function(){untiltimeInputChange(n,u);untiltimeValueChange(n)});$("#"+n+"_untiltime_"+u+"_to").bind("change",function(){untiltimeValueChange(n)})});break;default:break}$("input[type=button][featurename][id^="+n+"]").bind("click",function(){var t=$(this).attr("featurename");var k=[];$("#"+n+"_"+t+"_feature_selected ."+t+"item").each(function(){if($(this).attr("isfeature")){var u={};u.name=$(this).text();u.code=$(this).attr("code");var v=$(this).attr("exclude");if(v!=undefined){u.exclude=v}k.push(u)}});myFeatureRecommend(t,function(v){var u="";$.each(v,function(x,w){u+=createFormConfigSpanHtml(t,w.name,w.code,true,w.exclude,1)});if(v.length>0){$("#"+n+"_"+t+"_feature_selected ."+t+"item").each(function(){if($(this).attr("isfeature")){$(this).parents("span").first().remove()}});$("#"+n+"_"+t+"_feature_selected").parents("div").first().css("display","");$("#"+n+"_"+t+"_feature_selected").append(u);$("#"+n+"_"+o+"_feature_selected .cancleitem").die("click");$("#"+n+"_"+o+"_feature_selected .cancleitem").live("click",function(){$(this).parent().remove()})}},"",k)})}$("input[name="+n+"_limit_btn]").bind("click",function(){var u=$(this).attr("filtername");var w;switch(u){case"weiboid":w="weibourl";var x="url";break;case"oristatus":w="oristatusurl";var x="url";break;case"repost_url":w="repost_url";var x="url";break;default:w=u;break}var v=f[w].limit;var k=[];var t=[];$("#"+n+"_"+u+"_selected ."+u+"item").each(function(){switch(u){case"emotion":case"ancestor_emotion":case"emoCombin":case"ancestor_emoCombin":case"emoNRN":case"ancestor_emoNRN":case"emoOrganization":case"ancestor_emoOrganization":case"emoTopic":case"ancestor_emoTopic":case"emoTopicKeyword":case"ancestor_emoTopicKeyword":case"emoTopicCombinWord":case"ancestor_emoTopicCombinWord":var B=$(this).attr("code");var A=$(this).text();var z=$(this).attr("emotype");var y=$(this).attr("exclude")==undefined?0:1;k.push({name:A,code:B,emotype:z,exclude:y});break;default:var C=$(this).text();var y=$(this).attr("exclude")==undefined?0:1;k.push({name:C,code:C,exclude:y});break}});$.each(v,function(B,C){switch(u){case"emotion":case"ancestor_emotion":case"emoCombin":case"ancestor_emoCombin":case"emoNRN":case"ancestor_emoNRN":case"emoOrganization":case"ancestor_emoOrganization":case"emoTopic":case"ancestor_emoTopic":case"emoTopicKeyword":case"ancestor_emoTopicKeyword":case"emoTopicCombinWord":case"ancestor_emoTopicCombinWord":var A=C.value;var z=A.substr(A.length-1,1);var y=A.substr(0,A.length-2);t.push({name:y,code:y,emotype:z});break;default:t.push({name:C.value,code:C.value});break}});myCommonSelect(t,function(z){$("#"+n+"_"+u+"_selected").empty();if(z!=""){$.each(z,function(B,A){var C=createFormConfigSpanHtml(u,A.name,A.code,true,A.exclude,undefined,A.emotype,x,A.blurtype);$("#"+n+"_"+u+"_selected").append(C)});$("#"+n+"_"+u+"_all").attr("checked",false)}else{$("#"+n+"_"+u+"_all").attr("checked",true)}var y=$("#"+n+"_"+u+"_selected ."+u+"item").length;if(y!=0){$("#selected"+u).parents("div").first().css("display","")}},k)});$("a[name=cancleselectedvaluetextobj]").die("click");$("a[name=cancleselectedvaluetextobj]").live("click",function(){$(this).parent().remove()})}function getEleParams(l,Y,ab,E,L,C){var O="myfilter"+Y;var m=$("#"+l+" div[connid="+Y+"]").attr("fieldtype");var D={};D.fieldtype=m;if(parseInt(ab,10)==1){switch(E){case"username":case"usersfollower":case"usersfriend":case"users_url":case"users_page_url":case"users_domain":case"description":case"verifiedreason":var n=[];if(m=="classifyquery"){var c=[];$("#"+O+"_"+E+"_selected ."+E+"item").each(function(){c.push({datatype:"string",value:$(this).text()})});n.push(createFiltervalue(E,"array",c))}else{if(m=="classifycontrast"){if($("#"+O+"_"+E+"_selected ."+E+"item").length>1){var Z=[];$("#"+O+"_"+E+"_selected ."+E+"item").each(function(){Z.push(createFiltervalue(E,"string",$(this).text()))});n=Z}else{dialogAlert($("#"+O+"_"+E+"_selected").parents("div").first(),"请至少选择两项做分类对比");return false}}else{$("#"+O+"_"+E+"_selected ."+E+"item").each(function(){n.push(createFiltervalue(E,"string",$(this).text()))})}}D.retVal=n;break;case"area":case"userid":var H=E;if(C!=undefined){H=C}var n=[];if(m=="classifyquery"){var aj=[];$("#"+O+"_"+H+"_selected ."+H+"item").each(function(ak,x){var y={};y.datatype="value_text_object";var al={};al.value=$(this).attr("code");al.text=$(this).text();y.value=al;aj.push(y)});n.push(createFiltervalue(E,"array",aj))}else{if(m=="classifycontrast"){if($("#"+O+"_"+H+"_selected ."+H+"item").length>1){var Z=[];$("#"+O+"_"+H+"_selected ."+H+"item").each(function(y,x){var ak={};ak.value=$(this).attr("code");ak.text=$(this).text();Z.push(createFiltervalue(E,"value_text_object",ak))});n=Z}else{dialogAlert($("#"+O+"_"+H+"_selected").parents("div").first(),"请至少选择两项做分类对比");return false}}else{$("#"+O+"_"+H+"_selected ."+H+"item").each(function(){var x={fieldname:E,fieldvalue:{datatype:"value_text_object",value:{value:$(this).attr("code"),text:$(this).text()}}};n.push(x)})}}D.retVal=n;break;case"source":var H=E;if(C!=undefined){H=C}var n=[];if(m=="classifyquery"){if($("input[name="+O+"_"+H+"]:checked")!=undefined){var aj=[];$("input[name="+O+"_"+H+"]:checked").each(function(){var x={};x.datatype="value_text_object";var y={};y.value=$(this).val();y.text=$("#"+$(this).attr("id")).next().text();x.value=y;aj.push(x)});n.push(createFiltervalue("source","array",aj))}}else{if(m=="classifycontrast"){if($("input[name="+O+"_"+H+"]:checked")!=undefined){if($("input[name="+O+"_"+H+"]:checked").length>1){var Z=[];$("input[name="+O+"_"+H+"]:checked").each(function(){var x={};x.value=$(this).val();x.text=$("#"+$(this).attr("id")).next().text();Z.push(createFiltervalue("source","value_text_object",x))});n=Z}else{dialogAlert($("input[name="+O+"_"+H+"]").parents("div").first(),"请至少选择两项做分类对比");return false}}}else{var w=[];if(L.source.allowcontrol==-1){$("input[name="+O+"_"+H+"]:checked").each(function(y,x){var x=$(this).val();x=parseInt(x,10);w.push(x)})}if(w.length>0){$.each(w,function(y,x){var ak={fieldname:"source",fieldvalue:{datatype:"int",value:parseInt(x,10)}};n.push(ak)})}}}D.retVal=n;break;case"sex":case"users_allow_all_act_msg":case"users_allow_all_comment":var n=[];if(m=="allclassifyquery"){var aj=[];$("input[name="+O+"_"+E+"]").each(function(){var x={};x.datatype="value_text_object";var y={};y.value=$(this).val();y.text=$("#"+$(this).attr("id")).next().text();x.value=y;aj.push(x)});n.push(createFiltervalue(E,"array",aj))}else{if(m=="allclassifycontrast"){if($("input[name="+O+"_"+E+"]:checked").length==$("input[name="+O+"_"+E+"]").length||($("input[name="+O+"_"+E+"]:not(:checked)").length==$("input[name="+O+"_"+E+"]").length&&$("input[name="+O+"_"+E+"_all]").prop("checked"))){var Z=[];$("input[name="+O+"_"+E+"]").each(function(){var x={};x.value=$(this).val();x.text=$("#"+$(this).attr("id")).next().text();Z.push(createFiltervalue(E,"value_text_object",x))});n=Z}else{dialogAlert($("input[name="+O+"_"+E+"]").parents("div").first(),"请选择全部做全分类对比");return false}}else{$("input[name="+O+"_"+E+"]:checked").each(function(){n.push(createFiltervalue(E,"string",$(this).val()))})}}D.retVal=n;break;case"verified":case"verified_type":case"sourceid":case"source_host":var b=E;if(E=="verified_type"){b="verified"}if(E=="sourceid"){b="source_host"}var n=[];if(m=="classifycontrast"){var o=false;var V=false;$("#"+O+"_"+b+"_selected ."+b+"item").each(function(y,x){var ak=$(x).attr("code");if(ak.indexOf("verify_")>-1){o=true}else{V=true}});if(o&&V){dialogAlert($("#"+O+"_"+b+"_selected").parents("div").first(),"请选择同一级别做分类对比");return false}var ad=getFiltervalueFromHtml(""+O+"_"+b+"_selected",b,undefined,true);var k=ad.fieldname;var Z=ad.filtervalue;n=Z}else{if(L[b].allowcontrol==-1&&$("#"+O+"_"+b+"_selected ."+b+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+b+"_selected",b);var k=ad.fieldname;n=n.concat(ad.filtervalue)}}D.name=k;D.retVal=n;break;case"registertime":var n=[];var W={};if($("input[name="+O+"_registertime_start]").val()==""){W.start=null}else{W.start=parseInt($("input[name="+O+"_registertime_start]").val())}if($("input[name="+O+"_registertime_end]").val()==""){W.end=null}else{W.end=parseInt($("input[name="+O+"_registertime_end]").val())}var s=0;W.gap=$("#"+O+"_registertime_gap").val();if(W.start!=null||W.end!=null){n.push(createFiltervalue("registertime","gaprange",W))}D.retVal=n;break;case"followerrank":case"friendrank":case"statusesrank":case"users_favourites_count":case"users_bi_followers_count":case"users_replys_count":case"users_recommended_count":case"users_level":var H=E;if(C!=undefined){H=C}var n=[];var v=$("input[name="+O+"_"+H+"_start]").parents("div").first();if(!check(v,E,"input[name="+O+"_"+H+"_start]","input[name="+O+"_"+H+"_end]",L)){return false}if($("input[name="+O+"_"+H+"_start]").val().length!=0||$("input[name="+O+"_"+H+"_end]").val().length!=0){var W={};if($("input[name="+O+"_"+H+"_start]").val()==""){W.start=null}else{W.start=parseInt($("input[name="+O+"_"+H+"_start]").val())}if($("input[name="+O+"_"+H+"_end]").val()==""){W.end=null}else{W.end=parseInt($("input[name="+O+"_"+H+"_end]").val())}var s=0;if(W.start!=null||W.end!=null){n.push(createFiltervalue(E,"range",W,s))}}D.retVal=n;break;default:break}}else{var B=[];switch(E){case"hostdomain":case"ancestor_host_domain":case"verifiedreason":case"description":case"keyword":case"searchword":case"pg_text":case"ancestor_text":case"organization":case"ancestor_organization":case"weibotopic":case"post_title":case"productType":case"impress":case"commentTags":case"proClassify":case"promotionInfos":case"productFullName":case"productColor":case"productSize":case"productDesc":case"productComb":case"detailParam":case"compName":case"compAddress":case"phoneNum":case"compURL":case"serviceProm":case"logisticsInfo":case"payMethod":case"apdComment":case"serviceComment":case"nowLocation":case"column":case"column1":case"ancestor_weibotopic":case"NRN":case"ancestor_NRN":case"weibotopickeyword":case"ancestor_wb_topic_keyword":case"source":case"weibotopiccombinword":case"ancestor_weibotopiccombinword":case"topic":case"ancestor_combinWord":case"username":case"oristatus_username":case"repost_username":case"usersfollower":case"usersfriend":case"users_url":case"users_page_url":case"users_domain":if(C!=undefined){E=C}var n=[];if(m=="classifyquery"||m=="featureclassifyquery"){var a="";if(m=="classifyquery"){a=""+O+"_"+E+"_selected";var A=getFiltervalueFromHtml(""+O+"_"+E+"_feature_selected",E,"string");n=n.concat(A.filtervalue)}else{a=""+O+"_"+E+"_feature_selected";var ad=getFiltervalueFromHtml(""+O+"_"+E+"_selected",E,"string");n=n.concat(ad.filtervalue)}var F=$("#"+a+" ."+E+"item").length;if(F>1){var ad=getClassifyFilterValue(a,E,"string");var c=ad.fieldvalues;var f=ad.featurefieldvalues;if(c.length>0&&f.length>0){dialogAlert($("#"+a+"").parents("div").first(),"只能选择同一类别做分类查询");return false}else{if(c.length>0){n.push(createFiltervalue(E,"array",c,0,0))}else{if(f.length>0){n.push(createFiltervalue(E,"array",f,0,1))}}}}else{dialogAlert($("#"+a+"").parents("div").first(),"请至少选择两项做分类查询");return false}}else{if(m=="classifycontrast"||m=="featureclassifycontrast"){var a="";if(m=="classifycontrast"){a=""+O+"_"+E+"_selected";var A=getFiltervalueFromHtml(""+O+"_"+E+"_feature_selected",E,"string");n=n.concat(A.filtervalue)}else{a=""+O+"_"+E+"_feature_selected";var ad=getFiltervalueFromHtml(""+O+"_"+E+"_selected",E,"string");n=n.concat(ad.filtervalue)}var F=$("#"+a+" ."+E+"item").length;if(F>1){var ad=getFiltervalueFromHtml(a,E,"string");n=n.concat(ad.filtervalue);if(ad.ablecontrast!=undefined&&!ad.ablecontrast){dialogAlert($("#"+a+"").parents("div").first(),"只能选择同一类别做分类对比");return false}}else{dialogAlert($("#"+a+"").parents("div").first(),"请至少选择两项做分类对比");return false}}else{var ad=getFiltervalueFromHtml(""+O+"_"+E+"_selected",E,"string");n=n.concat(ad.filtervalue);var A=getFiltervalueFromHtml(""+O+"_"+E+"_feature_selected",E,"string");n=n.concat(A.filtervalue)}}D.retVal=n;break;case"emotion":case"ancestor_emotion":case"emoCombin":case"ancestor_emoCombin":case"emoNRN":case"ancestor_emoNRN":case"emoOrganization":case"ancestor_emoOrganization":case"emoTopic":case"ancestor_emoTopic":case"emoTopicKeyword":case"ancestor_emoTopicKeyword":case"emoTopicCombinWord":case"ancestor_emoTopicCombinWord":var n=[];if(m=="classifyquery"||m=="allclassifyquery"){if($("#"+O+"_"+E+"_selected ."+E+"item").length>0){var ad=getClassifyFilterValue(""+O+"_"+E+"_selected",E,"string");var c=ad.fieldvalues;n.push(createFiltervalue(E,"array",c,0,0))}else{dialogAlert($("#"+O+"_"+E+"_selected").parents("div").first(),"请至少选择两项做分类查询!");return false}}else{if(m=="classifycontrast"||m=="allclassifycontrast"){if($("#"+O+"_"+E+"_selected ."+E+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+E+"_selected",E,"value_text_object",true);var Z=ad.filtervalue;B=B.concat(ad.areacode);if($("#"+O+"_"+E+"_selected ."+E+"item").length==1){if(Z.length==1){dialogAlert($("#"+O+"_"+E+"_selected").parents("div").first(),"请至少选择两项做分类对比");return false}}n=Z}else{dialogAlert($("#"+O+"_"+E+"_selected").parents("div").first(),"请至少选择两项做分类对比");return false}}else{if(L[E].allowcontrol==-1&&$("#"+O+"_"+E+"_selected ."+E+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+E+"_selected",E,"string");n=n.concat(ad.filtervalue)}}}D.retVal=n;break;case"weiboid":case"original_url":case"weibourl":case"oristatus":case"oristatusurl":var ag="";if(E=="weibourl"||E=="weiboid"){ag="weiboid"}if(E=="oristatusurl"||E=="oristatus"){ag="oristatus"}var ad=getFiltervalueFromHtml(""+O+"_"+ag+"_selected",ag);var n=ad.filtervalue;D.retVal=n;break;case"weibotype":var n=[];if(m=="allclassifyquery"){var aj=[];$("input[name="+O+"_weibotype]").each(function(){if(!($(this).val()==103)){var x={};x.datatype="value_text_object";var y={};y.value=$(this).val();y.text=$("label[for="+$(this).attr("id")+"]").text();x.value=y;aj.push(x)}});n.push(createFiltervalue(E,"array",aj))}else{if(m=="allclassifycontrast"){var Z=[];$("input[name="+O+"_weibotype]").each(function(){if(!($(this).val()==103)){var x={};x.value=$(this).val();x.text=$("#"+$(this).attr("id")).next().text();Z.push(createFiltervalue(E,"value_text_object",x))}});n=Z}else{$("input[name="+O+"_weibotype]:checked").each(function(){if(parseInt($(this).val())!=103){n.push(createFiltervalue("weibotype","int",parseInt($(this).val())))}})}}D.retVal=n;break;case"sex":case"haspicture":case"isNewPro":case"isFavorite":case"isAttention":case"recommended":case"users_allow_all_act_msg":case"users_allow_all_comment":var H=E;if(C!=undefined){H=C}var n=[];if(m=="classifyquery"){if($("#"+O+"_"+H+" input:checked").length>1){if($("#"+O+"_"+H+" input:checked")!=undefined){var aj=[];$("#"+O+"_"+H+" input:checked").each(function(){var x={};x.datatype="value_text_object";var y={};y.value=$(this).val();y.text=$("#"+$(this).attr("id")).next().text();x.value=y;aj.push(x)});n.push(createFiltervalue(E,"array",aj))}}else{dialogAlert($("#"+O+"_"+H+"").parents("div").first(),"请至少选择两项做分类查询");return false}}else{if(m=="allclassifyquery"){var aj=[];$("input[name="+O+"_"+H+"]").each(function(){var x={};x.datatype="value_text_object";var y={};y.value=$(this).val();y.text=$("#"+$(this).attr("id")).next().text();x.value=y;aj.push(x)});n.push(createFiltervalue(E,"array",aj))}else{if(m=="classifycontrast"){if($("#"+O+"_"+H+" input:checked").length>1){if($("#"+O+"_"+H+" input:checked")!=undefined){var Z=[];$("#"+O+"_"+H+" input:checked").each(function(){var x={};x.value=$(this).val();x.text=$("#"+$(this).attr("id")).next().text();Z.push(createFiltervalue(E,"value_text_object",x))});n=Z}}else{dialogAlert($("#"+O+"_"+H+"").parents("div").first(),"请至少选择两项做分类对比");return false}}else{if(L[E].allowcontrol==-1&&$("input[name="+O+"_"+H+"]:checked").length>0){$("input[name="+O+"_"+H+"]:checked").each(function(){n.push(createFiltervalue(E,L[E].datatype,$(this).val()))})}}}}D.retVal=n;break;case"registertime":var n=[];W={};if($("input[name="+O+"_registertime_start]").val()==""){W.start=null}else{W.start=parseInt($("input[name="+O+"_registertime_start]").val())}if($("input[name="+O+"_registertime_end]").val()==""){W.end=null}else{W.end=parseInt($("input[name="+O+"_registertime_end]").val())}W.gap=$("#"+O+"_registertime_gap").val();var s=0;if(W.start!=null||W.end!=null){n.push(createFiltervalue("registertime","gaprange",W,s))}D.retVal=n;break;case"createdtime":case"nearlytime":case"beforetime":case"untiltime":var n=[];var ai=$("#"+O+"timetype").attr("checkedtimetype");if(ai=="createdtime"){if($("input[name="+O+"_createdtime_start]").val().length>0||$("input[name="+O+"_createdtime_end]").val().length>0){W={};if($("input[id="+O+"_createdtime_start]").val()==""){W.start=null}else{W.start=getTimeSec($("input[id="+O+"_createdtime_start]").val())}if($("input[id="+O+"_createdtime_end]").val()==""){W.end=null}else{W.end=getTimeSec($("input[id="+O+"_createdtime_end]").val())}if(W.start!=null&&W.end!=null){if(W.start>W.end){dialogAlert($("#"+O+"_createdtime_div"),"起始时间应小于结束时间!");return false}}if(!$("#"+O+"_createdtime_all").prop("checked")){var s=0;n.push(createFiltervalue("createdtime","range",W,s))}}}else{if(ai=="nearlytime"){W={};W.start=$("#"+O+"_nearlytime").val();if(W.start.length==0){dialogAlert($("#"+O+"timetype div[timetype=nearlytime]"),"请填写相对今天的时间");return false}W.startgap=$("#"+O+"_nearlytime_gap").val();W.datestate="now";W.timestate=$("#"+O+"_nearlytime_thistime").attr("timestate");var s=0;n.push(createFiltervalue("nearlytime","time_dynamic_state",W,s))}else{if(ai=="beforetime"){W={};W.start=$("#"+O+"_beforetime_start").val();W.startgap=$("#"+O+"_beforetime_end_gap").val();W.end=$("#"+O+"_beforetime_end").val();W.endgap=$("#"+O+"_beforetime_end_gap").val();W.datestate=$("#"+O+"_beforetime_thisdate").attr("datestate");W.timestate=$("#"+O+"_beforetime_thistime").attr("timestate");if(W.start.length==0||W.end.length==0){dialogAlert($("#"+O+"timetype div[timetype=beforetime]"),"请填写时间段的起始值");return false}else{var ah=strtotime("-"+W.start+" "+W.startgap+"");var R=strtotime("-"+W.end+" "+W.endgap+"");if(ah>R){dialogAlert($("#"+O+"timetype div[timetype=beforetime]"),"起始时间应小于结束时间");return false}}var s=0;n.push(createFiltervalue("beforetime","time_dynamic_state",W,s))}else{W={};W.start={};W.start.start=$("#"+O+"_untiltime_start").val();W.start.startgap=$("#"+O+"_untiltime_start_gap").val();W.start.startthisgap=$("#"+O+"_untiltime_start_this_gap").val();W.start.startto=$("#"+O+"_untiltime_start_to").val();W.start.starttogap=$("#"+O+"_untiltime_start_to_gap").val();W.end={};W.end.end=$("#"+O+"_untiltime_end").val();W.end.endgap=$("#"+O+"_untiltime_end_gap").val();W.end.endthisgap=$("#"+O+"_untiltime_end_this_gap").val();W.end.endto=$("#"+O+"_untiltime_end_to").val();W.end.endtogap=$("#"+O+"_untiltime_end_to_gap").val();if(W.start.start.length==0||W.start.startto.length==0||W.end.end.length==0||W.end.endto.length==0){dialogAlert($("#"+O+"timetype div[timetype=untiltime]"),"请填写日历时间段起始值");return false}else{var G=sinceToThis(W.start.start,W.start.startgap,W.start.startthisgap,W.start.startto,W.start.starttogap,"beginning");var Q=sinceToThis(W.end.end,W.end.endgap,W.end.endthisgap,W.end.endto,W.end.endtogap,"ending");if(G>Q){dialogAlert($("#"+O+"timetype div[timetype=untiltime]"),"起始时间应小于结束时间");return false}}var s=0;n.push(createFiltervalue("untiltime","time_dynamic_range",W,s))}}}D.retVal=n;break;case"repostsnum":case"commentsnum":case"direct_comments_count":case"praises_count":case"post_title":case"productType":case"impress":case"commentTags":case"proClassify":case"promotionInfos":case"productFullName":case"productColor":case"productSize":case"productDesc":case"productComb":case"detailParam":case"compName":case"compAddress":case"phoneNum":case"compURL":case"serviceProm":case"logisticsInfo":case"payMethod":case"apdComment":case"serviceComment":case"nowLocation":case"column":case"column1":case"satisfaction":case"godRepPer":case"midRepPer":case"wosRepPer":case"godRepNum":case"midRepNum":case"wosRepNum":case"apdRepNum":case"showPicNum":case"cmtStarLevel":case"proOriPrice":case"proCurPrice":case"proPriPrice":case"stockNum":case"salesNumMonth":case"operateTime":case"compDesMatch":case"logisticsScore":case"serviceScore":case"purchDate":case"created_year":case"created_month":case"created_day":case"created_hour":case"created_weekday":case"total_reposts_count":case"direct_reposts_count":case"total_reach_count":case"followers_count":case"level":case"repost_trend_cursor":case"followerrank":case"friendrank":case"statusesrank":case"users_favourites_count":case"users_bi_followers_count":case"users_replys_count":case"users_recommended_count":case"users_level":var H=E;if(C!=undefined){H=C}var n=[];var W={};if($("input[name="+O+"_"+H+"_start]").val()==""){W.start=null}else{W.start=parseInt($("input[name="+O+"_"+H+"_start]").val())}if($("input[name="+O+"_"+H+"_end]").val()==""){W.end=null}else{W.end=parseInt($("input[name="+O+"_"+H+"_end]").val())}var s=0;if(W.start!=null||W.end!=null){n.push(createFiltervalue(E,"range",W,s))}D.retVal=n;break;case"verified":case"verified_type":case"sourceid":case"source_host":var b=E;if(E=="verified_type"){b="verified"}if(E=="sourceid"){b="source_host"}var n=[];if(m=="classifycontrast"){var o=false;var V=false;$("#"+O+"_"+b+"_selected ."+b+"item").each(function(y,x){var ak=$(x).attr("code");if(ak.indexOf("verify_")>-1){o=true}else{V=true}});if(o&&V){dialogAlert($("#"+O+"_"+b+"_selected").parents("div").first(),"请选择同一级别做分类对比");return false}var ad=getFiltervalueFromHtml(""+O+"_"+b+"_selected",b,undefined,true);var Z=ad.filtervalue;n=Z}else{if(m=="classifyquery"){if($("#"+O+"_"+b+"_selected ."+b+"item").length>1){var o=false;var V=false;$("#"+O+"_"+b+"_selected ."+b+"item").each(function(y,x){var ak=$(x).attr("code");if(ak.indexOf("verify_")>-1){o=true}else{V=true}});if(o&&V){dialogAlert($("#"+O+"_"+b+"_selected").parents("div").first(),"请选择同一级别进行分类查询!");return false}var ad=getClassifyFilterValue(""+O+"_"+b+"_selected",b);var aj=ad.fieldvalues;var k=ad.fieldname;n.push(createFiltervalue(k,"array",aj,0,0))}else{dialogAlert($("#"+O+"_"+b+"_div").parents("div").first(),"请至少选择两项做分类查询!");return false}}else{if(L[b].allowcontrol==-1&&$("#"+O+"_"+b+"_selected ."+b+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+b+"_selected",b);var k=ad.fieldname;n=n.concat(ad.filtervalue)}}}D.name=k;D.retVal=n;break;case"business":case"ancestor_business":case"areauser":case"areamentioned":case"ancestor_areamentioned":case"account":case"ancestor_account":case"userid":case"repost_userid":case"oristatus_userid":var H=E;if(C!=undefined){H=C}var n=[];if(m=="classifyquery"||m=="featureclassifyquery"){var a="";if(m=="classifyquery"){a=""+O+"_"+E+"_selected"}else{a=""+O+"_"+E+"_feature_selected"}var F=$("#"+a+" ."+H+"item").length;if(F>1){var ad=getClassifyFilterValue(a,H,"value_text_object");var aj=ad.fieldvalues;var q=ad.featurefieldvalues;if(aj.length>0&&q.length>0){dialogAlert($("#"+a+"").parents("div").first(),"只能选择同一类别做分类查询");return false}else{if(aj.length>0){n.push(createFiltervalue(E,"array",aj,0,0))}else{if(q.length>0){n.push(createFiltervalue(E,"array",q,0,1))}}}}else{dialogAlert($("#"+a+"").parents("div").first(),"请至少选择两项做分类查询");return false}}else{if(m=="classifycontrast"||m=="featureclassifycontrast"){var a="";if(m=="classifycontrast"){a=""+O+"_"+E+"_selected";if($("#"+O+"_"+H+"_feature_selected ."+H+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+H+"_feature_selected",H,"value_text_object");n=n.concat(ad.filtervalue)}}else{a=""+O+"_"+E+"_feature_selected";if($("#"+O+"_"+H+"_selected ."+H+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+H+"_selected",H,"value_text_object");n=n.concat(ad.filtervalue)}}var F=$("#"+a+" ."+H+"item").length;if(F>1){var ad=getFiltervalueFromHtml(a,H,"value_text_object");var Z=ad.filtervalue;B=B.concat(ad.areacode);if(ad.ablecontrast!=undefined&&!ad.ablecontrast){dialogAlert($("#"+a+"").parents("div").first(),"只能选择同一类别做分类对比");return false}else{n=Z}}else{dialogAlert($("#"+a+"").parents("div").first(),"请至少选择两项做分类对比");return false}}else{if($("#"+O+"_"+H+"_feature_selected ."+H+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+H+"_feature_selected",H,"value_text_object");n=n.concat(ad.filtervalue)}if($("#"+O+"_"+H+"_selected ."+H+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+H+"_selected",H,"value_text_object");n=n.concat(ad.filtervalue)}}}D.retVal=n;break;case"emoBusiness":case"ancestor_emoBusiness":case"emoAreamentioned":case"ancestor_emoAreamentioned":case"emoAccount":case"ancestor_emoAccount":var n=[];var F=$("#"+O+"_"+E+"_selected ."+E+"item").length;if(m=="classifyquery"||m=="allclassifyquery"){var ad=getClassifyFilterValue(""+O+"_"+E+"_selected",E,"value_text_object");var aj=ad.fieldvalues;n.push(createFiltervalue(E,"array",aj,0,0))}else{if(m=="classifycontrast"||m=="allclassifycontrast"){if($("#"+O+"_"+E+"_selected ."+E+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+E+"_selected",E,"value_text_object",true);var Z=ad.filtervalue;B=B.concat(ad.areacode);if($("#"+O+"_"+E+"_selected ."+E+"item").length==1){if(Z.length==1){dialogAlert($("#"+O+"_"+E+"_selected").parents("div").first(),"请至少选择两项做分类对比");return false}}n=Z}else{dialogAlert($("#"+O+"_"+E+"_selected").parents("div").first(),"请至少选择两项做分类对比");return false}}else{if($("#"+O+"_"+E+"_selected ."+E+"item").length>0){var ad=getFiltervalueFromHtml(""+O+"_"+E+"_selected",E,"value_text_object");n=n.concat(ad.filtervalue)}}}D.retVal=n;break;case"facetfield":var t=0;var J=[];$("#"+O+"selectedfacetfeatureinclude"+C+" .facetfeature"+C+"item").each(function(){var x={};x.value=$(this).attr("code");x.text=$(this).text();J.push(x);t=1});var M=[];$("#"+O+"selectedfacetfeatureexclude"+C+" .facetfeature"+C+"item").each(function(){var x={};x.value=$(this).attr("code");x.text=$(this).text();M.push(x);t=1});if(C=="sex"||mdfi||C=="has_picture"||C=="content_type"||C=="verify"){$("input[name="+O+"_filter_exclude_"+C+"]:checked").each(function(y,x){var ak={};ak.text=$(x).val();ak.value=$(x).val();M.push(ak)})}else{if($("#"+O+"selectedexcludeword .excludeworditem").length>0){$("#"+O+"selectedexcludeword .excludeworditem").each(function(al,x){var ak=$(x).attr("emotype");if(ak!=undefined){var y=ak.split(",");$.each(y,function(ao,an){var ap={};ap.value=$(x).attr("code")+","+an;ap.text=$(x).text();M.push(ap)})}else{var am={};am.value=$(x).attr("code");am.text=$(x).text();M.push(am)}})}}var p=[];if(C=="sex"||C=="recommended"||C=="has_picture"||C=="content_type"||C=="verify"){$("input[name="+O+"_filter_include_"+C+"]:checked").each(function(y,x){var ak={};ak.text=$(x).val();ak.value=$(x).val();p.push(ak)})}else{if($("#"+O+"selectedincludeword .includeworditem").length>0){$("#"+O+"selectedincludeword .includeworditem").each(function(al,x){var ak=$(x).attr("emotype");if(ak!=undefined){var y=ak.split(",");$.each(y,function(ao,an){var ap={};ap.text=$(x).text();ap.value=$(x).attr("code")+","+an;p.push(ap)})}else{var am={};am.text=$(x).text();am.value=$(x).attr("code");p.push(am)}})}}var u=[];var d={};if(p.length>0){d.type="include";d.value=p;u.push(d)}var h={};if(M.length>0){h.type="exclude";h.value=M;u.push(h)}var I={};var ae={};ae.showother=$("#"+O+"_facet_"+C+"_feature_include_config").prop("checked")?1:0;ae.alias=$("#"+O+"_facet_"+C+"_feature_include_alias").val();if(ae.showother&&ae.alias!=""){I.featureconfig=ae}var U={};U.showother=$("#"+O+"_filter_include_config").prop("checked")?1:0;U.alias=$("#"+O+"_filter_include_alias").val();if(U.showother&&U.alias!=""){I.includeconfig=U}I.filter=u;I.feature=J;I.isfeature=t;D.fieldtype="facetfield";D.retVal=I;break;case"facetrange":var g={};g.name=C;var ac={};var r=$("#"+O+"_facet_range_custom").prop("checked");if(r){ac.type="gaplist";ac.value=[];var z=[];$("#"+O+"_facet_range_tag .customrangeitem").each(function(){var y=jQuery.parseJSON($(this).attr("rangevalue"));var x=$(this).text();ac.value.push(y);z.push(x)});if(z.length==0){dialogAlert($("#"+O+"_facet_range_name").parents("div").first(),"请添加区间!");return false}var P={};P.value=z;P.type="list";var aa={};aa.x=P;g.tag=aa;g.include=["lower","upper"]}else{var T=getFacetRangeValue(O,C);if(!T){return false}ac.value={};var S=$("#"+O+"_facet_gap_text").val();if(S.length>0){if(!testPositiveInt(S,6)){dialogAlert($("#"+O+"_facet_gap_text").parents("div").first(),"区间长度输入值不合法,请输入小于6位(包含)的正整数");$("#"+O+"_facet_gap_text").focus();return false}else{if(S==0){dialogAlert($("#"+O+"_facet_gap_text").parents("div").first(),"区间长度输入值不能为0");$("#"+O+"_facet_gap_text").focus();return false}}}else{dialogAlert($("#"+O+"_facet_gap_text").parents("div").first(),"请输入区间长度");$("#"+O+"_facet_gap_text").focus();return false}var K=$("input[name="+O+"_facet_gap_type]:checked").val();var e=S;if(K=="gap"){if(C=="created_at"||C=="register_time"){var X=$("#"+O+"_facet_gap_measure").val();e+=X}ac.type="gap";ac.value.gap=e}else{if(K=="gapCount"){ac.type="gapcount";ac.value.gapcount=e}else{dialogAlert($("input[name="+O+"_facet_gap_type]").parents("div").first(),"请输入区间类型");return false}}ac.value.rangevalue=T}g.rangeinfo=ac;var af=getFacetRangeSides(O);g.sides=af;var aa={};var P=getTagAxisValue(O,"x");if(P!=null){aa.x=P}var N=getTagAxisValue(O,"y");if(N!=null){aa.y=N}if(aa.x!=undefined||aa.y!=undefined){g.tag=aa}D.fieldtype="facetrange";D.retVal=g;break;default:break}}return D}function getValueTextObject(c){var a={};a.datatype="value_text_object";var b={};b.value=$(c).attr("code");b.text=$(c).text();b.guid=$(c).attr("guid");a.value=b;return a}function getClassifyFilterValue(d,c,e){var a={};var f=[];var b=[];$("#"+d+" ."+c+"item").each(function(r,l){var k=$(this).attr("exclude");if(k==undefined){k=0}if(c=="verified"){var g="";var q={};q.datatype="value_text_object";var h=$(l).attr("code");var v={};if(h.indexOf("verify_")>-1){g="verified";var u=h.split("verify_");v.value=u[1];v.text=$(l).text()}else{g="verified_type";v.value=h;v.text=$(l).text()}q.value=v;q.exclude=k;f.push(q);a.fieldname=g}else{if(c=="source_host"||c=="users_source_host"){var q={};q.datatype="value_text_object";var h=$(l).attr("code");var v={};v.value=h;v.text=$(l).text();q.value=v;q.exclude=k;f.push(q);a.fieldname=c}else{var o=$(this).attr("emotype");if(o!=undefined&&o!=""){var p=o.split(",");if(p=="*"){p=[1,2,3,4,5]}var t=$(this).attr("code");if(e=="string"){$.each(p,function(w,m){f.push({datatype:"string",value:t+","+m,exclude:k})})}else{if(e=="value_text_object"){$.each(p,function(y,x){var w={};w.datatype="value_text_object";v={};var A=$(l).text();var z=A.indexOf("(");var m=A.substr(0,z);v.text=m+"("+emoval2text(x)+")";v.value=$(l).attr("code")+","+x;w.value=v;w.exclude=k;f.push(w)})}}}else{var s=$(this).attr("isfeature");if(s){var n=getValueTextObject(this);n.exclude=k;b.push(n)}else{if(e=="value_text_object"){var n=getValueTextObject(this);n.exclude=k;f.push(n)}else{var v="";if($(this).attr("code")!=undefined){v=$(this).attr("code")}else{v=$(this).text()}f.push({datatype:"string",value:v,exclude:k})}}}}}});a.fieldvalues=f;a.featurefieldvalues=b;return a}function getFiltervalueFromHtml(b,l,f,d){var e={};var k=[];var g=0;var h=0;var c=[];var a="";$("#"+b+" ."+l+"item").each(function(u,p){var o=$(this).attr("exclude");if(o==undefined){o=0}if(l=="verified"){if(d){var n=$(p).attr("code");var A={};if(n.indexOf("verify_")>-1){a="verified";var z=n.split("verify_");A.value=z[1];A.text=getVerifiedName(n)}else{a="verified_type";A.value=n;A.text=getVerifiedTypeName(n)}k.push(createFiltervalue(a,"value_text_object",A,0,0,o))}else{var B=$(this).attr("code");if(B.indexOf("verify_")>-1){a="verified";var w=B.split("verify_");k.push(createFiltervalue(a,"int",parseInt(w[1]),0,0,o))}else{a="verified_type";k.push(createFiltervalue(a,"string",B,0,0,o))}}}else{if(l=="source_host"||l=="users_source_host"){if(d){var n=$(p).attr("code");var A={};A.value=n;A.text=getSourceHostName(n);k.push(createFiltervalue(l,"value_text_object",A,0,0,o))}else{var B=$(this).attr("code");k.push(createFiltervalue(l,"string",B,0,0,o))}}else{if(l=="weiboid"||l=="original_url"||l=="repost_url"||l=="oristatus"||l=="originalcontent"||l=="digestcontent"){var v=$(this).attr("marktype");var C=$(this).attr("code");if(v=="url"){if(l=="weiboid"){k.push(createFiltervalue("weibourl","string",C,0,0,o))}else{if(l=="oristatus"){k.push(createFiltervalue(l+"url","string",C,0,0,o))}else{k.push(createFiltervalue(l,"string",C,0,0,o))}}}else{k.push(createFiltervalue(l,"string",C))}}else{if($(this).attr("emotype")!=undefined&&$(this).attr("emotype")!=""){if(f=="string"){var r=$(this).attr("emotype").split(",");var y=$(this).attr("code");$.each(r,function(D,m){k.push(createFiltervalue(l,"string",y+","+m,0,0,o))})}else{if(f=="value_text_object"){if(l=="emoAreamentioned"||l=="ancestor_emoAreamentioned"){c.push($(this).attr("code"))}var t=$(this).attr("emotype");var s=t.split(",");if(d){if(s=="*"){s=[1,2,3,4,5]}}$.each(s,function(D,m){A={};A.text=$(p).text();A.value=$(p).attr("code")+","+m;k.push(createFiltervalue(l,"value_text_object",A,0,0,o))})}}}else{var x=$(this).attr("isfeature");if(parseInt(x,10)==1){h++;var q=getValueTextObject(this);if(!q.value.guid){alert("特征分类,请使用新版!");throw ("特征分类,请使用新版!")}k.push(createFiltervalue(l,q.datatype,q.value,0,x,o))}else{g++;if(f=="value_text_object"){if(l=="areauser"||l=="areamentioned"||l=="ancestor_areamentioned"){c.push($(this).attr("code"))}A={};A.text=$(p).text();A.value=$(p).attr("code");k.push(createFiltervalue(l,"value_text_object",A,0,0,o))}else{var A="";if($(this).attr("code")!=undefined){A=$(this).attr("code")}else{A=$(this).text()}k.push(createFiltervalue(l,f,A,0,0,o))}}}}}}});if(h>0&&g>0){e.ablecontrast=false}e.fieldname=a;e.filtervalue=k;e.areacode=c;return e}function splitFiltervalueFeature(d){var a={};var b=[];var c=[];if(d.length>0){$.each(d,function(f,e){if(e.isfeature==1){b.push(e)}else{c.push(e)}})}a.featurevalues=b;a.values=c;return a}function initFiltervalueHtml(h,e,g){var a={};var d=0;var c=0;var f="";var b=true;$.each(h,function(n,s){if(parseInt(s.fromlimit,10)==0){c++;var o="";if(g=="weiboid"||g=="oristatus"){o="id"}if(g=="weibourl"||g=="oristatusurl"||g=="repost_url"){o="url"}var r=s.fieldvalue.value;if(r!==""){var p="";var u="";var t="";if(g=="verified"){u="verify_"+r;p=getVerifiedName(u)}else{if(g=="verified_type"){u=r;p=getVerifiedTypeName(r)}else{if(g=="sourceid"||(g=="source"&&e=="users_source_host")){u=getSourceUrl(r);p=getSourceName(r)}else{if(g=="source_host"||g=="users_source_host"){u=r;p=getSourceHostName(r)}else{if(s.fieldvalue.datatype=="blur_value_object"){p=r.value;var q=r.blur}else{if(s.fieldvalue.datatype=="value_text_object"){p=r.text;u=r.value;t=r.guid}else{if(parseInt(s.isfeature,10)==1){p=r.text;u=r.value}else{p=r;u=r}}}}}}}if(e.indexOf("emo")>-1){var l=u.substr(0,u.length-2).toString();var m=u.substr(u.length-1,1);u=l;if(s.fieldvalue.datatype=="value_text_object"){p=p}else{p=u+"("+emoval2text(m)+")"}}f+=createFormConfigSpanHtml(e,p,u,b,s.exclude,s.isfeature,m,o,q,undefined,undefined,t)}}else{d++}});a.fromlimitn=c;a.fromlimity=d;a.valuehtml=f;return a}function featureUnfoldedFun(b,a){$("#"+b+"_"+a+"_feature").css("display","");$("#"+b+"_"+a+"_check").attr("featurechecktype","unfolded");$("#"+b+"_"+a+"_arrowcheck").removeClass().addClass("checkarrowup")}function expressDisplay(b,c){var a="";if(b.length>0){var g=[];var f=[];$.each(b,function(h,k){if(k.valueorder=="start"){g.push(conditionDisplay(k,c))}else{if(k.valueorder=="end"){f.push(conditionDisplay(k,c))}}});var e="";var d="";if(g.length>1){e=g.join(" AND ")}if(f.length>1){d=f.join(" AND ")}if(g.length>0&&f.length>0){if(e!=""&&d!=""){a="("+e+") AND ("+d+")"}else{if(e!=""){a="("+e+") AND "+f[0]}else{if(d!=""){a=g[0]+" AND ("+d+")"}else{a=g[0]+" AND "+f[0]}}}}else{if(g.length>0){if(e!=""){a=e}else{a=g[0]}}else{if(f.length>0){if(d!=""){a=d}else{a=f[0]}}}}}return a}function conditionDisplay(e,c){var d="";if(e!=undefined){switch(e.valueorder){case"start":d+="开始 ";break;case"end":d+="结束 ";break;default:break}switch(e.opt){case"gt":d+=">";break;case"lt":d+="<";break;case"gtequal":d+=">=";break;case"ltequal":d+="<=";break;case"equal":d+="=";break;default:break}var b="";if(c=="absolutetime"){b=formatTime("yyyy-MM-dd hh:mm:ss",e.checkorder)}else{if(c=="relativetime"){var a=getGapNumDate(e.checkorder);b=a.num+getGaptext(a.unit)}else{b=e.checkorder}}d+=" "+b}return d}function calcRangeLabel(e,a,d,c){var b="";if(a[d]!=undefined){if(a[d].type=="exp"){var f={};if(e.range!=undefined&&e.rangeend!=undefined){f.start=e.range;f.end=e.rangeend}else{if(e.start!=undefined||e.end!=undefined){f=e}else{f.start=e;f.end=e}}$.each(a[d].value,function(h,k){var g=false;$.each(k.condition,function(p,o){var m=o.checkorder;if(o.type=="numberunit"){var l=getGapNumDate(m);m=strtotime("-"+l.num+" "+l.unit+"")}var n=f[o.valueorder];if(n!=undefined){n=parseInt(f[o.valueorder],10)}else{return false}switch(o.opt){case"gt":if(n>m){g=true}else{g=false}break;case"lt":if(n<m){g=true}else{g=false}break;case"gtequal":if(n>=m){g=true}else{g=false}break;case"ltequal":if(n<=m){g=true}else{g=false}break;case"equal":if(n==m){g=true}else{g=false}break;default:break}});if(g){b=k.label;return false}})}else{if(a[d].type=="reg"&&c!=undefined){b=a[d].value.replace(/\[n\]/g,c+1)}}}return b}function getOtherAlias(a){var b="";switch(a){case"left":case"before":b="左其他";break;case"right":case"after":b="右其他";break;default:break}return b}function getGapList(b){var d=b[0].tag.x.value;var c;switch(b[0].sides){case 1:var a=[];a.push(getOtherAlias("left"));c=a.concat(d,getOtherAlias("right"));break;case 2:var a=[];a.push(getOtherAlias("left"));c=a.concat(d);break;case 3:c=d.concat(getOtherAlias("right"));break;default:c=d;break}return c}function check(d,a,e,b,c,f){if(!checkvalide(d,a,e,c,f)){return false}if(!checkvalide(d,a,b,c,f)){return false}if($(e).val()!=undefined&&$(b).val()!=undefined){if($(e).val().length>0&&$(b).val().length>0){if(parseInt($(e).val(),10)>parseInt($(b).val(),10)){dialogAlert(d,"起始值应小于结束值!");$(e).focus();return false}}}return true}function checkFilerRelation(d,c,b,a){$(d).parents("table").css("width","100%");$(d).parents("table").find("td").first().css("width","90px");if(c>0&&!b&&$(d).is(":empty")&&!a){dialogAlert($(d).parents("tr").first(),"请点击推荐或者条件组合按钮获取条件信息!");return false}return true}function checkvalide(d,a,b,c,e){if($(b).val()!=undefined){if($(b).val().length>0){if(!testPositiveInt($(b).val(),256)){if(a=="floor"){if($(b).val()!="-1"){dialogAlert(d,"输入值不合法!");$(b).focus();return false}}else{dialogAlert(d,"输入值不合法!");$(b).focus();return false}}else{if(!checklimit(d,a,$(b).val(),c,e)){$(b).focus();return false}}}}return true}function checklimit(e,f,h,b,g){if(b[f].limit.length>0){var d=h;if(g!=undefined){switch(g){case"year":d=h*365;break;case"month":d=h*365/12;break;default:d=h;break}}var a=b[f].limit[0].value.minvalue;var k=b[f].limit[0].value.maxvalue;if(a!=null){var c=b[f].limit[0].value.gap;if(c!=undefined){switch(c){case"year":a=a*365;break;case"month":a=a*365/12;break;default:a=a;break}}}if(k!=null){var c=b[f].limit[0].value.gap;if(c!=undefined){switch(c){case"year":k=k*365;break;case"month":k=k*365/12;break;default:k=k;break}}}if(a!=null&&k!=null){if(!(parseInt(d,10)>=a&&parseInt(d,10)<=k)){dialogAlert(e,"输入值不合法!");return false}}else{if(a==null&&k!=null){if(!(parseInt(d,10)>=0&&parseInt(d,10)<=k)){dialogAlert(e,"输入值不合法!");return false}}else{if(a!=null&&k==null){if(!(parseInt(d,10)>=a)){dialogAlert(e,"输入值不合法!");return false}}}}}return true}function checkEqualLimit(e,a,f){var d=false;if(e[f].limit.length>0){switch(e[f].datatype){case"range":if(e[f].limit[0].value.maxvalue==a.end&&e[f].limit[0].value.minvalue==a.start){d=true}break;case"gaprange":if(e[f].limit[0].value.maxvalue==a.end&&e[f].limit[0].value.minvalue==a.start&&e[f].limit[0].value.gap==a.gap){d=true}break;case"time_dynamic_state":if(e[f].limit[0].name=="nearlytime"){if(e[f].limit[0].value.start==a.start&&e[f].limit[0].value.startgap==a.startgap&&e[f].limit[0].value.timestate==a.timestate){d=true}}else{if(e[f].limit[0].name=="beforetime"){if(e[f].limit[0].value.start==a.start&&e[f].limit[0].value.startgap==a.startgap&&e[f].limit[0].value.timestate==a.timestate&&e[f].limit[0].value.end==a.end&&e[f].limit[0].value.endgap==a.endgap&&e[f].limit[0].value.datestate==a.datestate){d=true}}}break;case"time_dynamic_range":if(e[f].limit[0].value.start.start==a.start.start&&e[f].limit[0].value.start.startgap==a.start.startgap&&e[f].limit[0].value.start.startthisgap==a.start.startthisgap&&e[f].limit[0].value.start.startto==a.start.startto&&e[f].limit[0].value.start.starttogap==a.start.starttogap&&e[f].limit[0].value.end.end==a.end.end&&e[f].limit[0].value.end.endgap==a.end.endgap&&e[f].limit[0].value.end.endthisgap==a.end.endthisgap&&e[f].limit[0].value.end.endto==a.end.endto&&e[f].limit[0].value.end.endtogap==a.end.endtogap){d=true}break;case"string":case"int":if(f=="verified"){var h=[];var g=[];$.each(a,function(l,k){if(k.fieldname=="verified"){h.push(k)}else{if(k.fieldname=="verified_type"){g.push(k)}}});var c=false;if(e.verified.limit.length==h.length){$.each(e.verified.limit,function(k,l){var m=false;$.each(h,function(o,n){if(l.value==n.fieldvalue.value){m=true;return false}});if(m){c=true}else{c=false;return false}})}var b=false;if(e.verified_type.limit.length==g.length){$.each(e.verified_type.limit,function(k,l){var m=false;$.each(g,function(o,n){if(l.value==n.fieldvalue.value){m=true;return false}});if(m){b=true}else{b=false;return false}})}if(c&&b){d=true}}else{if(e[f].limit.length==a.length){var c=false;$.each(e[f].limit,function(k,l){var m=false;$.each(a,function(o,n){if(l.value==n.fieldvalue.value){m=true;return false}});if(m){c=true}else{c=false;return false}});if(c){d=true}}}break;case"value_text_object":if(e[f].limit.length==a.length){var c=false;$.each(e[f].limit,function(k,l){var m=false;$.each(a,function(o,n){if(l.value.value==n.fieldvalue.value.value){m=true;return false}});if(m){c=true}else{if(!m){c=false;return false}}});if(c){d=true}}break;default:break}}return d}function sumResultData(f,b){var a={};a.categoryname="总计";var h={};var g=false;var e=[];var d={};var c=false;if(f.errorcode==undefined&&f.error==undefined){$.each(f,function(l,k){if(k.datalist){a.totalcount=k.datalist.length;if(k.before!=undefined){g=true;if(l==0){for(var n in k.before){var o=true;$.each(b,function(m,p){if(n==p.value){o=false;h[p.value]=parseInt(k.before[p.value],10)}});if(o){h[n]=k.before[n]}}}else{$.each(b,function(m,p){if(k.before[p.value]!=undefined){h[p.value]+=parseInt(k.before[p.value],10)}})}}$.each(k.datalist,function(p,m){var s={};if(l==0){for(var q in m){var r=true;$.each(b,function(t,u){if(q==u.value){r=false;s[u.value]=parseInt(m[u.value],10)}});if(r){s[q]=m[q]}}e.push(s)}else{$.each(b,function(t,u){if(m[u.value]!=undefined){e[p][u.value]+=parseInt(m[u.value],10)}})}});if(k.after!=undefined){c=true;if(l==0){for(var n in k.after){var o=true;$.each(b,function(m,p){if(n==p.value){o=false;d[p.value]=parseInt(k.after[p.value],10)}});if(o){d[n]=k.after[n]}}}else{$.each(b,function(m,p){if(k.after[p.value]!=undefined){d[p.value]+=parseInt(k.after[p.value],10)}})}}}});a.datalist=e;if(g){a.before=h}if(c){a.after=d}f.push(a)}}function weiboMid2url(c,a,d){switch(parseInt(d,10)){case 1:if(c&&a){var e=WeiboUtility.mid2url(c);var b="http://weibo.com/"+a+"/"+e;return b}else{return""}case 2:return"";default:return""}}function weiboUserurl(a,c){switch(parseInt(c,10)){case 1:if(a){var b="http://weibo.com/"+a;return b}else{return""}case 2:return"";case 3:if(a){var b="http://i.autohome.com.cn/"+a;return b}else{return""}default:return""}}function getUserFollowUrl(a,c){var b;switch(parseInt(c,10)){case 1:b=a+"/follow";break;case 3:b=a+"/following";break;default:break}return b}function getUserFanUrl(a,c){var b;switch(parseInt(c,10)){case 1:b=a+"/fans";break;case 3:b=a+"/followers";break;default:break}return b}function getUserPostsUrl(a,c){var b;switch(parseInt(c,10)){case 1:b=a+"/profile";break;case 3:b=a+"/club/topic";break;default:break}return b}function getUserReplyPostsUrl(a,c){var b;switch(parseInt(c,10)){case 3:b=a+"/club/sendreply";break;default:break}return b}function changeLength(d,b){var a=0;for(i=0;i<d.length;++i){var e=d.charAt(i);if(e=="<"&&(i+4)<d.length&&d.substr(i,4)=="<em>"){i=i+3;continue}else{if(e=="<"&&(i+5)<d.length&&d.substr(i,5)=="</em>"){i=i+4;continue}}a=escape(d.charAt(i)).length==6?(a+1):(a+0.5);if(a>=(b-0.5)){return i}}return d.length}function truncateSentence(e,a){var b="";var d=changeLength(e,a);if(e!=undefined){for(i=0;i<e.length;++i){var g=e.charAt(i);b+=g;if(i>=d){if(g=="<"&&(i+4)<e.length&&e.substr(i,4)=="<em>"){b=b.substr(0,b.length-1)}else{if(g=="e"&&e.substr(i-1,1)=="<"&&(i+3)<e.length&&e.substr(i,3)=="em>"){b=b.substr(0,b.length-2)}else{if(g=="m"&&e.substr(i-2,2)=="<e"&&(i+3)<e.length&&e.substr(i,2)=="m>"){b=b.substr(0,b.length-3)}else{if(g==">"&&e.substr(i-3,3)=="<em"&&(i+3)<e.length&&e.substr(i,1)==">"){b=b.substr(0,b.length-4)}else{if(g=="<"&&(i+5)<e.length&&e.substr(i,5)=="</em>"){b+=e.substr(i+1,4)}else{if(g=="/"&&e.substr(i-1,1)=="<"&&(i+4)<e.length&&e.substr(i,4)=="/em>"){b+=e.substr(i+1,3)}else{if(g=="e"&&e.substr(i-2,2)=="</"&&(i+3)<e.length&&e.substr(i,3)=="em>"){b+=e.substr(i+1,2)}else{if(g=="m"&&e.substr(i-3,3)=="</e"&&(i+2)<e.length&&e.substr(i,2)=="m>"){b+=e.substr(i+1,1)}else{if(g==">"&&e.substr(i-4,4)=="</em"&&(i+1)<e.length&&e.substr(i,1)==">"){}else{var f=-1;for(j=b.length-1;j>=0;--j){f++;if(b.charAt(j)==">"&&b.substr(j-4,5)=="</em>"){break}if(b.charAt(j)==">"&&b.substr(j-3,4)=="<em>"){b=b.substr(0,b.length-f-4);break}}}}}}}}}}}break}}}return b}function getCounttypeByFacettype(b){var a="frq";if(b!=undefined){switch(parseInt(b)){case 301:a="users_followers_count";break;case 302:a="users_friends_count";break;case 303:a="users_statuses_count";break;case 304:a="users_favourites_count";break;case 305:a="users_bi_followers_count";break;case 201:a="discuss_count";break;case 202:a="reposts_count";break;case 203:a="comments_count";break;case 204:a="direct_reposts_count";break;case 205:a="total_reposts_count";break;case 206:a="followers_count";break;case 207:a="total_reach_count";break;case 208:a="direct_comments_count";break;case 209:a="praises_count";break;case 210:a="paragraphid";break;case 211:a="floor";break;case 212:a="read_count";break;case 101:a="frq";break;default:break}}return a}function getAreaType(b,h,a){var k;if(a==undefined){a=false}if(b.toString().length==6){var d=b.toString().substr(0,2);var m=b.toString().substr(2,2);var l=b.toString().substr(4,2);if(m=="00"&&l=="00"){if(a){k="emoProvince"}else{if(h=="areauser"){k="province_code"}else{k="province"}}}else{if(m!="00"&&l=="00"){if(a){k="emoCity"}else{if(h=="areauser"){k="city_code"}else{k="city"}}}else{if(m!="00"&&l!="00"){if(a){k="emoDistrict"}else{if(h=="areauser"){k="district_code"}else{k="district"}}}}}}else{if(b.length==2){var e=b.length;var g=true;for(var c=0;c<e;c++){if(!(b.charCodeAt(c)>=65&&b.charCodeAt(c)<=90)){g=false}}if(g){if(a){k="emoCountry"}else{if(h=="areauser"){k="country_code"}else{k="country"}}}}}return k}function calcFilterrelationIndexNum(b,a){if(b.fields.length>0){a+=b.fields.length}if(b.filterlist.length>0){$.each(b.filterlist,function(d,c){a=calcFilterrelationIndexNum(c,a)})}return a}function deleteFilterrelationIndex(d,b){if(d.fields.length>0){for(var c=d.fields.length-1;c>-1;c--){if(d.fields[c]==b){d.fields.splice(c,1);break}}}if(d.filterlist.length>0){for(var a=0;a<d.filterlist.length;a++){deleteFilterrelationIndex(d.filterlist[a],b)}}}function modifyFilterrelation(a){if(a.filterrelation.opt!=undefined){if(a.filterrelation.opt=="and"){a.filterrelation.fields.push(a.filtervalue.length-1)}else{if(a.filterrelation.opt=="or"){var b=deepClone(a.filterrelation);a.filterrelation={};a.filterrelation.opt="and";a.filterrelation.filterlist=[];a.filterrelation.filterlist.push(b);a.filterrelation.fields=[];a.filterrelation.fields.push(a.filtervalue.length-1)}}}}function getErrorLabel(b,a){var c=[];$.each(b.outlimit,function(f,d){switch(f){case"filter":if(d.length>0){var g="字段:";$.each(d,function(l,e){var m="";if(a.filter[e]!=undefined){m=a.filter[e].label}else{m=e}g+=m+" "});c.push(g)}break;case"facet":if(d.length>0){c.push(a.facet["filterlimit"].label)}break;case"facetlimit":if(d.length>0){var h="统计字段 ";$.each(d,function(l,e){h+=getDisplayName(e,a.filter)+" "});c.push(h)}break;case"select":if(d.length>0){c.push(a.select.label)}break;case"output":if(d.length>0){$.each(d,function(e,k){if(k=="orderby"){c.push("排序字段")}if(k=="countlimit"){c.push(a.output["countlimit"].label)}})}break;default:break}});return c}function getShowid(a){var b="";switch(a){case"fullscreenmulticolumn3d":case"bigmulticolumn3d":case"smallmulticolumn3d":b="column";break;case"fullscreenmultibar3d":case"bigmultibar3d":case"smallmultibar3d":b="bar";break;case"fullscreenmslinechart":case"bigmslinechart":case"smallmslinechart":b="spline";break;default:break}return b}function checkOverlayShow(b){var c=true;var a=["column","spline"];if(window.currInstance.instanceType==3){$.each(b,function(e,d){var f=getShowid(d);if(!a.inArray(f)){dialogAlert($("#modelshow_div"),"叠加模型只能选择柱状图或线型图!");c=false;return false}})}return c}function getLastRenderShowid(b){var c="";var a=b.instanceID;$.each(window.instances,function(d,e){if(e.instanceID==a){var f=e.elements[e.elements.length-1].showid;c=getShowid(f);return false}});return c}function drillDownShow(k,f,a,d){if(k.filterrelation==null){initFilterRelation(k)}var c;var b;switch(parseInt(k.modelid,10)){case 31:c=allmodels.weiboquery;b="singlelist";break;case 2:c=allmodels.foltop;b="userinfo";break;case 6:return false;default:c=allmodels.weiboquery;b="singlelist";break}var h=new Element(0,1,0,2,c,"",k,null,null);if(a&&a.instanceType==2){h.instanceID=a.instanceID;h.elementID=a.elementID;h.instanceType=a.instanceType}h.temprequestdata=f;h.tempseriesname=d;if(k.ispath){h.isdrilldown=false}else{h.isdrilldown=true}var g=Math.round(Math.random()*100000);var e="drilldownlist"+g;if($("#"+e).length==0){$("body").append("<div id='"+e+"'></div>")}else{$("#"+e).empty()}h.allshow.push({newobj:true,parentdomid:e,id:Global.GetNextShowID(),showid:b,scopetype:"all",scopeobj:null});$("#"+e).dialog({width:820,height:630,modal:true,resizable:false,close:function(){}});h.show()}function formatErrorMsg(c){var b="Maximum execution";var a="";if(c.indexOf(b)>-1){a="后台处理超时!"}else{a="后台处理错误!"}return a}function setRangeValue(d,c,a,b){if(d[0].rangeinfo==undefined){d[0].start=c;d[0].end=a;d[0].gap=b}else{d[0].rangeinfo.type="gap";d[0].rangeinfo.value.gap=b;d[0].rangeinfo.value.rangevalue.type="range";d[0].rangeinfo.value.rangevalue.value={};d[0].rangeinfo.value.rangevalue.value.start=c;d[0].rangeinfo.value.rangevalue.value.end=a}}function getRangeTotalCount(k){var c=k.gap;if(c!=undefined&&c!=null){var f="";var d=1;if(c.indexOf("year")!=-1){var e=c.split("year");d=parseInt(e[0],10);f="y"}else{if(c.indexOf("month")!=-1){var e=c.split("month");d=parseInt(e[0],10);f="m"}else{if(c.indexOf("day")!=-1){var e=c.split("day");d=parseInt(e[0],10);f="d"}else{if(c.indexOf("hour")!=-1){var e=c.split("hour");d=parseInt(e[0],10);f="h"}else{d=c}}}}var b;if(f!=""){var g=new Date(k.start*1000);var a=new Date(k.end*1000);var h=g.dateDiff(f,a);b=h/d}else{b=(k.end-k.start)/d}}else{b=k.gapcount}return b}function getGapCount(d){var a;var b=d.range;if(b[0].rangeinfo==undefined){var c=getRangeValue(d);a=getRangeTotalCount(c)}else{if(b[0].rangeinfo.type=="gap"){var c=getRangeValue(d);a=getRangeTotalCount(c)}else{if(b[0].rangeinfo.type=="gapcount"){a=b[0].rangeinfo.value.gapcount}else{if(b[0].rangeinfo.type=="gaplist"){a=b[0].rangeinfo.value.length}}}}return a}function getRangeValue(d){var k={};if(d.range!=undefined&&d.range!=null&&d.range.length>0){if(d.range[0].rangeinfo==undefined){if(d.range[0].gap!=undefined){k.gap=d.range[0].gap;k.start=d.range[0].start;k.end=d.range[0].end}else{k.gapcount=d.range[0].gapCount}}else{var h=d.range[0].rangeinfo;if(h.type=="gap"){k.gap=h.value.gap}else{if(h.type=="gapcount"){k.gapcount=h.value.gapcount}}var c=d.range[0].rangeinfo.value.rangevalue;if(c!=undefined){if(c.type=="range"){k.start=c.value.start;k.end=c.value.end}else{if(c.type=="time_dynamic_state"){if(c.value.name=="nearlytime"){var e=strtotime("-"+c.value.start+" "+c.value.startgap+"");var a=strtotime("now");var f=getStateTime(e,a,"now","",c.value.timestate);k.start=f.start;k.end=f.end}else{if(c.value.name=="beforetime"){var e=strtotime("-"+c.value.start+" "+c.value.endgap+"");var a=strtotime("-"+c.value.end+" "+c.value.endgap+"");var f=getStateTime(e,a,c.value.datestate,c.value.endgap,c.value.timestate);k.start=f.start;k.end=f.end}}}else{if(c.type=="time_dynamic_range"){var g=c.value.start;var e=sinceToThis(g.start,g.startgap,g.startthisgap,g.startto,g.starttogap,"beginning");var b=c.value.end;var a=sinceToThis(b.end,b.endgap,b.endthisgap,b.endto,b.endtogap,"beginning");var f=getStateTime(e,a,"now","","now");k.start=f.start;k.end=f.end}}}}}}return k}function getValueName(e){var a="frq";if(e.modelid&&e.modelid==6){labelname=e.fieldlist[1].value}var g=e.facet;var f=[];if(g.field!=undefined&&g.field.length>0){f=g.field[0].facetcalculate}else{if(g.range!=undefined&&g.range.length>0){f=g.range[0].facetcalculate}}var c=0;if(f!=undefined&&f.length>0){$.each(f,function(k,h){if(h.calctype!=undefined&&h.calctype!="field"){c=k;return false}})}else{if(e.facet.range!=null&&e.facet.range.length>0){if(e.facet.range[0].facettype!=undefined){a=getCounttypeByFacettype(e.facet.range[0].facettype)}}else{if(e.facet.field!=null&&e.facet.field.length>0){if(e.facet.field[0].facettype!=undefined){a=getCounttypeByFacettype(e.facet.field[0].facettype)}}}}if(e.output.sort!=undefined&&e.output.sort.length>0){var d=e.output.sort[0];if(f!=undefined&&f.length>0){var b=false;$.each(f,function(k,h){if(h.calctype==d.calctype&&h.code==d.orderby){b=true}});if(b){a=""+d.calctype+":"+d.orderby+""}else{a=""+f[c].calctype+":"+f[c].code+""}}}else{if(f!=undefined&&f.length>0){a=""+f[c].calctype+":"+f[c].code+""}}return a}function getValueNameFromOrderby(b){var a="";switch(b){case"followers_count":a="users_followers_count";break;case"friends_count":a="users_friends_count";break;case"statuses_count":a="users_statuses_count";break;default:a=b;break}return a}function facet2formfield(b){var a;switch(b){case"reposts_count":a="repostsnum";break;case"comments_count":a="commentsnum";break;case"register_time":case"users_created_at":a="registertime";break;case"created_at":a="createdtime";break;case"users_followers_count":a="followerrank";break;case"users_friends_count":a="friendrank";break;case"users_statuses_count":a="statusesrank";break;default:a=b;break}return a}function getFacetType(a){var b="field";switch(a){case"created_at":case"created_year":case"created_month":case"created_day":case"created_hour":case"created_weekday":case"register_time":case"reposts_count":case"comments_count":case"direct_comments_count":case"praises_count":case"paragraphid":case"trample_count":case"satisfaction":case"godRepPer":case"midRepPer":case"wosRepPer":case"godRepNum":case"midRepNum":case"wosRepNum":case"apdRepNum":case"showPicNum":case"cmtStarLevel":case"proOriPrice":case"proCurPrice":case"proPriPrice":case"stockNum":case"salesNumMonth":case"operateTime":case"compDesMatch":case"logisticsScore":case"serviceScore":case"purchDate":case"question_id":case"answer_id":case"child_post_id":case"question_father_id":case"answer_father_id":case"floor":case"level":case"read_count":case"reply_comment":case"total_reposts_count":case"direct_reposts_count":case"total_reach_count":case"followers_count":case"users_followers_count":case"users_friends_count":case"users_statuses_count":case"users_created_at":case"users_favourites_count":case"users_bi_followers_count":case"users_replys_count":case"users_recommended_count":case"users_level":b="range";break;default:b="field";break}return b}function getLabelName(a){var c="text";if(a.modelid&&a.modelid==6){c=a.fieldlist[0].value}var b=a.facet;if(b.range!=null&&b.range.length>0){switch(b.range[0].name){case"created_at":c="range";break;case"created_year":case"created_month":case"created_day":case"created_hour":case"created_weekday":case"register_time":case"reposts_count":case"comments_count":case"direct_comments_count":case"praises_count":case"paragraphid":case"trample_count":case"satisfaction":case"godRepPer":case"midRepPer":case"wosRepPer":case"godRepNum":case"midRepNum":case"wosRepNum":case"apdRepNum":case"showPicNum":case"cmtStarLevel":case"proOriPrice":case"proCurPrice":case"proPriPrice":case"stockNum":case"salesNumMonth":case"operateTime":case"compDesMatch":case"logisticsScore":case"serviceScore":case"purchDate":case"question_id":case"answer_id":case"child_post_id":case"question_father_id":case"answer_father_id":case"floor":case"level":case"read_count":case"reply_comment":case"total_reposts_count":case"direct_reposts_count":case"total_reach_count":case"followers_count":case"users_level":case"users_replys_count":case"users_recommended_count":case"users_followers_count":case"users_friends_count":case"users_statuses_count":case"users_favourites_count":case"users_bi_followers_count":case"users_created_at":c="alias";break;default:c="range";break}}else{if(b.field!=null&&b.field.length>0){switch(b.field[0].name){case"country":case"province":case"city":case"district":case"ancestor_country":case"ancestor_province":case"ancestor_city":case"ancestor_district":case"country_code":case"province_code":case"city_code":case"district_code":case"business":case"ancestor_business":case"sourceid":case"account":case"ancestor_account":case"userid":case"emotion":case"ancestor_emotion":case"emoCombin":case"ancestor_emoCombin":case"emoNRN":case"ancestor_emoNRN":case"emoOrganization":case"ancestor_emoOrganization":case"emoTopic":case"ancestor_emoTopic":case"emoTopicKeyword":case"ancestor_emoTopicKeyword":case"emoTopicCombinWord":case"ancestor_emoTopicCombinWord":case"emoAccount":case"ancestor_emoAccount":case"emoBusiness":case"ancestor_emoBusiness":case"emoCountry":case"emoProvince":case"emoCity":case"emoDistrict":case"ancestor_emoCountry":case"ancestor_emoProvince":case"ancestor_emoCity":case"ancestor_emoDistrict":case"sex":case"recommended":case"verify":case"verified_type":case"content_type":case"has_picture":case"source_host":case"users_id":case"users_sourceid":case"users_gender":case"users_allow_all_act_msg":case"users_allow_all_comment":case"users_verified":case"users_verified_type":case"users_source_host":case"users_country_code":case"users_province_code":case"users_city_code":case"users_district_code":case"users_friends_id":c="alias";break;case"verified_reason":case"description":case"text":case"column":case"column1":case"post_title":case"productType":case"impress":case"commentTags":case"proClassify":case"promotionInfos":case"productFullName":case"productColor":case"productSize":case"productDesc":case"productComb":case"detailParam":case"compName":case"compAddress":case"phoneNum":case"compURL":case"serviceProm":case"logisticsInfo":case"payMethod":case"apdComment":case"serviceComment":case"nowLocation":case"pg_text":case"ancestor_text":case"wb_topic":case"ancestor_wb_topic":case"wb_topic_keyword":case"ancestor_wb_topic_keyword":case"screen_name":case"NRN":case"ancestor_NRN":case"source":case"host_domain":case"ancestor_host_domain":case"combinWord":case"ancestor_combinWord":case"wb_topic_combinWord":case"ancestor_wb_topic_combinWord":case"users_screen_name":case"users_verified_reason":case"users_description":if(parseInt(b.field[0].isfeature,10)==1){c="alias"}break;default:c="text";break}}}return c}function getDisplayValueByFacet(g,b){var k=b;var a=g.facet.range;if(a!=undefined&&a.length>0){var c=a[0].name;if(g.filter[c].datatype=="timerange"){k=formatTime("yyyy-MM-dd hh:mm:ss",b)}}var f=g.facet.field;if(f!=undefined&&f.length>0){var d=f[0].name;var h=d.split(",");var l=b.split(",");var e=[];$.each(h,function(o,m){var n="";if(g.filter[m]!=undefined&&g.filter[m].datatype=="timerange"){n=formatTime("yyyy-MM-dd hh:mm:ss",l[o])}else{if(m=="*"){n="值"}else{n=l[o]}}if(n!=undefined){e.push(n)}});k=e.join(",")}return k}function getDisplayValueByField(d,h,a){var b=a;var c=h.split(":");var k="";var g=false;if(c.length>1){k=c[1];if(c[0]=="field"){g=true}}else{k=c[0];g=true}if(d.filter!=null&&d.filter[k]!=undefined&&g){var e=d.filter[k].datatype;switch(e){case"timerange":b=formatTime("yyyy-MM-dd",a);break;case"string":case"int":var f=getAliasValueList(e,k);if(f!=null){if(f[a]!=undefined){b=f[a].name}else{b="未知"}}else{b=a}break;default:b=a;break}}return b}function calcval2text(b){var a="";switch(b){case"field":a="标准";break;case"count":a="计数";break;case"sum":a="求和";break;case"average":a="平均值";break;case"max":a="最大值";break;case"min":a="最小值";break;default:break}return a}function emoval2text(a){var b=parseInt(a,10);var c="";switch(b){case 1:c="反对";break;case 2:c="负面";break;case 3:c="中立";break;case 4:c="正面";break;case 5:c="赞赏";break;default:break}return c}function emovalShow(a){var b=a.split("_");var d=emotype2text(b[1]);var c=b[0]+"("+d+")";return c}function emotype2text(a){var b=[];if(a.split(",").length==5){b.push("全部")}else{$.each(a.split(","),function(d,c){var e="";if(c=="*"){e="全部"}else{e=emoval2text(c)}b.push(e)})}return b}function checkfacetfield(a){var b="";if(a.range!=null&&a.range.length>0){switch(a.range[0].name){case"created_at":b="created_at";break;default:b=a.range[0].name;break}}else{if(a.field!=null&&a.field.length>0){switch(a.field[0].name){case"country":case"country_code":case"province":case"province_code":case"city":case"city_code":case"district":case"district_code":case"ancestor_country":case"ancestor_province":case"ancestor_city":case"ancestor_district":b="area";break;case"emotion":case"ancestor_emotion":case"emoCombin":case"ancestor_emoCombin":case"emoNRN":case"ancestor_emoNRN":case"emoOrganization":case"ancestor_emoOrganization":case"emoTopic":case"ancestor_emoTopic":case"emoTopicKeyword":case"ancestor_emoTopicKeyword":case"emoTopicCombinWord":case"ancestor_emoTopicCombinWord":case"emoAccount":case"ancestor_emoAccount":case"emoBusiness":case"ancestor_emoBusiness":case"emoCountry":case"emoProvince":case"emoCity":case"emoDistrict":case"ancestor_emoCountry":case"ancestor_emoProvince":case"ancestor_emoCity":case"ancestor_emoDistrict":case"ancestor_emotion":case"ancestor_emoCombin":case"ancestor_emoNRN":case"ancestor_emoOrganization":case"ancestor_emoTopic":case"ancestor_emoTopicKeyword":case"ancestor_emoTopicCombinWord":case"ancestor_emoAccount":case"ancestor_emoBusiness":case"ancestor_emoCountry":case"ancestor_emoProvince":case"ancestor_emoCity":case"ancestor_emoDistrict":b="emotion";break;default:b=a.field[0].name;break}}}return b}function emoreplace(d){var b=d.split(" ");var a=b.length;var e="";if(a>1){var c=[];$.each(b,function(g,f){if(g!=a-1){c.push(f)}});e=c.join(" ")+"_"+b[a-1]}else{e=d}return e}function emofilterhtml(b){var e={};var d=0;var c=0;$.each(b,function(k,g){if(g.fromlimit==0){d++;var n=g.fieldvalue.value.value;var o=g.fieldvalue.value.text;var l=n.substr(0,n.length-2).toString();var h=n.substr(n.length-1,1);if(e[l]!=undefined){e[l].emotype+=","+h}else{e[l]={};e[l].text=o;e[l].emotype=h;e[l].code=l;e[l].fieldname=g.fieldname;e[l].exclude=g.exclude}}else{c++}});var a="";for(i in e){a+=createFormConfigSpanHtml(e[i].fieldname,e[i].text,e[i].code,true,e[i].exclude,undefined,e[i].emotype)}var f={};f.fromlimitn=d;f.fromlimity=c;f.emohtml=a;return f}function stringemofilterhtml(c){var g={};var e=0;var d=0;$.each(c,function(n,k){if(k.fromlimit==0){e++;var p=k.fieldvalue.value;var o=p.substr(0,p.length-2).toString();var l=p.substr(p.length-1,1);if(g[o]!=undefined){g[o].emotype+=","+l}else{g[o]={};g[o].text=o;g[o].emotype=l;g[o].fieldname=k.fieldname;g[o].exclude=k.exclude}}else{d++}});var b="";for(i in g){var f=emotype2text(g[i].emotype);var a=g[i].text+"("+f+")";b+=createFormConfigSpanHtml(g[i].fieldname,a,g[i].text,true,g[i].exclude,undefined,g[i].emotype)}var h={};h.fromlimitn=e;h.fromlimity=d;h.emohtml=b;return h}function outputfieldfilter(c,d){var e={};$.each(c,function(h,f){var n=f.text;var l=f.value;var k=l.substr(0,l.length-2).toString();var g=l.substr(l.length-1,1);if(e[k]!=undefined){e[k].emotype+=","+g}else{e[k]={};e[k].text=n;e[k].code=k;e[k].emotype=g;e[k].fieldname=d}});var a="";for(var b in e){a+="<span class='selwordsbox'><span class='"+e[b].fieldname+"worditem' code='"+e[b].code+"' emotype='"+e[b].emotype+"' >"+e[b].text+"</span><a class='cancleitem' name='cancleselectedfilterword' value='"+e[b].fieldname+"word'>×</a></span>"}return a}function showFullScreenWait(){var b=$(document).width();var d=$(document).height();var g="waitfullscreendiv";var f=config.imagePath+"wait.gif";var a=b/2;var e=window.screen.availHeight/2;if($("#"+g).length==0){var c="<div id='"+g+"'><img src='"+f+"' style='padding-left:"+a+"px;padding-top:"+e+"px'/></div>";$("body").append(c);$("#"+g).css({position:"absolute",width:b,height:d,top:0,left:0,background:"white",opacity:".6",filter:"alpha(opacity=60)"})}else{$("#"+g).show()}}function hideFullScreenWait(){var a="waitfullscreendiv";$("#"+a).hide()}function getGapRangeStartEnd(d){var a="";var e={startdate:null,enddate:null,gap:null};if(d.indexOf("年")>-1){var c=d.split("年");if(d.indexOf("大于")>-1){var b=c[0].split("大于");e.startdate=b[1]}else{if(d.indexOf("小于")>-1){var b=c[0].split("小于");e.enddate=b[1]}else{var b=c[0].split("~");e.startdate=b[0];e.enddate=b[1]}}e.gap="year"}else{if(d.indexOf("月")>-1){var c=d.split("月");if(d.indexOf("大于")>-1){var b=c[0].split("大于");e.startdate=b[1]}else{if(d.indexOf("小于")>-1){var b=c[0].split("小于");e.enddate=b[1]}else{var b=c[0].split("~");e.startdate=b[0];e.enddate=b[1]}}e.gap="month"}else{if(d.indexOf("天")>-1){var c=d.split("天");if(d.indexOf("大于")>-1){var b=c[0].split("大于");e.startdate=b[1]}else{if(d.indexOf("小于")>-1){var b=c[0].split("小于");e.enddate=b[1]}else{var b=c[0].split("~");e.startdate=b[0];e.enddate=b[1]}}e.gap="day"}else{if(d.indexOf("大于")>-1){var b=d.split("大于");e.startdate=b[1]}else{if(d.indexOf("小于")>-1){var b=d.split("小于");e.enddate=b[1]}else{var b=d.split("~");e.startdate=b[0];e.enddate=b[1]}}}}}return e}function facettype2orderby(a){var b="";switch(parseInt(a,10)){case 101:b="created_at";break;case 201:case 202:b="reposts_count";break;case 203:b="comments_count";break;case 204:b="direct_reposts_count";break;case 205:b="total_reposts_count";break;default:b="created_at";break}return b}function getIntersectionSet(c,b){var a={};if(c.start=="*"||b.start=="*"){if(c.start=="*"&&b.start=="*"){a.start="*"}else{if(c.start=="*"){a.start=b.start}else{if(b.start=="*"){a.start=c.start}}}}else{a.start=c.start>b.start?c.start:b.start}if(c.end=="*"||b.end=="*"){if(c.end=="*"&&b.end=="*"){a.end="*"}else{if(c.end=="*"){a.end=b.end}else{if(b.end=="*"){a.end=c.end}}}}else{a.end=c.end>b.end?b.end:c.end}return a}function drillDownTempJson(C,z,s,r){var n="";var d="";var A=0;if(typeof(C)=="object"&&typeof(C.category)=="object"){n=C.category;d=C.series;A=n.other!=undefined?parseInt(n.other,10):0}else{return false}var a=[];z.output.outputtype=1;z.output.pageable=true;z.output.data_limit=0;if(z.facet.range.length>0){var x=z.facet.range[0].name;switch(x){case"created_at":case"created_year":case"created_month":case"created_day":case"created_hour":case"created_weekday":case"register_time":case"reposts_count":case"comments_count":case"direct_comments_count":case"praises_count":case"paragraphid":case"trample_count":case"satisfaction":case"godRepPer":case"midRepPer":case"wosRepPer":case"godRepNum":case"midRepNum":case"wosRepNum":case"apdRepNum":case"showPicNum":case"cmtStarLevel":case"proOriPrice":case"proCurPrice":case"proPriPrice":case"stockNum":case"salesNumMonth":case"operateTime":case"compDesMatch":case"logisticsScore":case"serviceScore":case"purchDate":case"question_id":case"answer_id":case"child_post_id":case"question_father_id":case"answer_father_id":case"floor":case"level":case"read_count":case"total_reposts_count":case"direct_reposts_count":case"total_reach_count":case"followers_count":case"users_followers_count":case"users_friends_count":case"users_statuses_count":case"users_favourites_count":case"users_bi_followers_count":case"users_level":case"users_replys_count":case"users_recommended_count":case"users_created_at":var w=n.start;var h=n.end;break;default:break}var l={};l={start:w,end:h};if(n.include!=undefined){l.include=n.include}var o=false;switch(z.facet.range[0].name){case"created_at":var q=true;$.each(z.filtervalue,function(I,M){if(M.fieldname=="createdtime"||M.fieldname=="nearlytime"||M.fieldname=="beforetime"||M.fieldname=="untiltime"){q=false;var H={};if(M.fieldname=="createdtime"){H=M.fieldvalue.value}else{if(M.fieldname=="nearlytime"){var F=M.fieldvalue;var J=strtotime("-"+F.value.start+" "+F.value.startgap+"");var E=strtotime("now");H=getStateTime(J,E,"now","",F.value.timestate)}else{if(M.fieldname=="beforetime"){var F=M.fieldvalue;var J=strtotime("-"+F.value.start+" "+F.value.endgap+"");var E=strtotime("-"+F.value.end+" "+F.value.endgap+"");H=getStateTime(J,E,F.value.datestate,F.value.endgap,F.value.timestate)}else{if(M.fieldname=="untiltime"){var F=M.fieldvalue;var L=F.value.start;var J=sinceToThis(L.start,L.startgap,L.startthisgap,L.startto,L.starttogap,"beginning");var G=F.value.end;var E=sinceToThis(G.end,G.endgap,G.endthisgap,G.endto,G.endtogap,"beginning");H=getStateTime(J,E,"now","","now")}}}}var K=getIntersectionSet(H,l);if(l.include!=undefined){K.include=l.include}M.fieldname="createdtime";M.fieldvalue.datatype="range";M.fieldvalue.value=K}});if(q){a.push(createFiltervalue("createdtime","range",l))}break;case"reposts_count":var q=true;$.each(z.filtervalue,function(E,G){if(G.fieldname=="repostsnum"&&z.facet.range[0].name=="reposts_count"){var H=G.fieldvalue.value;var F=getIntersectionSet(H,l);if(l.include!=undefined){F.include=l.include}G.fieldvalue.value=F;q=false}});if(q){a.push(createFiltervalue("repostsnum","range",l))}break;case"comments_count":var q=true;$.each(z.filtervalue,function(E,G){if(G.fieldname=="commentsnum"&&z.facet.range[0].name=="comments_count"){var H=G.fieldvalue.value;var F=getIntersectionSet(H,l);if(l.include!=undefined){F.include=l.include}G.fieldvalue.value=F;q=false}});if(q){a.push(createFiltervalue("commentsnum","range",l))}break;case"direct_comments_count":case"praises_count":case"paragraphid":case"trample_count":case"satisfaction":case"godRepPer":case"midRepPer":case"wosRepPer":case"godRepNum":case"midRepNum":case"wosRepNum":case"apdRepNum":case"showPicNum":case"cmtStarLevel":case"proOriPrice":case"proCurPrice":case"proPriPrice":case"stockNum":case"salesNumMonth":case"operateTime":case"compDesMatch":case"logisticsScore":case"serviceScore":case"purchDate":case"question_id":case"answer_id":case"child_post_id":case"question_father_id":case"answer_father_id":case"floor":case"read_count":case"level":case"created_year":case"created_month":case"created_day":case"created_hour":case"created_weekday":case"total_reposts_count":case"direct_reposts_count":case"total_reach_count":case"followers_count":case"users_favourites_count":case"users_bi_followers_count":case"users_level":case"users_replys_count":case"users_recommended_count":var q=true;$.each(z.filtervalue,function(E,G){if(G.fieldname==z.facet.range[0].name){var H=G.fieldvalue.value;var F=getIntersectionSet(H,l);if(l.include!=undefined){F.include=l.include}G.fieldvalue.value=F;q=false}});if(q){a.push(createFiltervalue(z.facet.range[0].name,"range",l))}break;case"register_time":var q=true;$.each(z.filtervalue,function(E,H){if(H.fieldname=="registertime"&&z.facet.range[0].name=="register_time"){var I={};var K=H.fieldvalue;var G=strtotime("-"+K.value.start+" "+K.value.gap+"");var J=strtotime("-"+K.value.end+" "+K.value.gap+"");I.start=G;I.end=J;var F=getIntersectionSet(I,l);H.fieldvalue.value=F;q=false}});if(q){a.push(createFiltervalue("registertime","gaprange",l))}break;case"users_created_at":var q=true;$.each(z.filtervalue,function(E,H){if(H.fieldname=="registertime"&&z.facet.range[0].name=="users_created_at"){var I={};var K=H.fieldvalue;var G=strtotime("-"+K.value.start+" "+K.value.gap+"");var J=strtotime("-"+K.value.end+" "+K.value.gap+"");I.start=G;I.end=J;var F=getIntersectionSet(I,l);H.fieldvalue.value=F;q=false}});if(q){a.push(createFiltervalue("registertime","gaprange",l))}break;case"users_followers_count":var q=true;$.each(z.filtervalue,function(E,G){if(G.fieldname=="followerrank"&&z.facet.range[0].name=="users_followers_count"){var H=G.fieldvalue.value;var F=getIntersectionSet(H,l);if(l.include!=undefined){F.include=l.include}G.fieldvalue.value=F;q=false}});if(q){a.push(createFiltervalue("followerrank","range",l))}break;case"users_friends_count":var q=true;$.each(z.filtervalue,function(E,G){if(G.fieldname=="friendrank"&&z.facet.range[0].name=="users_friends_count"){var H=G.fieldvalue.value;var F=getIntersectionSet(H,l);if(l.include!=undefined){F.include=l.include}G.fieldvalue.value=F;q=false}});if(q){a.push(createFiltervalue("friendrank","range",l))}break;case"users_statuses_count":var q=true;$.each(z.filtervalue,function(E,G){if(G.fieldname=="statusesrank"&&z.facet.range[0].name=="users_statuses_count"){var H=G.fieldvalue.value;var F=getIntersectionSet(H,l);if(l.include!=undefined){F.include=l.include}G.fieldvalue.value=F;q=false}});if(q){a.push(createFiltervalue("statusesrank","range",l))}break;default:break}z.output.orderby=facettype2orderby(z.facet.range[0].facettype);z.output.ordertype="desc"}if(z.facet.field.length>0){var c=z.facet.field[0].name;z.select.value.push(c);var g=true;var m=typeof(z.facet.field[0].isfeature)!="undefined"?z.facet.field[0].isfeature:0;var u=z.facet.field[0].name;var e="";var l={};if("alias"==getLabelName(z)){var B=n.text;if(z.facet.field[0].name=="combinWord"||z.facet.field[0].name=="ancestor_combinWord"||z.facet.field[0].name=="wb_topic_combinWord"||z.facet.field[0].name=="ancestor_wb_topic_combinWord"){var k=new RegExp(" ","g");B=n.text.replace(k,",")}l.value=B;l.text=n.alias;if(m){for(var p=0;p<z.facet.field[0].feature.length;p++){var f=z.facet.field[0].feature[p];if(f.value===l.value){l.guid=f.guid}}}switch(z.facet.field[0].name){case"province_code":case"province":case"ancestor_province":if(r!=undefined&&z.maptype=="world"){var t="CN";l.value=t;l.text=t;if(z.facet.field[0].name.indexOf("_code")>-1){if(z.facet.field[0].name.indexOf("users_")>-1){u="users_country_code"}else{u="country_code"}}else{if(z.facet.field[0].name.indexOf("ancestor_")>-1){u="ancestor_country"}else{u="country"}}}break;case"city":case"district":case"ancestor_city":case"ancestor_district":case"city_code":case"district_code":case"users_district_code":case"users_city_code":if(r!=undefined){if(z.maptype=="world"){var t="CN";l.value=t;l.text=t;if(z.facet.field[0].name.indexOf("_code")>-1){if(z.facet.field[0].name.indexOf("users_")>-1){u="users_country_code"}else{u="country_code"}}else{if(z.facet.field[0].name.indexOf("ancestor_")>-1){u="ancestor_country"}else{u="country"}}}else{if(z.maptype=="china"){var t=n.text.substr(0,2)+"0000";l.value=t;l.text=n.text;if(z.facet.field[0].name.indexOf("_code")>-1){if(z.facet.field[0].name.indexOf("users_")>-1){u="users_province_code"}else{u="province_code"}}else{if(z.facet.field[0].name.indexOf("ancestor_")>-1){u="ancestor_province"}else{u="province"}}}else{var t=n.text.substr(0,4)+"00";l.value=t;l.text=n.text;if(z.facet.field[0].name.indexOf("_code")>-1){if(z.facet.field[0].name.indexOf("users_")>-1){u="users_city_code"}else{u="city_code"}}else{if(z.facet.field[0].name.indexOf("ancestor_")>-1){u="ancestor_city"}else{u="city"}}}}}break;default:break}e="value_text_object"}else{switch(z.facet.field[0].name){case"country":case"province":case"ancestor_country":case"ancestor_province":case"country_code":case"province_code":case"ancestor_business":case"business":case"account":case"ancestor_account":case"users_country_code":case"users_province_code":l.value=n.text;l.text=n.alias;e="value_text_object";break;case"city":case"district":case"ancestor_city":case"ancestor_district":case"city_code":case"district_code":case"users_district_code":case"users_city_code":if(r!=undefined){var t=n.text.substr(0,2)+"0000";l.value=t;l.text=n.text;if(z.facet.field[0].name.indexOf("_code")>-1){if(z.facet.field[0].name.indexOf("users_")>-1){u="users_province_code"}else{u="province_code"}}else{if(z.facet.field[0].name.indexOf("ancestor_")>-1){u="ancestor_province"}else{u="province"}}}else{l.value=n.text;l.text=n.alias}e="value_text_object";break;case"combinWord":case"ancestor_combinWord":case"wb_topic_combinWord":case"ancestor_wb_topic_combinWord":var k=new RegExp(" ","g");l=n.text.replace(k,",");e="string";break;case"repost_trend_cursor":l={start:n.text,end:n.text};e="range";$.each(z.filtervalue,function(E,F){if(F.fieldname=="repost_trend_cursor"){F.fieldvalue.value=l;g=false}});break;default:l=n.text;e="string";break}}if(A==0){if(g){a.push(createFiltervalue(u,e,l,0,m))}}else{if(A==1){var b=z.facet.field[0].feature;$(b).each(function(E,F){a.push(createFiltervalue(u,"value_text_object",F,0,m,1))})}else{if(A==2){var D=[];$(z.facet.field[0].filter).each(function(F,G){if(G.type=="include"){for(var E=0;E<G.value.length;E++){if(e=="value_text_object"){D.push(G.value[E])}else{D.push(G.value[E].value)}}}});$(D).each(function(E,F){a.push(createFiltervalue(u,e,F,0,m,1))})}}}z.output.orderby=facettype2orderby(z.facet.field[0].facettype);z.output.ordertype="desc"}var y=z.filtervalue.length;if(a.length>0){z.filtervalue=z.filtervalue.concat(a)}if(z.filterrelation!=null&&z.filterrelation.opt!=undefined){if(z.filterrelation.opt=="or"){var v=deepClone(z.filterrelation);z.filterrelation={};z.filterrelation.opt="and";z.filterrelation.filterlist=[];z.filterrelation.filterlist.push(v);z.filterrelation.fields=[]}for(var p=y;p<z.filtervalue.length;p++){z.filterrelation.fields.push(p)}}else{initFilterRelation(z)}if(z.classifyquery!=null&&d){if(typeof(d.categoryvalue)=="string"){if(d.categoryvalue=="sum"){return false}else{if(d.categoryvalue=="all"){z.classifytype="all"}else{if(d.categoryvalue=="other"){z.classifytype="other"}}}}else{$.each(z.filtervalue,function(E,F){if(F.fieldname==z.classifyquery.fieldname){if(F.fieldvalue.datatype=="array"){F.fieldvalue=d.categoryvalue;if(d.categoryvalue.exclude&&typeof(d.categoryvalue.exclude)!="undefined"){F.exclude=d.categoryvalue.exclude}}}})}z.classifyquery=null}return z}function checkIsShow(a,b){if(b.classifyquery!=null&&b.classifyquery.fieldname==a){return false}if(b.filter[a].isshow&&b.filter[a].allowcontrol!=1&&b.filter[a].allowcontrol!=0){if(b.filter[a].limit.length>0){switch(b.filter.datatype){case"int":case"string":if(b.filter[a].limit.length>1){return true}else{return false}break;default:return true;break}}else{return true}}else{return false}}function getDrilldownAuth(){$.ajax({url:config.checkDrilldownUrl,type:"GET",dataType:"json",async:false,success:function(a){config.allowdrilldown=a.allowdrilldown;config.allowdownload=a.allowdownload;config.allowupdatesnapshot=a.allowupdatesnapshot;config.alloweventalert=a.alloweventalert;config.allowwidget=a.allowwidget;config.allowvirtualdata=a.allowvirtualdata;config.allowoverlay=a.allowoverlay;config.allowlinkage=a.allowlinkage;config.selfstyle=a.selfstyle},error:function(){alert("数据请求异常!")}})}function createOnsiteFieldParentHtml(h,g,c,e,d){var f="";if(c==undefined){c="button"}var b="";if(e!=undefined){b="dockfieldeleid='"+e+"'"}var a="";if(d!=undefined){a="style='color:"+d+"'"}f+="<div style='margin:3px;'><span id='"+h+"_"+g+"_docked_span' style='float: right;'><input type='checkbox' name='"+h+"_"+g+"_docked' id='"+h+"_"+g+"_docked' dockfield="+g+" "+b+" docktype="+c+" /><label for='"+h+"_"+g+"_docked' "+a+">停靠</label></span><span id='"+h+"_"+g+"'></span></div>";return f}function createValueTextOnsiteFieldHtml(f,e,b,c){var d="";if(b==""||b==undefined){b="地区"}var a="";if(c!=undefined){a="color:"+c+";"}d+="<div style='margin:3px;'><span id='"+f+"_"+e+"'><input type='button' value='增加"+b+"' id='"+f+"_"+e+"_btn' style='border:1px solid #ccc;"+a+"' /></span></div><span id='"+f+"_selected"+e+"'></span>";return d}function createOnsiteFieldHtml(g,m,a,c,d,k,e){var f="";var l="";if(d){l="_dock"}var h="checkbox";if(k){h=k}var b="";if(e!=undefined){b="style='color:"+e+"'"}f+="<input type='"+h+"' name='"+g+l+"_"+m+"' id='"+g+l+"_"+m+""+c+"' value="+c+" class='outborder' filtervalue='"+m+"'/><label for='"+g+l+"_"+m+""+c+"' "+b+"> "+a+" </label>&nbsp;&nbsp;";return f}function setOnsiteFieldValue(e,d,c,a,f){var b="";if(f){b="_dock"}$("input[name="+e+b+"_"+d+"]").attr("checked",false);$.each(c,function(k,g){var h=g.fieldvalue.value;if(d=="verified"){h=setVerifiedVal(g.fieldvalue.value)}$("#"+e+b+"_"+d+""+h).attr("checked",true)})}function setVerifiedVal(a){return"verify_"+a}function getVerifiedVal(b){if(b.toString().indexOf("verify_")>-1){var a=b.split("verify_");return a[1]}else{return b}}function dialogAlert(q,c,o){var h="";var m=Math.round(Math.random()*100000);var p="alertdiv"+m;h+='<div id="'+p+'" style="position:absolute;display:none;z-index:9999;background-color:#000000;border:1px solid #cccccc;font-size: 12px; width:264px;opacity:0.6;filter:alpha(opacity=60);text-align:right;text-align:middle;"></div>';$("div[id^='alertdiv']").each(function(){if($(this).text()==c){$(this).remove()}});var r="editelementdiv";if(o!=undefined){r="updatescheddiv"}$("#"+r+"").append(h);$("#"+p+"").unbind("click");$("#"+p+"").bind("click",function(){$("#"+p+"").remove()});$("#"+p+"").empty().append("<span style='color:red;'>"+c+"</span>");var a=q.parents("div[name=accordiondiv]").length;if(a>0){var d=q.parents("div[name=accordiondiv]").accordion("option","active");if(d===false){q.parents("div[name=accordiondiv]").accordion("option","collapsible",true);q.parents("div[name=accordiondiv]").accordion("option","active",0)}}var l=$("#tabdiv");var g=0,f=0;if(l.length>0){var e=l.offset();f=q.offset().top-e.top}else{f=q.offset().top}g=-1;if(q.parents().find($("#add_range_classifyquery_div")).length>0){g=q.offset().left-e.left}$("#"+p+"").css({top:f+"px",left:g+"px",display:"block"});var b=q.width();var n=q.height();$("#"+p+"").css({width:b,height:n});if($("#editdiv").length>0){$("#editdiv").scrollTop(f-$(window).height()/3)}var k=$("#"+p+"").offset().top-$(window).scrollTop();if(k<0){$(window).scrollTop($(window).scrollTop()+k)}}function fadeDialogAlert(d,g){var e="";var c=Math.round(Math.random()*100000);var f="fadealertdiv"+c;e+='<div id="'+f+'" class="ui-state-highlight ui-corner-all" style="position:absolute;display:none;z-index:9999;background-color:#000000;border:1px solid #cccccc;font-size: 12px; width:264px;opacity:0.8;filter:alpha(opacity=80);"><p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span><span id="msg"></span></p></div>';if($("div[id^='fadealertdiv']").text()!=g){$("body").append(e)}$("#"+f+" #msg").text(g);var b,a;a=d.position().top;b=d.position().left;$("#"+f+"").css({top:a+"px",left:b+"px",display:"block",width:d.width(),height:"30px"});$("#"+f+"").show().delay(2000).hide(400,function(){$(this).remove()})}function getFilterValueTime(f){var v={};var r=getFilterValue("createdtime",f.filtervalue,f.filter.createdtime.datatype);var e=getFilterValue("nearlytime",f.filtervalue,f.filter.nearlytime.datatype);var u=getFilterValue("beforetime",f.filtervalue,f.filter.beforetime.datatype);var o=getFilterValue("untiltime",f.filtervalue,f.filter.untiltime.datatype);if(r.length>0){v.start=r[0].fieldvalue.value.start;v.end=r[0].fieldvalue.value.end}else{if(e.length>0){var s=e[0].fieldvalue.value.start;var p=e[0].fieldvalue.value.startgap;v.start=strtotime("-"+s+" "+p+"");v.end=strtotime("now")}else{if(u.length>0){var g=u[0].fieldvalue.value.start;var m=u[0].fieldvalue.value.end;var a=u[0].fieldvalue.value.endgap;v.start=strtotime("-"+g+" "+a+"");v.end=strtotime("-"+m+" "+a+"")}else{if(o.length>0){var c=o[0].fieldvalue.value.start.start;var n=o[0].fieldvalue.value.start.startgap;var t=o[0].fieldvalue.value.start.startthisgap;var b=o[0].fieldvalue.value.start.startto;var q=o[0].fieldvalue.value.start.starttogap;var k=o[0].fieldvalue.value.end.end;var l=o[0].fieldvalue.value.end.endgap;var d=o[0].fieldvalue.value.end.endthisgap;var h=o[0].fieldvalue.value.end.endto;var w=o[0].fieldvalue.value.end.endtogap;v.start=sinceToThis(c,n,t,b,q,"beginning");v.end=sinceToThis(k,l,d,h,w,"ending")}}}}return v}function getFieldText(e,b){if(b==undefined||b==null||b.length==0){return b}var a;var d=0;if(e.indexOf("emo")>-1){d=1}switch(e){case"country_code":case"province_code":case"city_code":case"district_code":case"country":case"province":case"city":case"district":case"ancestor_country":case"ancestor_province":case"ancestor_city":case"ancestor_district":case"emoCountry":case"emoProvince":case"emoCity":case"emoDistrict":case"ancestor_emoCountry":case"ancestor_emoProvince":case"ancestor_emoCity":case"ancestor_emoDistrict":a="area";break;case"emoBusiness":case"ancestor_emoBusiness":case"business":case"ancestor_business":a="business";break;case"account":case"ancestor_account":case"emoAccount":case"ancestor_emoAccount":case"userid":case"users_id":a="account";break;default:break}if(a==undefined){return b}else{var c=b;$.ajax({url:config.dataUrl+"?type=getfieldtext&isemo="+d+"&valuetype="+a,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(b),async:false,success:function(f){c=f},error:function(){alert("数据请求异常!")}});return c}}function fieldvalueIsInPindata(a,b){var c=false;var d=b.outputdata.value;if(a.datatype=="dynamic"){c=a.outelementid==b.outelementid&&a.outputfield==b.outputdata.outputfield&&a.value.start==b.outputdata.value.start&&a.value.end==b.outputdata.value.end}else{$(d).each(function(e,f){if(a.datatype=="value_text_object"){c=a.value.value==f.value}else{c=a.value==f.value}if(c){return false}})}return c}function getRealPinvalue(c,b){var a;if(b=="value_text_object"){a=c}else{a=c.value}return a}function refreshFilterValue(f,a,b){var d=0;for(var e=a.filtervalue.length-1;e>-1;e--){var g=a.filtervalue[e];if(g.fieldname==f.inputdata.value){if(g.fieldvalue.datatype=="array"){for(var c=0;c<g.fieldvalue.value.length;c++){if(fieldvalueIsInPindata(g.fieldvalue.value[c],f)){if(b[d]!=undefined){g.fieldvalue.value[c]=getRealPinvalue(b[d]);d++}else{g.fieldvalue.value.splice(c,1)}}}}}else{if(fieldvalueIsInPindata(g.fieldvalue,f)){if(b[d]!=undefined){g.fieldvalue.value=getRealPinvalue(b[d]);d++}else{a.filtervalue.splice(e,1)}}}}}function appendStaticPin2Filtervalue(h,a){var e=a.inputdata.value;if((e=="include"||e=="exclude")&&h.facet.field.length>0){if(h.facet.field[0].filter==undefined||h.facet.field[0].filter.length==0){h.facet.field[0].filter=[];h.facet.field[0].filter.push({type:e,value:a.outputdata.value})}else{var g=null;for(var c=0;c<h.facet.field[0].filter.length;c++){if(h.facet.field[0].filter[c].type==e){g=h.facet.field[0].filter[c];break}}if(g==null){h.facet.field[0].filter.push({type:e,value:a.outputdata.value})}else{for(var f=0;f<a.outputdata.value.length;f++){var l=false;for(var b=0;b<g.value.length;b++){if(g.value[b].value==a.outputdata.value[f].value){l=true;break}}if(!l){g.value.push(a.outputdata.value[f])}}}}return true}var m=h.filtervalue;var d=a.inputdata.datatype;if(h.contrast&&h.contrast.fieldname==a.inputdata.value){m=dataJson.contrast.filtervalue}if(h.classifyquery&&h.classifyquery.fieldname==a.inputdata.value){$(h.filtervalue).each(function(r,p){if(p.fieldname==h.classifyquery.fieldname&&p.fieldvalue.datatype=="array"){for(var n=0;n<a.outputdata.value.length;n++){var o=a.outputdata.value[n];var q={datatype:a.inputdata.datatype};if(q.datatype=="value_text_object"){q.value=o}else{q.value=o.value}if(a.outputdata.exclude){q.exclude=1}h.filtervalue[r].fieldvalue.value.push(q)}if(a.outputdata.isfeature){h.filtervalue[r].isfeature=1}return false}})}else{$(a.outputdata.value).each(function(o,k){var n=false;$(m).each(function(s,r){var q;if(d=="value_text_object"){q=r.fieldvalue.value.value}else{q=r.fieldvalue.value}if(q==k.value){n=true;return false}});if(n){return true}var p;if(d=="value_text_object"){p=createFiltervalue(a.inputdata.value,d,k,0)}else{p=createFiltervalue(a.inputdata.value,d,k.value,0)}if(a.outputdata.exclude){p.exclude=1}if(a.outputdata.isfeature){p.isfeature=1}m.push(p)})}}function appendDynamicPin2Filtervalue(b,a){var e=createFiltervalue(a.inputdata.value,"dynamic",a.outputdata.value,0);if(a.outputdata.isfeature){e.isfeature=1}if(a.outputdata.exclude){e.exclude=1}e.fieldvalue.outelementid=a.outelementid;e.fieldvalue.outputfield=a.outputdata.outputfield;if(b.contrast&&b.contrast.fieldname==a.inputdata.value){b.contrast.filtervalue.push(e)}else{if(b.classifyquery&&b.classifyquery.fieldname==a.inputdata.value){var d=false;a.outputdata.value.exclude=a.outputdata.exclude;$(b.filtervalue).each(function(g,f){if(f.fieldname==a.inputdata.value&&f.fieldvalue.datatype=="array"){b.filtervalue[g].fieldvalue.value.push({datatype:"dynamic",value:a.outputdata.value,outelementid:a.outelementid,outputfield:a.outputdata.outputfield});if(a.outputdata.isfeature){b.filtervalue[g].isfeature=1}d=true;return false}});if(!d){var c={fieldname:a.inputdata.value,fieldvalue:{datatype:"array",value:[]}};if(a.outputdata.isfeature){c.isfeature=1}c.fieldvalue.value.push({datatype:"dynamic",value:a.outputdata.value,outelementid:a.outelementid,outputfield:a.outputdata.outputfield});b.filtervalue.push(c)}}else{b.filtervalue.push(e)}}}function isLinkage(b){var a=false;if(window.currInstance.instanceType==2){a=true}else{if(b!=undefined){if(window.currInstance.instanceType==3&&b.subInstanceType==2){a=true}}}return a}function removeDynamicPinFiltervalue(c){if(c.filtervalue!=null){for(var b=c.filtervalue.length-1;b>-1;b--){var d=c.filtervalue[b];if("dynamic"==d.fieldvalue.datatype){c.filtervalue.splice(b,1)}else{if("array"==d.fieldvalue.datatype){for(var a=d.fieldvalue.value.length-1;a>-1;a--){if("dynamic"==d.fieldvalue.value[a].datatype){c.filtervalue[b].fieldvalue.value.splice(a,1)}}}}}}if(c.contrast){for(var b=c.contrast.filtervalue.length-1;b>-1;b--){var d=c.contrast.filtervalue[b];if("dynamic"==d.fieldvalue.datatype){c.contrast.filtervalue.splice(b,1)}}}}function checkClassifyQueryCount(a){var b=0;if(a.contrast){$.each(a.contrast.filtervalue,function(c,d){if(d.fieldvalue.datatype=="dynamic"){if(d.fieldvalue.value.start!=null&&d.fieldvalue.value.end!=null){b+=(d.fieldvalue.value.end-d.fieldvalue.value.start+1)}}else{b++}})}else{if(a.classifyquery){$.each(a.filtervalue,function(c,d){if(d.fieldvalue.datatype=="array"){$.each(d.fieldvalue.value,function(f,e){if(e.datatype=="dynamic"&&e.value.start!=null&&e.value.end!=null){b+=(e.value.end-e.value.start+1)}else{b++}})}else{b++}})}}return b<=config.maxClassifyQueryCount}function rollbackDynamicPin(b,a){var c=b.getLinkedOutputPin("dynamic");$(c).each(function(e,d){appendDynamicPin2Filtervalue(a,d)})}function modelshowDisplay(a){$("#modelshow_span_"+a+"").css("display","inline-block")}function modelshowHide(b,a){var c="modelshow";if(a){c=a}$("#"+c+"_span_"+b+"").css("display","none");$("#"+c+"_"+b+"").attr("checked",false)}function mslineShow(){$("#modelshow_ul a[href='#modelshow_msline']").parent().css("display","");modelshowDisplay("fullscreenmslinechart");modelshowDisplay("bigmslinechart");modelshowDisplay("smallmslinechart")}function mslineHide(){$("#modelshow_ul a[href='#modelshow_msline']").parent().css("display","none");$("#modelshow_msline input[type=checkbox]").attr("checked",false);modelshowHide("fullscreenmslinechart");modelshowHide("bigmslinechart");modelshowHide("smallmslinechart");checkSelectedTab()}function radarShow(){$("#modelshow_ul a[href='#modelshow_radar']").parent().css("display","");modelshowDisplay("fullscreenradarchart");modelshowDisplay("bigradarchart");modelshowDisplay("smallradarchart")}function radarHide(){$("#modelshow_ul a[href='#modelshow_radar']").parent().css("display","none");$("#modelshow_radar input[type=checkbox]").attr("checked",false);modelshowHide("fullscreenradarchart");modelshowHide("bigradarchart");modelshowHide("smallradarchart");checkSelectedTab()}function influenceShow(){$("#modelshow_ul a[href='#modelshow_influence']").parent().css("display","");modelshowDisplay("userfollowers")}function influenceHide(){$("#modelshow_ul a[href='#modelshow_influence']").parent().css("display","none");modelshowHide("userfollowers")}function setjQueryButtonStyle(a){var b="modelshow_";if(a){b=a}$("#"+b+"group_div").buttonset();$("#"+b+"group_div").find("label").css({width:"100%","text-align":"center","border-radius":"0"});$("#"+b+"ul li").css("display","")}function hideTab(a){var b="modelshow_";if(a){b=a}$("#"+b+"group_div").children("div").each(function(d,c){var e=false;$(c).children().each(function(f,h){var g=$(h).css("display");if(g!="none"){e=true;return false}});if(!e){$("#"+b+"ul a[href='#"+$(this).attr("id")+"']").parent().css("display","none")}})}function checkSelectedTab(c){var e="modelshow_";if(c){e=c}var b=$("#"+e+"div").tabs("option","selected");var a=b+1;var d=$("#"+e+"ul li:nth-child("+parseInt(a,10)+")");if(d.css("display")=="none"){$("#"+e+"div").tabs("select",0)}}function setmodelshowGroupActive(e){var a=$("input[name=modelshow_showtype]:checked").length;if(a>0){setGroupActiveAttr("#modelshow_div")}$("#modelshow_group_div").buttonset();$("#modelshow_group_div").find("label").css({width:"100%","text-align":"center","border-radius":"0"});setModelshowGroupTabBorder(e);var d=$("input[name=modelshow_showtype]:checked").first().attr("value");var b=$("#modelshow_"+d+"").parents("div").first().attr("id");var c=$("#modelshow_ul a[href='#"+b+"']").parent().css("display");if(c!="none"){$("#modelshow_div").tabs("select",b)}}function setModelshowGroupTabBorder(f,b){var d=false;var a=$("input[name=modelshow_showtype]:checked");a.each(function(){var h=$(this).attr("value");var g=$("#modelshow_"+h+"").parents("div").first().attr("id");if(g=="modelshow_list"){d=true}$("#modelshow_ul a[href='#"+g+"']").parent().css({border:"1px solid #0D09D9"})});if(a.length>0){var c;if(!d||(f!=undefined&&!f.output.pageable)){$("input[id^=dataconfig_][id$=page0]").attr("checked",true);if(f!=undefined){f.output.pageable=false;c="start_end"}}else{$("input[id^=dataconfig_][id$=page1]").attr("checked",true);if(f!=undefined){f.output.pageable=true;c="perpagenum"}}if(f!=undefined){var e;switch(f.modelid){case 1:e="foltop_config";break;case 2:e="user_config";break;case 31:e="topic_config";break;case 51:e="weibo_config";break;default:break}if(b==false){outputDataLimitChangeBorder(e,c)}else{outputDataLimitChangeBorder(e,c,f.output)}}}}function setOutputDatalimitNum(e,a){var d=a.data_limit+1;$("#"+e+"_output_start_num").val(d);if(d>1){setGroupActiveAttr("#"+e+"_output_start_num")}var b=a.count;$("#"+e+"_output_perpage_num").val(b);if(a.data_limit!=null&&a.data_limit!=undefined){if(a.allowcontrol==0){$("#"+e+"_limit_span").empty();$("#"+e+"_limit_span").append("<label>"+a.data_limit+"</label>")}else{if(a.allowcontrol==1){$("#"+e+"_limit_span").parent().css("display","none")}else{var d=a.data_limit+1;$("#"+e+"_limit").val(d)}}}if(a.count!=null&&a.count!=undefined){if(a.allowcontrol==0){$("#"+e+"_orderword_span").empty();$("#"+e+"_orderword_span").append("<label>"+a.count+"</label>")}else{if(a.allowcontrol==1){$("#"+e+"_orderword_span").parent().css("display","none")}else{var c=parseInt(a.data_limit,10)+parseInt(a.count,10);$("#"+e+"_orderword").val(c)}}}}function getOutputPerpageNum(e){var a=true;var f;var c;if($("input[name="+e+"_output_start_num]").val().length>0){if(!testPositiveInt($("input[name="+e+"_output_start_num]").val(),9)){dialogAlert($("#"+e+"_output_start_num_span").parents().first(),"起始条数输入值不合法,请输入小于9位(包含)的正整数!");a=false;$("input[name="+e+"_output_start_num]").focus()}}else{dialogAlert($("#"+e+"_output_start_num_span").parents().first(),"请输入起始条数");a=false;$("input[name="+e+"_output_start_num]").focus()}var d=$("#"+e+"_output_start_num").val();if(d.length>0){f=d-1}else{dialogAlert($("#"+e+"_output_start_num").parents("div").first(),"请输入起始条数!");a=false;$("input[name="+e+"_output_start_num]").focus()}if(!testPositiveInt($("input[name="+e+"_output_perpage_num]").val(),9)){dialogAlert($("#"+e+"_output_perpage_num").parents().first(),"起始条数输入值不合法,请输入小于9位(包含)的正整数!");a=false;$("input[name="+e+"_output_perpage_num]").focus()}var b=$("#"+e+"_output_perpage_num").val();if(b.length>0){c=b}else{dialogAlert($("#"+e+"_output_perpage_num").parents("div").first(),"请输入每页显示条数!");a=false;$("input[name="+e+"_output_perpage_num]").focus()}return{data_limit:f,count:c,outputcorrect:a}}function getOutputStartEndNum(e){var a=true;var f;var c;if($("input[name="+e+"_limit]").val().length>0){if(!testPositiveInt($("input[name="+e+"_limit]").val(),9)){dialogAlert($("#"+e+"_limit_span").parents().first(),"起始条数输入值不合法,请输入小于9位(包含)的正整数!");a=false;$("input[name="+e+"_limit]").focus()}}else{dialogAlert($("#"+e+"_limit_span").parents().first(),"请输入起始条数");a=false;$("input[name="+e+"_limit]").focus()}var d=parseInt($("input[name="+e+"_limit]").val());if(d==0){dialogAlert($("#"+e+"_limit_span").parents("div").first(),"起始条数从1开始!");a=false;$("input[name="+e+"_limit_span]").focus()}f=d-1;if($("input[name="+e+"_orderword]").val().length>0){if(!testPositiveInt($("input[name="+e+"_orderword]").val(),9)){dialogAlert($("#"+e+"_orderword_span").parents().first(),"终止条数输入值不合法,请输入小于9位(包含)的正整数!!");a=false;$("input[name="+e+"_orderword]").focus()}}else{dialogAlert($("#"+e+"_orderword_span").parents().first(),"请输入终止条数!");a=false;$("input[name="+e+"_orderword]").focus()}var b=parseInt($("input[name="+e+"_orderword]").val());c=b-d+1;if(d>b){dialogAlert($("#"+e+"_limit_span").parents("div").first(),"起始条数应小于结束条数!");a=false}return{data_limit:f,count:c,outputcorrect:a}}function setGroupActiveAttr(a){$(a).parents("div[name=accordiondiv]").attr("active",0).attr("hasvalue",1)}function setGroupDormantAttr(a){$(a).removeAttr("active").removeAttr("hasvalue")}function setAccordionGroup(a){var b=$(a);b.accordion("destroy");b.each(function(d,g){var h=$(g).find("[formcontrol=1]").length;if($(g).find("[formcontrol=1]").length>0){var f=0;$(g).find("[formcontrol=1]").each(function(l,m){if($(m).css("display")=="none"){f++}});if(f==h){$(g).css("display","none")}}var k=false;var e=$(g).attr("active");if(e!=undefined){k=parseInt(e,10)}$(g).accordion({active:k,collapsible:true});$(g).children("h3").removeClass("ui-state-active").addClass("ui-state-default");var c="#555555";if($(g).attr("hasvalue")){c="#E17009"}$(g).children("h3").children("a").css({color:c,outline:"none","text-decoration":"none"})});b.children("div").css({height:"auto",border:0,padding:0,"border-top":"1px solid #A6C9E2","border-bottom":"1px solid #A6C9E2","border-radius":"0",overflow:"visible"});b.children("h3").css({border:"0","margin-top":"2px","line-height":"1","background-color":""});$("#type_facet").parent("div").css({border:"0"})}function getShowType(c){var a=[];var b="modelshow_";if(c){b=c}$("input[name="+b+"showtype]:checked").each(function(g,d){var k=$(d).attr("value");var e=$("#"+b+k).parents("div").first().attr("id");var h=$("#"+b+"ul a[href='#"+e+"']").parent().css("display");if(h!="none"){var f={};f.showtype=$(this).val();f.displaycontent=[];$("input[name="+b+"listcontent_"+$(this).val()+"]").each(function(l,m){if($(m).prop("checked")){f.displaycontent.push($(m).val())}});f.repostpagesize=$("input[name="+b+"listcontent_"+$(this).val()+"_repost_pagesize]").val();f.commentpagesize=$("input[name="+b+"listcontent_"+$(this).val()+"_comment_pagesize]").val();f.scatterXY={};f.scatterXY.x=$("select[name="+b+"listcontent_"+$(this).val()+"_X]").val();f.scatterXY.y=$("select[name="+b+"listcontent_"+$(this).val()+"_Y]").val();f.maptype=$("select[name="+b+"listcontent_"+$(this).val()+"_maptype]").val();f.linetype=$("input[name="+b+"listcontent_"+$(this).val()+"_linetype]:checked").val();a.push(f)}});return a}function getLabelNameValue(c,b){var a="";if(c[b]!=undefined){a=c[b]}else{if(c.alias!=undefined){a=c.alias}else{if(c.text!=undefined){a=c.text}}}return a}function outputDataLimitChangeBorder(c,b,a){if(b=="perpagenum"){$("#"+c+"_output_datafilter").attr("checkedoutputdata","perpagenum");$("#"+c+"_output_perpage_num").parents("div").first().css("display","");$("#"+c+"_limit").parents("div").first().css("display","none")}else{if(b=="start_end"){$("#"+c+"_output_datafilter").attr("checkedoutputdata","start_end");$("#"+c+"_limit").parents("div").first().css("display","");$("#"+c+"_output_perpage_num").parents("div").first().css("display","none")}}if(a!=undefined){setOutputDatalimitNum(c,a)}}function getVerifiedImg(c,b){if(c!=undefined&&(parseInt(c,10)==1||parseInt(c,10)==3)){var a='<img src="images/v1.png" align="absmiddle" />';if(b!=undefined&&b!=""&&b!=null){if(parseInt(b,10)===0){a='<img src="images/v1.png"  align="absmiddle" />'}else{if(parseInt(b,10)>=1&&parseInt(b,10)<=7||parseInt(b,10)==-2){a='<img src="images/v2.png"  align="absmiddle" />'}else{a='<img src="images/v1.png"  align="absmiddle" />'}}}return a}else{if(c!=undefined&&(parseInt(c,10)==0||parseInt(c,10)==2)){var a="";if(b!=undefined&&b!=""&&b!=null){if(parseInt(b,10)>=210){a='<img src="images/star.png"  align="absmiddle" />'}}return a}else{return false}}}function formatPieDataCom(a,d){if(a.modelid==6){if(d.length==1){var c=[];$.each(d,function(g,f){var h=f.datalist.length;var l={};l.totalcount=h;l.categoryname="";l.datalist=[];$.each(f.datalist,function(n,k){var o={};o.label=k.text;o.value=k.frq;l.datalist.push(o)});c.push(l)})}else{var c=[];var e={};e.totalcount=d.length;e.categoryname="";e.datalist=[];$.each(d,function(g,f){var k={};var h=f.categoryname;k.label=h;k.value=f.totalcount;e.datalist.push(k)});c.push(e)}return c}var b="";if(a.facet.range!=undefined&&a.facet.range.length>0){b=a.facet.range[0].name}switch(b){case"reposts_count":case"comments_count":case"direct_comments_count":case"praises_count":case"paragraphid":case"trample_count":case"satisfaction":case"godRepPer":case"midRepPer":case"wosRepPer":case"godRepNum":case"midRepNum":case"wosRepNum":case"apdRepNum":case"showPicNum":case"cmtStarLevel":case"proOriPrice":case"proCurPrice":case"proPriPrice":case"stockNum":case"salesNumMonth":case"operateTime":case"compDesMatch":case"logisticsScore":case"serviceScore":case"purchDate":case"question_id":case"answer_id":case"child_post_id":case"question_father_id":case"answer_father_id":case"floor":case"read_count":case"level":case"total_reposts_count":case"total_reach_count":case"followers_count":case"direct_reposts_count":case"register_time":case"created_at":case"created_year":case"created_month":case"created_day":case"created_hour":case"created_weekday":case"users_followers_count":case"users_friends_count":case"users_statuses_count":case"users_favourites_count":case"users_bi_followers_count":case"users_created_at":case"users_replys_count":case"users_recommended_count":case"users_level":var c=[];$.each(d,function(h,g){var l=g.datalist.length;var n={};n.totalcount=l;n.categoryname="";n.datalist=[];if(g.before!=undefined){var m={};m.label=getOtherAlias("before");var f=getValueName(a);m.value=g.before[f];m.tmpx=rangeTmpxCom(g.before,1);n.datalist.push(m)}$.each(g.datalist,function(x,q){var t;var k=a.facet.range;if(k!=undefined&&k.length>0&&k[0].tag!=undefined&&k[0].tag.x!=undefined){if(k[0].tag.x.type=="list"){t=k[0].tag.x.value[x]}else{var o=calcRangeLabel(g.datalist[x],k[0].tag,"x",x);t=o}}else{if(b=="created_at"){t=formatTime("yyyy-MM-dd",q.range)}else{t=q.alias}}var r={};r.label=t;var u=getValueName(a);r.value=q[u];var v=a.facet;var p=1;var w=getGapCount(v);var s=g.datalist.length;if(s==x+1&&parseInt(a.output.count,10)>=parseInt(w,10)){p=3}r.tmpx=rangeTmpxCom(q,p);n.datalist.push(r)});if(g.after!=undefined){var m={};m.label=getOtherAlias("after");var f=getValueName(a);m.value=g.after[f];m.tmpx=rangeTmpxCom(g.after,2);n.datalist.push(m)}c.push(n)});break;default:var c=[];var e={};e.totalcount=d.length;e.categoryname="";e.datalist=[];$.each(d,function(k,f){var n={};var l=f.categoryname;var h=a.filtervalue;var g=getClassifyRangeTag(h);if(g!=""){if(g.x.type!="list"){if(f.categoryvalue.value!=undefined){l=calcRangeLabel(f.categoryvalue.value.value,g,"x",k)}}}n.label=l;n.value=f.totalcount;e.datalist.push(n)});c.push(e);break}return c}function checkSuitableXcombined(d){var b=true;var a={};var c=0;$.each(d,function(f,e){if(e.datalist.length>c){c=e.datalist.length;a=e}});$.each(d,function(f,e){if(e.before!=undefined){if(e.before.rangeend!=a.before.rangeend){b=false;return false}}$.each(e.datalist,function(g,h){if(h.range!=undefined||h.rangeend!=undefined){if(h.range!=a.datalist[g].range||h.rangeend!=a.datalist[g].rangeend){b=false;return false}}else{if(h.text!=undefined){if(h.text!=a.datalist[g].text){b=false;return false}}}});if(e.after!=undefined){if(e.after.range!=a.after.range){b=false;return false}}if(!b){return false}});return b}function getRatioConvertData(g,a){var d=getFieldList(a,true);var b=getFieldList(a,true);var f=getFieldList(a,true);var e=[];if(d.length>0){$.each(d,function(h,k){if(!e.inArray(k.value)){e.push(k.value)}})}if(b.length>0){$.each(b,function(k,h){if(!e.inArray(h.value)){e.push(h.value)}})}if(f!=undefined&&f.length>0){$.each(f,function(h,k){if(!e.inArray(k.value)){e.push(k.value)}})}var c=deepClone(g);$.each(c,function(l,h){var k=h.referencedataratio?h.referencedataratio:1;if(h.before!=undefined){$.each(e,function(n,m){if(h.before[m]!=undefined){h.before[getRealDataField(m)]=h.before[m];h.before[m]=h.before[m]*k}})}if("datalist" in h){$.each(h.datalist,function(m,n){$.each(e,function(p,o){if(n[o]!=undefined){if(o!="alias"&&o!="text"){h.datalist[m][getRealDataField(o)]=n[o];h.datalist[m][o]=n[o]*k}}})})}if(h.after!=undefined){$.each(e,function(n,m){if(h.after[m]!=undefined){h.after[getRealDataField(m)]=h.after[m];h.after[m]=h.after[m]*k}})}});return c}function getRealDataField(a){return"real_"+a}function getCurrSnapshotData(){var a=null;$.each(window.currInstance.elements,function(c,b){if(b.firstrequestData){a=b.firstrequestData}});return a}function getCurrPostDataJson(a,d,e){var c=a;var b=d.instanceID;$.each(window.instances,function(f,g){if(g.instanceID==b){if(e){$.each(g.elements,function(k,h){if(e==h.modelname&&h.elementType==2){c=h.dataJson;return false}})}return false}});return c}function addBeforeAfterToDatalist(b){var a=[];$.each(b,function(d,c){if(c.before!=undefined){c.before.valuetype="before";c.datalist.splice(0,0,c.before);c.before=undefined}if(c.after!=undefined){c.after.valuetype="after";c.datalist.push(c.after);c.after=undefined}a.push(c)});return a}function partialFormatXZreverse(g,a,e){var b=g;if(e.instanceType==3){var f=[];var c=[];var h={};$.each(g,function(l,k){if(h[k.categoryname]==undefined){h[k.categoryname]=[];h[k.categoryname].push(k)}else{h[k.categoryname].push(k)}});var d=e.instanceID;$.each(window.instances,function(k,l){if(l.instanceID==d){$.each(l.elements,function(p,o){if(o.elementType==2){var n=o.modelname;if(o.dataJson.classifyquery!=null&&o.dataJson.classifyquery.xzreverse){var m=formatXZreverse(h[n]);if(o.referencedata){c.splice(0,0,m)}else{if(o.secondaryyaxis){c.splice(1,0,m)}else{c.push(m)}}}else{if(o.referencedata){c.splice(0,0,h[n])}else{if(o.secondaryyaxis){c.splice(1,0,h[n])}else{c.push(h[n])}}}}});if(c.length>0){$.each(c,function(n,m){if(m!=undefined){$.each(m,function(o,p){f.push(p)})}})}return false}});b=f}else{if((a.classifyquery!=null&&a.classifyquery.xzreverse)||g[0].xzreverse){b=formatXZreverse(g)}}return b}function mainFormatXZreverse(d,c){var a=d;if(c.instanceType==3){var b=c.instanceID;$.each(window.instances,function(e,f){if(f.instanceID==b){if(f.xzreverse){a=cateFormatXZreverse(d);return false}}})}return a}function cateFormatXZreverse(f){var b=[];var d=[];var g={};$.each(f,function(o,h){var p={};var l="";if(h.categoryname!=undefined){l=h.categoryname;p.categoryname=h.categoryname;p.categoryvalue=h.categoryvalue}else{l=h.category[0].categoryname}if("referencedataratio" in h){p.referencedataratio=h.referencedataratio}if("secondaryyaxis" in h){p.secondaryyaxis=h.secondaryyaxis}if("showid" in h){p.showid=h.showid}if("xzreverse" in h){p.xzreverse=h.xzreverse}var k=0;$.each(f,function(q,s){var r="";if(s.categoryname!=undefined){r=s.categoryname}else{r=s.category[0].categoryname}if(l==r){if(s.datalist.length>k){k=s.datalist.length}}});if(g[l]==undefined){g[l]={}}if(g[l]["category"]==undefined){g[l]["category"]=[];g[l]["category"][0]=[]}if(h.categoryname!=undefined){g[l]["category"][0].push(p)}if(g[l]["datalist"]==undefined){g[l]["datalist"]={}}if(h.before!=undefined){if(g[l]["before"]==undefined){g[l]["before"]=[]}g[l]["before"].push(h.before)}for(var m=0;m<k;m++){if("category" in h){if(g[l]["category"][m]==undefined){g[l]["category"][m]=[]}g[l]["category"][m].push(h.category[m])}var n={};if(h.datalist[m]!=undefined){n=h.datalist[m]}if(g[l]["datalist"][m]==undefined){g[l]["datalist"][m]=[]}g[l]["datalist"][m].push(n)}if(h.after!=undefined){if(g[l]["after"]==undefined){g[l]["after"]=[]}g[l]["after"].push(h.after)}});var e=[];for(da in g){var a={};a.category=[];for(i in g[da]["category"]){$.each(g[da]["category"][i],function(h,k){a.category.push(k)})}if("before" in g[da]){a.before=g[da]["before"]}a.datalist=[];for(item in g[da]["datalist"]){$.each(g[da]["datalist"][item],function(h,k){a.datalist.push(k)})}if("after" in g[da]){a.after=g[da]["after"]}e.push(a)}var c=formatXZreverse(e);return c}function dataSortByLabel(c,a,b){$.each(c,function(f,d){if(d.datalist[0]&&d.datalist[0].alias==undefined){a="text"}d.datalist.sort(by(a));var g=[];$.each(d.datalist,function(k,h){$.each(b,function(l,m){if(h.alias==m.value){g[l]=h}})});for(var e=0;e<g.length;e++){if(g[e]==""||typeof(g[e])=="undefined"){g.splice(e,1);e=e-1}}d.datalist=g});return c}function hasModelxzReverse(a,d){var b=false;if(a.classifyquery!=null&&a.classifyquery.xzreverse){b=true;return b}else{var c=d.instanceID;$.each(window.instances,function(e,f){if(f.instanceID==c){$.each(f.elements,function(h,g){if(g.elementType==2){if(g.dataJson.classifyquery!=null&&g.dataJson.classifyquery.xzreverse){b=true;return false}}});if(b){return false}}})}return b}function virtualdataParams(b){var a={};a.xzreverse=b[0].xzreverse?true:false;a.xcombined=b[0].xcombined?true:false;a.columnstacking=b[0].columnstacking?true:false;return a}function overlayParams(c){var a={};if(c.instanceType==3){var b=c.instanceID;$.each(window.instances,function(d,e){if(e.instanceID==b){a.xzreverse=e.xzreverse?true:false;a.xcombined=e.xcombined?true:false;a.columnstacking=e.columnstacking?true:false}})}return a}function formatXZreverse(c){var b=0;$.each(c,function(e,d){if(d.datalist.length>b){b=d.datalist.length}});var a=[];$.each(c,function(l,f){var d={};if(f.categoryname!=undefined){d.categoryname=f.categoryname;d.categoryvalue=f.categoryvalue}if("referencedataratio" in f){d.referencedataratio=f.referencedataratio}if("secondaryyaxis" in f){d.secondaryyaxis=f.secondaryyaxis}if("showid" in f){d.showid=f.showid}if("xzreverse" in f){d.xzreverse=f.xzreverse}var e=0;if(f.before!=undefined){if(l==0){var g={};g.category=[];g.category.push(d);g.before=[];g.before.push(f.before);a.push(g)}else{a[e]["category"].push(d);a[e]["before"].push(f.before)}e++}for(var h=0;h<b;h++){if("category" in f){var m=f.category.length;var n=h%m;if(f.category[n]!=undefined){var d={};d=f.category[n]}}var k={};if(f.datalist[h]!=undefined){k=f.datalist[h]}if(l==0){var g={};g.category=[];g.category.push(d);g.datalist=[];g.datalist.push(k);a.push(g)}else{a[e+h]["category"].push(d);a[e+h]["datalist"].push(k)}}if(f.after!=undefined){e+=f.datalist.length;if(l==0){var g={};g.category=[];g.category.push(d);g.after=[];g.after.push(f.after);a.push(g)}else{a[e]["category"].push(d);a[e]["after"].push(f.after)}}});return a}function rangeTmpxCom(d,a){var b={};var c=d.range;if(d.range==undefined){c="*"}b.start=c;var f=d.rangeend;if(d.rangeend==undefined){f="*"}b.end=f;b.include=a;return b}function getClassifyRangeTag(b){var a="";$.each(b,function(d,e){if(e!=undefined&&e.fieldvalue["datatype"]=="array"){if(e.fieldvalue["value"][0]["datatype"]=="classifyrange"){var c=e.fieldvalue["value"][0]["value"];if(c.tag!=undefined&&c.tag.x!=undefined){a=c.tag}}}});return a}function tooltipComOverFun(p,h,b){if($("#temptooltip").length==0){var c="";if(b!=undefined){c="max-width:"+b+"px;"}var d="#497EB4";$("body").append('<div style="border:2px solid '+d+"; "+c+' border-radius:5px; position:absolute; z-index:3000; display:none;padding:8px;background-color:#ffffff;" id="temptooltip"></div>')}$("#temptooltip").html(p);var o=$("#temptooltip").outerWidth();var f=$("#temptooltip").outerHeight();var m=h.pageX;var l=h.pageY-f;var q=l;var k=m;var g=$(window).width();var a=k+o-g;if(a>0){k=k-a-10}var r=$(document).height();var n=q+f-r;if(n>0){q=0}if(q<0){q=0}if(k<0){k=0}$("#temptooltip").css({top:q,left:k,display:"inline-block"})}function tooltipComOutFun(){$("#temptooltip").remove()}function checkClassifyqueryOverFun(a){$("input[type=checkbox][name=contrast]:checked").each(function(){var b=$(this).attr("contrastvalue");var c=$(this).attr("contrasttype");$("#choose_classifyquery_div").remove();$("a[name="+a+"_classify_hover]").unbind("mouseover");$("#"+a+"_classify_"+b+"_"+c+"_hover").bind("mouseover",function(){chooseClassifyFun(a,b,c)})})}function chooseClassifyFun(c,a,b){$("#"+c+"_classify_"+a+"_"+b+"_arrowhover").attr("currentstate","unfolded");$("#"+c+"_classify_"+a+"_"+b+"_arrowhover").removeClass().addClass("checkarrowup");chooseClassifyqueryType(c,a,b)}function getCategoryvalueText(b){var a="";if(typeof(b)=="string"){if(b=="sum"){a="分类总计"}else{if(b=="all"){a="全部"}else{if(b=="other"){a="其他"}}}}else{if(b.datatype=="value_text_object"){a=b.value.text}else{a=b.value}}return a}function chooseClassifyqueryType(d,a,c){var b="";b+="<div id='choose_classifyquery_div' class='sigma_searcher' >";b+="<div><input type='checkbox' class='outborder' id='"+d+"_classifyquery_"+a+"_"+c+"_all' name='"+d+"_classifyquery_all' classifyfield='"+a+"' classifytype='"+c+"' /><label for='"+d+"_classifyquery_"+a+"_"+c+"_all'>全部</label></div>";b+="<div><input type='checkbox' class='outborder' id='"+d+"_classifyquery_"+a+"_"+c+"_other' classifyfield='"+a+"' name='"+d+"_classifyquery_other' classifytype='"+c+"' /><label for='"+d+"_classifyquery_"+a+"_"+c+"_other'>其他</label></div>";b+="<div><input type='checkbox' class='outborder' id='"+d+"_classifyquery_"+a+"_"+c+"_sum' classifyfield='"+a+"' name='"+d+"_classifyquery_sum' classifytype='"+c+"' /><label for='"+d+"_classifyquery_"+a+"_"+c+"_sum'>分类总计</label></div>";b+="<div><input type='checkbox' class='outborder' id='"+d+"_classifyquery_"+a+"_"+c+"_xzreverse' classifyfield='"+a+"' name='"+d+"_classifyquery_xzreverse' classifytype='"+c+"' /><label for='"+d+"_classifyquery_"+a+"_"+c+"_xzreverse'>x.z轴反转</label></div>";b+="<div><input type='checkbox' class='outborder' id='"+d+"_classifyquery_"+a+"_"+c+"_xcombined' classifyfield='"+a+"' name='"+d+"_classifyquery_xcombined' classifytype='"+c+"' /><label for='"+d+"_classifyquery_"+a+"_"+c+"_xcombined'>x轴合并</label></div>";b+="</div>";if($("#choose_classifyquery_div").length==0){$("#editelementdiv").append(b)}setClassifyqueryTypePosition(a,c);$("#"+d+"_classifyquery_"+a+"_"+c+"_xzreverse").bind("click",function(){if($(this).prop("checked")){$("#"+d+"_classifyquery_"+a+"_"+c+"_xcombined").attr("checked",false);mslineHide()}});$("#"+d+"_classifyquery_"+a+"_"+c+"_xcombined").bind("click",function(){if($(this).prop("checked")){$("#"+d+"_classifyquery_"+a+"_"+c+"_xzreverse").attr("checked",false);var e=$("#fieldstofacet input[name="+d+"_facet]:checked").val();if(getFacetType(getFacetname(e))=="range"){mslineShow();radarShow()}}else{mslineHide();radarHide()}});$("a[name="+d+"_classify_hover]").unbind("mouseout");$("#"+d+"_classify_"+a+"_"+c+"_hover").bind("mouseout",function(l){if($("#choose_classifyquery_div").length>0){var h,g,n,f,m,k;h=l.pageX;g=l.pageY;var e=$("#choose_classifyquery_div").offset();if(e!=null){m=e.left;k=e.top-5;n=$("#choose_classifyquery_div").outerWidth(true);f=$("#choose_classifyquery_div").outerHeight(true);if(h>m&&h<=(m+n)&&g>k&&g<=(k+f)){return false}}mouseleaveClassify(d,a,c)}});$("#choose_classifyquery_div").bind("mouseleave",function(){mouseleaveClassify(d,a,c)})}function setClassifyqueryTypePosition(c,d){var e=$("input[type=checkbox][name=contrast][contrasttype="+d+"][contrastvalue="+c+"]");var b=e.offset().left;if(b==0){b=-1000}var a=$("#tabdiv").offset();$("#choose_classifyquery_div").css({display:"inline-block",position:"absolute",width:"80px","z-index":9002,left:b-a.left+13,top:e.offset().top-a.top+15})}function mouseleaveClassify(d,b,c){$("#"+d+"_classify_"+b+"_"+c+"_arrowhover").attr("currentstate","folded");$("#"+d+"_classify_"+b+"_"+c+"_arrowhover").removeClass().addClass("checkarrowdown");var a=$("input[type=checkbox][classifyfield="+b+"][classifytype="+c+"]:checked").length;if(a==0){$("#choose_classifyquery_div").remove()}else{$("#choose_classifyquery_div").css("display","none")}}function setRangeClassifyPosition(e,c,d){var f=$("#"+e+"_classify_"+c+"_"+d+"_add_hover");var b=f.offset().left;if(b==0){b=-1000}var a=$("#tabdiv").offset();$("#add_range_classifyquery_div").css({display:"inline-block",position:"absolute","z-index":9002,left:b+f.outerWidth(true)-a.left-$("#add_range_classifyquery_div").outerWidth(true),top:f.offset().top-a.top+15})}function addRangeClassifyLayer(g,c,e){var f="";f+="<div id='add_range_classifyquery_layer_div' align='right' style='background-color:#ffffff;opacity:.7;filter:alpha(opacity=70);padding:5px;border:1px solid #B3CFE7;display:none;'>";f+="<span><a id='editrangeclassifybtn'  href='javascript:void(0)'>编辑</a>&nbsp;&nbsp;</span>";f+="</div>";if($("#add_range_classifyquery_layer_div").length==0){$("#editelementdiv").append(f)}var b=$("#tabdiv").offset();var d=$("#add_range_classifyquery_div");var a=d.offset().left;if(a==0){a=-1000}$("#add_range_classifyquery_layer_div").css({display:"inline-block",position:"absolute",width:d.width(),height:d.height(),"z-index":9003,left:a-b.left,top:d.offset().top-b.top});$("#editrangeclassifybtn").bind("click",function(){$("#topic_config_classify_createdtime_multivalue_add_hover").attr("hasvalue",4);$("#add_range_classifyquery_layer_div").remove()})}function addRangeClassifyValueFun(f,c,e,d,b){var a="";a+="<div id='add_range_classifyquery_div' class='sigma_searcher' style='width:560px;display:none;'>";a+="<div id='add_range_classifyquery_form_div'></div>";a+="<div style='float:right;'><input type='button' id='classifysubmit' value='确定' />&nbsp;&nbsp;<input type='button' id='classifyreset' value='取消' /></div>";a+="</div>";if($("#add_range_classifyquery_div").length==0){$("#editelementdiv").append(a);createFacetRangeHtml("add_range_classifyquery_form_div",f,d,b,undefined,undefined,false)}setRangeClassifyPosition(f,c,e);addRangeClassifyLayer(f,c,e);$("a[name="+f+"_classify_add_hover]").unbind("mouseout");$("#"+f+"_classify_"+c+"_"+e+"_add_hover").bind("mouseout",function(n){if($("#add_range_classifyquery_layer_div").length>0){var l,k,p,h,o,m;l=n.pageX;k=n.pageY;var g=$("#add_range_classifyquery_layer_div").offset();if(g!=null){o=g.left;m=g.top-5;p=$("#add_range_classifyquery_layer_div").outerWidth(true);h=$("#add_range_classifyquery_layer_div").outerHeight(true);if(l>o&&l<=(o+p)&&k>m&&k<=(m+h)){return false}}mouseleaveAddClassify(f,c,e)}});$("#add_range_classifyquery_layer_div").bind("mouseleave",function(){mouseleaveAddClassify(f,c,e)});$("#classifyreset").bind("click",function(){$("#add_range_classifyquery_div").css("display","none");$("#topic_config_classify_createdtime_multivalue_add_hover").attr("hasvalue",1)})}function mouseleaveAddClassify(c,a,b){if(!$("#"+b+"_contrast_"+a+"").prop("checked")){$("#add_range_classifyquery_div").remove();$("#add_range_classifyquery_layer_div").remove()}else{$("#add_range_classifyquery_div").css("display","none");$("#add_range_classifyquery_layer_div").css("display","none")}}function getFieldList(a,k){var m=parseInt(a.modelid,10);if(m==6){if(a.fieldlist!=undefined){if(k){var f=[];$.each(a.fieldlist,function(p,q){if(q.value!="text"){f.push(q)}});return f}else{return a.fieldlist}}}var c=a.facet;var n=a.select.value;var b=[];var h=[];var o="";switch(m){case 2:o="用户数";break;case 31:o="文章数";break;default:o="次数";break}if(c.field!=undefined&&c.field.length>0&&c.field[0].facetcalculate){h=c.field[0].facetcalculate;if(k){b.push({value:"frq",text:o})}else{var d=c.field[0].name;var e=[];$.each(d.split(","),function(p,q){var r=getEleFilterItem(a,q,"label");if(r){e.push(r)}});var l=e.join(" ");b.push({value:"text",text:l});if(h.length==0){b.push({value:"frq",text:o})}}}else{if(c.range!=undefined&&c.range.length>0&&c.range[0].facetcalculate){h=c.range[0].facetcalculate;if(k){b.push({value:"frq",text:o})}else{var d=c.range[0].name;var l=getEleFilterItem(a,d,"label");b.push({value:"text",text:l});if(h.length==0){b.push({value:"frq",text:o})}}}else{var g="";if(a!=undefined){if(a.facet.field.length>0){if(a.facet.field[0].average){g="(平均)"}}else{if(a.facet.range.length>0){if(a.facet.range[0].average){g="(平均)"}}}}switch(parseInt(m,10)){case 31:if(k===true){b=[{value:"frq",text:"文"},{value:"reposts_count",text:"转"+g+""},{value:"comments_count",text:"评"+g+""},{value:"direct_comments_count",text:"直评"+g+""},{value:"praises_count",text:"赞"+g+""},{value:"read_count",text:"阅读"+g+""},{value:"discuss_count",text:"讨"+g+""},{value:"direct_reposts_count",text:"直转"+g+""},{value:"total_reposts_count",text:"总转"+g+""},{value:"followers_count",text:"直接到达"+g+""},{value:"total_reach_count",text:"总到达"+g+""}]}else{b=[{value:"text",text:""},{value:"frq",text:"文章数"},{value:"reposts_count",text:"转发数"+g+""},{value:"direct_comments_count",text:"直接评论数"+g+""},{value:"comments_count",text:"评论数"+g+""},{value:"praises_count",text:"赞"+g+""},{value:"read_count",text:"阅读数"+g+""},{value:"discuss_count",text:"讨论数"+g+""},{value:"direct_reposts_count",text:"直接转发数"+g+""},{value:"total_reposts_count",text:"总转发数"+g+""},{value:"followers_count",text:"直接到达数"+g+""},{value:"total_reach_count",text:"总到达数"+g+""}]}break;case 51:if(k===2){b=[{value:"followers_count",text:"直接到达数"},{value:"floor",text:"楼层"},{value:"reposts_count",text:"转发数"},{value:"comments_count",text:"评论数"},{value:"praises_count",text:"赞"},{value:"read_count",text:"阅读数"}]}else{b=[{value:"screen_name",text:"用户名"},{value:"text",text:"内容"},{value:"created_at",text:"创建时间"},{value:"source",text:"应用来源"},{value:"source_hostname",text:"数据来源"},{value:"floor",text:"楼层"},{value:"column",text:"栏目"},{value:"post_title",text:"标题"},{value:"reposts_count",text:"转发数"},{value:"comments_count",text:"评论数"},{value:"praises_count",text:"赞"},{value:"read_count",text:"阅读数"},{value:"productType",text:"产品型号"},{value:"impress",text:"买家印象"},{value:"commentTags",text:"单评论的标签"},{value:"proClassify",text:"详细商品分类"},{value:"promotionInfos",text:"促销信息"},{value:"productFullName",text:"产品全名"},{value:"productColor",text:"产品颜色"},{value:"productSize",text:"产品尺寸"},{value:"productDesc",text:"产品描述"},{value:"productComb",text:"产品组合"},{value:"detailParam",text:"规格参数"},{value:"compName",text:"公司名称"},{value:"compAddress",text:"公司地址"},{value:"phoneNum",text:"公司电话"},{value:"compURL",text:"公司URL"},{value:"serviceProm",text:"服务承诺"},{value:"logisticsInfo",text:"物流"},{value:"payMethod",text:"支付方式"},{value:"apdComment",text:"追评内容"},{value:"serviceComment",text:"对服务的评论"},{value:"nowLocation",text:"出发地"},{value:"satisfaction",text:"满意度"},{value:"godRepPer",text:"好评百分比"},{value:"midRepPer",text:"中评百分比"},{value:"wosRepPer",text:"差评百分比"},{value:"godRepNum",text:"好评数"},{value:"midRepNum",text:"中评数"},{value:"wosRepNum",text:"差评数"},{value:"apdRepNum",text:"追评数"},{value:"showPicNum",text:"有晒单的评价"},{value:"cmtStarLevel",text:"评价所属星级"},{value:"purchDate",text:"购买日期"},{value:"proOriPrice",text:"原价"},{value:"proCurPrice",text:"现价"},{value:"proPriPrice",text:"促销价"},{value:"stockNum",text:"库存"},{value:"salesNumMonth",text:"月成交量"},{value:"operateTime",text:"开店时长"},{value:"compDesMatch",text:"对公司总体打分"},{value:"logisticsScore",text:"对公司物流打分"},{value:"serviceScore",text:"对公司服务打分"}]}break;case 1:if(k===2){b=[{value:"users_followers_count",text:"粉丝数"+g+""},{value:"users_friends_count",text:"关注数"+g+""},{value:"users_statuses_count",text:"文章数"+g+""},{value:"users_favourites_count",text:"收藏数"+g+""},{value:"users_bi_followers_count",text:"互粉数"+g+""}]}case 2:if(k===true){b=[{value:"frq",text:"用户数"},{value:"users_followers_count",text:"粉丝数"+g+""},{value:"users_friends_count",text:"关注数"+g+""},{value:"users_statuses_count",text:"文章数"+g+""},{value:"users_favourites_count",text:"收藏数"+g+""},{value:"users_bi_followers_count",text:"互粉数"+g+""}]}else{b=[{value:"text",text:""},{value:"frq",text:"用户数"},{value:"users_followers_count",text:"粉丝数"+g+""},{value:"users_friends_count",text:"关注数"+g+""},{value:"users_statuses_count",text:"文章数"+g+""},{value:"users_favourites_count",text:"收藏数"+g+""},{value:"users_bi_followers_count",text:"互粉数"+g+""}]}break;default:break}}}if(h!=undefined&&h.length>0){$.each(h,function(t,q){var r={};if(q.calctype==undefined){q.calctype="field"}r.value=""+q.calctype+":"+q.code+"";var s="";if(q.calctype!=undefined){s=calcval2text(q.calctype)}var p=getEleFilterItem(a,q.code,"label");r.text=p+"("+s+")";b.push(r)})}if(b.length==0){$.each(n,function(r,q){var p={};p.value=q;p.text=getEleFilterItem(a,q,"label");b.push(p)})}return b}function unitNumberFormatter(a){if(a>=1000000000000){return Math.round(a/1000000000000)+"T"}else{if(a>=1000000000){return Math.round(a/1000000000)+"B"}else{if(a>=1000000){return Math.round(a/1000000)+"M"}else{if(a>=1000){return Math.round(a/1000)+"K"}else{return a}}}}}function getRangeTextFromLimit(b,c){var a="&nbsp;&nbsp;[取值范围：";if(b[c].limit.length>0){$.each(b[c].limit,function(f,e){var d="";if(e.value.gap!=undefined&&e.value.gap!=null){d=getGaptext(e.value.gap)}if(e.value.minvalue!=null&&e.value.maxvalue!=null){if(c=="createdtime"){a+="("+formatTime("yyyy-MM-dd hh:mm:ss",e.value.minvalue)+" 到 "+formatTime("yyyy-MM-dd hh:mm:ss",e.value.maxvalue)+")"}else{a+="("+e.value.minvalue+" 到 "+e.value.maxvalue+d+")"}}else{if(e.value.minvalue==null&&e.value.maxvalue!=null){if(c=="createdtime"){a+="(小于"+formatTime("yyyy-MM-dd hh:mm:ss",e.value.maxvalue)+")"}else{a+="(0到"+e.value.maxvalue+d+")"}}else{if(e.value.minvalue!=null&&e.value.maxvalue==null){if(c=="createdtime"){a+="(大于"+formatTime("yyyy-MM-dd hh:mm:ss",e.value.minvalue)+")"}else{a+="(大于"+e.value.minvalue+d+")"}}else{a+="不限"}}}})}else{a+="不限"}a+="]";return a}function isEmptyData(d){var a=true;if(d!=null&&d.errorcode==undefined){var e=d.length;if(e>0){var c=false;for(var b=0;b<e;b++){if(d[b].datalist!=undefined&&d[b].datalist!=null&&d[b].datalist.length>0){c=true}if(d[b].before!=undefined&&d[b].before!=null){c=true}if(d[b].after!=undefined&&d[b].after!=null){c=true}}if(c){a=false}}}return a}function dropDownMenuMouseEvent(c){var b="";var a="";switch(c){case"editelebtn":b="arrowup";a="arrowdown";break;case"datahelper":b="datahelperarrowup";a="datahelperarrowdown";break;default:b="modelarrowup";a="modelarrowdown";break}$("#add"+c+"").bind("mouseover",function(){$("#add"+c+"div").css({display:"inline-block",position:"absolute","z-index":1001,left:$("#add"+c+"").position().left,top:$("#add"+c+"").position().top+$("#add"+c+"").height()});$("#add"+c+"_arrowhover").removeClass().addClass(b)});$("#add"+c+"").bind("mouseout",function(k){if($("#add"+c+"div").length>0){var g,f,m,e,l,h;g=k.pageX;f=k.pageY;var d=$("#add"+c+"div").offset();if(d!=null){l=d.left;h=d.top-5;m=$("#add"+c+"div").outerWidth(true);e=$("#add"+c+"div").outerHeight(true);if(g>l&&g<=(l+m)&&f>h&&f<=(h+e)){return false}}$("#add"+c+"div").css("display","none");$("#add"+c+"_arrowhover").removeClass().addClass(a)}});$("#add"+c+"div").bind("mouseleave",function(){$("#add"+c+"div").css("display","none");$("#add"+c+"_arrowhover").removeClass().addClass(a)})}function createUpdateSchedBtn(f){var l=$(f).attr("instanceid");var a=$(f).attr("elementid");var c=false;var k=false;var g=false;if(config.updateschedule){$.each(window.instances,function(m,n){if(n.instanceID==l){window.currInstance=n;$.each(n.elements,function(p,o){if(o.elementID==a){if(o.issnap){c=true;k=o.dataJson.allowupdatesnapshot;g=o.dataJson.alloweventalert;return false}}})}})}if(c){if((config.allowupdatesnapshot)&&k){if($("#addeditelebtndiv").length==0){var d="<div id='addeditelebtndiv' style='display:none;background: none repeat scroll 0 0 #ffffff;'>";if(config.allowupdatesnapshot){if(k){d+="<a id='updateschedule' href='javascript:void(0)'>更新计划</a>";if(config.alloweventalert){if(g){d+="<a id='editeventalert' href='javascript:void(0)'>事件预警</a>"}}}}d+="</div>";$("#editelementlayer").append(d)}var h="<span><a id='addeditelebtn' href='javascript:void(0);'>编辑<span class='arrowdown' id='addeditelebtn_arrowhover' ></span></a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>";$("#editelementbtn").parent("span").after(h);var e=$("#editelementbtn").text("模型编辑");$("#editelementbtn").parent("span").remove();$("#updateschedule").before(e);dropDownMenuMouseEvent("editelebtn")}}else{if($("#addeditelebtn").length>0){var b='<span><a id="editelementbtn" href="javascript:void(0)">编辑</a>&nbsp;&nbsp;|&nbsp;&nbsp;</span>';$("#addeditelebtn").parent("span").after(b);$("#addeditelebtn").parent("span").remove();$("#addeditelebtndiv").remove()}}$("#updateschedule").die("click");$("#updateschedule").live("click",function(){var m=window.currInstance.schedparams;if(!c){m.status=0}myUpdateSchedule(function(n){window.currInstance.schedparams=n;if(window.currInstance.status==1){window.currInstance.preUpdate()}},m,undefined,undefined,true)});$("#editeventalert").die("click");$("#editeventalert").live("click",function(){var m=window.currInstance.schedparams;if(!c){m.status=0}myUpdateSchedule(function(n){window.currInstance.schedparams=n;var o=false;if(n.eventlist!=undefined&&n.eventlist.alarms!=undefined&&n.eventlist.alarms.length>0){o=true}$.each(window.currInstance.elements,function(q,p){p.hasalarm=o});if(window.currInstance.status==1){window.currInstance.preUpdate()}},m,undefined,true,true)})}function gotoOrishow(a){var b={};b.type="setsnapshotshowinfo";b.snapid=a.snapid;b.level1id=a.level1id;b.level2id=a.level2id;b.level3id=a.level3id;b.incid=a.instanceid;b.eleid=a.elementid;$.ajax({url:config.phpUrl+"modelinterface.php",data:JSON.stringify(b),type:"post",dataType:"json",contentType:"application/json",async:false,success:function(c){if(c!=undefined&&parseInt(c.result,10)){}},error:function(){}});window.open(config.sitePath+"index.html","_blank")}function initNavMenu(f,c,b,a){var e="snapshot";if(f=="event"){e="eventalert";var d=config.phpUrl+"modelinterface.php?type=geteventlistall"}else{if(f=="eventhistory"){e="eventhistory";var d=config.phpUrl+"modelinterface.php?type=geteventhistorylistall"}else{var d=config.phpUrl+"modelinterface.php?type=getsnapshothistorylistall"}}$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:d,async:false,beforeSend:function(){},success:function(n){if(n!=null&&n.children!=undefined&&n.children.length>0){var m="<option value=''>请选择</option>";var k="<option value=''>请选择</option>";var g="<option value=''>请选择</option>";var o=[];var l=[];var h=[];$.each(n.children,function(s,t){var q="";var v="";if(t.level1id==c){q="selected='selected'"}else{if(t.level2id==b){q="selected='selected'"}else{if(t.level3id==a){q="selected='selected'"}}}var r="<option value='"+t.level1id+"' "+q+" navid='"+t.level1id+"'>"+t.level1+"</option>";if(!o.inArray(t.level1id)){m+=r;o.push(t.level1id)}var p="<option value='"+t.level2id+"' "+q+" navid='"+t.level2id+"'>"+t.level2+"</option>";if(!l.inArray(t.level2id)){k+=p;l.push(t.level2id)}if(t.level3id!=null){var u="<option value='"+t.level3id+"' "+q+" navid='"+t.level3id+"'>"+t.level3+"</option>";if(!h.inArray(t.level3id)){g+=u;h.push(t.level3id)}}});$("#"+e+"_search_level1").empty().append(m);$("#"+e+"_search_level2").empty().append(k);$("#"+e+"_search_level3").empty().append(g);$("#"+e+"_search_level1").unbind("change");$("#"+e+"_search_level1").bind("change",function(){var r=$(this).find("option[value="+$(this).val()+"]").attr("navid");var p="<option value=''>请选择</option>";var q=[];$.each(n.children,function(s,t){if(t.level1id==r){if(!q.inArray(t.level2id)){p+="<option value='"+t.level2id+"' navid='"+t.level2id+"'>"+t.level2+"</option>";q.push(t.level2id)}}});$("#"+e+"_search_level2").empty().append(p)});$("#"+e+"_search_level2").unbind("change");$("#"+e+"_search_level2").bind("change",function(){var q=$(this).find("option[value="+$(this).val()+"]").attr("navid");var r="<option value=''>请选择</option>";var p=[];$.each(n.children,function(s,t){if(t.level2id==q){if(t.level3id!=null&&!p.inArray(t.level3id)){r+="<option value='"+t.level3id+"' navid='"+t.level3id+"'>"+t.level3+"</option>";p.push(t.level3id)}}});$("#"+e+"_search_level3").empty().append(r)})}}})}function getFloorDisplay(a){var b="";switch(parseInt(a,10)){case 0:b="楼主";break;case 1:b="沙发";break;case 2:b="板凳";break;case 3:b="地板";break;default:if(a){b=a+"楼"}break}return b}function getChartMapKey(e){var d=e;for(var b=0,a=config.mapData.length;b<a;b++){var c=config.mapData[b];if(c.map_alias_name.inArray(e)){d=c.map_chart_key;break}}return d}function barShow(){$("#modelshow_ul a[href='#modelshow_barchart']").parent().css("display","");column3dShow();bar3dShow()}function barHide(){$("#modelshow_ul a[href='#modelshow_barchart']").parent().css("display","none");column3dHide();bar3dHide()}function column3dShow(){modelshowDisplay("fullscreenmulticolumn3d");modelshowDisplay("bigmulticolumn3d");modelshowDisplay("smallmulticolumn3d")}function bar3dShow(){modelshowDisplay("fullscreenmultibar3d");modelshowDisplay("bigmultibar3d");modelshowDisplay("smallmultibar3d")}function column3dHide(){modelshowHide("fullscreenmulticolumn3d");modelshowHide("bigmulticolumn3d");modelshowHide("smallmulticolumn3d")}function bar3dHide(){modelshowHide("fullscreenmultibar3d");modelshowHide("bigmultibar3d");modelshowHide("smallmultibar3d")};function initDrag(a){window.dragobj={};window.dragmasobj={};window.onfocus=function(){document.onmouseup()};window.onblur=function(){document.onmouseup()};document.onmouseup=function(){window.draging=false;if(window.resizing){return false}if(dragobj.o!=null){changePage(4);$("#drag_grouptip").remove();if($(dragobj.o).attr("movetogroup")=="1"&&dragobj.targetgroup!=null){dragobj.targetgroup.appendChild(dragobj.o);if($(dragobj.targetgroup).children("div").length==1){$(dragobj.targetgroup).css("height","auto")}changeMoveGroupButton(dragobj.o);hideGroupShade();checkGroupWidth(dragobj.targetgroup);changeWidthHeigh(dragobj.o)}else{dragobj.otemp.parentNode.insertBefore(dragobj.o,dragobj.otemp)}var b=$(dragobj.o).data("showobj");if(b!=undefined&&b!=null&&b.onDrag!=undefined){b.onDrag()}dragobj.o.style.position="";changeEditLayerPosition(dragobj.o);$(dragobj.otemp).remove();dragobj={};setMenuHeight()}};$(document).bind("mousemove",function(b){if(window.resizing){return false}var d=b;if(dragobj.o!=null){dragobj.o.style.left=(d.clientX-dragobj.xx[0])+"px";dragobj.o.style.top=(d.pageY-dragobj.xx[1])+"px";dragmasobj.o.style.left=(d.clientX-dragmasobj.xx[0])+"px";dragmasobj.o.style.top=(d.pageY-dragmasobj.xx[1])+"px";var c;if(dragobj.o!=null){c=$(dragobj.o).parent().children()}else{return false}c.each(function(g,h){var f=h;if(f!=null&&f!=dragobj.o){var e=drag_inner(f,d);if(e==0){dragobj.targetgroup=null;$("#drag_grouptip").remove();return true}if($(dragobj.o).attr("movetogroup")=="1"){if($("#drag_grouptip").length==0&&$(f).attr("isgroup")=="1"){$(dragmasobj.o).append("<span id='drag_grouptip' style='color:black;font-size:16px;'>松开鼠标将模型加入分组</span>")}dragobj.targetgroup=f}else{$("#drag_grouptip").remove();if(e==1){f.parentNode.insertBefore(dragobj.otemp,f)}else{if(f.nextSibling==null){f.parentNode.appendChild(dragobj.otemp)}else{f.parentNode.insertBefore(dragobj.otemp,f.nextSibling)}}}return false}})}});$(document).bind("keypress",function(b){b=b||event;if(b.keyCode==27){document.onmouseup()}});$(a).live("mousedown",function(d){if(window.resizing){return false}window.draging=true;if(dragobj.o!=null){return false}var f=d;if(f.target!=this){return}dragobj.targetgroup=null;dragmasobj.o=this;dragmasobj.xy=drag_getPositionInfo(dragmasobj.o);dragmasobj.xx=new Array((f.clientX-dragmasobj.xy[1]),(f.pageY-dragmasobj.xy[0]));var c=$($(a).attr("targetselector"));dragobj.o=c[0];dragobj.xy=drag_getPositionInfo(dragobj.o);dragobj.xx=new Array((f.clientX-dragobj.xy[1]),(f.pageY-dragobj.xy[0]));var b=document.createElement("div");dragobj.otemp=b;$(b).attr("style",$(dragobj.o).attr("style"));$(b).css("border","1px dashed gray");$(b).css("display","none");$(b).attr("class",$(dragobj.o).attr("class"));$(dragobj.o).before(b);$(dragobj.o).css({width:dragobj.xy[4],height:dragobj.xy[5]});$(dragobj.o).css({left:$(dragobj.o).position().left+"px",top:$(dragobj.o).position().top+"px"});$(dragobj.o).css("position","absolute");$(b).css("display","");return false})}function freeDrag(a){window.dragobj=null;window.dragmasobj=null;window.onfocus=null;window.onblur=null;document.onmouseup=null;$(document).unbind("mousemove");$(a).die("mousedown");$(document).unbind("keypress")}function drag_getPositionInfo(k){var e=new Array();var j=k.offsetTop;var b=k.offsetLeft;var f=k.offsetWidth;var c=k.offsetHeight;var g=$(k).css("width");var d=$(k).css("height");var i=k;while(i=i.offsetParent){j+=i.offsetTop;b+=i.offsetLeft}e[0]=j;e[1]=b;e[2]=f;e[3]=c;e[4]=g;e[5]=d;return e}function drag_inner(c,d){var b=drag_getPositionInfo(c);if(d.clientX>b[1]&&d.clientX<(b[1]+b[2])&&d.pageY>b[0]&&d.pageY<(b[0]+b[3])){if(d.pageY<(b[0]+b[3]/2)){return 1}else{return 2}}else{return 0}};var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.stringifyOnce!=="function"){JSON.stringifyOnce=function(obj,replacer,indent){var printedObjects=[];var printedObjectKeys=[];function printOnceReplacer(key,value){var printedObjIndex=false;printedObjects.forEach(function(obj,index){if(obj===value){printedObjIndex=index}});if(key==""){printedObjects.push(obj);printedObjectKeys.push("root");return value}else{if(printedObjIndex+""!="false"&&typeof(value)=="object"){if(printedObjectKeys[printedObjIndex]=="root"){return"(pointer to root)"}else{return"(see "+((!!value&&!!value.constructor)?value.constructor.name.toLowerCase():typeof(value))+" with key "+printedObjectKeys[printedObjIndex]+")"}}else{var qualifiedKey=key||"(empty key)";printedObjects.push(value);printedObjectKeys.push(qualifiedKey);if(replacer){return replacer(key,value)}else{return value}}}}return JSON.stringify(obj,printOnceReplacer,indent)}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());function myECharts(){var a=this;this.myChart=null;this.ecConfig=null;this.renderTo="";this.chartoption={color:["#497eb4","#53b8de","#4be556","#d3418a","#d73b5b"],title:{text:"",subtext:""},tooltip:{trigger:"axis",borderColor:"#497EB4",borderWidth:2,backgroundColor:"#fff",formatter:function(c){var b=c[0].data.name+"\t"+c[0].indicator+":"+c[0].value+"<br/>"+c[1].data.name+"\t"+c[1].indicator+":"+c[1].value;return b},textStyle:{color:"#497EB4"},show:true},legend:{orient:"vertical",x:"left",data:[]},toolbox:{show:false,feature:{mark:{show:true},dataView:{show:true,readOnly:false},restore:{show:true},saveAsImage:{show:true}}},calculable:false,polar:[{indicator:[]}],series:[{name:"",type:"",data:[]}]};this.chartCreate=function(){a.myChart=echarts.init(document.getElementById(a.renderTo));a.myChart.setOption(a.chartoption);a.ecConfig=echarts.config}};Highcharts.setOptions({lang:{months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],shortMonths:["01","02","03","04","05","06","07","08","09","10","11","12"],weekdays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],loading:"正在加载..."}});function MyHighCharts(d,a,b){var c=this;this.highchart;this.autorotation=(d==undefined)?-1:d;this.autostep=(a==undefined)?-1:a;this.maxLabelLen=(b==undefined)?-1:b;this.xAxiscategories=[];this.categorydata=[];this.pointclick={};this.firstRender=true;this.maxColumnWidth=50;this.xzReverse=false;this.xCombined=false;this.xPartCombined=false;this.oldLinkedTo=0;this.chartoption={chart:{renderTo:"",marginLeft:50,marginRight:10,style:{fontSize:"12px"},events:{redraw:function(){},load:function(){if(!c.firstRender){return}}}},colors:["#497eb4","#53b8de","#4be556","#d3418a","#d73b5b"],credits:{enabled:false},exporting:{enabled:false},title:{text:null},subtitle:{text:null},xAxis:{id:"x-axis",tickmarkPlacement:"between",labels:{step:0,align:"center",rotation:0,style:{}}},yAxis:{gridLineDashStyle:"Dash",title:{text:null},labels:{},startOnTick:false,showFirstLabel:true},point:{marker:{symbol:"triangle"}},legend:{align:"center",verticalAlign:"bottom",y:10,margin:5},tooltip:{shared:true,style:{fontSize:"12px",padding:"5px"},crosshairs:true},plotOptions:{pie:{center:["50%","50%"],allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true,color:"#000000",connectorColor:"#000000",distance:10,connectorWidth:1,formatter:function(){return"<b>"+this.point.name+"</b>: "+this.percentage.toFixed(2)+" %"}},tooltip:{},showInLegend:true},column:{groupPadding:0.1,plotPadding:0.1,connectNulls:true},lineWidth:1,series:{groupPadding:0.1,cursor:"pointer",point:{events:{click:function(){}}},events:{hide:function(){c.legendClick(this.name,false)},show:function(e){c.legendClick(this.name,true)},legendItemClick:function(e){}}}},labels:{items:[],style:{}}};this.legendClick=function(m,k){var f=[];var q=[];c.categorydata=[];var v=[];var p=0;for(var t=0;t<c.highchart.series.length;t++){if(c.highchart.series[t].name==m){c.highchart.series[t].visible=k}}for(var t=0;t<c.highchart.series.length;t++){c.chartoption.series[t].visible=c.highchart.series[t].visible;var n=c.chartoption.series[t].yAxis;if(c.highchart.series[t].visible){if(c.chartoption.series[t].dmax>p){p=c.chartoption.series[t].dmax}if(c.highchart.series[t].type=="column"){if(c.xAxiscategories.length>0&&isArray(c.xAxiscategories[0])){if(c.xAxiscategories[t]!=undefined){c.categorydata.push(c.xAxiscategories[t])}}else{c.categorydata=c.xAxiscategories}f.push(c.highchart.series[t])}else{if(c.highchart.series[t].type=="bar"){if(c.xAxiscategories.length>0&&isArray(c.xAxiscategories[0])){if(c.xAxiscategories[t]!=undefined){c.categorydata.push(c.xAxiscategories[t])}}else{c.categorydata=c.xAxiscategories}q.push(c.highchart.series[t])}else{if(c.xAxiscategories.length>0&&isArray(c.xAxiscategories[0])){if(c.xAxiscategories.length==1){v.push(c.xAxiscategories[0])}else{if(c.xAxiscategories.length>1){if(c.xAxiscategories[t]!=undefined){v.push(c.xAxiscategories[t])}}}}else{v=c.xAxiscategories}}}if(c.chartoption.yAxis[n]!=undefined){c.chartoption.yAxis[n].title.text=c.chartoption.series[t].name;if(!c.chartoption.yAxis[n].labels.enabled){c.chartoption.yAxis[n].title.text=null}}}else{if(c.chartoption.yAxis[n]!=undefined){c.chartoption.yAxis[n].title.text=null;c.chartoption.yAxis[n].max=null}}}if(c.chartoption.yAxis.length>0){var r=false;var w=false;var g=0;$.each(c.chartoption.yAxis,function(y,z){if(z.title.text!=null&&y==0){for(var x=0;x<c.highchart.series.length;x++){if(c.highchart.series[x].name==z.title.text){if(c.chartoption.series[x].visible){r=c.chartoption.series[x].visible;g=y}}}}if(z.title.text!=null&&z.opposite){for(var x=0;x<c.highchart.series.length;x++){if(c.highchart.series[x].name==z.title.text){if(c.chartoption.series[x].visible){w=c.chartoption.series[x].visible;g=y}}}}});if(r&&w){var s;c.chartoption.yAxis[0].max=p;$.each(c.chartoption.yAxis,function(i,x){if("linkedTo" in x){x.linkedTo=c.oldLinkedTo}if(x.opposite){s=x.referencedataratio}});var h=c.chartoption.labels.style.fontSize;h=h?parseInt(h.replace("px",""),10):12;var e=unitNumberFormatter(parseInt(p,10));var u=getStringPx(e.toString(),h);c.chartoption.chart.marginLeft=u+30+12;var e=unitNumberFormatter(parseInt(p/s,10));var u=getStringPx(e.toString(),h);c.chartoption.chart.marginRight=u+30+12}else{if(!r&&!w){var h=c.chartoption.labels.style.fontSize;h=h?parseInt(h.replace("px",""),10):12;var e=unitNumberFormatter(parseInt(p,10));var u=getStringPx(e.toString(),h);c.chartoption.chart.marginLeft=u+30+12;c.chartoption.chart.marginRight=10;$.each(c.chartoption.yAxis,function(i,x){if("linkedTo" in x){x.linkedTo=null}});$.each(c.chartoption.yAxis,function(z,A){var x=false;if(z!=0&&!A.opposite){for(var y=0;y<c.chartoption.series.length;y++){if(c.chartoption.series[y].yAxis==z){if(c.chartoption.series[y].visible){A.max=p;A.labels.enabled=true;A.labels.formatter=function(){var i=A.referencedataratio?parseFloat(A.referencedataratio):1;var B=this.value/i;return unitNumberFormatter(B)};A.title.text=c.chartoption.series[y].name;A.title.style={};A.title.style.color=c.chartoption.series[y].color;x=true}}}}if(x){return false}})}else{var s;$.each(c.chartoption.yAxis,function(i,x){if("linkedTo" in x){x.linkedTo=null}if(g==i){x.max=p}else{x.max=null}if(i!=0&&!x.opposite){x.labels.enabled=false;if(x.title!=undefined){x.title.text=null}if(r){x.linkedTo=0}}if(x.opposite){s=x.referencedataratio?parseFloat(x.referencedataratio):1}});var h=c.chartoption.labels.style.fontSize;h=h?parseInt(h.replace("px",""),10):12;var e=unitNumberFormatter(parseInt(p,10));var u=getStringPx(e.toString(),h);if(r){c.chartoption.chart.marginLeft=u+30+12}else{c.chartoption.chart.marginLeft=20}if(w){var e=unitNumberFormatter(parseInt(p/s,10));var u=getStringPx(e.toString(),h);c.chartoption.chart.marginRight=u+38+12}else{c.chartoption.chart.marginRight=10}}}}if((f.length>0||q.length>0)&&(c.highchart.options.chart.type=="column"||c.highchart.options.chart.type=="bar")){c.chartoption.xAxis.labels.enabled=false;c.chartoption.xAxis.categories=c.categorydata;c.firstRender=false;c.highchart=new Highcharts.Chart(c.chartoption);var o=[];var j=[];for(var t=0;t<c.highchart.series.length;t++){if(c.highchart.series[t].type=="column"&&c.highchart.series[t].visible){o.push(c.highchart.series[t])}if(c.highchart.series[t].type=="bar"&&c.highchart.series[t].visible){j.push(c.highchart.series[t])}}if(c.highchart.options.chart.type=="column"){c.multiColumnLoad(o,c.highchart)}if(c.highchart.options.chart.type=="bar"){c.multiBarLoad(j,c.highchart)}}else{c.firstRender=false;var l=v;if(v.length>0&&isArray(v[0])){l=v[0]}else{if(v.length==0){if(c.xAxiscategories.length>0&&isArray(c.xAxiscategories[0])){l=c.xAxiscategories[0]}else{l=c.xAxiscategories}}}c.chartoption.xAxis.categories=l;c.chartoption.xAxis.labels.enabled=true;c.highchart=new Highcharts.Chart(c.chartoption)}};this.multiBarLoad=function(H,P){var m=c.categorydata;var v=0;var l=0;var I=0;var u=c.chartoption.labels.style.fontSize;u=u?parseInt(u.replace("px",""),10):12;var O=c.chartoption.legend.enabled;var t=true;var x=[];for(var N=0;N<m.length;N++){for(var M=0;M<m[N].length;M++){var K=m[N][M];if(m.length>1){if(N==0){x.push(K)}else{if(x[M]!=K){t=false}}}else{t=false}var w=getStringPx(m[N][M],u);if(c.maxLabelLen!=-1&&m[N][M].length>c.maxLabelLen){m[N][M]=m[N][M].substr(0,c.maxLabelLen)+".";w=getStringPx(m[N][M],u)}if(w>v){v=w}var q=getStringMaxHeight(m[N][M],u);if(q>I){I=q}if(m[N][M].length>l){l=m[N][M].length}}}if(O){t=false}var A=0;var E=deepClone(c.chartoption);E.labels.items=[];E.xAxis.categories=new Array();E.xAxis.categories[c.chartoption.xAxis.categories[0].length-1]="";var h=0;for(var N=0;N<H.length;N++){for(var M=0;M<H[N].points.length;M++){var o=H[N].points[M].barY;var G=H[N].points[M].tmpval.alias==undefined?H[N].points[M].tmpval.text:H[N].points[M].tmpval.alias;var L=c.calcLabelSize(I,G,1.1);var D=L.outerwidth;if(D>o){if((D-o)>h){h=D-o}}var B="";B=m[N][M];if(t){if(N==0){x.push(B);J=false}else{if(x[M]!=B){J=false}else{J=true}}}else{J=false}if(!J){var L=c.calcLabelSize(I,B);var D=L.outerwidth+10;var k=L.outerheight;if(A<D){A=D}}}}if(t){E.chart.marginRight+=h}E.chart.marginLeft=12+A;var y=new Highcharts.Chart(E);var H=[];for(var N=0;N<y.series.length;N++){if(y.series[N].type=="bar"&&y.series[N].visible){H.push(y.series[N])}}var x=[];var J=true;var s=[];for(var N=0;N<H.length;N++){for(var M=0;M<H[N].points.length;M++){var p=H[N].points[M].barX;var o=H[N].points[M].barY;var z=H[N].points[M].barH;var r=H[N].points[M].barW;if(t||c.xCombined){var F=p;if(H.length%2==0){if(H[H.length/2].points[M]!=undefined&&H[H.length/2-1].points[M]!=undefined){F=H[H.length/2].points[M].barX-(H[H.length/2].points[M].barX-H[H.length/2-1].points[M].barX-r)/2}}else{var g=Math.floor(H.length/2);if(H[g].points[M]!=undefined){F=H[g].points[M].barX+r/2}}}if(I>r){I=r}var B="";B=m[N][M];if(t){if(N==0){x.push(B);J=false}else{if(x[M]!=B){J=false}else{J=true}}}else{J=false}if(!J){var L=c.calcLabelSize(I,B);var D=L.outerwidth+10;var k=L.outerheight;if(A<D){A=D}if(t||c.xCombined){var n;if(r>k){n=c.highchart.plotHeight-F-r/2-k/2}else{n=c.highchart.plotHeight-F-r}}else{var n;if(r>k){n=c.highchart.plotHeight-p-r/2-k/2}else{n=c.highchart.plotHeight-p-r}if(k<=10){n-=I/2}}var f=c.labelItemObj(B,-D,n,I,I);if(c.xCombined){if(!s.inArray(B)){s.push(B);E.labels.items.push(f)}}else{E.labels.items.push(f)}}if(t){var G=H[N].points[M].tmpval.alias==undefined?H[N].points[M].tmpval.text:H[N].points[M].tmpval.alias;if(G!=undefined){var L=c.calcLabelSize(I,G,1.1);var D=L.outerwidth;var k=L.outerheight;var n;n=c.highchart.plotHeight-Math.ceil(p)-r/2-k/2;if(k<=10){n-=I/2}var e=z;if(z<2){e=z+2}var f=c.labelItemObj(G,e,n,I,I*1.1);E.labels.items.push(f)}}}}c.destroy();c.highchart=new Highcharts.Chart(E);E=null;var C=c.highchart.renderTo.id;$("#"+C+"").find("svg").find("text").each(function(R,Y){if($(Y).attr("zIndex")!=undefined){var Q=$(Y).attr("style").match(/font-size:(\d*.\d*)px/g);var j=$(Y).attr("style").match(/line-height:(\d*.\d*)px/g);if(Q!=null){var U=parseFloat(Q[0].split(":")[1]);var X=U;if(j!=null){X=parseFloat(j[0].split(":")[1])}if(U<config.minFontSize){var V=U/config.minFontSize;var W=0.7;$(Y).attr("transform","scale("+W+","+V+")");var T=$(Y).attr("x")/W;var S=$(Y).attr("y")/V;$(Y).attr("x",T);$(Y).attr("y",S);$(Y).find("tspan").each(function(i,Z){if($(Z).attr("x")!=undefined){$(Z).attr("x",T)}if($(Z).attr("dy")!=undefined){$(Z).attr("dy",X/V)}})}}}})};this.multiColumnLoad=function(x,ap){var n=deepClone(c.categorydata);var X=0;var I;$.each(x,function(j,k){if(k.points[0]!=undefined){X=k.points[0].barW;I=k.points[0].barX;var m=ap.plotWidth;var i=m/k.points.length;var ar=(k.points[0].barX-m/2)>0?k.points[0].barX-m/2:0;I=I-ar-X*j;return false}});var D=$("#"+c.chartoption.chart.renderTo).width();var w=0;var l=D;var B=0;var Y=X;$.each(c.chartoption.xAxis.categories,function(i,ar){if(ar.length>B){X=Y;B=ar.length;var k=ar.length;var m=c.chartoption.chart.marginLeft+c.chartoption.chart.marginRight;l=(D-m)/k;if(n.length==1||c.chartoption.plotOptions.column.stacking!=null){X=l;w=I*2}else{var j=(n.length-1)>0?(n.length-1):1;w=(l-(2*I)-(n.length*X))/j;X=X+w}}});var E=[];var B=0;var h=0;var Z=0;var A=c.chartoption.labels.style.fontSize;var an=c.chartoption.legend.enabled;A=A?parseInt(A.replace("px",""),10):12;var z=true;var F=[];for(var aj=0;aj<n.length;aj++){if(n[aj].length==0){z=false}for(var ai=0;ai<n[aj].length;ai++){var ac=n[aj][ai];if(n.length>1){if(aj==0){F.push(ac)}else{if(F[ai]!=ac){z=false}}}else{z=false}var C=getStringPx(n[aj][ai],A);if(c.xzReverse||c.xCombined){if(C>l){var e=0;var al=0;for(var ao=0;ao<n[aj][ai].length;ao++){e+=getStringPx(n[aj][ai].charAt(ao),A);if(e<l){al++}else{break}}if(al<c.maxLabelLen){al=c.maxLabelLen}n[aj][ai]=n[aj][ai].substr(0,al-1)+".";var ae=c.calcLabelSize(A,n[aj][ai],1.1);C=ae.outerwidth}}else{if(c.maxLabelLen!=-1&&C>X&&n[aj][ai].length>c.maxLabelLen){n[aj][ai]=n[aj][ai].substr(0,c.maxLabelLen)+".";var ae=c.calcLabelSize(A,n[aj][ai],1.1);C=ae.outerwidth}}if(C>B){B=C}var v=getStringMaxHeight(n[aj][ai],A);if(v>Z){Z=v}}}var o=0;var M=0;if(z){for(var aj=0;aj<x.length;aj++){for(var ai=0;ai<x[aj].points.length;ai++){var V=x[aj].points[ai].tmpval.alias==undefined?x[aj].points[ai].tmpval.text:x[aj].points[ai].tmpval.alias;if(V!=undefined){var C=getStringPx(V,A);if(c.maxLabelLen!=-1&&C>X&&V.length>c.maxLabelLen){V=V.substr(0,c.maxLabelLen)+".";C=getStringPx(V,A)}if(C>o){o=C}var v=getStringMaxHeight(V,A);if(v>M){M=v}}}}}var ag=B>X;var Q=o>X;if(z||c.xCombined){ag=B>l}var r=0;var S=deepClone(c.chartoption);S.labels.items=[];S.xAxis.categories=new Array();if(c.chartoption.xAxis.categories[0]!=undefined){S.xAxis.categories[c.chartoption.xAxis.categories[0].length-1]=""}if(ag){if(Z>X){Z=X}var ac=5;Z=Z<ac?ac:Z;r=B}else{Z=A;r=Z}var ad=0;if(Q){if(M>X){M=X}ad=o}else{M=A;ad=M}var ak=0;for(var aj=0;aj<x.length;aj++){for(var ai=0;ai<x[aj].points.length;ai++){var u=x[aj].points[ai].barX;var t=x[aj].points[ai].barY;var H=x[aj].points[ai].barH;var L="";var V=x[aj].points[ai].tmpval.alias==undefined?x[aj].points[ai].tmpval.text:x[aj].points[ai].tmpval.alias;var s=true;if(V!=undefined){if(V!=c.categorydata[aj][ai]){s=false}var C=getStringPx(V,A);if(c.maxLabelLen!=-1&&C>X&&V.length>c.maxLabelLen){V=V.substr(0,c.maxLabelLen)+"."}}var aq="";var K=0;if(ag){K=Z;for(var ah=0;ah<n[aj][ai].length;ah++){var ab=ah==n[aj][ai].length-1?"":"<br/>";L+=n[aj][ai].charAt(ah)+ab}}else{K=getStringPx(n[aj][ai],Z);L=n[aj][ai]}var U=0;if(z&&V!=undefined){if(Q){U=M;for(var af=0;af<V.length;af++){var ab=af==V.length-1?"":"<br/>";aq+=V.charAt(af)+ab}}else{U=getStringPx(V,M);aq=V}}if(z){if(aj==0){F.push(L);aa=false}else{if(F[ai]!=L){aa=false}else{aa=true}}}else{aa=false}if(!aa){var ae=c.calcLabelSize(Z,L,1.1);if(r<ae.outerheight){r=ae.outerheight}}if(z&&!s){var ae=c.calcLabelSize(M,aq,1.1);var R=ae.outerheight;var p=t>0?t:0;var J=p-R;if(J<0){if(-J>ak){ak=-J}}}}}S.chart.marginBottom=12+r+(ap.legend.legendHeight?ap.legend.legendHeight:0)+(ap.options.legend.margin?ap.options.legend.margin*2:30);if(ak!=0){S.chart.marginTop=ak+10}var G=new Highcharts.Chart(S);var x=[];for(var aj=0;aj<G.series.length;aj++){if(G.series[aj].type=="column"&&G.series[aj].visible){x.push(G.series[aj])}}var F=[];var aa=true;var y=[];for(var aj=0;aj<x.length;aj++){for(var ai=0;ai<x[aj].points.length;ai++){var u=x[aj].points[ai].barX;if(z||c.xCombined){var T=u;if(S.plotOptions.column.stacking!=undefined&&S.plotOptions.column.stacking!=null){T=u+x[aj].points[ai].barW/2}else{if(x.length==1){T=u+x[aj].points[ai].barW/2}else{if(x.length%2==0){if(x[x.length/2].points[ai]!=undefined&&x[x.length/2-1].points[ai]!=undefined){T=x[x.length/2].points[ai].barX-(x[x.length/2].points[ai].barX-x[x.length/2-1].points[ai].barX-X)/2}}else{var g=Math.floor(x.length/2);if(x[g].points[ai]!=undefined){T=x[g].points[ai].barX+X/2}}}}}var t=x[aj].points[ai].barY;var H=x[aj].points[ai].barH;for(var P=0;P<x.length;P++){if(x[P].points[ai]!=undefined&&x[P].points[ai].percentage!=undefined){var W=x[P].points[ai].barH;W=W*100/x[P].points[ai].percentage;if(W>H){H=W}}}var L="";var V=x[aj].points[ai].tmpval.alias==undefined?x[aj].points[ai].tmpval.text:x[aj].points[ai].tmpval.alias;var s=true;if(V!=undefined){if(V!=c.categorydata[aj][ai]){s=false}var C=getStringPx(V,A);if(c.maxLabelLen!=-1&&C>X&&V.length>c.maxLabelLen){V=V.substr(0,c.maxLabelLen)+"."}}var aq="";var K=0;if(ag){K=Z;for(var ah=0;ah<n[aj][ai].length;ah++){var ab=ah==n[aj][ai].length-1?"":"<br/>";L+=n[aj][ai].charAt(ah)+ab}}else{var ae=c.calcLabelSize(Z,n[aj][ai],1.1);K=ae.outerwidth;L=n[aj][ai]}var U=0;if(z&&V!=undefined){if(Q){U=M;for(var af=0;af<V.length;af++){var ab=af==V.length-1?"":"<br/>";aq+=V.charAt(af)+ab}}else{U=getStringPx(V,M);aq=V}}if(z){if(aj==0){F.push(L);aa=false}else{if(F[ai]!=L){aa=false}else{aa=true}}}else{aa=false}if(!c.xCombined&&!c.xzReverse){aa=false}if(!aa){var ae=c.calcLabelSize(Z,L,1.1);if(r<ae.outerheight){r=ae.outerheight}var O;if(z&&(c.xCombined||c.xzReverse)){if(c.xPartCombined){var am=0;$.each(n,function(i,j){if(j.inArray(L)){am++}});O=u-w/2+(X*am-K)/2}else{O=T-K/2}}else{O=u-w/2+(X-K)/2}var f=c.labelItemObj(L,O,t+H+Z,Z,Z*1.1);if(c.xCombined){if(!y.inArray(L)){y.push(L);S.labels.items.push(f)}}else{S.labels.items.push(f)}}if(z&&!s){if(!(aa&&S.plotOptions.column.stacking!=undefined&&S.plotOptions.column.stacking!=null)){var ae=c.calcLabelSize(M,aq,1.1);var R=ae.outerheight;var p=t>0?t:0;var q=p-R-6;var O=u-w/2+(X-U)/2;var f=c.labelItemObj(aq,O,q,M,M*1.1,1,V,t);S.labels.items.push(f)}}}}c.destroy();c.highchart=new Highcharts.Chart(S);S=null;var N=c.highchart.renderTo.id;$("#"+N+"").find("svg").find("text").each(function(m,ax){if($(ax).attr("zIndex")!=undefined){var k=$(ax).attr("style").match(/font-size:(\d*.\d*)px/g);var j=$(ax).attr("style").match(/line-height:(\d*.\d*)px/g);if(k!=null){var au=parseFloat(k[0].split(":")[1]);var aw=au;if(j!=null){aw=parseFloat(j[0].split(":")[1])}if(au<config.minFontSize){var av=au/config.minFontSize;$(ax).attr("transform","scale("+av+", 1)");var ar=$(ax).attr("x");var at=ar/av;$(ax).attr("x",at);$(ax).find("tspan").each(function(i,ay){if($(ay).attr("x")!=undefined){$(ay).attr("x",at)}if($(ay).attr("dy")!=undefined){$(ay).attr("dy",aw/av)}})}}}})};this.labelItemObj=function(e,f,j,k,m,l,g,i){var h={};h.html=e;h.style={};h.style.left=f;h.style.top=j;h.style.fontSize=k+"px";h.style.fontFamily="Helvetica, sans-serif";h.style.lineHeight=m+"px";h.transform="scale(0.5)";if(l!=undefined){h.flag=l}if(g!=undefined){h.labelname=g}if(i!=undefined){h.coly=i}return h};this.calcLabelSize=function(i,h,g){var f={};if($("#calcLabelSize").length==0){$("body").append('<div style="top:-1000px;" id="calcLabelSize"></div>')}if(g==undefined){g=1}var e=$("<span style='font-size:"+i+"px;line-height:"+g+"'>"+h+"</span>").appendTo("#calcLabelSize");f.outerwidth=e.outerWidth();f.outerheight=e.outerHeight();e.remove();$("#calcLabelSize").remove();return f};this.getAppendSpan=function(f,h){var g="";if(h>=14){for(var e=0;e<f;e++){g+='<span style="color:white">.</span>'}}return g};this.render=function(){c.firstRender=true;if(c.chartoption.xAxis.categories!=undefined){if(c.chartoption.xAxis.categories.length>0&&isArray(c.chartoption.xAxis.categories[0])){var k=$("#"+c.chartoption.chart.renderTo).width()-80;var l=c.chartoption.plotOptions.column.groupPadding;var j=0;$.each(c.chartoption.xAxis.categories,function(i,n){if(n.length>j){j=n.length}});var m=k*(1-2*l)/j;var h=(m/c.chartoption.xAxis.categories.length);h=h*(1-2*c.chartoption.plotOptions.column.plotPadding);if(h>c.maxColumnWidth){c.chartoption.plotOptions.column.pointWidth=c.maxColumnWidth}else{c.chartoption.plotOptions.column.pointWidth=null}}else{if(c.autorotation>-1){c.chartoption.xAxis.labels.rotation=c.autorotation}if(c.autostep>-1){c.chartoption.xAxis.labels.step=c.autostep}c.calcWidth()}c.xAxiscategories=c.chartoption.xAxis.categories}if(c.chartoption.yAxis.length>0){$.each(c.chartoption.yAxis,function(i,n){if("linkedTo" in n){c.oldLinkedTo=n.linkedTo}})}c.highchart=new Highcharts.Chart(c.chartoption);if(c.chartoption.xAxis.categories!=undefined&&c.chartoption.xAxis.categories.length>0&&isArray(c.chartoption.xAxis.categories[0])){var e=[];var f=[];c.categorydata=[];for(var g=0;g<c.highchart.series.length;g++){if(c.highchart.series[g].type=="column"&&c.highchart.series[g].visible){e.push(c.highchart.series[g]);if(c.chartoption.xAxis.categories[g]!=undefined){c.categorydata.push(c.chartoption.xAxis.categories[g])}}if(c.highchart.series[g].type=="bar"&&c.highchart.series[g].visible){f.push(c.highchart.series[g]);if(c.chartoption.xAxis.categories[g]!=undefined){c.categorydata.push(c.chartoption.xAxis.categories[g])}}}if(e.length>0){c.multiColumnLoad(e,c.highchart)}if(f.length>0){c.multiBarLoad(f,c.highchart)}}};this.showLoading=function(){if(c.highchart!=undefined){c.highchart.showLoading()}};this.hideLoading=function(){if(c.highchart!=undefined){c.highchart.hideLoading()}};this.getMaxLenPix=function(k){var j=c.getFontPix();var h={width:0,height:0,count:0};for(var g=0;g<k.length;g++){var f=getStringPx(k[g],j);if(f>h.width){h.width=f}var e=getStringMaxHeight(k[g],j);if(e>h.height){h.height=e}if(k[g].length>h.count){h.count=k[g].length}}return h};this.getFontPix=function(){var e;if(c.highchart!=undefined&&c.highchart.xAxis!=undefined&&c.highchart.xAxis.length>0&&c.highchart.xAxis[0].options!=undefined&&c.highchart.xAxis[0].options.labels!=undefined){e=c.highchart.xAxis[0].options.labels.style.fontSize}else{e=c.chartoption.xAxis.labels.style.fontSize}e=e?parseInt(e.replace("px",""),10):c.chartoption.chart.style.fontSize;e=e?parseInt(e.replace("px",""),10):12;return e};this.calcWidth=function(){var k=c.chartoption.xAxis.categories;var i=c.getMaxLenPix(k);var f=i.width;var e=i.height;var l=$("#"+c.chartoption.chart.renderTo).width();var g=k.length;var h=c.chartoption.chart.marginLeft+c.chartoption.chart.marginRight;var j=(l-h)/g;var m=1;if(c.chartoption.xAxis.labels.rotation==0){m=Math.ceil(f/j)}else{m=Math.ceil(e/j)}var n=(f>j)?true:false;var o=(e>j)?true:false;if(c.autorotation==-1){if(n){if(c.chartoption.xAxis.labels.rotation==0){c.chartoption.xAxis.labels.rotation=90;c.chartoption.xAxis.labels.align="left";c.chartoption.xAxis.labels.y=5}else{if(c.autostep==-1){c.chartoption.xAxis.labels.step=m}}}else{if(c.chartoption.xAxis.labels.rotation==90){c.chartoption.xAxis.labels.rotation=0;c.chartoption.xAxis.labels.align="center";c.chartoption.xAxis.labels.y=0}else{if(c.autostep==-1){c.chartoption.xAxis.labels.step=m}}}}else{if(c.autostep==-1){c.chartoption.xAxis.labels.step=m}}};this.onResize=function(){if(c.highchart!=undefined&&c.highchart!=null){c.destroy();c.render()}};this.onResizing=function(){if(c.highchart!=undefined&&c.highchart!=null){var e=$("#"+c.chartoption.chart.renderTo)}};this.destroy=function(){if(c.highchart!=undefined&&c.highchart!=null){c.highchart.destroy()}}};if(!window.Global){window.Global=new Object()}Global._RequestQueue=function(){this.tag;this._requestingQueue=new Array();this._requestDelegateQueue=new Array();this._requestInProgress=0;this._maxConcurrentRequest=2};Global._RequestQueue.prototype={setTag:function(a){if(this.tag!=undefined&&this.tag!=a){this._requestDelegateQueue=new Array()}this.tag=a},enqueueRequestDelegate:function(a){a.requestobj.tag=this.tag;this._requestDelegateQueue.push(a);this._request()},next:function(){this._requestInProgress--;this._request()},_request:function(){if(this._requestDelegateQueue.length<=0){return}if(this._requestInProgress>=this._maxConcurrentRequest){return}this._requestInProgress++;var a=this._requestDelegateQueue.shift();a.call(null)}};Global.RequestQueue=new Global._RequestQueue();window._progIDs=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.XMLHttpRequest){window.XMLHttpRequest=function(){for(var c=0;c<window._progIDs.length;c++){try{var a=new _originalActiveXObject(window._progIDs[c]);return a}catch(b){}}return null}}if(window.ActiveXObject){window._originalActiveXObject=window.ActiveXObject;window.ActiveXObject=function(b){b=b.toUpperCase();for(var a=0;a<window._progIDs.length;a++){if(b===window._progIDs[a].toUpperCase()){return new XMLHttpRequest()}}return new _originalActiveXObject(b)}}window._originalXMLHttpRequest=window.XMLHttpRequest;window.XMLHttpRequest=function(){this._async=true;this._xmlHttpRequest=new _originalXMLHttpRequest();this.readyState=this._xmlHttpRequest.readyState;this._xmlHttpRequest.onreadystatechange=this._createDelegate(this,this._internalOnReadyStateChange)};window.XMLHttpRequest.prototype={open:function(c,a,b){this._async=b;this._xmlHttpRequest.url=a;this._xmlHttpRequest.open(c,a,b);this.readyState=this._xmlHttpRequest.readyState},send:function(a){var b=this._createDelegate(this,function(){if(typeof _gaq!="undefined"){_gaq.push(["_trackPageview",this._xmlHttpRequest.url])}this._xmlHttpRequest.send(a);this.readyState=this._xmlHttpRequest.readyState});b.requestobj=this;if(this._async){Global.RequestQueue.enqueueRequestDelegate(b)}else{Global.RequestQueue._requestInProgress++;b.call(null)}},setRequestHeader:function(b,a){this._xmlHttpRequest.setRequestHeader(b,a)},getResponseHeader:function(a){return this._xmlHttpRequest.getResponseHeader(a)},getAllResponseHeaders:function(){return this._xmlHttpRequest.getAllResponseHeaders()},abort:function(){this._xmlHttpRequest.abort();this.readyState=this._xmlHttpRequest.readyState},_internalOnReadyStateChange:function(){var b=this._xmlHttpRequest;try{this.readyState=b.readyState;this.responseText=b.responseText;this.responseXML=b.responseXML;this.statusText=b.statusText;this.status=b.status}catch(a){}if(4===this.readyState||0===this.readyState){Global.RequestQueue.next()}if(this.tag!=undefined&&this.tag!=null&&this.tag!=Global.RequestQueue.tag){return false}if(this.onreadystatechange){this.onreadystatechange.call(null)}},_createDelegate:function(a,b){return function(){return b.apply(a,arguments)}}};var offsetfromcursorX=12;var offsetfromcursorY=10;var offsetdivfrompointerX=10;var offsetdivfrompointerY=14;var div1=document.createElement("div");document.body.appendChild(div1);div1.id="dhtmltooltip";var img1=document.createElement("img");document.body.appendChild(img1);img1.id="dhtmlpointer";img1.setAttribute("src","../images/arrow2.gif");var ie=document.all;var ns6=document.getElementById&&!document.all;var enabletip=false;if(ie||ns6){var tipobj=document.all?document.all.dhtmltooltip:document.getElementById?document.getElementById("dhtmltooltip"):""}var pointerobj=document.all?document.all.dhtmlpointer:document.getElementById?document.getElementById("dhtmlpointer"):"";function ietruebody(){return(document.compatMode&&document.compatMode!="BackCompat")?document.documentElement:document.body}function ddrivetip(b,a,c){if(ns6||ie){if(typeof a!="undefined"){tipobj.style.width=a+"px"}if(typeof c!="undefined"&&c!=""){tipobj.style.backgroundColor=c}tipobj.style.zIndex=9999;tipobj.innerHTML=b;enabletip=true;return false}}function positiontip(i){if(enabletip){var c=false;var d=(ns6)?i.pageX:event.clientX+ietruebody().scrollLeft;var b=(ns6)?i.pageY:event.clientY+ietruebody().scrollTop;var h=ie&&!window.opera?ietruebody().clientWidth:window.innerWidth-20;var a=ie&&!window.opera?ietruebody().clientHeight:window.innerHeight-20;var g=ie&&!window.opera?h-event.clientX-offsetfromcursorX:h-i.clientX-offsetfromcursorX;var f=ie&&!window.opera?a-event.clientY-offsetfromcursorY:a-i.clientY-offsetfromcursorY;var j=(offsetfromcursorX<0)?offsetfromcursorX*(-1):-1000;if(g<tipobj.offsetWidth){tipobj.style.left=d-tipobj.offsetWidth+"px";c=true}else{if(d<j){tipobj.style.left="5px"}else{tipobj.style.left=d+offsetfromcursorX-offsetdivfrompointerX+"px";pointerobj.style.left=d+offsetfromcursorX+"px"}}if(f<tipobj.offsetHeight){tipobj.style.top=b-tipobj.offsetHeight-offsetfromcursorY+"px";c=true}else{tipobj.style.top=b+offsetfromcursorY+offsetdivfrompointerY+"px";pointerobj.style.top=b+offsetfromcursorY+"px"}tipobj.style.visibility="visible";if(!c){pointerobj.style.visibility="visible"}else{pointerobj.style.visibility="hidden"}}}function hideddrivetip(){if(ns6||ie){enabletip=false;tipobj.style.visibility="hidden";pointerobj.style.visibility="hidden";tipobj.style.left="-1000px";tipobj.style.backgroundColor="";tipobj.style.width="";tipobj.style.zIndex=""}}document.onmousemove=positiontip;function createUtilSpanHtml(q,u,c,e,b,h,p,j,m,f,n){var g="";if(p!=undefined&&p!=""){g="rtext='"+p+"'"}var s="";if(c!=undefined&&c!=""){s="code='"+c+"'"}var k="";if(h!=undefined){k="onclick='"+h+"(this)'"}var t="";if(j!=undefined&&j!=""){t="emotype='"+j+"'"}var o="";if(f!=undefined&&f!=""){o="calctype='"+f+"'"}var r="";if(m!=undefined&&m!=""){r="btype='"+m+"'"}var l="";if(typeof n==="string"&&n!==""){l="guid='"+n+"'"}var i="";var d="";i+="<span class='selwordsbox'>";if(e){var a="";if(b!=undefined&&b!=0){d="exclude='"+b+"'";a="style='color:#000000;'"}i+="<a class='excludeitem' onclick='excludeUtilItemFun(this)' "+a+">不</a>"}i+="<span class='"+q+"' "+g+" "+s+" "+d+" "+t+" "+o+" "+r+" "+l+" >"+u+"</span>";i+="<a class='cancleitem' "+g+" "+s+" "+t+" "+o+" "+k+">×</a>";i+="</span>";return i}function excludeUtilItemFun(b){var c=$(b).next();var a=$(c).attr("exclude");if(a==undefined){$(c).attr("exclude",1);$(b).css("color","#000000")}else{$(c).removeAttr("exclude");$(b).css("color","#DADADA")}}function createUtilSelectSpanHtml(e,a,c,d,i){var h="";if(c!=undefined&&c!=""){h="code='"+c+"'"}var b="";if(d!=undefined){b="onclick='"+d+"(this)'"}var g="";if(i!=undefined&&i!=""){g="calctype='"+i+"'"}else{i=""}var f="";f+="<span class='selwordsbox'>";f+="<input type='radio' class='outborder' name='fields_orderby' id='fields_orderby_"+c+""+i+"' value='"+c+"' "+g+" />";f+="<label class='"+e+"' "+h+" for='fields_orderby_"+c+""+i+"' >"+a+"</label>";f+="<a class='cancleitem' "+h+" "+g+" "+b+">×</a>";f+="</span>";return f}function myUserRecommend(d,j,b){var e=this;var d=d;var g;var c=50;var h;var f;var i=function(){$("#namesbox").remove();var k="<div id='bluropt'>用户筛选 :<input type='checkbox' name='bluruseropt' checked='checked' id='bluruseropt_prefix' value='prefix' /><label for='bluruseropt_prefix'>以\""+d+"\"开头</label><input type='checkbox'  name='bluruseropt' id='bluruseropt_suffix' value='suffix' /><label for='bluruseropt_suffix'>以\""+d+"\"结尾</label><input type='checkbox' name='bluruseropt' id='bluruseropt_infix' value='infix' /><label for='bluruseropt_infix'>包含\""+d+'"</label></div>';k+="<fieldset>";k+="<legend>用户列表</legend>";k+="<div id='names'></div><div id='uapagestyle' style='margin-top:2px;float:left;width:100%;margin:5px;'></div>";k+="<div style='clear:both;'><span>模糊查询用户:</span></div>";k+="<div id='blurqueryuser'></div>";k+="</fieldset>";k+="<fieldset>";k+="<legend>已选择的用户</legend>";k+="<div id='selecteduser'></div>";k+="</fieldset>";k+="<div class='search'><input id='usersubmit' name='usersubmint' type='button' value='确定' />  <input id='usercancle' name='usercancle' type='button' value='取消' /></div>";$("<div id='namesbox' title='用户列表-包含\""+d+"\"的用户'></div>").insertAfter("body");$("#namesbox").append(k);var l="";l+="<a style='margin:2px;color:blue;width:100px;float:left;cursor:pointer;' rtext='"+d+"*' onclick='sendName(this)'>以\""+d+'"开头</a>';l+="<a style='margin:2px;color:blue;width:100px;float:left;cursor:pointer;' rtext='*"+d+"' onclick='sendName(this)'>以\""+d+'"结尾</a>';l+="<a style='margin:2px;color:blue;width:100px;float:left;cursor:pointer;' rtext='*"+d+"*' onclick='sendName(this)'>包含\""+d+'"</a>';$("#blurqueryuser").append(l);$("#bluropt").buttonset();$("#namesbox").dialog({autoOpen:false,modal:true,width:550,height:540});$("#bluropt input[name=bluruseropt]").bind("click",function(){var m=$("#bluropt input[name=bluruseropt]:checked").length;if(m==0){var n=$(this).attr("id");$("#bluropt label[for="+n+"]").addClass("ui-state-active");return false}e.bluroptClick()});e.bluroptClick();$("#usersubmit").bind("click",function(){var m=[];$("#selecteduser .selusername").each(function(p,n){var o={};o.name=$(this).attr("rtext");if($(this).attr("exclude")!=undefined){o.exclude=$(this).attr("exclude")}m.push(o)});j(m);$("#namesbox").dialog("close")});$("#usercancle").bind("click",function(){$("#namesbox").dialog("close");$("#selecteduser").empty()})};this.bluroptClick=function(){var l=[];$("#bluropt input[name=bluruseropt]").each(function(){if($(this).prop("checked")){l.push($(this).val())}});if(l.length>0){if(l.length==1){f=l[0]}else{var k=true;$.each(l,function(o,n){if(n=="infix"){k=false;return false}});if(k){f="prefix_suffix"}else{f="infix"}}}if(d!=undefined&&d!=""&&d!=undefined){a(c,1);$("#names").html("<img src='"+config.imagePath+"wait.gif'  style='padding:100px;padding-left:230px;' id='uawait'/>");$("#uapagestyle").empty();$("#namesbox").dialog("open")}else{alert("请输入用户名！")}};var a=function(k,m){if(m==""||m==null||m==undefined){e.curpage2=1}else{e.curpage2=m}var l=config.solrData+"?type=kwblur&fieldname=users_screen_name&keyword="+encodeURIComponent(d)+"&blurtype="+f+"&page="+e.curpage2+"&pagesize="+k;ajaxRequest(l,function(o){if(o.result!=undefined&&o.result==false){alert(o.msg);return false}var n=o[0].datalist;if(n!=""&&n!=null&&n!=undefined){$("#names").empty();var p="";$.each(n,function(s,q){var r=true;$("#selecteduser .selusername").each(function(w,u){var x=$(this).attr("rtext");if(q.screen_name==x){r=false}});var t="";if(r){t="class='notselected'"}else{t="class='selected'"}p+="<a "+t+" rtext='"+q+"' onclick='sendName(this)'>"+q+"</a>"});$("#names").append(p)}else{$("#uawait").css({display:"none"});$("#names").text("无此相关用户！")}if(o[0].totalcount>k){pageDisplay(o[0].totalcount,a,"uapagestyle",k,e.curpage2)}else{$("#grouppage").empty()}},"json",function(){},function(){$("#names").html("<img src='"+config.imagePath+"wait.gif'  style='padding:100px;padding-left:230px;' id='uawait'/>")},function(){})};this.sendName=function(o){var m=$(o).attr("rtext");var n=$(o).text();$(o).removeClass().addClass("selected");var k=true;$("#selecteduser .selusername").each(function(q,p){var r=$(this).attr("rtext");if(m==r){$(this).parent().remove();$(o).css("background-color","white");k=false}});if(k){if(b==undefined){b=true}var l=createUtilSpanHtml("selusername",n,undefined,b,undefined,"cancleWord",m);$("#selecteduser").append(l)}else{}};this.cancleWord=function(l){$(l).parent().remove();var k=$(l).attr("rtext");$("#names a[rtext='"+k+"']").css("background-color","white");$("#blurqueryuser a[rtext='"+k+"']").css("background-color","white")};i()}function delfilterrelation(b,a){if(b.fields.length>0){$.each(b.fields,function(d,c){if(c==a){b.fields[d]=-1;return false}})}if(b.filterlist.length>0){$.each(b.filterlist,function(d,c){delfilterrelation(c,a)})}}function myFacetRangeRecommend(b,m,n,g,c,f){if(m!=null){m.contrast=null;if(m.classifyquery!=null){var a=m.classifyquery.fieldname;var p=getFilterValue(a,m.filtervalue,m.filter[a].datatype);var k;$(m.filtervalue).each(function(q,i){if(i.fieldname==a&&i.fieldvalue.datatype=="array"){k=q}});for(var e=0;e<p.length;e++){m.filtervalue.push(p[e])}if(m.filterrelation==null){initFilterRelation(m)}else{var o={opt:"or",filterlist:[],fields:[]};o.filterlist.push(m.filterrelation);for(var e=0;e<p.length;e++){o.fields.push(m.filtervalue.length-e-1)}m.filterrelation=o}delfilterrelation(m.filterrelation,k)}m.classifyquery=null;m.facet.field=[];m.facet.range=[];m.select.value=[];m.select.value.push(b);m.output.outputtype=1;m.output.orderby=b;m.output.ordertype="asc";m.output.data_limit=0;m.output.count=1;if(m.filtervalue==null){m.filtervalue=[]}var d=false;$(m.filtervalue).each(function(q,r){if(r.fieldname==b){d=true;return false}});if(!d){var j,h;if(m.filter[b]!=undefined&&(m.filter[b].datatype=="range")){j="range";h={start:"*",end:"*"}}else{j="string";h="*"}m.filtervalue.push(createFiltervalue(b,j,h,0));if(m.filterrelation==null){initFilterRelation(m)}else{if(m.filterrelation.opt=="and"){m.filterrelation.fields.push(m.filtervalue.length-1)}else{var o={opt:"and",filterlist:[],fields:[]};o.filterlist.push(m.filterrelation);o.fields.push(m.filtervalue.length-1);m.filterrelation=o}}}}if(f==undefined){f=true}var l=config.requestData+"?instanceid=0&elementid=0&hasformjson=1&returnoriginal=0";$.ajax({type:"POST",dataType:"json",async:f,data:JSON.stringify(m),url:l,contentType:"application/json",success:function(q){if(q!=""&&q!=null&&q!=undefined){if(q.errorcode==undefined&&q.length>0&&q[0].datalist!=undefined&&q[0].datalist.length>0){var i={};i.min=q[0].datalist[0][b];m.output.ordertype="desc";$.ajax({type:"POST",dataType:"json",async:f,data:JSON.stringify(m),url:l,contentType:"application/json",success:function(r){if(r.errorcode==undefined&&r.length>0&&r[0].datalist!=undefined&&r[0].datalist.length>0){i.max=r[0].datalist[0][b];n(i)}else{if(g!=undefined){g(r)}}},complete:function(){$("#testwait").remove()}})}else{if(g!=undefined){g(q)}}}},beforeSend:function(){if(c!=undefined){$("#"+c+"").after("<span id='testwait'><img src='"+config.imagePath+"minwait.gif' width='15' height='15' /></span>")}},error:function(){alert("数据请求异常!")}})}function myAreaSelect(f,d){var g=this;var c=d;var e=f;var b="CN";var a=function(){$("#areaselecthidediv").remove();var i="<div id='areaselectslttip'>";i+="<h3>";i+="<span>提示：</span><b><input type='button' value='确定' id='areaselecttipsmt'>&nbsp;&nbsp;<input type='button' value='清空'></b>";i+="</h3>";i+="<p>当您选择以下的城市时，将会获得更为准确的搜索结果<br>请选择：(点击省市名称可选具体地区)</p>";i+="</div>";i+="<div id='areaselectselectedbox' style='display:none;'>";i+="<h3>";i+="<span>您选择的地区是：</span><b><input type='button' value='确定' id='areaselectsmtarea'>&nbsp;&nbsp;<input type='button' value='清空' id='areaselectresetarea'></b>";i+="</h3>";i+="<div id='areaselectselectedarea'></div>";i+="</div>";i+="<div>";i+="<h2>";i+="<h3><span>省市列表：</span></h3>";i+="</h2>";i+="<ul id='areaselectallprocity'  style='list-style-type:none;padding-left:0;'>";i+="<li><img src='"+config.imagePath+"wait.gif'  style='padding:80px;padding-left:200px;' id='areaawait'/></li>";i+="</ul>";i+="</div>";i+="<div id='areaselectsublayer' class='sublayerdiv'>";i+="<input type='hidden' name='' value='' id='areaselecthiddenp'>";i+="<ul id='areaselectcity'  style='list-style-type:none;padding-left:0;'><li></li></ul></div>";$("<div id='areaselecthidediv' title='请选择地区'></div>").insertAfter("body");$("#areaselecthidediv").append(i);$("#areaselecthidediv").dialog({autoOpen:true,modal:true,width:480,height:460,resizable:false,close:function(){$("#areaselectsublayer").dialog("close")}});$("#areaselectsublayer").dialog({autoOpen:false});var h=config.dataUrl+"?type=selectprovince&countrycode="+b;ajaxRequest(h,g.areaProvince,"json");$("#areaselectresetarea").bind("click",function(){$("#areaselectselectedarea").empty();$("#areaselectallprocity input:checkbox").attr("checked",false);$("#areaselectcity input:checkbox").attr("checked",false);$("#areaselect").val("请选择地区");$("#areaselectcode").val("");$("#areaselectslttip").css("display","block");$("#areaselectselectedbox").css("display","none")});$("#areaselectsmtarea").bind("click",function(){var j=[];$("#areaselectselectedarea .areaitem").each(function(){var k={};k.name=commonFun.trim($(this).text());k.code=$(this).attr("areacode");j.push(k)});e(j);$("#areaselecthidediv").dialog("close")});$("#areaselecttipsmt").bind("click",function(){var j=[];e(j);$("#areaselecthidediv").dialog("close")})};this.cancleArea=function(k){var h=$(k).attr("id");$("input[value="+h+"]").attr("checked",false);$(k).parent().remove();var j=true;$("#areaselectselectedarea .areaitem").each(function(){var l=$(this).attr("areacode");if(l.substr(0,2)==h.substr(0,2)){j=false}});if(j){var i=h.substr(0,2)+"0000";$("#areaselectallprocity input[value="+i+"]").parent().css("backgroundColor","#ffffff");$("#areaselectallprocity input[value="+i+"]").removeAttr("disabled")}};this.addArea=function(l){var k=l.code;var j=l.name;var i=$("input[type=checkbox][value="+k+"]").prop("checked");if(i){var h=$("#areaselectselectedarea .areaitem").length+1;$("#areaselectslttip").css("display","none");$("#areaselectselectedbox").css("display","block");$("#areaselectselectedarea").append("<span class='selwordsbox'><span style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;' class='areaitem' areacode='"+k+"'>"+j+"</span><a class='cancleitem' id="+k+"  onclick='cancleArea(this)'>×</a></span>");if(l.code.substr(2,4)!="0000"){var m=l.code.substr(0,2)+"0000";$("#areaselectselectedarea .areaitem").each(function(p){var o=$(this).attr("areacode");if(o==m){$(this).parent().remove();$("#areaselectallprocity input[value="+m+"]").attr("checked",false)}});$("#areaselectallprocity input[value="+m+"]").parent().css("backgroundColor","#6FBAE4");$("#areaselectallprocity input[value="+m+"]").attr("disabled","disabled")}}else{$("#areaselectselectedarea .areaitem").each(function(o){var p=$(this).text();if(p==j){$(this).parent().remove()}});var n=true;$("#areaselectselectedarea .areaitem").each(function(){var o=$(this).attr("areacode");if(o.substr(0,2)==k.substr(0,2)){n=false}});if(n){var m=k.substr(0,2)+"0000";$("#areaselectallprocity input[value="+m+"]").parent().css("backgroundColor","#ffffff");$("#areaselectallprocity input[value="+m+"]").attr("disabled",false)}var h=$("#areaselectselectedarea .areaitem").length;if(h==0){$("#areaselectslttip").css("display","block");$("#areaselectselectedbox").css("display","none")}}};this.getSubArea=function(i){var j=i.code;$("#areaselecthiddenp").attr("name",i.name);$("#areaselecthiddenp").attr("value",i.code);if(j=="110000"||j=="120000"||j=="310000"||j=="500000"){citycode=j.substr(0,3)+"100,"+j.substr(0,3)+"200";var h=config.dataUrl+"?type=selectdistrict&countrycode="+b+"&provincecode="+j+"&citycode="+citycode}else{var h=config.dataUrl+"?type=selectcity&countrycode="+b+"&provincecode="+j}ajaxRequest(h,g.areaCity,"json")};this.areaProvince=function(h){$("#areaselectallprocity").empty();$.each(h[0].datalist,function(j,l){var k=JSON.stringify(l);$("#areaselectallprocity").append("<li style='width:140px;float:left;cursor:pointer;'><input type='checkbox' class='outborder' onclick='addArea("+k+")' value="+l.code+" /><a onclick='getSubArea("+k+")'>"+l.name+"</a></li>")});if(c!=undefined&&c!=""&&c!=null){$("#areaselectselectedarea").empty();$("#areaselectslttip").css("display","none");$("#areaselectselectedbox").css("display","block");$.each(c,function(j,i){$("input[value="+i.code+"]").attr("checked","checked");if(i.code.substr(2,4)!="0000"){var l=i.code.substr(0,2)+"0000";$("#areaselectallprocity input[value="+l+"]").parent().css("backgroundColor","#6FBAE4")}$("#areaselectselectedarea").append("<span class='selwordsbox'><span style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;' class='areaitem' areacode='"+i.code+"'>"+i.name+"</span><a class='cancleitem' id="+i.code+"  onclick='cancleArea(this)'>×</a></span>")})}};this.areaCity=function(h){var i=$("#areaselecthiddenp").val();var j=$("input[value="+i+"]:checked").val();$("#areaselectsublayer").dialog("open");$("#areaselectsublayer").attr("areacode",i);$("#areaselectcity").empty();$.each(h[0].datalist,function(k,m){var l=JSON.stringify(m);$("#areaselectcity").append("<li style='width:100px;float:left;cursor:pointer;'><input type='checkbox' class='outborder' onclick='addArea("+l+")' value="+m.code+" id=city"+m.code+" /><label for=city"+m.code+">"+m.name+"</label></li>")});$("#areaselectselectedarea .areaitem").each(function(l){var k=$(this).attr("areacode");$("input[value="+k+"]").attr("checked","checked")})};a()}function myBizSelect(d,b,g){var h=this;var c=b;var a=d;var f=false;var e=function(){$("#bizbizlayer").remove();var i="<div class='sltbox' id='bizselecttip'>";i+="<h3>";i+="<span>提示：</span><b><input type='button' value='确定' id='bizbiztip'>&nbsp;&nbsp;<input type='button' class='' value='清空' disabled='' name=''></b>";i+="</h3>";i+="<p>当您选择以下的具体行业时，将会获得更为准确的搜索结果</p>";i+="</div>";i+="<div class='sltbox' id='bizselectbox' style='display:none;'>";i+="<h3>";i+="<span>您选择的行业是：</span><b><input type='button' value='确定' id='bizsmtbiz'>&nbsp;&nbsp;<input type='button' class='' value='清空' name='' id='bizresetbiz'></b>";i+="</h3>";i+="<div id='bizselectedbiz'></div>";i+="</div>";i+="<div class=''>";i+="<h2 id=''>";i+="</h2>";i+="<h3><span>行业列表</span></h3>";i+="<ul id='bizallbusiness' style='list-style-type:none;padding-left:0;'>";i+="<li><img src='"+config.imagePath+"wait.gif'  style='padding:100px;padding-left:250px;' id='areaawait'/></li>";i+="</ul>";i+="</div>";$("<div id='bizbizlayer'  title='请选择行业'></div>").insertAfter("body");$("#bizbizlayer").append(i);if(g!=""&&g!=undefined){f=g}if(f){h.bizemotionChk()}$("#bizbizlayer").dialog({autoOpen:true,modal:true,width:550,height:450,resizable:false});var j=config.dataUrl+"?type=getbusiness";ajaxRequest(j,h.getbusiness,"json");$("#bizresetbiz").bind("click",function(){$("#bizselectedbiz").empty();$("#bizallbusiness input:checkbox").attr("checked",false);$("#biz").val("请选择地区");$("#bizcode").val("");$("#bizselecttip").css("display","block");$("#bizselectbox").css("display","none")});$("#bizsmtbiz").bind("click",function(){var k=[];$("#bizselectedbiz .bizitem").each(function(l){var m={};m.name=commonFun.trim($(this).text());m.code=$(this).attr("title");k.push(m)});a(k);$("#bizbizlayer").dialog("close")});$("#bizbiztip").bind("click",function(){var k=[];a(k);$("#bizbizlayer").dialog("close")})};this.bizemotionChk=function(){var i='<div id="bizemotiondiv"><span id="bizemotion">';i+='<input type="checkbox" name="bizemotion" id="bizemotion1" value="1" class="outborder" /><label for="bizemotion1">反对</label>';i+='<input type="checkbox" name="bizemotion" id="bizemotion2" value="2" class="outborder" /><label for="bizemotion2">负面</label>';i+='<input type="checkbox" name="bizemotion" id="bizemotion3" value="3" class="outborder" /><label for="bizemotion3">中性</label>';i+='<input type="checkbox" name="bizemotion" id="bizemotion4" value="4" class="outborder" /><label for="bizemotion4">正面</label>';i+='<input type="checkbox" name="bizemotion" id="bizemotion5" value="5" class="outborder" /><label for="bizemotion5">赞赏</label>';i+='<input type="checkbox" name="bizemotion" id="bizemotionall" value="*" class="outborder" /><label for="bizemotionall">全部</label></span></div>';$("#bizallbusiness").before(i)};this.addBusiness=function(p){var m=p.code;var l=p.name;if(f){var i=[];var o=[];var q=$("#bizemotiondiv input[name=bizemotion]:checked").length;if(q==0){alert("请选择情感!");$("#bizallbusiness input[value="+p.code+"]").attr("checked",false);return false}$("#bizemotiondiv input[name=bizemotion]:checked").each(function(t,r){var u=$(this).attr("id");if(u!="bizemotionall"){var s=$("#bizemotiondiv label[for="+u+"]").text();i.push(s);var v=$(this).val();o.push(v)}});var n=$("#bizemotiondiv input[name=bizemotion]").length;if(o.length>0){if(o.length==n-1){l=p.name+"(全部)";m=p.code+"_*"}else{l=p.name+"("+i.join(",")+")";m=p.code+"_"+o.join(",")}}}var k=$("#bizallbusiness input[value="+p.code+"]:checked").val();if(k!=undefined){$("#bizselecttip").css("display","none");$("#bizselectbox").css("display","block");$("#bizselectedbiz").append("<span class='selbizbox'><span style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;' class='bizitem' title='"+m+"'>"+l+"</span><a style='border:1px solid #cccccc;padding:1.5px;color:red; cursor:pointer;' id="+p.code+" onclick='cancleBiz(this)'>×</a></span>")}else{$("#bizselectedbiz .bizitem").each(function(r){var s=$(this).text();if(s==l){$(this).parent().remove()}});var j=$("#bizselectedbiz .bizitem").length;if(j==0){$("#bizselecttip").css("display","block");$("#bizselectbox").css("display","none")}}};this.cancleBiz=function(j){var i=$(j).attr("id");$("input[value="+i+"]").attr("checked",false);$(j).parent().remove()};this.getbusiness=function(i){$("#bizallbusiness").empty();$.each(i[0].datalist,function(j,l){var k=JSON.stringify(l);$("#bizallbusiness").append("<li style='width:250px;float:left;cursor:pointer;'><input type='checkbox' class='outborder' onclick='addBusiness("+k+")' value="+l.code+" />"+l.name+"</li>")});if(c!=undefined&&c!=""&&c!=null){$("#bizselectedbiz").empty();$("#bizselecttip").css("display","none");$("#bizselectbox").css("display","block");$.each(c,function(l,j){$("#bizallbusiness input[value="+j.code+"]").attr("checked","checked");$("#bizselectedbiz").append("<span class='selbizbox'><span class='selbizbox'><span style='border:1px solid #cccccc;padding:1.5px;margin: 2px 0px 2px 2px;' class='bizitem' title='"+j.code+"'>"+j.name+"</span><a style='border:1px solid #cccccc;padding:1.5px;color:red; cursor:pointer;' id="+j.code+" onclick='cancleBiz(this)'>×</a></span>")})}};e()}function myKeywordRecommend(e,k,f,b){var d=this;var i;this.pagesize=20;var j;var h;var g=function(){var m;if(b!=""&&b!=undefined){m=b}else{m="关键词"}$("#keywordsbox").remove();var n="<div id='blurkeywordopt'>"+m+"筛选:<br/><input type='checkbox' name='blurwordopt' checked='checked' id='blurwordopt_prefix' value='prefix'/><label for='blurwordopt_prefix'>以\""+e+"\"开头</label><input type='checkbox'  name='blurwordopt' id='blurwordopt_suffix' value='suffix' /><label for='blurwordopt_suffix'>以\""+e+"\"结尾</label><input type='checkbox' name='blurwordopt' id='blurwordopt_infix' value='infix' /><label for='blurwordopt_infix'>包含\""+e+'"</label></div>';n+="<fieldset>";n+="<legend>"+m+"列表</legend>";n+="<div id='blurwords'><img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait1'/></div>";n+="<div id='blurpage' style='margin:5px;float:left;width:100%;'></div>";n+="<div style='clear:both;'><span>模糊查询"+m+":</span></div>";n+="<div id='blurqueryword'></div>";n+="</fieldset>";n+="<fieldset>";n+="<legend>分词列表</legend>";n+="<div id='tokenwords'><img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait2'/></div>";n+="<div id='tokenpage' style='margin:5px;float:left;width:100%;'></div>";n+="</fieldset>";n+="<fieldset>";n+="<legend>已选择的"+m+"</legend>";n+="<div id='selectedwords'></div>";n+="</fieldset>";n+="<div class='search'><input id='kasubmit' name='kasubmint' type='button' value='确定' />  <input id='kacancle' name='kacancle' type='button' value='取消' /></div>";$("<div id='keywordsbox' title='"+m+'列表-包含"'+e+'"的'+m+"'></div>").insertAfter("body");$("#keywordsbox").append(n);var l="";l+="<a style='margin:2px;color:blue;width:100px;float:left;cursor:pointer;' rtext='"+e+"*' rvalue='prefix' onclick='sendWord(this)'>以\""+e+'"开头</a>';l+="<a style='margin:2px;color:blue;width:100px;float:left;cursor:pointer;' rtext='*"+e+"' rvalue='suffix' onclick='sendWord(this)'>以\""+e+'"结尾</a>';l+="<a style='margin:2px;color:blue;width:100px;float:left;cursor:pointer;' rtext='*"+e+"*' rvalue='infix' onclick='sendWord(this)'>包含\""+e+'"</a>';$("#blurqueryword").append(l);$("#blurkeywordopt").buttonset();$("#keywordsbox").dialog({autoOpen:false,modal:true,width:550,height:460});$("#blurkeywordopt input[name=blurwordopt]").bind("click",function(){var o=$("#blurkeywordopt input[name=blurwordopt]:checked").length;if(o==0){var p=$(this).attr("id");$("#blurkeywordopt label[for="+p+"]").addClass("ui-state-active");return false}d.blurwordoptClick()});d.blurwordoptClick();$("#kasubmit").bind("click",function(){var o=[];$("#selectedwords .selword").each(function(r,p){var q={};q.name=$(this).attr("rtext");if($(this).attr("exclude")!=undefined){q.exclude=$(this).attr("exclude")}o.push(q)});k(o);$("#keywordsbox").dialog("close")});$("#kacancle").bind("click",function(){$("#keywordsbox").dialog("close");$("#selectedwords").empty()})};this.blurwordoptClick=function(){var m=[];$("#blurkeywordopt input[name=blurwordopt]").each(function(){if($(this).prop("checked")){m.push($(this).val())}});if(m.length>0){if(m.length==1){h=m[0]}else{var l=true;$.each(m,function(o,n){if(n=="infix"){l=false;return false}});if(l){h="prefix_suffix"}else{h="infix"}}}if(e!=null&&e!=""&&e!=undefined){a(d.pagesize,1);c(d.pagesize,1);$("#blurwords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait1'/>");$("#blurpage").empty();$("#tokenwords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait2'/>");$("#tokenpage").empty();$("#keywordsbox").dialog("open")}else{alert("请输入"+ftext+"！")}};this.sendWord=function(p){var n=$(p).text();var o=$(p).attr("rtext");$(p).removeClass().addClass("selected");var l=true;$("#selectedwords .selword").each(function(r,q){var s=$(this).attr("rtext");if(o==s){$(this).parent().remove();$(p).removeClass().addClass("notselected");l=false}});if(l){var m=createUtilSpanHtml("selword",n,undefined,true,undefined,"cancleWord",o);$("#selectedwords").append(m)}else{}};this.cancleWord=function(m){$(m).parent().remove();var l=$(m).attr("rtext");$("#blurwords a[rtext='"+l+"']").removeClass().addClass("notselected");$("#tokenwords a[rtext='"+l+"']").removeClass().addClass("notselected");$("#blurqueryword a[rtext='"+l+"']").removeClass().addClass("notselected")};this.changeWord=function(m){var l=$(m).text();$(m).parent().html("<input type='text' value="+l+" onblur='returnBack(this)'/>")};this.returnBack=function(m){var l=$(m).val();$(m).parent().html("<span onclick='changeWord(this)'>"+l+"</span>")};var a=function(l,n){if(n==""||n==null||n==undefined){d.curpage2=1}else{d.curpage2=n}if(f==undefined){f="text"}var m=config.solrData+"?type=kwblur&fieldname="+f+"&keyword="+encodeURIComponent(e)+"&blurtype="+h+"&page="+d.curpage2+"&pagesize="+l;ajaxRequest(m,function(p){if(p[0].totalcount>0){$("#blurwords").empty();var o="";$.each(p[0].datalist,function(s,q){var r=true;$("#selectedwords .selword").each(function(x,w){var y=$(this).attr("rtext");if(q==y){r=false}});var t="";if(r){t="class='notselected'"}else{t="class='selected'"}var u="";if(f=="users_url"){u="style='overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block;' title='"+q+"' "}o+="<a "+t+" rtext='"+q+"' onclick='sendWord(this)' "+u+">"+q+"</a>"});$("#blurwords").append(o);if(p[0].totalcount>l){pageDisplay(p[0].totalcount,a,"blurpage",d.pagesize,d.curpage2)}else{$("#blurpage").empty()}}else{$("#blurwords").text("模糊查询暂无数据！")}},"json",function(){},function(){$("#blurwords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait1'/>")},function(){$("#wait1").css({display:"none"})})};var c=function(l,n){if(n==""||n==null||n==undefined){d.curpage2=1}else{d.curpage2=n}if(f==undefined){f="text"}var m=config.solrData+"?type=kwtoken&fieldname="+f+"&keyword="+encodeURIComponent(e)+"&page="+d.curpage2+"&pagesize="+l;ajaxRequest(m,function(o){if(o[0].totalcount>0){$("#tokenwords").empty();var p="";$.each(o[0].datalist,function(s,q){var r=true;$("#selectedwords .selword").each(function(w,u){var x=$(this).attr("rtext");if(q==x){r=false}});var t="";if(r){t="class='notselected'"}else{t="class='selected'"}p+="<a "+t+" rtext='"+q+"' onclick='sendWord(this)'>"+q+"</a>"});$("#tokenwords").append(p);if(o[0].totalcount>l){pageDisplay(o[0].totalcount,c,"tokenpage",d.pagesize,d.curpage2)}else{$("#tokenpage").empty()}}else{$("#tokenwords").text("分词查询暂无数据！")}},"json",function(){},function(){$("#tokenwords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait2'/>")},function(){$("#wait2").css({display:"none"})})};g()}function myFeatureRecommend(r,k,j,l,i,c,e){var p=this;var f;this.pagesize=20;var o;var n="";var m="";var d=[];var s=false;i=false;var t=function(){var u;if(typeof j!=="undefined"){u=j}else{u="特征分类"}if(typeof c==="undefined"){c=true}$("#keywordsbox").remove();var v="";v+="<div style='text-align:right;'><a href='javascript:void(0)' id='goParent'  style='color:blue;display:none;'>返回上一级</a></div>";v+="<fieldset>";v+="<legend>"+u+"列表</legend>";v+="<div id='featurewords'><img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait1'/></div>";v+="<div id='featurewordspage' style='margin:5px;float:left;width:100%;'></div>";v+="</fieldset>";v+="<fieldset>";v+="<legend>已选择的"+u+"</legend>";v+="<div id='selectedfeaturewords'></div>";v+="</fieldset>";if(i!==false){v+="<div><input id='featureother' name='featureother' type='checkbox' class='outborder' /><label for='featureother' >包含其他</label>&nbsp;&nbsp;名称：<input type='text' id='featureothername' name='featureothername' /></div>"}$("<div id='keywordsbox' title='"+u+"列表'></div>").insertAfter("body");if(e==true&&Global.user.usertype==1){s=true;v+="<div style='margin-top:10px'><input id='allarticle' type='checkbox' name='allarticle' style='vertical-align:middle; margin-top:0;' /><label style='margin-left:10px' for='allarticle'>应用到当前页面</label></div>"}$("#keywordsbox").append(v);if(l!=undefined&&l.length>0){$.each(l,function(y,x){if(x.code=="*"){$("#featureother").attr("checked",true);$("#featureothername").val(x.name)}else{var w=createUtilSpanHtml("selword",x.name,x.code,c,x.exclude,"cancleWord",undefined,undefined,undefined,undefined,x.guid);$("#selectedfeaturewords").append(w)}})}$("#keywordsbox").dialog({autoOpen:false,modal:true,width:550,height:460,buttons:{"确定":function(){var x=[];$("#selectedfeaturewords .selword").each(function(B,z){var A={};A.name=$(this).text();A.code=$(this).attr("code");A.exclude=$(this).attr("exclude");A.guid=$(this).attr("guid");x.push(A)});if(i!=false){if($("#featureother").prop("checked")){var y=$("#featureothername").val();var w={};w.name=y;w.code="*";w.exclude=1;x.push(w)}}k(x);if(!s){$(this).dialog("close")}},"取消":function(){$(this).dialog("close")}},close:function(){$("#keywordsbox").remove()}});p.searchFeature();$("#goParent").bind("click",function(){var x=d.splice(d.length-1,1);var w=x[0].feature_father_guid;if(w=="0"){a(p.pagesize,1);$("#goParent").css("display","none")}else{n=d[d.length-1].fpclass;m=d[d.length-1].guid;h(p.pagesize,1)}$("#featurewords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait1'/>");$("#featurewordspage").empty()})};this.searchFeature=function(){if(r!=null&&r!=""&&r!=undefined){a(p.pagesize,1);$("#featurewords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait1'/>");$("#featurewordspage").empty();$("#keywordsbox").dialog("open")}};var b=function(x){var w=new RegExp("##","g");var u=new RegExp("#","g");var v=x.replace(w,",").replace(u,"");return v};var g=function(w){var u=b(w);var v=u.split(",");return v[1]||v[0]};var q=function(x){var v=b(x);var w=v.split(",");var u="";u="("+w[0]+")";if(w[1]!="*"){u=w[1]}return u};var a=function(v,w){if(w==""||w==null||w==undefined){p.curpage2=1}else{p.curpage2=w}if(r==undefined){r="text"}r=getFacetname(r);var u=config.solrData+"?type=selectfeaturepclass&fieldname="+r+"&page="+p.curpage2+"&pagesize="+v;ajaxRequest(u,function(y){if(y[0].totalcount>0){$("#featurewords").empty();var x="<table class='table2' cellspacing='0' cellpadding='0' border='0' style='width:100%;'><tr class='trnotselected'><td>父类</td><td>操作</td></tr>";$.each(y[0].datalist,function(B,z){var A=true;$("#selectedfeaturewords .selword").each(function(E,D){var F=$(this).attr("code");if(z.feature_class==F){A=false}});var C="";if(A){C="class='trnotselected'"}else{C="class='trselected'"}x+="<tr "+C+" guid='"+z.guid+"' ><td>"+b(z.feature_class)+"</td><td><a style='margin:2px;color:blue;width:100px;cursor:pointer;' code='"+b(z.feature_class)+"' onclick='sendFWord(this)'>选择</a> &nbsp;&nbsp; <a style='margin:2px;color:blue;width:100px;cursor:pointer;' code='"+b(z.feature_class)+"' feature_father_guid='"+z.feature_father_guid+"' onclick='checkChildClass(this)' >查看子类</a></td></tr>"});x+="</table>";$("#featurewords").append(x);if(y[0].totalcount>v){pageDisplay(y[0].totalcount,a,"featurewordspage",p.pagesize,p.curpage2)}else{$("#featurewordspage").empty()}}else{$("#featurewords").text("查询暂无数据！")}},"json",function(){},function(){},function(){})};var h=function(v,y,u){u=u?u:true;if(y==""||y==null||y==undefined){p.curpage2=1}else{p.curpage2=y}if(r==undefined){r="text"}r=getFacetname(r);var x="";if(u){if(n!=""){x+="&feature_class="+encodeURIComponent(n)+""}if(m){x+="&guid="+m+""}}var w=config.solrData+"?type=selectfeatureclass&fieldname="+r+"&page="+p.curpage2+"&pagesize="+v+x;ajaxRequest(w,function(A){if(A[0].totalcount>0){$("#featurewords").empty();var z="<table class='table2' cellspacing='0' cellpadding='0' border='0' style='width:100%;'><tr class='trnotselected'><td>选择</td>";z+="<td>特征分类</td>";z+="<td>操作</td>";z+="</tr>";$.each(A[0].datalist,function(D,B){var C=true;$("#selectedfeaturewords .selword").each(function(G,F){var H=$(this).attr("code");if(b(B.feature_class)==H){C=false}});var E="";if(C){E="class='trnotselected'"}else{E="class='trselected'"}z+="<tr "+E+" guid='"+B.guid+"' ><td><input type='checkbox'onclick='sendFWord(this)' code='"+b(B.feature_class)+"'name='checklist' id='' value=''></td><td>"+g(B.feature_class)+"</td>";z+="<td><a style='margin:2px;color:blue;width:100px;cursor:pointer;' code='"+b(B.feature_class)+"' onclick='sendFWord(this)'>选择</a>";if(!("feature_keyword" in B)){z+="&nbsp;&nbsp; <a style='margin:2px;color:blue;width:100px;cursor:pointer;' code='"+b(B.feature_class)+"' feature_father_guid='"+B.feature_father_guid+"' onclick='checkChildClass(this)' >查看子类</a>"}z+="</td></tr>"});z+="<tr><td colspan='4'><div style='text-align:left;'>&nbsp;&nbsp;<input type='button' name='selectAll' id='selectAll' onclick='selectall()' value='全选'>";z+="&nbsp;&nbsp;<input type='button' name='unselectAll' id='unselectAll' onclick='unselectall()' value='反选'>";z+="</div></td></tr>";z+="</table>";$("#featurewords").append(z);if(A[0].totalcount>v){pageDisplay(A[0].totalcount,h,"featurewordspage",p.pagesize,p.curpage2,m,n)}else{$("#featurewordspage").empty()}}else{$("#featurewords").text("查询暂无数据！")}},"json",function(){},function(){$("#featurewords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='wait1'/>")},function(){$("#wait1").css({display:"none"})})};this.checkChildClass=function(w){n=$(w).attr("code");m=$(w).parents("tr[guid]").attr("guid");var u=$(w).attr("feature_father_guid");var v={fpclass:n,guid:m,feature_father_guid:u};d.push(v);$("#goParent").css("display","");h(p.pagesize,1)};this.sendFParWord=function(y){var w=$(y).attr("code");var u=$(y).parents("tr[guid]").attr("guid");r=getFacetname(r);var x="";if(w!=""){x+="&feature_class="+encodeURIComponent(w)+""}if(u){x+="&guid="+u+""}var v=config.solrData+"?type=selectfeatureclass&fieldname="+r+"&page="+p.curpage2+"&pagesize="+pagesize+x;ajaxRequest(v,function(z){if(z[0].totalcount>0){$.each(z[0].datalist,function(E,B){var F=B.feature_class;var D=B.feature_class;var A=true;$("#selectedfeaturewords .selword").each(function(I,G){var H=$(this).attr("code");if(F==H){A=false}});if(A){var C=createUtilSpanHtml("selword",D,F,c,undefined,"cancleWord");$("#selectedfeaturewords").append(C)}})}else{$("#selectedfeaturewords").text("查询暂无数据！")}},"json",function(){},function(){},function(){})};this.sendFWord=function(z){var y=$(z).attr("code");var x=q(y)?q(y):y;var w=$(z).parents("tr[guid]").attr("guid");var u=true;$(z).parents("tr").first().removeClass().addClass("trselected");$("#selectedfeaturewords .selword").each(function(C,A){var B=$(this).attr("code");if(y==B){$(this).parent().remove();$(z).parents("tr").first().removeClass().addClass("trnotselected");u=false}});if(u){var v=createUtilSpanHtml("selword",x,y,c,undefined,"cancleWord",undefined,undefined,undefined,undefined,w);$("#selectedfeaturewords").append(v)}if($(z).parents("tr").first().attr("class")=="trnotselected"){$(z).parents("tr").first().find("input:checkbox").attr("checked",false)}else{$(z).parents("tr").first().find("input:checkbox").attr("checked",true)}};this.sendAllFWord=function(){$.each($("#featurewords").find("tr:not(:last,:first)"),function(x,z){var A=$(z).find("td").last().find("a");var y=$(A).attr("code");var w=q(y)?q(y):y;var v=$(A).parents("tr[guid]").attr("guid");$(A).parents("tr").first().removeClass().addClass("trselected");$("#selectedfeaturewords .selword").each(function(D,B){var C=$(this).attr("code");if(y==C){$(this).parent().remove();$(A).parents("tr").first().removeClass().addClass("trnotselected")}});var u=createUtilSpanHtml("selword",w,y,c,undefined,"cancleWord",undefined,undefined,undefined,undefined,v);$("#selectedfeaturewords").append(u)})};this.unselectFWord=function(){$.each($("#featurewords").find("tr:not(:last,:first)"),function(u,v){var w=$(v).find("td").last().find("a");sendFWord(w)})};this.selectall=function(){$("#featurewords :checkbox").each(function(){$(this).attr("checked",true);sendAllFWord()})};this.unselectall=function(){unselectFWord()};this.cancleWord=function(v){$(v).parent().remove();var u=$(v).attr("code");$("#featurewords a[code='"+u+"']").parents("tr").first().removeClass().addClass("trnotselected")};t()}function myPartSelect(b,d,a){var g=this;var c=a;var f=d;var e=function(){$("#parthidediv").remove();var h="<div class='sltbox' id='partselecttip'>";h+="<h3>";h+="<span>提示：</span><b><input type='button' value='确定' id='partparttip'>&nbsp;&nbsp;<input type='button' value='清空' disabled='' name=''></b>";h+="</h3>";h+="<p>请从列表中选择</p>";h+="</div>";h+="<div class='sltbox' id='partselectbox' style='display:none;'>";h+="<h3>";h+="<span>您选择的是：</span><b><input type='button' value='确定' id='partsmtpart'>&nbsp;&nbsp;<input type='button' value='清空' name='' id='partresetpart'></b>";h+="</h3>";h+="<div id='partselectedpart'></div>";h+="</div>";h+="<div class=''>";h+="<h2 id=''>";h+="<span>可选列表:</span>";h+="</h2>";h+="<ul id='partallitems' style='list-style-type:none;padding-left:0;'>";h+="<li><a><input type='checkbox' class='outborder' id=''/></a>&gt;</li>";h+="</ul>";h+="</div>";$("<div id='parthidediv' style='display:none'></div>").insertAfter("body");$("#parthidediv").append(h);$("#parthidediv").dialog({autoOpen:true,modal:true,width:385,height:220});g.getitems(b);$("#partresetpart").bind("click",function(){$("#partselectedpart").empty();$("#partallitems input:checkbox").attr("checked",false);$("#partselecttip").css("display","block");$("#partselectbox").css("display","none")});$("#partsmtpart").bind("click",function(){$("#parthidediv").dialog("close");var i=[];$("#partselectedpart .partitem").each(function(j){var k={};k.name=$(this).text();k.code=$(this).attr("title");if($(this).attr("blurtype")!=undefined){k.blurtype=$(this).attr("blurtype")}i.push(k)});f(i)});$("#partparttip").bind("click",function(){$("#parthidediv").dialog("close");var i=[];f(i)})};g.additems=function(m){var l=m.code;var k=m.name;var j="";if(m.blurtype!=undefined){j="blurtype="+m.blurtype+""}var i=$("input[value='"+l+"']:checked").val();if(i!=undefined){$("#partselecttip").css("display","none");$("#partselectbox").css("display","block");$("#partselectedpart").append("<span class='selpartbox'><span class='partitem' title='"+l+"' "+j+">"+k+"</span><a style='border:1px solid #ffffff;color:red; cursor:pointer;' id='"+l+"' onclick='canclepart(this)'>×</a></span>")}else{$("#partselectedpart .partitem").each(function(n){var o=$(this).text();if(o==k){$(this).parent().remove()}});var h=$("#partselectedpart .partitem").length;if(h==0){$("#partselecttip").css("display","block");$("#partselectbox").css("display","none")}}};g.canclepart=function(j){var i=$(j).attr("id");$("input[value='"+i+"']").attr("checked",false);$(j).parent().remove();var h=$("#partselectedpart .partitem").length;if(h==0){$("#partselecttip").css("display","block");$("#partselectbox").css("display","none")}};g.getitems=function(h){$("#partallitems").empty();if(typeof(h)=="string"){h=JSON.parse(h)}$.each(h,function(j,m){var l=JSON.stringify(m);var k="";if(m.blurtype!=undefined){k="blurtype="+m.blurtype+""}$("#partallitems").append("<li style='width:150px;float:left;cursor:pointer;'><input type='checkbox' class='outborder' onclick='additems("+l+")' value='"+m.code+"' "+k+" />"+m.name+"</li>")});if(c!=undefined&&c!=""&&c!=null){$("#partselectedpart").empty();$("#partselecttip").css("display","none");$("#partselectbox").css("display","block");if(typeof(c)=="string"){c=JSON.parse(c)}$.each(c,function(j,i){var l="";if(i.blurtype!=undefined){l="blurtype="+i.blurtype+""}$("#partallitems input[value='"+i.code+"']").attr("checked","checked");$("#partselectedpart").append("<span class='selpartbox'><span class='partitem' title='"+i.code+"' "+l+">"+i.name+"</span><a style='border:1px solid #ffffff;color:red; cursor:pointer;' id='"+i.code+"' onclick='canclepart(this)'>×</a></span>")})}};e()}function myDatePicker(){this.setTimeSelect=function(c){$("#"+c).append("<span class='rightalign'>时间：</span><input id='"+c+"d4311' class='Wdate' style='border:1px solid #DADADA;' type='text' readonly='readonly'/> 	至 <input id='"+c+"d4312' class='Wdate' style='border:1px solid #DADADA;' type='text'  readonly='readonly' />");var b=commonFun.queryString("startdate");if(b!=""&&b!=null&&b!=undefined){$("#"+c+"d4311").val(formatTime("yyyy-MM-dd hh:mm",b))}var a=commonFun.queryString("enddate");if(a!=""&&a!=null&&a!=undefined){$("#"+c+"d4312").val(formatTime("yyyy-MM-dd hh:mm",a))}$("#"+c+"d4311").click(function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm"})});$("#"+c+"d4312").click(function(){var d=c+"d4311";WdatePicker({minDate:"#F{$dp.$D('"+d+"')}",maxDate:"%y-%M-%d",dateFmt:"yyyy-MM-dd HH:mm"})})},this.getStartTime=function(a){return $("#"+a+"d4311").val()},this.getEndTime=function(a){return $("#"+a+"d4312").val()}}function myTopicRecommend(f,l,h,e,b){var g=this;var j;this.pagesize=20;var k;var i;var d=false;var c=function(){var m;if(e!=""&&e!=undefined){m=e}else{m="短语"}if(b!=""&&b!=undefined){d=b}$("#topicsbox").remove();var n="<div id='blurtopicopt_div'>"+m+"筛选:<br/><input type='checkbox' name='blurtopicopt' checked='checked' id='blurtopicopt_tprefix' value='t_prefix'/><label for='blurtopicopt_tprefix'>关键词以\""+f+"\"开头</label><input type='checkbox'  name='blurtopicopt' id='blurtopicopt_tsuffix' value='t_suffix' /><label for='blurtopicopt_tsuffix'>关键词以\""+f+"\"结尾</label><input type='checkbox' name='blurtopicopt' id='blurtopicopt_tinfix' value='t_infix' /><label for='blurtopicopt_tinfix'>关键词包含\""+f+"\"</label><input type='checkbox' name='blurtopicopt' id='blurtopicopt_tmblur' value='tm_blur' /><label for='blurtopicopt_tmblur'>包含关键词\""+f+'"</label></div>';n+="<fieldset>";n+="<legend>"+m+"列表</legend>";n+="<div id='groupwords'><img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:305px;' id='wait3'/></div>";n+="<div id='grouppage' style='margin-top:2px;float:left;width:100%;margin:5px;'></div>";n+="<div style='clear:both;' id='blurquerytopicemotion'><span>模糊查询"+m+":</span></div>";n+="<div id='blurquerytopic'></div>";n+="</fieldset>";n+="<fieldset>";n+="<legend>已选择的"+m+"</legend>";n+="<div id='slttopicrecommend'></div>";n+="</fieldset>";n+="<div class='search'><input id='topicsubmit' name='topicsubmint' type='button' value='确定' />  <input id='topiccancle' name='topiccancle' type='button' value='取消' /></div>";$("<div id='topicsbox' title='"+m+'列表-包含"'+f+'"的'+m+"'></div>").insertAfter("body");$("#topicsbox").append(n);var o="";o+="<a style='margin:2px;color:blue;width:150px;float:left;cursor:pointer;' rtext='"+f+"*' btype='t_prefix' >关键词以\""+f+'"开头</a>';o+="<a style='margin:2px;color:blue;width:150px;float:left;cursor:pointer;' rtext='*"+f+"' btype='t_suffix' >关键词以\""+f+'"结尾</a>';o+="<a style='margin:2px;color:blue;width:150px;float:left;cursor:pointer;' rtext='*"+f+"*' btype='t_infix' >关键词包含\""+f+'"</a>';o+="<a style='margin:2px;color:blue;width:150px;float:left;cursor:pointer;' rtext='"+f+"' btype='tm_blur' >包含关键词\""+f+'"</a>';$("#blurquerytopic").append(o);if(d){g.emotionChk()}$("#blurquerytopic a[rtext][btype]").bind("click",function(){if(d){g.sendEmotion(this)}else{g.sendTopic(this)}});$("#blurtopicopt_div").buttonset();$("#topicsbox").dialog({autoOpen:false,modal:true,width:730,height:460});$("#blurtopicopt_div input[name=blurtopicopt]").bind("click",function(){var p=$("#blurtopicopt_div input[name=blurtopicopt]:checked").length;var q=$(this).attr("id");if(p==0){$("#blurtopicopt_div label[for="+q+"]").addClass("ui-state-active");return false}g.blurtopicoptClick()});g.blurtopicoptClick();$("#topicsubmit").bind("click",function(){var p=[];$("#slttopicrecommend .seltopic").each(function(s,q){var r={};r.topic=$(this).attr("rtext");r.btype=$(this).attr("btype");if($(q).attr("emotype")!=undefined){r.emotype=$(q).attr("emotype")}p.push(r)});l(p);$("#topicsbox").dialog("close")});$("#topiccancle").bind("click",function(){$("#topicsbox").dialog("close");$("#slttopicrecommend").empty()})};this.blurtopicoptClick=function(){var q=[];$("#blurtopicopt_div input[name=blurtopicopt]").each(function(){if($(this).prop("checked")){q.push($(this).val())}});var p=[];var o=[];var n=[];var m=[];$.each(q,function(s,r){if(r=="t_infix"){p.push(r)}if(r=="tm_blur"){m.push(r)}if(r=="t_prefix"){o.push(r)}if(r=="t_suffix"){o.push(r)}});if(p.length>0){i="t_infix"}else{if(o.length==2){i="t_prefix_suffix"}else{if(o.length==1){i=o[0]}else{if(m.length>0){i="tm_blur"}}}}if(f!=null&&f!=""&&f!=undefined){a(pagesize,1);$("#groupwords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:305px;' id='wait3'/>");$("#grouppage").empty();$("#topicsbox").dialog("open")}else{alert("请输入"+ftext+"！")}};this.emotionChk=function(){var m='<div id="utilemotiondiv"><span id="utilemotion">';m+='<input type="checkbox" name="utilemotion" id="utilemotion1" value="1" class="outborder" /><label for="utilemotion1">反对</label>';m+='<input type="checkbox" name="utilemotion" id="utilemotion2" value="2" class="outborder" /><label for="utilemotion2">负面</label>';m+='<input type="checkbox" name="utilemotion" id="utilemotion3" value="3" class="outborder" /><label for="utilemotion3">中性</label>';m+='<input type="checkbox" name="utilemotion" id="utilemotion4" value="4" class="outborder" /><label for="utilemotion4">正面</label>';m+='<input type="checkbox" name="utilemotion" id="utilemotion5" value="5" class="outborder" /><label for="utilemotion5">赞赏</label>';m+='<input type="checkbox" name="utilemotion" id="utilemotionall" value="*" class="outborder" /><label for="utilemotionall">全部</label></span></div>';$("#blurquerytopicemotion").after(m);$("#utilemotiondiv input[name=utilemotion]").bind("click",function(){var n=$(this).attr("id");if(n=="utilemotionall"){if($(this).prop("checked")==true){$("#utilemotiondiv input[name=utilemotion]").attr("checked",true)}else{$("#utilemotiondiv input[name=utilemotion]").attr("checked",false)}}else{var o=$("#utilemotiondiv input[name=utilemotion]:checked").length;var p=$("#utilemotiondiv input[name=utilemotion]").length;if($(this).prop("checked")==true){if(o==p-1){$("#utilemotiondiv input[name=utilemotion]").attr("checked",true)}}else{$("#utilemotiondiv input[name=utilemotion][id=utilemotionall]").attr("checked",false)}}})};this.sendEmotion=function(q){var p=$(q).text();var r=$(q).attr("rtext");var o=[];var u=[];if($(q).attr("emotype")!=undefined){t=$(q).attr("emotype")}else{$("#utilemotiondiv input[name=utilemotion]:checked").each(function(x,v){var y=$(this).attr("id");if(y!="utilemotionall"){var w=$("#utilemotiondiv label[for="+y+"]").text();o.push(w);var z=$(this).val();u.push(z)}});var s=$("#utilemotiondiv input[name=utilemotion]").length;var t="";if(u.length>0){if(u.length==s-1){p+="(全部)";t="*"}else{p+="("+o.join(",")+")";t=u.join(",")}}}if(t==""){alert("请选择情感!");return false}var m=$(q).attr("btype");$(q).removeClass().addClass("selected");var n=true;$("#slttopicrecommend .seltopic").each(function(x,v){var y=$(this).attr("rtext");var w=$(this).attr("emotype");if(r==y&&t==w){$(this).parent().remove();$(q).removeClass().addClass("notselected");n=false}});if(n){$("#slttopicrecommend").append("<span class='selwordsbox' style='border:1px solid #cccccc;padding:1.5px 0 1.5px 1.5px;margin: 7px 0px 2px 2px;'><span class='seltopic' style='cursor:pointer;'  emotype='"+t+"' rtext='"+r+"' btype="+m+" >"+p+"</span><a class='cancleitem' rtext='"+r+"'  emotype='"+t+"' onclick='cancleTopic(this)'>×</a></span>");$("#utilemotiondiv input[name=utilemotion]").attr("checked",false)}else{}};this.sendTopic=function(r){var o=$(r).text();var p=$(r).attr("rtext");var q=$(r).attr("btype");$(r).removeClass().addClass("selected");var m=true;$("#slttopicrecommend .seltopic").each(function(t,s){var u=$(this).attr("rtext");if(p==u){$(this).parent().remove();$(r).removeClass().addClass("notselected");m=false}});if(m){var n=createUtilSpanHtml("seltopic",o,undefined,true,undefined,"cancleTopic",p,$(r).attr("emotype"),q);$("#slttopicrecommend").append(n)}else{}};this.cancleTopic=function(o){$(o).parent().remove();var m=$(o).attr("rtext");if($(o).attr("emotype")!=undefined){var n=$(o).attr("emotype");$("#groupwords a[rtext='"+m+"'][emotype='"+n+"']").removeClass().addClass("notselected");$("#blurquerytopic a[rtext='"+m+"'][emotype='"+n+"']").removeClass().addClass("notselected")}else{$("#groupwords a[rtext='"+m+"']").removeClass().addClass("notselected");$("#blurquerytopic a[rtext='"+m+"']").removeClass().addClass("notselected")}};var a=function(m,o){if(o==""||o==null||o==undefined){g.curpage2=1}else{g.curpage2=o}if(h==undefined){h="combinWord"}var n=config.solrData+"?type=kwgroup&fieldname="+h+"&keyword="+encodeURIComponent(f)+"&blurtype="+i+"&page="+g.curpage2+"&pagesize="+m;ajaxRequest(n,function(p){if(p!=null&&p[0].datalist!=null&&p[0].datalist.length>0&&p[0].totalcount>0){$("#groupwords").empty();var q="";$.each(p[0].datalist,function(y,u){var r=true;$("#slttopicrecommend .seltopic").each(function(C,B){var D=$(this).attr("rtext");if(u==D){r=false}});var A="";if(r){A="class='notselected'"}else{A="class='selected'"}var z="";var t="";var x="";if(d){var w=u.split(",");var v=[];for(var y=0;y<w.length-1;y++){v.push(w[y])}t=v;x="emotype='"+w[w.length-1]+"'";var s=emoval2text(w[w.length-1]);z=v+"("+s+")"}else{z=u;t=u}q+="<a "+A+" rtext='"+t+"' "+x+" btype='tbnull' >"+z+"</a>"});$("#groupwords").append(q);$("#groupwords a[rtext][btype]").bind("click",function(){if(d){g.sendEmotion(this)}else{g.sendTopic(this)}});if(p[0].totalcount>m){pageDisplay(p[0].totalcount,a,"grouppage",g.pagesize,g.curpage2)}else{$("#grouppage").empty()}}else{$("#groupwords").text("组合查询暂无数据！")}},"json",function(){},function(){$("#groupwords").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:305px;' id='wait3'/>")},function(){$("#wait3").css({display:"none"})})};c()}function myAccountSelect(g,m,i,h,a,n,p){var l=this;var e;var j=20;var k;var d="";var f;if(m==undefined){f=[]}else{f=m}var r=false;if(a==undefined){a=true}var b=function(){$("#accountsbox").remove();$("#batchuserdiv").remove();var t="搜索用户:<input type='text' id='accounttxt' name='accounttxt' /> <input type='button' name='sac' id='sac' value='搜索' />(使用*模糊搜索)";if(n){t+="<input type='button' name='batchquery' id='batchquery' value='批量查询' />"}t+="<fieldset>";t+="<legend>用户列表</legend>";t+="<div id='groupaccounts'><img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='waitimg'/></div>";t+="<div id='accountpage' style='margin-top:2px;float:left;width:100%;margin:5px;'></div>";if(p){t+="<div class='search' id='accountselectallbtndiv' style='float:left;width:100%;'><input id='accountselectallbtn' name='accountselectallbtn' type='button' value='全选' /> <input id='accountunselectallbtn' name='accountunselectallbtn' type='button' value='反选' /> <input id='accountunselectnonebtn' name='accountunselectnonebtn' type='button' value='清空' /></div>"}t+="</fieldset>";t+="<fieldset>";t+="<legend>已选择的用户</legend>";t+="<div id='selectedaccounts'></div>";t+="</fieldset>";t+="<div class='search'><input id='accsubmit' name='accsubmit' type='button' value='选择完毕' /></div>";$("<div id='accountsbox' title='用户列表'></div>").insertAfter("body");$("#accountsbox").append(t);var s="";s+='<table class="formtable">';s+="<tr>";s+='<td class="tdleft">用户昵称：</td>';s+="<td>";s+='<textarea rows="25" cols="15" id="batch_screen_name"></textarea>';s+="</td>";s+='<td class="tdtip"></td>';s+="</tr>";s+='<tr id="noexistnametr" style="display:none;">';s+='<td class="tdleft">右边用户昵称不存在请重新输入：</td>';s+='<td colspan="2">';s+='<textarea rows="8" cols="15" id="noexistname"></textarea>';s+="</td>";s+="</tr>";s+='<tr id="repeatusertr" style="display:none;">';s+='<td class="tdleft">右边用户昵称存在重复项,仅分别保留一项,点击"获取结果",以确认：</td>';s+='<td colspan="2">';s+='<textarea rows="5" cols="15" id="repeatuser"></textarea>';s+="</td>";s+="</tr>";s+='<tr id="systemrepeatusertr" style="display:none;">';s+='<td class="tdleft">系统中有多个用户分别拥有右边用户昵称,点击"获取结果"确认后,可分别选择：</td>';s+='<td colspan="2">';s+='<textarea rows="4" cols="15" id="systemrepeatuser"></textarea>';s+="</td>";s+="</tr>";s+="</table>";$("<div id='batchuserdiv' style='display:none;'></div>").insertAfter("body");$("#batchuserdiv").append(s);if(h!=""&&h!=undefined){r=h}$("#accountsbox").dialog({autoOpen:false,modal:true,width:550,height:360,close:function(){$("#accountemotiondiv").css("display","none")}});c(f);o(j,1,d);$("#accountpage").empty();$("#accountsbox").dialog("open");$("#accounttxt").unbind("change");$("#batchquery").bind("click",function(){$("#batch_screen_name").val("");$("#batch_screen_name").removeAttr("style");$("#noexistnametr").hide();$("#noexistname").val("");$("#repeatusertr").hide();$("#repeatuser").val("");$("#systemrepeatusertr").hide();$("#systemrepeatuser").val("");$("#batchuserdiv").dialog("destroy");$("#batchuserdiv").dialog({autoOpen:true,title:"查询用户是否存在",modal:true,height:560,width:573,buttons:{"查询":function(){var v="";var z=$("#batch_screen_name").val();var w=z.split("\n");var y={};y.users_screen_name=[];var u=[];$.each(w,function(B,A){if(A!=""){var C=commonFun.trim(A);if(!y.users_screen_name.inArray(C)){y.users_screen_name.push(C)}else{if(!u.inArray(C)){u.push(C)}}}});var x={type:"query_screen_name",names:y};$.ajax({type:"POST",contentType:"application/json",dataType:"json",async:false,url:config.modelUrl+"feature_model.php",data:JSON.stringify(x),beforeSend:function(){},complete:function(){},success:function(A){if(A.flag==1){$("#batch_screen_name").css({width:"199px",height:"296px"});$("#noexistnametr").show();$("#repeatusertr").hide();$("#systemrepeatusertr").hide();$("#noexistname").val(A.noexistname.join("\n"))}else{$("#batch_screen_name").css({width:"199px",height:"256px"});$("#noexistnametr").val("");$("#noexistnametr").hide();$("#repeatusertr").hide();$("#systemrepeatusertr").hide();if(u.length>0||A.flag==2){if(u.length>0){$("#repeatusertr").show();$("#repeatuser").val(u.join("\n"));$("#batch_screen_name").val(y.users_screen_name.join("\n"))}if(A.flag==2){$("#systemrepeatusertr").show();$("#systemrepeatuser").val(A.sysrepeatuser.join("\n"))}i=A.users;$("#batchuserdiv").dialog("option","buttons",[{text:"获取结果",click:function(){if(i!=undefined&&i.length>0){o(j,1);$("#batchuserdiv").dialog("close")}}}])}else{i=A.users;o(j,1);$("#batchuserdiv").dialog("close")}}}})}}})});$("#accountunselectallbtn").bind("click",function(){$("#groupaccounts").find("a").each(function(u,v){sendAccount($(v))})});$("#accountselectallbtn").bind("click",function(){$("#selectedaccounts").empty();$("#groupaccounts").find("a").each(function(u,v){sendAccount($(v))})});$("#accountunselectnonebtn").bind("click",function(u,v){$("#selectedaccounts .cancleitem").each(function(x,w){cancleWord($(w))})});$("#sac").bind("click",function(){d=$("#accounttxt").val();if(i!=undefined&&i.length>0){q(i,d);$("#waitimg").css({display:"none"})}else{o(j,1,d);$("#groupaccounts").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='waitimg'/>");$("#accountpage").empty()}});$("#accsubmit").unbind("click");$("#accsubmit").bind("click",function(){var u=[];$("#selectedaccounts .selword").each(function(w,v){var x={};x.code=$(this).attr("code");x.name=$(this).text();if($(this).attr("emotype")!=undefined){x.emotype=$(this).attr("emotype")}if($(this).attr("exclude")!=undefined){x.exclude=$(this).attr("exclude")}u.push(x)});g(u);$("#accountemotiondiv").css("display","none");$("#accountsbox").dialog("close")})};this.emotionChk=function(){var s='<div id="accountemotiondiv" style="position:absolute;display:none;z-index:9999;background-color:white;border:1px solid blue;font-size: 12px;"><span id="accountemotionspan">';s+='<input type="checkbox" name="accountemotion" id="accountemotion1" value="1" class="outborder" /><label for="accountemotion1">反对</label>';s+='<input type="checkbox" name="accountemotion" id="accountemotion2" value="2" class="outborder" /><label for="accountemotion2">负面</label>';s+='<input type="checkbox" name="accountemotion" id="accountemotion3" value="3" class="outborder" /><label for="accountemotion3">中性</label>';s+='<input type="checkbox" name="accountemotion" id="accountemotion4" value="4" class="outborder" /><label for="accountemotion4">正面</label>';s+='<input type="checkbox" name="accountemotion" id="accountemotion5" value="5" class="outborder" /><label for="accountemotion5">赞赏</label>';s+='<input type="checkbox" name="accountemotion" id="accountemotionall" value="*" class="outborder" /><label for="accountemotionall">全部</label>';s+='<br/><a id="itemaccountemo" style="cursor:pointer;">确定</a></span></div>';if($("#accountemotiondiv").length==0){$("body").append(s)}$("#accountemotiondiv input[name=accountemotion]").bind("click",function(){var t=$(this).attr("id");if(t=="accountemotionall"){if($(this).prop("checked")==true){$("#accountemotiondiv input[name=accountemotion]").attr("checked",true)}else{$("#accountemotiondiv input[name=accountemotion]").attr("checked",false)}}else{var u=$("#accountemotiondiv input[name=accountemotion]:checked").length;var v=$("#accountemotiondiv input[name=accountemotion]").length;if($(this).prop("checked")==true){if(u==v-1){$("#accountemotiondiv input[name=accountemotion]").attr("checked",true)}}else{$("#accountemotiondiv input[name=accountemotion][id=accountemotionall]").attr("checked",false)}}})};var c=function(s){var t="";$.each(s,function(v,u){t+=createUtilSpanHtml("selword",u.name,u.code,a,u.exclude,"cancleWord",undefined,u.emotype)});$("#selectedaccounts").append(t)};var q=function(s,u){var t="";$.each(s,function(C,B){var E=false;var x=B.users_id==undefined?B.code:B.users_id;var w=B.users_screen_name==undefined?B.name:B.users_screen_name;if(f!=undefined&&f.length>0){$.each(f,function(J,I){if(B.emotype!=undefined){if(I.emotype==B.emotype&&I.code==x){E=true;return false}}else{if(I.code==x){E=true;return false}}})}var z="";if(E){z="class='selected'"}else{z="class='notselected'"}var G=new RegExp("^"+u+".*","g");if(G.test(w)){var A="";var D=w;if(B.emotype!=undefined){A="emotype='"+B.emotype+"'";D=w+"("+emoval2text(B.emotype)+")"}var y="";var H=x;if(H!=undefined&&H!=null){var F=1;y=weiboUserurl(H,F)}var v=" <span href='"+y+"' style='color:#37547D;' repeatlink='true' >前往</span>";t+="<a "+z+" onclick='sendAccount(this)' name='"+w+"' code='"+x+"' "+A+" >"+D+" "+v+"</a>"}});$("#groupaccounts").empty().append(t);$("span[repeatlink]").unbind("click");$("span[repeatlink]").bind("click",function(w){var v=$(this).attr("href");window.open(v,"_blank");w.stopPropagation()})};this.sendAccount=function(A){var t=$(A).attr("name");var v=$(A).attr("code");var z=$(A).attr("emotype");if(r){l.emotionChk();var y,x;y=$(A).offset().left+30;x=$(A).offset().top-$("#accountemotiondiv").height();$("#accountemotiondiv").css({top:x+"px",left:y+"px",display:"block"});$("#accountemotionspan input[name=accountemotion]").attr("checked",false);$("#itemaccountemo").unbind("click");$("#itemaccountemo").bind("click",function(){var G=$("#accountemotiondiv input[name=accountemotion]:checked").length;if(G==0){alert("请选择情感!");return false}var D=[];var F=[];$("#accountemotiondiv input[name=accountemotion]:checked").each(function(K,I){var L=$(this).attr("id");if(L!="accountemotionall"){var J=$("#accountemotiondiv label[for="+L+"]").text();D.push(J);var M=$(this).val();F.push(M)}});var H=$("#accountemotiondiv input[name=accountemotion]").length;var E="";if(F.length>0){if(F.length==H-1){t=t+"(全部)";E="*"}else{t=t+"("+D.join(",")+")";E=F.join(",")}}var B=true;$("#selectedaccounts .selword").each(function(J,I){var K=$(this).attr("code");if(v==K){$(this).parent().remove();$(A).removeClass().addClass("notselected");B=false}});if(B){$(A).removeClass().addClass("selected");var C=createUtilSpanHtml("selword",t,v,a,undefined,"cancleWord",undefined,E);$("#selectedaccounts").append(C)}else{}$("#accountemotiondiv").css({display:"none"})})}else{t=$(A).attr("name");v=$(A).attr("code");z=$(A).attr("emotype");var u=true;$("#selectedaccounts .selword").each(function(C,B){var D=$(this).attr("code");var E=$(this).attr("emotype");if(z!=undefined){if(v==D&&z==E){$(this).parent().remove();$(A).removeClass().addClass("notselected");u=false}}else{if(v==D){$(this).parent().remove();$(A).removeClass().addClass("notselected");u=false}}});if(u){$(A).removeClass().addClass("selected");var w=t;if(z!=undefined){w=t+"("+emoval2text(z)+")"}var s=createUtilSpanHtml("selword",w,v,a,undefined,"cancleWord",undefined,z);$("#selectedaccounts").append(s)}else{}}};this.cancleWord=function(t){$(t).parent().remove();var s=$(t).attr("emotype");if(s!=undefined&&!h){$("#groupaccounts a[code="+$(t).attr("code")+"][emotype="+s+"]").removeClass().addClass("notselected")}else{$("#groupaccounts a[code="+$(t).attr("code")+"]").removeClass().addClass("notselected")}};var o=function(s,u,v){if(i==undefined||i.length==0){if(u==""||u==null||u==undefined){l.curpage2=1}else{l.curpage2=u}if(v==undefined){v=$("#accounttxt").val()}var t=config.solrData+"?type=searchname&blurname="+encodeURIComponent(v)+"&page="+l.curpage2+"&pagesize="+s;ajaxRequest(t,function(w){if(w[0].totalcount>0){q(w[0].datalist,"");if(w[0].totalcount>s){pageDisplay(w[0].totalcount,o,"accountpage",s,l.curpage2)}else{$("#accountpage").empty()}}else{$("#groupaccounts").text("用户查询暂无数据！")}},"json",function(){},function(){$("#groupaccounts").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='waitimg'/>")},function(){$("#waitimg").css({display:"none"})})}else{$("#accountpage").empty();q(i,"");$("#waitimg").css({display:"none"})}};b()}function myExpressionLabel(h,g,d){var i=function(){var j="";j+="<fieldset>";j+="<legend>表达式添加</legend>";j+="<div><input type='radio' name='label_type' value='reg' checked='checked' />表达式 <input type='radio' name='label_type' value='exp' />条件表达式</div>";j+="<div exptype='exp'><span>&nbsp;&nbsp;&nbsp;名称：</span><input type='text' name='expname' id='expname' /></div>";$.each([1,2,3,4],function(k,l){j+="<div exptype='exp'><span>表达式：</span><select id='value"+k+"order'><option value=''>-</option><option value='start'>开始</option><option value='end'>结束</option></select>";j+="<select id='value"+k+"opt'><option value=''>-</option><option value='gt'>大于</option><option value='lt'>小于</option><option value='gtequal'>大于等于</option><option value='ltequal'>小于等于</option><option value='equal'>等于</option></select>";var m="class='shortinput'";if(d=="absolutetime"){m=""}j+="<input type='text' "+m+" name='valuetxt' id='value"+k+"txt' />";if(d=="relativetime"){j+="<select id='value"+k+"gap'><option value='year'>年</option><option value='month'>月</option><option value='day'>天</option></select>"}j+="<input type='button' name='conditionempty' id='value"+k+"' value='清空' />";j+="</div>"});j+="<div exptype='reg'><span>表达式：</span><input type='text' name='label_reg' /><input type='button' id='reg_add' value='插入标记' /></div>";j+="<div><input type='button' id='addlabel' value='新增' /><input type='button' id='resetlabel' value='取消' /></div>";j+="</fieldset>";j+="<fieldset>";j+="<legend>已添加的表达式</legend>";j+="<div id='conditionres'></div>";j+="</fieldset>";$("body").append("<div id='expressionbox' title='添加表达式'></div>");$("#expressionbox").append(j);$("#expressionbox").dialog({modal:true,width:435,resizable:false,close:function(){}});if(g!=null){if(g.type=="reg"){b(g.value);$("input[name=label_type][value=reg]").attr("checked",true)}else{if(g.type=="exp"){c(g.value,d);$("input[name=label_type][value=exp]").attr("checked",true)}}}a();$("input[name=label_type]").bind("click",function(){a();$("#conditionres").empty();var k=$("input[name=label_type]:checked").val();if(k=="reg"){if(g!=null&&g.type=="reg"){b(g.value)}}else{if(k=="exp"){if(g!=null&&g.type=="exp"){c(g.value,d)}}}});$("#reg_add").bind("click",function(){var k=$("input[name=label_reg]").val();var l="[n]";$("input[name=label_reg]").val(k+l)});$("input[name=conditionempty]").bind("click",function(){var k=$(this).attr("id");$("#"+k+"order").val("");$("#"+k+"opt").val("");$("#"+k+"gap").val("");$("#"+k+"txt").val("")});$("#resetlabel").bind("click",function(){f();$("#conditionres .customlabelitem").css("background-color","")});$("#addlabel").bind("click",function(){var q=$("input[name=label_type]:checked").val();if(q=="exp"){var p=[];$.each([1,2,3,4],function(u,w){var s=$("#value"+u+"order").val();var t=$("#value"+u+"opt").val();var r=$("#value"+u+"txt").val();var v;if(d=="absolutetime"){v=getTimeSec(r)}else{if(d=="relativetime"){var y=$("#value"+u+"gap").val();v=r+y}else{v=r}}if(s!=""&&t!=""&&v!=""){var x={};x.valueorder=s;x.opt=t;if(d=="relativetime"){x.type="numberunit"}x.checkorder=v;p.push(x)}});var m={};m.label=$("#expname").val();if(m.label!=""){m.condition=p;if(m.condition.length>0){var n=[];n.push(m);var l=$(this).attr("expid");if(l!=undefined&&l!=""){var k=expressDisplay(m.condition,d);$("#conditionres span[expid="+l+"]").attr("title",k);$("#conditionres span[expid="+l+"]").attr("conditionvalue",JSON.stringify(m));$("#conditionres span[expid="+l+"]").text(m.label);$("#conditionres span[expid="+l+"]").css("background-color","")}else{c(n,d)}f()}else{$("#value0txt").focus()}}else{$("#expname").focus()}}else{var o=$("input[name=label_reg]").val();var l=$(this).attr("regid");if(l!=undefined&&l!=""){$("#conditionres span[regid="+l+"]").text(o);$("#conditionres span[regid="+l+"]").css("background-color","")}else{b(o)}f();$("input[name=label_reg]").val("")}});if(d=="absolutetime"){$.each([1,2,3,4],function(k,l){$("#value"+k+"txt").bind("click",function(){WdatePicker({onpicked:function(){},oncleared:function(){},dateFmt:"yyyy-MM-dd HH:mm:ss"})})})}$("#expressionbox").dialog("option","buttons",{"确定":function(){var k=e();if(k!=null){h(k);$("#expressionbox").dialog("close");$("#expressionbox").remove()}},"取消":function(){$("#expressionbox").dialog("close");$("#expressionbox").remove()}})};this.cancleItem=function(l){$(l).parent().remove();var k=$(l).prev().attr("expid");if(k!=undefined){var j=$("#addlabel").attr("expid");if(k==j){f()}}};var f=function(){$("#expname").val("");$.each([1,2,3,4],function(j,k){$("#value"+j+"order").val("");$("#value"+j+"opt").val("");$("#value"+j+"gap").val("");$("#value"+j+"txt").val("")});$("input[name=label_reg]").val("");$("#addlabel").removeAttr("expid");$("#addlabel").removeAttr("regid");$("#addlabel").val("新增")};var b=function(j){$("#conditionres").empty().append("<span class='selwordsbox'><span class='customlabelitem' labeltype='reg' style='cursor:pointer;' >"+j+"</span><a class='cancleitem' onclick='cancleItem(this)'>×</a></span>");$("#conditionres span[labeltype=reg]").bind("click",function(){$("input[name=label_reg]").val($(this).text());var k=Math.round(Math.random()*100000);$(this).css("background-color","#6FBAE4");$(this).attr("regid","reg"+k);$("#addlabel").attr("regid","reg"+k);$("#addlabel").val("确定")})};var c=function(k,j){var l="";$.each(k,function(n,o){var m=expressDisplay(o.condition,j);l+="<span class='selwordsbox'><span class='customlabelitem' title='"+m+"' labeltype='exp' style='cursor:pointer;' conditionvalue='"+JSON.stringify(o)+"'>"+o.label+"</span><a class='cancleitem' onclick='cancleItem(this)'>×</a></span>"});$("#conditionres").append(l);$("#conditionres span[labeltype=exp]").bind("click",function(){$("#expname").val($(this).text());var m=jQuery.parseJSON($(this).attr("conditionvalue"));$.each(m.condition,function(q,r){$("#value"+q+"order").val(r.valueorder);$("#value"+q+"opt").val(r.opt);var o=r.checkorder;if(j=="absolutetime"){o=formatTime("yyyy-MM-dd hh:mm:ss",o)}else{if(j=="relativetime"){var p=getGapNumDate(o);o=p.num;$("#value"+q+"gap").val(p.unit)}}$("#value"+q+"txt").val(o)});var n=Math.round(Math.random()*100000);$(this).css("background-color","#6FBAE4");$(this).attr("expid","exp"+n);$("#addlabel").attr("expid","exp"+n);$("#addlabel").val("确定")})};var e=function(){var l=null;var j=$("#conditionres .customlabelitem").length;if(j>0){var k={};k.type="exp";k.value=[];$("#conditionres .customlabelitem").each(function(m,n){if($(n).attr("labeltype")=="reg"){k={};k.type="reg";k.value=$(n).text();return false}else{k.value.push(jQuery.parseJSON($(n).attr("conditionvalue")))}});l=k}return l};var a=function(){var j=$("input[name=label_type]:checked").val();if(j=="reg"){$("#expressionbox div[exptype=reg]").css("display","");$("#expressionbox div[exptype=exp]").css("display","none")}else{if(j=="exp"){$("#expressionbox div[exptype=reg]").css("display","none");$("#expressionbox div[exptype=exp]").css("display","")}}};i()}function myFilterFieldHtml(c,a){var b=function(){var f=c.fieldvalue.labelname;var d=c.fieldname;var e="";e+="<div>";e+="<span>"+f+":</span>";e+='<span><input id="myfilter_'+d+'_text" type="text" name="myfilter_'+d+'_text"><input id="myfilter_'+d+'_recommend" type="button" value="推荐" name="myfilter_'+d+'_recommend"><input id="myfilter_'+d+'_add" type="button" value="添加" name="myfilter_'+d+'_add"></span>';e+="</div>";e+='<div><span id="selected'+d+'"></span></div>';$("body").append("<div id='filterfieldbox' title='编辑字段'></div>");$("#filterfieldbox").append(e);var g="";$.each(c.fieldvalue.labelvalue.value,function(i,h){g+="<span class='selwordsbox'><span class='"+d+"item'>"+h+"</span><a class='cancleitem'>×</a></span>"});$("#selected"+d+"").append(g);$("#filterfieldbox").dialog({modal:true,width:435,resizable:false});$("#filterfieldbox").dialog("option","buttons",{"确定":function(){var h=[];$("#selected"+d+" ."+d+"item").each(function(j,i){h.push($(i).text())});c.fieldvalue.labelvalue.value=h;a(c)},"取消":function(){}})};b()}function myInnerNavTab(g){var h=this;var f;var b=8;var c;var d=[];var e=function(){$("#innertabdiv").remove();$("#addnewtabdiv").remove();var i="<div><a href='javascript:void(0);' id='addnewtab'>新增卡片</a></div>";i+="<table class='table1' align='center' width='98%' border='0' cellspacing='0' cellpadding='0' id='tablelist'>";i+="</table>";$("<div id='innertabdiv'></div>").insertAfter("body");$("#innertabdiv").append(i);var j="<table class='table1' align='center' width='98%' border='0' cellspacing='0' cellpadding='0' id='navtabform' navid=''>";j+="<tr><td>所属导航:</td><td><span>"+window.Level1Title+"</span>-<span>"+window.Level2Title+"</span></td></tr>";j+="<tr><td>卡片名称:</td><td><input type='text' id='tabname' name='tabname' /></td></tr>";j+="<tr><td>是否默认:</td><td><input type='radio' id='defaulttab1' name='defaulttab' value='1' /><label for='defaulttab1'>是</label><input type='radio' id='defaulttab0' name='defaulttab' value='0' checked='checked' /><label for='defaulttab0'>否</label></td></tr>";j+="</table>";$("<div id='addnewtabdiv' style='display:none;'></div>").insertAfter("body");$("#addnewtabdiv").append(j);a(b,1);$("#innertabdiv").dialog({title:"卡片管理",autoOpen:true,modal:true,height:460,width:480,buttons:{"关闭":function(){g(d);$(this).dialog("close")}},close:function(){}});$("#addnewtabdiv").dialog({autoOpen:false,modal:true,height:240,width:443,buttons:{"确定":function(){var l=$("#tabname").val();var o=$("input[name=defaulttab]:checked").val();var n=window.currTabsParentID;if(l==""){alert("请填写卡片名称!");return false}var t=$("#navtabform").attr("navid");var s={level:3,pagetype:2,tabname:l,parentid:n,defaulttab:o};var r="";if(t==""){s.type="addnavtab"}else{s.type="updatenavtab";s.id=t;r="&navid="+t+""}var m;var k=config.phpUrl+"modelinterface.php?type=checktabexist&tabname="+l+"&parentid="+n+""+r+"";$.ajax({type:"GET",dataType:"json",url:k,async:false,success:function(u){if(u!=null){m=u.flag}}});if(m==1){alert("卡片名称已存在,请更改!");return false}if(parseInt(o,10)==1){var q;var p=config.phpUrl+"modelinterface.php?type=checkdefaulttab&parentid="+n+r;$.ajax({url:p,dataType:"json",cache:false,async:false,success:function(u){q=u.flag}});if(q==1){if(!confirm("已存在默认卡片，是否进行修改!")){return false}}}var k=config.phpUrl+"modelinterface.php";$.ajax({type:"POST",contentType:"application/json",dataType:"json",url:k,data:JSON.stringify(s),success:function(u){if(u.flag==1){$("#addnewtabdiv").dialog("close");a(b,1)}}})},"取消":function(){$(this).dialog("close")}},close:function(){}});$("#addnewtab").bind("click",function(){$("#navtabform").attr("navid","");$("#tabname").val("");$("#defaulttab0").attr("checked",true);$("#addnewtabdiv").dialog("option","title","新增卡片");$("#addnewtabdiv").dialog("open")})};this.selectall=function(){$("#tablelist :checkbox").each(function(){$(this).attr("checked","true")})};this.unselectall=function(){$("#tablelist :checkbox").each(function(){$(this).attr("checked",!this.checked)})};this.delselect=function(){var i=[];$("#tablelist input[name=tabchecklist]:checked").each(function(m,n){i.push($(n).val())});if(i.length>0){var l="您确认要删除选中卡片么，删除后卡片中的模型将无法恢复!";var j=$("#tablelist").attr("totalcount");if(i.length==parseInt(j,10)){l="您确认要删除全部卡片么，只有最后一个卡片的模型会被保持在页面中!"}if(confirm(l)){var k=config.phpUrl+"modelinterface.php?type=deletenavtab&id="+i;ajaxRequest(k,function(m){if(m!=null){if(m.flag==1){a(b,1)}else{alert("删除失败!")}}},"json")}}};this.editinnernavtab=function(i){$("#navtabform").attr("navid",i);$("#tabname").val("");var j=config.getNavbyidUrl+"&navid="+i;ajaxRequest(j,function(k){$("#addnewtabdiv").dialog("option","title","修改卡片");$("#addnewtabdiv").dialog("open");if(k.totalcount>0){$.each(k.children,function(m,l){$("#tabname").val(l.tabname);$("input[name=defaulttab][value="+l.defaulttab+"]").attr("checked",true)})}},"json")};var a=function(j,k){if(k==""||k==null||k==undefined){c=1}else{c=k}var i=config.phpUrl+"modelinterface.php?type=gettabbyparentid&navid="+window.currTabsParentID+"&page="+c+"&pagesize="+j+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:i,async:false,beforeSend:function(){$("#tablelist").html("<img src='"+config.imagePath+"wait.gif'  style='padding:10px;padding-left:215px;' id='waitimg'/>")},success:function(l){d=[];var m="<tr><th>选择</th><th>卡片名称</th><th>是否默认</th><th>创建时间</th><th>操作</th></tr>";if(l!=null&&l.totalcount>0){$.each(l.children,function(o,n){var p=parseInt(n.defaulttab,10)?"是":"否";m+="<tr><td><input type='checkbox' name='tabchecklist'  value="+n.id+" /></td><td>"+n.tabname+"</td><td>"+p+"</td><td>"+n.updatetime+"</td><td><a href='javascript:editinnernavtab("+n.id+");'>修改</a></td></tr>";d.push(n)});m+="<tr><td colspan='5'><div style='text-align:left;'>&nbsp;&nbsp;<input type='button' name='selectAll' id='selectAll' onclick='selectall()' value='全选'>&nbsp;&nbsp;<input type='button' name='unselectAll' id='unselectAll' onclick='unselectall()' value='反选'>&nbsp;&nbsp;<input type='button' name='delall' id='delall' onclick='delselect()' value='删除'></div></td></tr>";if(l.totalcount>j){m+="<tr><td colspan='5'><div id='navtabpage' style='margin-top:2px;float:left;width:100%;margin:5px;'></div></td></tr>"}$("#tablelist").attr("totalcount",l.totalcount)}else{m+="<tr><td colspan='5'>暂无记录!</td></tr>"}$("#tablelist").empty().append(m);if(l!=null&&l.totalcount!=undefined&&l.totalcount>j){pageDisplay(l.totalcount,a,"navtabpage",j,c)}else{$("#navtabpage").empty()}},complete:function(){$("#waitimg").css({display:"none"})},error:function(){}})};e()}function myUpdateSchedule(l,n,k,C,z){var r=this;var t="updatesched";if(k!=undefined){t=k}var i=0;this.submitFun=function(){var J=0;var E={};var I=$("input[name=sched"+t+"_enable]:checked").val();E.status=parseInt(I,10);var K=$("#"+t+"_cronstart").val();var Q=$("#"+t+"_cronend").val();if(K!=""&&Q!=""){var N=getTimeSec(K);var O=getTimeSec(Q);if(O<=N){alert("失效时间应该大于生效时间!");J++;return false}E.cronstart=N;E.cronend=O}else{if(K!=""){var N=getTimeSec(K);E.cronstart=N}if(Q!=""){var O=getTimeSec(Q);E.cronend=O}}var R=$("#"+t+"_crontime").val();if(R==""&&parseInt(I,10)){alert("请选择更新计划!");J++;return false}else{E.crontime=R}E.remarks=$("#"+t+"_remarks").val();E.history_enable=$("input[name="+t+"_history_enable]:checked").val();if(parseInt(E.history_enable,10)){var G=$("#"+t+"_history_save").attr("savetype");if(G=="count"){var H=$("#"+t+"_history_count").val();if(testPositiveInt(H,256)){E.history_count=H}else{if(parseInt(E.status,10)){alert("请填写正整数!");J++;return false}}}else{var L=$("#"+t+"_history_duration").val();if(L){L=getTimeSec(L)}else{if(parseInt(E.status,10)){alert("请填写保存时间!");J++;return false}}E.history_duration=L}}if(C){var P={};P.name=$("#"+t+"_event_name").val();P.remarks=$("#"+t+"_event_remarks").val();var M=$("#"+t+"_event_condition_datafrom_x_start").val();P.datastart=(parseInt(M,10)-1)>0?(parseInt(M,10)-1):0;var F=$("#"+t+"_event_condition_datafrom_x_end").val();if(F!=""){P.dataend=parseInt(F,10)-1}P.alarms=[];$("div[name="+t+"_event_alarm_group]").each(function(U,af){var Y=$(af).attr("alarmnum");var W={};W.sevtext=$("#"+t+"_event_severity_"+Y+"").val();W.trigtext=$("#"+t+"_event_severity_name_"+Y+"").val();W.trigger={};var Z=$("#"+t+"_event_condition_logic_"+Y+"").attr("code");if(!Z){alert("请添加预警逻辑关系!");J++;return false}W.trigger=jQuery.parseJSON(Z);W.action={};W.action.type=$("input[name="+t+"_event_action_type_"+Y+"]:checked").val();var ag=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;var ac=$("#"+t+"_event_mail_to_"+Y+"").val().replace(/\s/g,"");var T=ac.split(";");var ae=false;$.each(T,function(ah,ai){if(!ag.test(ai)){ae=true;return false}});if(ae){alert("请填写正确的收件人!");J++;return false}else{W.action.to=ac}var S=$("#"+t+"_event_mail_cc_"+Y+"").val().replace(/\s/g,"");if(S!=""){var ad=S.split(";");var ae=false;$.each(ad,function(ah,ai){if(!ag.test(ai)){ae=true;return false}});if(!ae){W.action.cc=S}else{alert("请填写正确的抄送人!");J++;return false}}var X=$("#"+t+"_event_mail_bcc_"+Y+"").val().replace(/\s/g,"");if(X!=""){var aa=X.split(";");var ae=false;$.each(aa,function(ah,ai){if(!ag.test(ai)){ae=true;return false}});if(!ae){W.action.bcc=X}else{alert("请填写正确的密送人!");J++;return false}}var V=$("#"+t+"_event_mail_subject_"+Y+"").val();if(V!=""){W.action.subject=V}else{alert("请填写邮件标题!");J++;return false}var ab=$("#"+t+"_event_mail_message_"+Y+"").val();if(ab!=""){W.action.message=ab}else{alert("请填写邮件正文!");J++;return false}P.alarms.push(W)});if(P.alarms.length>0){E.eventlist=P}}else{if(n!=undefined&&n.eventlist!=undefined){E.eventlist=n.eventlist}}if(k!=undefined){if(J==0){return E}else{return false}}else{if(J==0){l(E);return true}else{return false}}};var B=function(){var K;var E="";if(window.currInstance){K=getCurrSnapshotData();if(K!=null&&K[0].facet!=undefined){E=K[0].facet.name}}else{if(n!=undefined&&n.elecondition!=undefined){K=n.elecondition.firstrequestData;if(K!=null&&K[0].facet!=undefined){E=K[0].facet.name}}}var I={};if(!K){I={text:"",frq:0}}else{I=K[0]["datalist"][0]}var J="";var H=0;for(var L in I){if(L!="other"&&L!="alias"){H++;var F="";switch(L){case"text":var G="";if(E==""){G="正文"}else{G=getDisplayName(E)}F=G;if(I.alias!=undefined){L="alias"}break;case"range":F="区间起始";break;case"rangeend":F="区间结束";break;default:var G=getRetweetDisplayName(L);if(G!=""&&G!=undefined){F=G}break}var M="";switch(H){case 1:M=H+"(X轴:"+F+")";break;case 2:if(F!=""){M=H+"(Y轴:"+F+")"}else{M=H+"(Y轴)"}break;default:if(F!=""){M=H+"("+F+")"}break}if(M!=""){J+="<option value='"+H+"' field='"+L+"'>"+M+"</option>"}}}return J};var v=function(E){var G="";G+='<div name="alarmaccordion">';G+='<h3><a href="javascript:void(0);">事件预警组合'+E+"</a></h3>";G+='<div id="'+t+"_event_alarm_group_"+E+'" alarmnum="'+E+'" name="'+t+'_event_alarm_group" style="border:1px solid #CCCCCC;">';if(z){G+='<div style="text-align:right;"><a name="'+t+'_event_alarm_delete" alarmnum="'+E+'" href="javascript:void(0);" style="color:blue;">删除</a></div>'}G+="<fieldset>";G+="<legend>事件预警条件</legend>";G+='<div class="search"><span class="rightalign">级别：</span><select name="'+t+'_event_severity" id="'+t+"_event_severity_"+E+'">';G+='<option value="1">一</option>';G+='<option value="2">二</option>';G+='<option value="3">三</option>';G+='<option value="4">四</option>';G+='<option value="5">五</option>';G+="</select>(数字越小,级别越高)</div>";G+='<div class="search"><span class="rightalign">级别名称：</span><input type="text" name="'+t+'_event_severity_name" id="'+t+"_event_severity_name_"+E+'" /></div>';G+='<div name="'+t+'_event_condition_create" alarmnum="'+E+'" operand="left">';var F=false;if(window.currInstance!=null&&(window.currInstance.instanceType==3||window.currInstance.elements[0].dataJson.classifyquery!=null)){F=true}else{if(n!=undefined&&n.elecondition!=undefined){if(n.elecondition.instancetype==3||n.elecondition.classifyquery!=null){F=true}}}if(F){G+='<div class="search"><span class="rightalign"></span>第<input type="text" id="'+t+"_event_condition_datafrom_group_"+E+'" name="'+t+'_event_condition_datafrom_group" alarmnum="'+E+'" />组</div>'}G+='<div class="search"><span class="rightalign"></span><span name="'+t+'_event_condition_data_totalnum" alarmnum="'+E+'" style="cursor:pointer;background-color: #F0F0F0;border: 1px solid #D5D5D5;">记录个数</span></div>';G+='<div class="search"><span class="rightalign"></span>第<select id="'+t+"_event_condition_datafrom_columns_arbitrary_"+E+'" name="'+t+'_event_condition_datafrom_columns" alarmnum="'+E+'" datafrom="all">';G+=B();G+='</select>列<span name="'+t+'_event_condition_datafrom_arbitraryvalue" alarmnum="'+E+'" style="cursor:pointer;background-color: #F0F0F0;border: 1px solid #D5D5D5;">任意值</span><span id="'+t+"_event_condition_datafrom_columns_arbitrary_"+E+'_field"></span></div>';G+='<div class="search"><span class="rightalign"></span>第<select id="'+t+"_event_condition_datafrom_columns_x_"+E+'" name="'+t+'_event_condition_datafrom_columns" alarmnum="'+E+'" datafrom="specified">';G+=B();G+='</select>列第<input type="text" id="'+t+"_event_condition_datafrom_x_"+E+'" name="'+t+'_event_condition_datafrom_x" alarmnum="'+E+'" />行的值<span id="'+t+"_event_condition_datafrom_columns_x_"+E+'_field"></span></div>';G+='<div class="search"><span class="rightalign"></span>第<select id="'+t+"_event_condition_datafrom_columns_y_"+E+'" name="'+t+'_event_condition_datafrom_columns" alarmnum="'+E+'" datafrom="statistics">';G+=B();G+='</select>列<select name="'+t+'_event_condition_datafrom_y" alarmnum="'+E+'">';G+='<option value="">请选择</option>';G+='<option value="count">计数</option>';G+='<option value="sum">求和</option>';G+='<option value="max">最大值</option>';G+='<option value="min">最小值</option>';G+='<option value="average">平均值</option>';G+='</select><span id="'+t+"_event_condition_datafrom_columns_y_"+E+'_field"></span></div>';G+='<div class="search"><span class="rightalign"></span>固定值<input type="text" id="'+t+"_event_condition_datafrom_value_"+E+'" name="'+t+'_event_condition_datafrom_value" alarmnum="'+E+'" /></div>';G+="</div>";G+='<div id="'+t+"_event_condition_cal_div_"+E+'" class="search"><span class="rightalign">数学运算：</span>';G+='<div><span class="rightalign"></span><span style="border: 1px solid #ff0000; cursor: pointer;margin: 5px;padding:2px;color:#CCCCCC;" id="'+t+"_event_condition_cal_leftoperand_"+E+'" name="'+t+'_event_condition_cal_leftoperand" alarmnum="'+E+'">添加数值</span><select id="'+t+"_event_condition_cal_oper_"+E+'" name="'+t+'_event_condition_cal_oper" alarmnum="'+E+'"><option value="">请选择</option><option value="+">加</option><option value="-">减</option><option value="×">乘</option><option value="÷">除</option><option value="%">取模</option></select><span id="'+t+"_event_condition_cal_rightoperand_"+E+'" name="'+t+'_event_condition_cal_rightoperand" alarmnum="'+E+'" style="border: 1px dashed #CCCCCC; cursor:pointer;margin:5px;padding:2px;display:none;color:#CCCCCC;">添加数值</span><span style="border: 1px dashed #CCCCCC; cursor: pointer; font-size: 18px; margin: 5px;display:none;color:#CCCCCC;" name="'+t+'_event_condition_cal_operand_add" alarmnum="'+E+'">+</span><span><input type="button" id="" name="'+t+'_event_condition_cal_clear" alarmnum="'+E+'" value="清空" style="display:none;" /></span> </div>';G+='<div style="text-align:center;margin:3px;"><span name="'+t+'_event_condition_cal_to_cond" alarmnum="'+E+'" operand="left" title="添加到条件运算" ><img src="'+config.imagePath+'addnext.png" style="cursor:pointer;height:20px;width:120px;"/></span></div>';G+="</div>";G+='<div class="search"><span class="rightalign">条件运算：</span></div>';G+='<div><span class="rightalign"></span><span style="border: 1px dashed #CCCCCC; cursor: pointer;margin: 5px;padding:2px;color:#CCCCCC;" id="'+t+"_event_condition_cond_leftoperand_"+E+'" name="'+t+'_event_condition_cond_leftoperand" alarmnum="'+E+'">添加条件</span><select id="'+t+"_event_condition_cond_oper_"+E+'" name="'+t+'_event_condition_cond_oper" alarmnum='+E+">";G+='<option value="">请选择</option>';G+='<option value="==">等于</option>';G+='<option value="!=">不等于</option>';G+='<option value=">">大于</option>';G+='<option value=">=">大于等于</option>';G+='<option value="<">小于</option>';G+='<option value="<=">小于等于</option>';G+='<option value="[]">包含</option>';G+='</select><span style="border: 1px dashed #CCCCCC; cursor:pointer;margin:5px;padding:2px;display:none;color:#CCCCCC;" id="'+t+"_event_condition_cond_rightoperand_"+E+'" name="'+t+'_event_condition_cond_rightoperand" alarmnum="'+E+'" >添加条件</span><span style="border: 1px dashed #CCCCCC; cursor: pointer; font-size: 18px; margin: 5px; display:none;" name="'+t+'_event_condition_cond_operand_add" alarmnum="'+E+'">+</span><span><input type="button" name="'+t+'_event_condition_cond_clear" alarmnum="'+E+'" value="清空" style="display:none;" /></span></div>';G+='<div style="text-align:center;margin:3px;"><span name="'+t+'_event_condition_cond_to_logic" alarmnum="'+E+'" title="添加到逻辑运算"><img src="'+config.imagePath+'addnext.png" style="cursor:pointer;height:20px;width:120px;"/></span></div>';G+='<div class="search"><span class="rightalign">逻辑运算：</span></div>';G+="<fieldset>";G+="<legend>可配置条件</legend>";G+='<div id="'+t+"_event_condition_logic_choice_"+E+'"></div>';G+="</fieldset>";G+='<div><input type="button" name="'+t+'_event_condition_relation_and" alarmnum="'+E+'" value="并且" /><input type="button" name="'+t+'_event_condition_relation_or" alarmnum="'+E+'" value="或" /><input type="button" name="'+t+'_event_condition_relation_not" alarmnum="'+E+'" value="非"/>&nbsp;&nbsp;&nbsp; <input type="button" name="'+t+'_event_condition_relation_reset" alarmnum="'+E+'" value="重置"/><input type="button" id="'+t+"_event_condition_relation_clear_"+E+'" name="'+t+'_event_condition_relation_clear" alarmnum="'+E+'" value="清空"/></div>';G+="<fieldset>";G+="<legend>逻辑关系</legend>";G+='<div id="'+t+"_event_condition_logic_"+E+'"></div>';G+="</fieldset>";G+="</fieldset>";G+="<fieldset>";G+="<legend>事件预警动作</legend>";G+='<div class="search"><span class="rightalign">类型：</span><input type="checkbox" name="'+t+"_event_action_type_"+E+'" id="'+t+"_event_action_type_"+E+'" value="mail" checked="checked" /><label for="'+t+"_event_action_type_"+E+'">发送邮件</label></div>';G+='<div class="search"><span class="rightalign">收件人：</span><input type="text" name="'+t+'_event_mail_to" id="'+t+"_event_mail_to_"+E+'" style="width:300px;" /></div>';G+='<div class="search"><span class="rightalign">抄送人：</span><input type="text" name="'+t+'_event_mail_cc" id="'+t+"_event_mail_cc_"+E+'" style="width:300px;" /></div>';G+='<div class="search"><span class="rightalign">密送人：</span><input type="text" name="'+t+'_event_mail_bcc" id="'+t+"_event_mail_bcc_"+E+'" style="width:300px;" /></div>';G+='<div class="search"><span class="rightalign">标题：</span><input type="text" name="'+t+'_event_mail_subject" id="'+t+"_event_mail_subject_"+E+'" /></div>';G+='<div class="search"><span class="rightalign">正文：</span><textarea name="'+t+'_event_mail_message" id="'+t+"_event_mail_message_"+E+'" style="width: 233px; height: 34px;" cols="7" rows="5" ></textarea></div>';G+="</fieldset>";G+="</div>";G+="</div>";return G};var g=function(F){var E="";E+=F.leftoperand.axis+"轴";switch(F.leftoperand.sampling.type){case"value":E+="第"+F.leftoperand.sampling.value+"个值";break;case"range":E+="第"+F.leftoperand.sampling.value.start+"到"+F.leftoperand.sampling.value.end+"个值";break;case"all":E+="所有值";default:break}switch(F.relation){case"==":E+="等于";break;case"!=":E+="等于";break;case">":E+="大于";break;case">=":E+="大于等于";break;case"<":E+="小于";break;case"<=":E+="小于等于";break;case"[]":E+="包含";break;default:break}switch(F.rightoperand.type){case"string":E+=F.rightoperand.value;break;default:break}return E};var d=function(E,G,F){$(E).empty().append(G);$(E).attr("code",JSON.stringify(F));$(E).css({color:"#000000",border:"1px solid #FF0000",display:""})};var w=function(E,H){if(H.table!=undefined){var G=parseInt(H.table,10)+1;$("#"+t+"_event_condition_datafrom_group_"+E+"").val(G)}if(H.constant){$("#"+t+"_event_condition_datafrom_value_"+E+"").val(H.constant);y(E,"#"+t+"_event_condition_datafrom_value_"+E+"")}else{if(H.row!=undefined){switch(H.row){case"totalnum":y(E,"span[name="+t+"_event_condition_data_totalnum][alarmnum="+E+"]");break;case"all":$("#"+t+"_event_condition_datafrom_columns_arbitrary_"+E+"").val(H.column);y(E,"span[name="+t+"_event_condition_datafrom_arbitraryvalue][alarmnum="+E+"]");break;case"count":case"sum":case"max":case"min":case"average":$("#"+t+"_event_condition_datafrom_columns_y_"+E+"").val(H.column);$("select[name="+t+"_event_condition_datafrom_y][alarmnum="+E+"]").val(H.row);y(E,"select[name="+t+"_event_condition_datafrom_y][alarmnum="+E+"]");break;default:var I=parseInt(H.column,10)+1;$("#"+t+"_event_condition_datafrom_columns_x_"+E+"").val(I);var F=parseInt(H.row,10)+1;$("#"+t+"_event_condition_datafrom_x_"+E+"").val(F);y(E,"#"+t+"_event_condition_datafrom_x_"+E+"");break}}}};var p=function(G){var I={};var M=$("#"+t+"_event_condition_datafrom_group_"+G+"").val();if(M!=""&&M!=undefined){I.table=parseInt(M,10)-1;var O="";if(window.currInstance){var L=getCurrSnapshotData();if(L[I.table]!=undefined){O=L[I.table]["categoryname"];if(O){I.tablename=O}}}else{if(n!=undefined&&n.elecondition!=undefined){var N=n.elecondition.firstrequestData;if(N[I.table]!=undefined){O=N[I.table]["categoryname"];if(O){I.tablename=O}}}}}var H=$("div[name="+t+"_event_condition_create][alarmnum="+G+"]").attr("datafrom");switch(H){case"totalnum":I.row="totalnum";I.column=0;break;case"all":var J=$("#"+t+"_event_condition_datafrom_columns_arbitrary_"+G+"").val();I.row="all";I.column=parseInt(J,10)-1;I.field=$("#"+t+"_event_condition_datafrom_columns_arbitrary_"+G+" option[value="+J+"]").attr("field");break;case"specified":var K=$("#"+t+"_event_condition_datafrom_x_"+G+"").val();if(K!=""){I.row=parseInt(K,10)-1}var J=$("#"+t+"_event_condition_datafrom_columns_x_"+G+"").val();I.column=parseInt(J,10)-1;I.field=$("#"+t+"_event_condition_datafrom_columns_x_"+G+" option[value="+J+"]").attr("field");break;case"statistics":var J=$("#"+t+"_event_condition_datafrom_columns_y_"+G+"").val();I.column=parseInt(J,10)-1;I.field=$("#"+t+"_event_condition_datafrom_columns_y_"+G+" option[value="+J+"]").attr("field");var F=$("select[name="+t+"_event_condition_datafrom_y][alarmnum="+G+"]").val();if(F!=""){I.row=F}break;case"constant":var E=$("#"+t+"_event_condition_datafrom_value_"+G+"").val();if(E!=""){I.constant=E}break;default:break}return I};var A=function(E){var H={};var F=$("#"+t+"_event_condition_cal_leftoperand_"+E+"").attr("code");H.arg1=jQuery.parseJSON(F);var I=$("#"+t+"_event_condition_cal_rightoperand_"+E+"").attr("code");var J=$("#"+t+"_event_condition_cal_rightoperand_"+E+"").css("display");if(I&&J!="none"){if(I){H.arg2=jQuery.parseJSON(I);var G=$("#"+t+"_event_condition_cal_oper_"+E+"").val();H.cop=G}}if(F){return H}else{return false}};var c=function(F,G){if(G){var E=false;for(var H in G){if(H=="cop"){$("#"+t+"_event_condition_cal_oper_"+F+"").val(G[H])}else{var I=getAtomicExpDes(G[H]);if(I!=""){var J="";if(!E){J="left";E=true;$("#"+t+"_event_condition_cal_rightoperand_"+F+"").css({border:"1px solid #CCCCCC"})}else{J="right";$("#"+t+"_event_condition_cal_leftoperand_"+F+"").css({border:"1px solid #CCCCCC"})}$("div[name="+t+"_event_condition_create][alarmnum="+F+"]").attr("operand",J);d("#"+t+"_event_condition_cal_"+J+"operand_"+F+"",I,G[H])}w(F,G[H])}}}};var u=function(E){$("select[name="+t+"_event_condition_datafrom_columns][alarmnum="+E+"]").val(1);$("#"+t+"_event_condition_datafrom_x_"+E+"").val("");$("select[name="+t+"_event_condition_datafrom_y][alarmnum="+E+"]").val("");$("#"+t+"_event_condition_datafrom_value_"+E+"").val("")};var q=function(E){$("span[name="+t+"_event_condition_data_totalnum][alarmnum="+E+"]").parent("div").css({border:""});$("span[name="+t+"_event_condition_datafrom_arbitraryvalue][alarmnum="+E+"]").parent("div").css({border:""});$("input[name="+t+"_event_condition_datafrom_x][alarmnum="+E+"]").parent("div").css({border:""});$("select[name="+t+"_event_condition_datafrom_y][alarmnum="+E+"]").parent("div").css({border:""});$("input[name="+t+"_event_condition_datafrom_value][alarmnum="+E+"]").parent("div").css({border:""})};var y=function(F,E){q(F);$(E).parent("div").css({border:"1px solid #FF0000"});$("input[name="+t+"_event_condition_cal_clear][alarmnum="+F+"]").show();$("input[name="+t+"_event_condition_cond_clear][alarmnum="+F+"]").show()};var x=function(E){$("#"+t+"_event_condition_cal_leftoperand_"+E+"").text("添加数值");$("#"+t+"_event_condition_cal_leftoperand_"+E+"").css({border:"1px solid #FF0000",color:"#CCCCCC"});$("#"+t+"_event_condition_cal_leftoperand_"+E+"").removeAttr("code");$("#"+t+"_event_condition_cal_rightoperand_"+E+"").text("添加数值");$("#"+t+"_event_condition_cal_rightoperand_"+E+"").css({border:"1px solid #CCCCCC",display:"none"});$("#"+t+"_event_condition_cal_rightoperand_"+E+"").removeAttr("code");$("div[name="+t+"_event_condition_create][alarmnum="+E+"]").attr("operand","left");$("#"+t+"_event_condition_cal_oper_"+E+"").val("");$("#"+t+"_event_condition_cal_oper_"+E+"").css({display:"none"})};var a=function(E){$("#"+t+"_event_condition_cond_leftoperand_"+E+"").text("添加条件");$("#"+t+"_event_condition_cond_leftoperand_"+E+"").css({border:"1px dashed #CCCCCC",color:"#CCCCCC"});$("#"+t+"_event_condition_cond_leftoperand_"+E+"").removeAttr("code");$("#"+t+"_event_condition_cond_rightoperand_"+E+"").text("添加条件");$("#"+t+"_event_condition_cond_rightoperand_"+E+"").css({border:"1px solid #CCCCCC",display:"none"});$("#"+t+"_event_condition_cond_rightoperand_"+E+"").removeAttr("code");$("span[name="+t+"_event_condition_cal_to_cond][alarmnum="+E+"]").attr("operand","left");$("#"+t+"_event_condition_cond_oper_"+E+"").val("");$("input[name="+t+"_event_condition_cond_clear][alarmnum="+E+"]").show()};var o=function(G,E){if(E.obj1){var F=getCalExpDes(E.obj1);d("#"+t+"_event_condition_cond_leftoperand_"+G+"",F,E.obj1);$("#"+t+"_event_condition_cond_leftoperand_"+G+"").css({border:"1px solid #FF0000"});$("#"+t+"_event_condition_cond_rightoperand_"+G+"").css({border:"1px solid #CCCCCC"});c(G,E.obj1)}if(E.obj2){$("#"+t+"_event_condition_cond_oper_"+G+"").val(E.rop);var F=getCalExpDes(E.obj2);d("#"+t+"_event_condition_cond_rightoperand_"+G+"",F,E.obj2);$("#"+t+"_event_condition_cond_leftoperand_"+G+"").css({border:"1px solid #CCCCCC"});$("#"+t+"_event_condition_cond_rightoperand_"+G+"").css({border:"1px solid #FF0000"});c(G,E.obj2)}};var m=function(G){var H={};H.type="relation";var I=$("#"+t+"_event_condition_cond_leftoperand_"+G+"").attr("code");H.obj1=jQuery.parseJSON(I);var E=$("#"+t+"_event_condition_cond_rightoperand_"+G+"").attr("code");var F=$("#"+t+"_event_condition_cond_rightoperand_"+G+"").css("display");if(E&&F!="none"){H.obj2=jQuery.parseJSON(E);var J=$("#"+t+"_event_condition_cond_oper_"+G+"").val();H.rop=J}return H};var j=function(F){var H=$("span[name="+t+"_event_condition_cal_to_cond][alarmnum="+F+"]").attr("operand");var G=A(F);if(G){var E=getCalExpDes(G);d("#"+t+"_event_condition_cond_"+H+"operand_"+F+"",E,G);if(H=="left"){$("#"+t+"_event_condition_cond_leftoperand_"+F+"").css({border:"1px solid #FF0000"});$("#"+t+"_event_condition_cond_rightoperand_"+F+"").css({border:"1px solid #CCCCCC"})}else{$("#"+t+"_event_condition_cond_leftoperand_"+F+"").css({border:"1px solid #CCCCCC"});$("#"+t+"_event_condition_cond_rightoperand_"+F+"").css({border:"1px solid #FF0000"})}$("input[name="+t+"_event_condition_cond_clear][alarmnum="+F+"]").show()}};var D=function(F,I){if(I){var E=[];getLogicConds(E,I);var K="";var G=[];$.each(E,function(L,M){if(!G.inArray(JSON.stringify(M.exp))){G.push(JSON.stringify(M.exp));K+="<div><input type='checkbox' name='"+t+"_event_condition_logic_choice_field' alarmnum='"+F+"' id='' value='"+JSON.stringify(M.exp)+"' /><span name='"+t+"_event_condition_logic_choice_span' alarmnum='"+F+"' style='cursor:pointer;'>"+M.expdes+"</span><input type='button' name='"+t+"_event_condition_relation_split' alarmnum='"+F+"' value='删除'/></div>"}});$("#"+t+"_event_condition_logic_choice_"+F+"").append(K);o(F,E[0].exp);var J=getLogicExpDes(I);var H="<span id=''>"+J+"</span>";$("#"+t+"_event_condition_logic_"+F+"").empty().append(H);$("#"+t+"_event_condition_logic_"+F+"").attr("code",JSON.stringify(I))}};var f=function(J,F,O,I){var P=$("input[type=checkbox][name="+t+"_event_condition_logic_choice_field][alarmnum="+J+"]:checked").length;if(P>0){var G={};var K="";var H="";var L="";switch(F){case"&&":L="并且";H="#ff0000";if(P<2){alert("请选择两项!");return false}break;case"||":L="或";H="#00ff00";if(P<2){alert("请选择两项!");return false}break;case"!":L="非";H="#0000ff";if(P>1){alert("请选择一项!");return false}break;case"N/A":L="";H="#CCCCCC";break;default:break}G.type="boolean";G.bop=F;$("input[name="+t+"_event_condition_logic_choice_field][alarmnum="+J+"]:checked").each(function(S,Q){var U=$(Q).attr("id");var T=jQuery.parseJSON($(Q).val());var R=parseInt(S,10)+1;G["cond"+R+""]=T;if(F=="!"){if(parseInt(U,10)<0){K+=L+"<div style='border:1px #0000ff solid;margin:2px;display:inline-block'>"+getLogicExpDes(T)+"</div>"}else{K+=L+"<span style='border:1px "+H+" solid;padding:2px;margin:2px;display:inline-block;'>"+getCondExpDes(T)+"</span>"}}else{if(parseInt(U,10)<0){K+="<div style='border:1px #0000ff solid;margin:2px;display:inline-block'>"+getLogicExpDes(T)+"</div>"+L}else{K+="<span style='border:1px "+H+" solid;padding:2px;margin:2px;display:inline-block;'>"+getCondExpDes(T)+"</span>"+L}}});var N=/并且$|或$/g;K=K.replace(N,"");if(F!="N/A"&&I!="condtologic"){var M="<div><input type='checkbox' name='"+t+"_event_condition_logic_choice_field' alarmnum='"+J+"' id='"+O+"' value='"+JSON.stringify(G)+"' /><span name='"+t+"_event_condition_logic_choice_span' alarmnum='"+J+"' style='cursor:pointer;'>"+K+"</span><input type='button' name='"+t+"_event_condition_relation_split' alarmnum='"+J+"' value='删除'/></div>";$("#"+t+"_event_condition_logic_choice_"+J+"").append(M)}var E="<span id=''>"+K+"</span>";$("#"+t+"_event_condition_logic_"+J+"").empty().append(E);$("#"+t+"_event_condition_logic_"+J+"").attr("code",JSON.stringify(G))}};var b=function(F){var G=m(F);var E=getCondExpDes(G);if(E!=""){var H="<div><input type='checkbox' name='"+t+"_event_condition_logic_choice_field' alarmnum='"+F+"' id='' value='"+JSON.stringify(G)+"' checked='checked' /><span name='"+t+"_event_condition_logic_choice_span' alarmnum='"+F+"' style='cursor:pointer;'>"+E+"</span><input type='button' name='"+t+"_event_condition_relation_split' alarmnum='"+F+"' value='删除'/></div>";$("#"+t+"_event_condition_logic_choice_"+F+"").append(H)}var I=$("input[type=checkbox][name="+t+"_event_condition_logic_choice_field][alarmnum="+F+"]:checked").length;if(I==1){i--;f(F,"N/A",i,"condtologic")}else{i--;f(F,"&&",i,"condtologic")}};var e=function(){if(C){$("div[name=scheduleaccordion][issnapshot=true]").accordion({active:false,collapsible:true});$("div[name=scheduleaccordion][isalarm=true]").accordion({active:0,collapsible:true})}else{$("div[name=scheduleaccordion]").accordion({active:0,collapsible:true})}$("div[name=scheduleaccordion]").children("div").css({height:"auto",padding:0,border:"1px solid #A6C9E2","border-radius":"0",overflow:"visible"});$("div[name=scheduleaccordion]").children("h3").css({border:"0","margin-top":"2px","line-height":"1","background-color":""})};var s=function(){$("div[name=alarmaccordion]").each(function(F,E){$(E).accordion({active:false,collapsible:true})});$("div[name=alarmaccordion]").children("div").css({height:"auto",border:0,padding:0,"border-top":"1px solid #A6C9E2","border-bottom":"1px solid #A6C9E2","border-radius":"0",overflow:"visible"});$("div[name=alarmaccordion]").children("h3").css({border:"0","margin-top":"2px","line-height":"1","background-color":""})};var h=function(){$("#updatescheddiv").remove();var L='<div name="scheduleaccordion" issnapshot="true">';if(k==undefined){L+='<h3><a href="javascript:void(0);">定时计划</a></h3>'}L+="<div>";L+='<div class="search"><span class="rightalign"></span><input type="radio" id="sched'+t+'_enable1" name="sched'+t+'_enable" value="1" checked="checked" /><label for="sched'+t+'_enable1">设定计划</label><input type="radio" id="sched'+t+'_enable0" name="sched'+t+'_enable" value="0" /><label for="sched'+t+'_enable0">取消计划</label></div>';L+='<div class="search"><span class="rightalign">更新计划生效：</span><input id="'+t+'_cronstart" name="'+t+'_cronstart" class="Wdate" type="text" readonly="readonly" style="width:150px;" /></div>';L+='<div class="search"><span class="rightalign">更新计划失效：</span><input id="'+t+'_cronend" name="'+t+'_cronend" class="Wdate" type="text" readonly="readonly" style="width:150px;" /></div>';L+='<div class="search"><span class="rightalign"></span><input id="'+t+'_crontimebtn" name="'+t+'_crontimebtn" type="button"  value="更新计划" /><input id="'+t+'_crontime" name="'+t+'_crontime" type="hidden"/>重复规则：<span id="'+t+'_crontimedes"></span></div>';L+='<div class="search"><span class="rightalign">计划描述：</span><textarea name="'+t+'_remarks" id="'+t+'_remarks" rows="5" cols="7" style="width: 233px; height: 17px;" ></textarea></div>';L+='<div class="search"><span class="rightalign">保存快照历史：</span><input type="radio" name="'+t+'_history_enable" id="'+t+'_history_enable1" value="1" checked="checked" /><label for="'+t+'_history_enable1">是</label><input type="radio" name="'+t+'_history_enable" id="'+t+'_history_enable0" value="0" /><label for="'+t+'_history_enable0">否</label></div>';L+='<div id="'+t+'_history_save">';L+='<div class="search"><span class="rightalign">保存方式：</span><span id="'+t+'_history_duration_span">保存<input id="'+t+'_history_duration" name="'+t+'_history_duration" class="Wdate" type="text" readonly="readonly" style="width:150px;" />至今的历史</span></div>';L+='<div class="search"><span class="rightalign"></span><span id="'+t+'_history_count_span">保存<input type="text" name="'+t+'_history_count" id="'+t+'_history_count" />条历史</span></div>';L+="</div>";L+="</div>";L+="</div>";if(C){var M="";M+='<div name="scheduleaccordion" isalarm="true">';M+='<h3><a href="javascript:void(0);">事件预警</a></h3>';M+="<div>";M+='<div class="search"><span class="rightalign">事件预警名称：</span><input type="text" name="'+t+'_event_name" id="'+t+'_event_name" /></div>';M+='<div class="search"><span class="rightalign">事件预警描述：</span><textarea name="'+t+'_event_remarks" id="'+t+'_event_remarks" rows="5" cols="7" style="width: 233px; height: 17px;" ></textarea></div>';var E=1;if(n!=undefined&&n.eventlist!=undefined){if(n.eventlist.alarms!=undefined){E=n.eventlist.alarms.length}}M+='<div class="search"><span class="rightalign">数据范围：</span>第<input type="text" id="'+t+'_event_condition_datafrom_x_start" name="'+t+'_event_condition_datafrom_x_start" class="shortinput" />到<input type="text" id="'+t+'_event_condition_datafrom_x_end" name="'+t+'_event_condition_datafrom_x_end" class="shortinput" />条的值</div>';M+='<div id="'+t+'_event_alarm_list" alarmcount="'+E+'">';if(z){M+='<div style="text-align: right;" ><a id="'+t+'_event_alarm_add" href="javascript:void(0);" style="color:blue;">添加预警</a></div>'}var J="";for(var K=1;K<=E;K++){J+=v(K)}if(J){M+=J}M+="</div>";M+="</div>";M+="</div>"}if(k!=undefined){var H=L;if(C){H=L+M}$("#"+t).append(H)}else{$("<div id='updatescheddiv'></div").insertAfter("body");var H=L;var P="更新快照计划";if(C){H=L+M;P="事件预警"}$("#updatescheddiv").append(H);$("#updatescheddiv").dialog({title:P,autoOpen:true,modal:true,height:560,width:743,close:function(){}});if(z){$("#updatescheddiv").dialog({buttons:{"确定":function(){if(submitFun()){$("#updatescheddiv").dialog("close")}},"取消":function(){$("#updatescheddiv").dialog("close")}}})}e();s()}var F=n;if(F!=undefined){if(!z){var N=0;$("input[name=sched"+t+"_enable]").attr("disabled","disabled");$("input[name=sched"+t+"_enable][value=0]").attr("checked",true)}else{$("input[name=sched"+t+"_enable]").removeAttr("disabled");var N=parseInt(F.status,10)==0?0:1;$("input[name=sched"+t+"_enable][value="+N+"]").attr("checked",true)}if(N){$("input[name^="+t+"_]").removeAttr("disabled");$("select[name^="+t+"_]").removeAttr("disabled");$("textarea[name^="+t+"_]").removeAttr("disabled")}else{$("input[name^="+t+"_]").attr("disabled","disabled");$("select[name^="+t+"_]").attr("disabled","disabled");$("textarea[name^="+t+"_]").attr("disabled","disabled")}if(F.cronstart){$("#"+t+"_cronstart").val(timeToStr(F.cronstart))}if(F.cronend){$("#"+t+"_cronend").val(timeToStr(F.cronend))}$("#"+t+"_crontime").val(F.crontime);var O=getDesHtml(jQuery.parseJSON(F.crontime));$("#"+t+"_crontimedes").html(O);$("#"+t+"_remarks").val(F.remarks);var R=parseInt(F.history_enable,10)?"1":"0";$("input[name="+t+"_history_enable]").attr("checked",false);$("input[name="+t+"_history_enable][value="+R+"]").attr("checked",true);if(parseInt(R,10)){$("#"+t+"_history_save").css("display","")}else{$("#"+t+"_history_save").css("display","none")}if(F.history_duration){$("#"+t+"_history_duration").val(timeToStr(F.history_duration));$("#"+t+"_history_save").attr("savetype","duration");$("#"+t+"_history_duration_span").css({border:"1px solid #ff0000",padding:"4px"});$("#"+t+"_history_count_span").css({border:"0"})}if(F.history_count!=undefined){$("#"+t+"_history_count").val(F.history_count);$("#"+t+"_history_save").attr("savetype","count");$("#"+t+"_history_duration_span").css({border:"0"});$("#"+t+"_history_count_span").css({border:"1px solid #FF0000",padding:"4px"})}if(F.eventlist!=undefined){$("#"+t+"_event_name").val(F.eventlist.name);$("#"+t+"_event_remarks").val(F.eventlist.remarks);var G=parseInt(F.eventlist.datastart,10);if(!isNaN(G)){G+=1}else{G=""}$("#"+t+"_event_condition_datafrom_x_start").val(G);var Q=parseInt(F.eventlist.dataend,10);if(!isNaN(Q)){Q+=1}else{Q=""}$("#"+t+"_event_condition_datafrom_x_end").val(Q);if(F.eventlist.alarms!=undefined){var S=F.eventlist.alarms.length;for(var K=1;K<=S;K++){var I=F.eventlist.alarms[K-1];$("#"+t+"_event_severity_"+K+"").val(I.sevtext);$("#"+t+"_event_severity_name_"+K+"").val(I.trigtext);D(K,I.trigger);$("input[name="+t+"_event_action_type_"+K+"][value="+I.action.type+"]").attr("checked",true);$("#"+t+"_event_mail_subject_"+K+"").val(I.action.subject);$("#"+t+"_event_mail_message_"+K+"").val(I.action.message);$("#"+t+"_event_mail_cc_"+K+"").val(I.action.cc);$("#"+t+"_event_mail_bcc_"+K+"").val(I.action.bcc);$("#"+t+"_event_mail_to_"+K+"").val(I.action.to)}}}}$("input[type=radio][name=sched"+t+"_enable]").bind("click",function(){var T=$("input[type=radio][name=sched"+t+"_enable]:checked").val();if(parseInt(T,10)){$("input[name^="+t+"_]").removeAttr("disabled");$("select[name^="+t+"_]").removeAttr("disabled");$("textarea[name^="+t+"_]").removeAttr("disabled")}else{$("input[name^="+t+"_]").attr("disabled","disabled");$("select[name^="+t+"_]").attr("disabled","disabled");$("textarea[name^="+t+"_]").attr("disabled","disabled")}});$("#"+t+"_cronstart").unbind("click");$("#"+t+"_cronstart").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:00"})});$("#"+t+"_cronend").unbind("click");$("#"+t+"_cronend").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:00"})});$("#"+t+"_history_duration").unbind("click");$("#"+t+"_history_duration").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss",maxDate:"%y-%M-%d",onpicked:function(){$("#"+t+"_history_duration_span").css({border:"1px solid #ff0000",padding:"4px"});$("#"+t+"_history_count_span").css({border:"0"});$("#"+t+"_history_save").attr("savetype","duration");$("#"+t+"_history_count").val("")},oncleared:function(){$("#"+t+"_history_duration_span").css({border:"0"});$("#"+t+"_history_save").attr("savetype","")}})});$("#"+t+"_history_count").bind("focus",function(){$("#"+t+"_history_duration_span").css({border:"0"});$("#"+t+"_history_count_span").css({border:"1px solid #FF0000",padding:"4px"});$("#"+t+"_history_save").attr("savetype","count")});$("#"+t+"_history_count").bind("blur",function(){var T=$("#"+t+"_history_count").val();if(T!=""){$("#"+t+"_history_duration").val("")}else{$("#"+t+"_history_count_span").css({border:"0"});$("#"+t+"_history_save").attr("savetype","")}});$("input[type=radio][name="+t+"_history_enable]").bind("click",function(){var T=$("input[type=radio][name="+t+"_history_enable]:checked").val();if(parseInt(T,10)){$("#"+t+"_history_save").css("display","")}else{$("#"+t+"_history_save").css("display","none")}});$("#"+t+"_crontimebtn").bind("click",function(){var T=jQuery.parseJSON($("#"+t+"_crontime").val());myCrontimeSelect(function(U){$("#"+t+"_crontime").val(JSON.stringify(U));var V=getDesHtml(U);$("#"+t+"_crontimedes").html(V)},T)});$("#"+t+"_event_alarm_add").bind("click",function(){var T=$("#"+t+"_event_alarm_list").attr("alarmcount");var U=parseInt(T,10)+1;$("#"+t+"_event_alarm_list").append(v(U));$("#"+t+"_event_alarm_list").attr("alarmcount",U);s()});$("a[name="+t+"_event_alarm_delete]").die("click");$("a[name="+t+"_event_alarm_delete]").live("click",function(){var T=$(this).attr("alarmnum");$("#"+t+"_event_alarm_group_"+T+"").parent("div[name=alarmaccordion]").accordion("destroy");$("#"+t+"_event_alarm_group_"+T+"").parent("div[name=alarmaccordion]").remove()});$("input[name="+t+"_event_condition_datafrom_group]").bind("keyup",function(){var V=$(this).attr("alarmnum");var X=$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("datafrom");if(X!=undefined){$("#"+t+"_event_condition_datafrom_value_"+V+"").val("");var T=p(V);var U=getAtomicExpDes(T);if(U!=""){var W=$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("operand");d("#"+t+"_event_condition_cal_"+W+"operand_"+V+"",U,T)}j(V)}});$("span[name="+t+"_event_condition_data_totalnum]").die("click");$("span[name="+t+"_event_condition_data_totalnum]").live("click",function(){var V=$(this).attr("alarmnum");$("#"+t+"_event_condition_datafrom_value_"+V+"").val("");$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("datafrom","totalnum");var T=p(V);var U=getAtomicExpDes(T);if(U!=""){var W=$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("operand");d("#"+t+"_event_condition_cal_"+W+"operand_"+V+"",U,T)}y(V,this);$("#"+t+"_event_condition_cal_oper_"+V+"").css({display:""});j(V)});$("select[name="+t+"_event_condition_datafrom_columns]").die("change");$("select[name="+t+"_event_condition_datafrom_columns]").live("change",function(){var V=$(this).attr("alarmnum");$("#"+t+"_event_condition_datafrom_value_"+V+"").val("");var X=$(this).attr("datafrom");$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("datafrom",X);var T=p(V);var U=getAtomicExpDes(T);if(U!=""){var W=$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("operand");d("#"+t+"_event_condition_cal_"+W+"operand_"+V+"",U,T)}y(V,this);$("#"+t+"_event_condition_cal_oper_"+V+"").css({display:""});j(V)});$("span[name="+t+"_event_condition_datafrom_arbitraryvalue]").die("click");$("span[name="+t+"_event_condition_datafrom_arbitraryvalue]").live("click",function(){var V=$(this).attr("alarmnum");$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("datafrom","all");var T=p(V);var U=getAtomicExpDes(T);var W=$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("operand");d("#"+t+"_event_condition_cal_"+W+"operand_"+V+"",U,T);y(V,this);$("#"+t+"_event_condition_cal_oper_"+V+"").css({display:""});j(V)});$("input[name="+t+"_event_condition_datafrom_x]").die("focus");$("input[name="+t+"_event_condition_datafrom_x]").live("focus",function(){var T=$(this).attr("alarmnum");$("#"+t+"_event_condition_datafrom_value_"+T+"").val("");$("div[name="+t+"_event_condition_create][alarmnum="+T+"]").attr("datafrom","specified");y(T,this)});$("input[name="+t+"_event_condition_datafrom_x]").die("keyup");$("input[name="+t+"_event_condition_datafrom_x]").live("keyup",function(){var V=$(this).attr("alarmnum");var T=p(V);var U=getAtomicExpDes(T);if(U!=""){var W=$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("operand");d("#"+t+"_event_condition_cal_"+W+"operand_"+V+"",U,T)}$("#"+t+"_event_condition_cal_oper_"+V+"").css({display:""});j(V)});$("select[name="+t+"_event_condition_datafrom_y]").die("change");$("select[name="+t+"_event_condition_datafrom_y]").live("change",function(){var V=$(this).attr("alarmnum");$("#"+t+"_event_condition_datafrom_value_"+V+"").val("");$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("datafrom","statistics");var T=p(V);var U=getAtomicExpDes(T);if(U!=""){var W=$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("operand");d("#"+t+"_event_condition_cal_"+W+"operand_"+V+"",U,T)}y(V,this);$("#"+t+"_event_condition_cal_oper_"+V+"").css({display:""});j(V)});$("input[name="+t+"_event_condition_datafrom_value]").die("focus");$("input[name="+t+"_event_condition_datafrom_value]").live("focus",function(){var T=$(this).attr("alarmnum");$("div[name="+t+"_event_condition_create][alarmnum="+T+"]").attr("datafrom","constant");$("#"+t+"_event_condition_datafrom_group_"+T+"").val("");$("#"+t+"_event_condition_datafrom_x_"+T+"").val("");$("select[name="+t+"_event_condition_datafrom_y][alarmnum="+T+"]").val("");y(T,this)});$("input[name="+t+"_event_condition_datafrom_value]").die("keyup");$("input[name="+t+"_event_condition_datafrom_value]").live("keyup",function(){var V=$(this).attr("alarmnum");var T=p(V);if(isNaN(T.constant)){$("#"+t+"_event_condition_cal_oper_"+V+"").css({display:"none"})}else{$("#"+t+"_event_condition_cal_oper_"+V+"").css({display:""})}var U=getAtomicExpDes(T);if(U!=""){var W=$("div[name="+t+"_event_condition_create][alarmnum="+V+"]").attr("operand");d("#"+t+"_event_condition_cal_"+W+"operand_"+V+"",U,T)}j(V)});$("span[name="+t+"_event_condition_cal_leftoperand]").die("click");$("span[name="+t+"_event_condition_cal_leftoperand]").live("click",function(){var T=$(this).attr("alarmnum");$("div[name="+t+"_event_condition_create][alarmnum="+T+"]").attr("operand","left");$(this).css({border:"1px solid #FF0000"});var U=$("#"+t+"_event_condition_cal_rightoperand_"+T+"").attr("code");var V="";if(U){V="solid"}else{V="dashed"}$("#"+t+"_event_condition_cal_rightoperand_"+T+"").css({border:"1px "+V+" #CCCCCC"});u(T);q(T);var W=$(this).attr("code");if(W!=undefined){w(T,jQuery.parseJSON(W))}});$("span[name="+t+"_event_condition_cal_rightoperand]").die("click");$("span[name="+t+"_event_condition_cal_rightoperand]").live("click",function(){var T=$(this).attr("alarmnum");$("div[name="+t+"_event_condition_create][alarmnum="+T+"]").attr("operand","right");$(this).css({border:"1px solid #FF0000"});$("#"+t+"_event_condition_cal_leftoperand_"+T+"").css({border:"1px solid #CCCCCC"});u(T);q(T);var U=$(this).attr("code");if(U!=undefined){w(T,jQuery.parseJSON(U))}});$("select[name="+t+"_event_condition_cal_oper]").die("change");$("select[name="+t+"_event_condition_cal_oper]").live("change",function(){var W=$(this).val();var U=$(this).attr("alarmnum");var X="";var T={};if(W!=""){X="right";T.display="";var V=$("#"+t+"_event_condition_cal_rightoperand_"+U+"").attr("code");if(!V){T.border="1px dashed #CCCCCC";T.color="#CCCCCC"}}else{X="left";T.display="none";$("div[name="+t+"_event_condition_create][alarmnum="+U+"]").attr("operand",X)}$("span[name="+t+"_event_condition_cal_rightoperand][alarmnum="+U+"]").css(T);j(U)});$("input[name="+t+"_event_condition_cal_clear]").die("click");$("input[name="+t+"_event_condition_cal_clear]").live("click",function(){var T=$(this).attr("alarmnum");x(T);u(T);q(T)});$("span[name="+t+"_event_condition_cal_to_cond]").die("click");$("span[name="+t+"_event_condition_cal_to_cond]").live("click",function(){var T=$(this).attr("alarmnum");j(T)});$("span[name="+t+"_event_condition_cond_leftoperand]").die("click");$("span[name="+t+"_event_condition_cond_leftoperand]").live("click",function(){var T=$(this).attr("alarmnum");$("span[name="+t+"_event_condition_cal_to_cond][alarmnum="+T+"]").attr("operand","left");$(this).css({border:"1px solid #FF0000"});var U=$("#"+t+"_event_condition_cond_rightoperand_"+T+"").attr("code");var V="";if(U){V="solid"}else{V="dashed"}$("#"+t+"_event_condition_cond_rightoperand_"+T+"").css({border:"1px "+V+" #CCCCCC"});var W=$(this).attr("code");if(W!=undefined){c(T,jQuery.parseJSON(W))}});$("span[name="+t+"_event_condition_cond_rightoperand]").die("click");$("span[name="+t+"_event_condition_cond_rightoperand]").live("click",function(){var T=$(this).attr("alarmnum");$("span[name="+t+"_event_condition_cal_to_cond][alarmnum="+T+"]").attr("operand","right");x(T);u(T);q(T);$(this).css({border:"1px solid #FF0000"});$("#"+t+"_event_condition_cond_leftoperand_"+T+"").css({border:"1px solid #CCCCCC"});var U=$(this).attr("code");if(U!=undefined){c(T,jQuery.parseJSON(U))}});$("select[name="+t+"_event_condition_cond_oper]").die("change");$("select[name="+t+"_event_condition_cond_oper]").live("change",function(){var W=$(this).val();var U=$(this).attr("alarmnum");var X="";var T={};if(W!=""){X="right";T.display="";var V=$("#"+t+"_event_condition_cond_rightoperand_"+U+"").attr("code");if(!V){T.border="1px dashed #CCCCCC";T.color="#CCCCCC"}}else{X="left";T.display="none";$("span[name="+t+"_event_condition_cal_to_cond][alarmnum="+U+"]").attr("operand",X)}$("span[name="+t+"_event_condition_cond_rightoperand][alarmnum="+U+"]").css(T)});$("input[name="+t+"_event_condition_cond_clear]").die("click");$("input[name="+t+"_event_condition_cond_clear]").live("click",function(){var T=$(this).attr("alarmnum");a(T)});$("span[name="+t+"_event_condition_cond_to_logic]").die("click");$("span[name="+t+"_event_condition_cond_to_logic]").live("click",function(){var T=$(this).attr("alarmnum");b(T)});$("input[name="+t+"_event_condition_relation_and]").die("click");$("input[name="+t+"_event_condition_relation_and]").live("click",function(){var T=$(this).attr("alarmnum");i--;f(T,"&&",i);$("input[name="+t+"_event_condition_logic_choice_field]").attr("checked",false)});$("input[name="+t+"_event_condition_relation_or]").die("click");$("input[name="+t+"_event_condition_relation_or]").live("click",function(){var T=$(this).attr("alarmnum");i--;f(T,"||",i);$("input[name="+t+"_event_condition_logic_choice_field]").attr("checked",false)});$("input[name="+t+"_event_condition_relation_not]").die("click");$("input[name="+t+"_event_condition_relation_not]").live("click",function(){var T=$(this).attr("alarmnum");i--;f(T,"!",i);$("input[name="+t+"_event_condition_logic_choice_field]").attr("checked",false)});$("input[name="+t+"_event_condition_relation_reset]").die("click");$("input[name="+t+"_event_condition_relation_reset]").live("click",function(){var T=$(this).attr("alarmnum");$("input[name="+t+"_event_condition_logic_choice_field][alarmnum="+T+"]").each(function(U,V){var W=$(V).attr("id");if(parseInt(W,10)<0){$(V).parent("div").remove()}});$("#"+t+"_event_condition_logic_"+T+"").empty();$("#"+t+"_event_condition_logic_"+T+"").attr("code","");$("input[name="+t+"_event_condition_logic_choice_field][alarmnum="+T+"]").attr("checked",false)});$("input[name="+t+"_event_condition_relation_clear]").die("click");$("input[name="+t+"_event_condition_relation_clear]").live("click",function(){var T=$(this).attr("alarmnum");$("#"+t+"_event_condition_logic_choice_"+T+"").empty();$("#"+t+"_event_condition_logic_"+T+"").empty();$("#"+t+"_event_condition_logic_"+T+"").attr("code","")});$("input[type=checkbox][name="+t+"_event_condition_logic_choice_field]").die("click");$("input[type=checkbox][name="+t+"_event_condition_logic_choice_field]").live("click",function(){var T=$(this).attr("alarmnum");var U=$("input[type=checkbox][name="+t+"_event_condition_logic_choice_field][alarmnum="+T+"]:checked").length;if($(this).prop("checked")&&U==1){i--;f(T,"N/A",i)}});$("span[name="+t+"_event_condition_logic_choice_span]").die("click");$("span[name="+t+"_event_condition_logic_choice_span]").live("click",function(){var T=$(this).attr("alarmnum");var U=$(this).parent("div").children("input[type=checkbox]").val();o(T,jQuery.parseJSON(U))});$("input[name="+t+"_event_condition_relation_split]").die("click");$("input[name="+t+"_event_condition_relation_split]").live("click",function(){var T=$(this).attr("alarmnum");$(this).parent("div").remove()})};h()}function myEventHistoryList(h,a,k){var j=this;var l;var f=10;var n;var i="";var g="";var d="";var b=[];var e="<input type='button' value='删除' name='deleteitem' style='background-color:#2E6E9E;color:#FFFFFF;' />";var m="<input type='button' value='取消' name='deleteitemselected' style='background-color:#EA3D3D;color:#FFFFFF;' />";this.setSelectedCountPosition=function(){$("#selectdiv").css({display:"inline-block",position:"absolute",width:"20px","z-index":1005,left:$("#selectedcount").offset().left,top:$("#selectedcount").offset().top-40});$("#selectedcount").attr("currstate","unfolded")};this.hideSelectedCount=function(){$("#selectdiv").hide();$("#selectedcount").attr("currstate","folded")};this.deleteSubmitBtn=function(){var p=b.length;if(p>0){var q="<input type='button' id='confirmdelete' name='confirmdelete' value='确认删除' />&nbsp;<input type='button' id='selectedcount' name='selectedcount' value='已选择"+p+"条' currstate='folded' />";$("#eventhistorydeletediv").empty().append(q)}else{$("#eventhistorydeletediv").empty()}};var o=function(){var p="<div id='eventhistorydiv'>";p+="<div id='eventhistory_search_div'>";p+="一级导航:<select id='eventhistory_search_level1'></select>";p+="二级导航:<select id='eventhistory_search_level2'></select>";p+="卡片名称:<select id='eventhistory_search_level3'></select>";p+="事件级别:<input type='text' id='eventhistory_search_trigtext' />";p+="<span>使用*进行模糊查询</span>";p+="<br/>快照时间:<input id='eventhistory_search_triggertimestart' name='eventhistory_search_triggertimestart' class='Wdate' type='text' readonly='readonly'>至<input id='eventhistory_search_triggertimeend' name='eventhistory_search_triggertimeend' class='Wdate' type='text' readonly='readonly'>";p+="<input type='button' name='eventhistory_search' value='查询' id='eventhistory_search' />";p+="<input type='button' name='eventhistory_reset' value='清空' id='eventhistory_reset' />";p+="</div>";p+="<input type='hidden' name='eventhistory_list_orderby' id='eventhistory_list_orderby' />";p+="<table class='table1' align='center' width='98%' border='0' cellspacing='0' cellpadding='0' id='eventhistorylist'>";p+="</table>";p+="</div>";$("#modelcondition").empty().append(p);initNavMenu("eventhistory",i,g,d);c(f,1);$("#eventhistory_search_triggertimestart").unbind("click");$("#eventhistory_search_triggertimestart").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss"})});$("#eventhistory_search_triggertimeend").unbind("click");$("#eventhistory_search_triggertimeend").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss"})});$("#eventhistory_search").bind("click",function(){k="";h="";b.length=0;c(f,1)});$("#eventhistory_reset").bind("click",function(){$("#eventhistory_search_div [id^='eventhistory_'][type!=button]").each(function(q,r){$(r).val("")})})};var c=function(u,t){if(t==""||t==null||t==undefined){n=1}else{n=t}var s="";if(h){s+="&instanceid="+h+""}if(k){s+="&scheduleid="+k+""}var x=$("#eventhistory_search_level1").val();i=x;if(x){s+="&level1id="+x+""}var z=$("#eventhistory_search_level2").val();i=z;if(z){s+="&level2id="+z+""}var p=$("#eventhistory_search_level3").val();i=p;if(p){s+="&level3id="+p+""}var r=$("#eventhistory_search_trigtext").val();if(r){s+="&trigtext="+r+""}var v=$("#eventhistory_search_triggertimestart").val();if(v){s+="&triggertimestart="+getTimeSec(v)+""}var y=$("#eventhistory_search_triggertimeend").val();if(y){s+="&triggertimeend="+getTimeSec(y)+""}var w=$("#eventhistory_list_orderby").val();if(w){s+="&orderby="+w+""}var q=config.phpUrl+"modelinterface.php?type=geteventhistorylist&page="+n+"&pagesize="+u+""+s+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:q,beforeSend:function(){$("#eventhistorylist").html("<tr><td><img src='"+config.imagePath+"wait.gif' id='waitimg'/></td></tr>")},success:function(F){var D=[];var A="ui-icon ui-icon-carat-2-n-s";var E=$("#eventhistory_list_orderby").val();var C=E.split(" ");if(C[1]=="asc"){A="ui-icon ui-icon-triangle-1-n"}else{A="ui-icon ui-icon-triangle-1-s"}var B="<tr><th style='width:65px;'>选择</th><th style='width:100px;'>一级导航</th><th style='width:100px;'>二级导航</th><th style='width:100px;'>所属卡片</th><th style='width:70px;'>模型标题</th><th style='width:100px;'><span name='sort' _target='a.sevtext' style='display:inline-block;cursor:pointer'>事件级别<span class='"+A+"' style='display:inline-block'></span></th><th style='width:100px;'>事件名称</th><th>事件描述</th><th style='width:70px;'><span name='sort' _target='a.triggertime' style='display:inline-block;cursor:pointer'>发生时间<span class='"+A+"' style='display:inline-block'></span></th><th style='width:70px;'><span name='sort' _target='a.status' style='display:inline-block;cursor:pointer'>事件动作<span class='"+A+"' style='display:inline-block'></span></th><th style='width:65px;'>事件详情</th><th style='width:40px;'>前往</th></tr>";var G=[];if(F!=null&&F.children!=undefined&&F.children.length>0){$.each(F.children,function(L,J){var M="";if(J.showtitle==undefined){M=J.filepath;G=arrayAppend(G,J.filepath)}else{M=J.showtitle}var O=J.level3==undefined?"":J.level3;var P="";if(b.inArray(J.snapid)){P=m}else{P=e}var N="无动作";if(J.action=="mail"){N="邮件";if(parseInt(J.status,10)){N+="已发"}else{N+="未发"}}var I="";var K="";if(J.sched){var H=J.sched.taskparams.eventlist;I=H.name;K=H.remarks}B+="<tr><td><span id='delete_"+J.elementid+"-"+J.triggertime+"'>"+P+"</span></td><td>"+J.level1+"</td><td>"+J.level2+"</td><td>"+O+"</td><td><span name='eventhistory_showtitle_"+J.elementid+"'>"+M+"</span></td><td>"+J.trigtext+"</td><td><span name='eventhistory_eventname' incid='"+J.instanceid+"' triggertime='"+J.triggertime+"' >"+I+"</span></td><td><span name='eventhistory_eventremark' incid='"+J.instanceid+"' triggertime='"+J.triggertime+"'>"+K+"</span></td><td>"+formatTime("yyyy-MM-dd hh:mm",J.triggertime)+"</td><td>"+N+"</td><td><a href='javascript:void(0);' id='eventhistory_detail_"+J.elementid+"' code='"+J.instanceid+"' triggertime='"+J.triggertime+"' >事件详情</a></td><td><a id='eventhistory_goto_"+J.elementid+"' code='"+J.elementid+"' href='javascript:void(0);'>前往</a></td></tr>";D.push(J)});B+="<tr><td colspan='2'><div style='text-align:left;' id='eventhistorydeletediv'></div></td>";if(F.totalcount>u){B+="<td colspan='5'><div id='eventhistorypage' style='text-align:left;'></div></td>"}B+="</tr>";$("#eventhistorylist").attr("totalcount",F.totalcount)}else{B+="<tr><td colspan='7'>暂无记录!</td></tr>"}$("#eventhistorylist").empty().append(B);$("span[name=sort]").unbind("click");$("span[name=sort]").bind("click",function(){var J=$(this).attr("_target");var I=$(this).children("span").attr("class");var H="";$("span[name=sort][_target!="+J+"]").children("span").attr("class","ui-icon ui-icon-carat-2-n-s");if(I=="ui-icon ui-icon-carat-2-n-s"||I=="ui-icon ui-icon-triangle-1-s"){H="asc";$(this).children("span").attr("class","ui-icon ui-icon-triangle-1-n")}else{$(this).children("span").attr("class","ui-icon ui-icon-triangle-1-s");H="desc"}$("#eventhistory_list_orderby").val(J+" "+H);c(u,1)});$("#eventhistorylist a[id^=eventhistory_detail_]").bind("mouseover",function(J){var H=this;var I=$(this).attr("code");var K=$(this).attr("triggertime");$.each(D,function(N,O){if(O.instanceid=I&&O.triggertime==K){var M="";M+="一级导航:"+O.level1+"<br/>";M+="二级导航:"+O.level2+"<br/>";if(O.level3){M+="三级导航:"+O.level3+"<br/>"}if(O.content.showtitle){M+="模型标题:"+O.content.showtitle+"<br/>"}M+="预警条件:<br/>";var P=O.sched.taskparams.eventlist.alarms;if(!L){var L={};L.firstrequestData=O.snapshot;L.dataJson=O.content}$.each(P,function(Q,R){var S=parseInt(Q,10)+1;M+="&nbsp;&nbsp;&nbsp;&nbsp;条件"+S+":"+getLogicExpDes(R.trigger,L)+"<br/>"});tooltipComOverFun(M,J)}})});$("#eventhistorylist a[id^=eventhistory_detail_]").bind("mouseout",function(H){tooltipComOutFun()});$("#eventhistorylist a[id^=eventhistory_goto_]").bind("click",function(){var I=$(this).attr("code");var H;$.each(D,function(J,K){if(K.elementid==I){H=K;return false}});gotoOrishow(H)});if(G.length>0){$("body").append("<div id='temp_show' style='display:none;'></div>");$.each(G,function(H,I){$.ajax({url:I+"?"+Math.random(),dataType:"html",type:"GET",async:false,success:function(J){$("#temp_show").html(J);$("#temp_show div").each(function(K,M){if($(M).attr("instanceid")){var O=$(M).attr("elementid");var L=getShowTitleCom(M);var P=$(M).attr("title");if((L==undefined||L=="")&&(P!=undefined&&P!="")){L=P}if($("span[name=eventhistory_showtitle_"+O+"]").length>0){$("span[name=eventhistory_showtitle_"+O+"]").text(L)}var N=$(M).attr("showid");$.each(D,function(Q,R){if(R.elementid==O){R.content.showid=N;R.content.showtitle=L}})}})}})});$("#temp_show").remove()}j.deleteSubmitBtn();$("#eventhistorylist").find("input[name=deleteitem]").die("click");$("#eventhistorylist").find("input[name=deleteitem]").live("click",function(){var I=$(this).parent("span").attr("id");var H=I.split("_");var J=H[1];b=arrayAppend(b,J);$("#"+I+"").empty().append(m);j.deleteSubmitBtn()});$("#eventhistorylist").find("input[name=deleteitemselected]").die("click");$("#eventhistorylist").find("input[name=deleteitemselected]").live("click",function(){var I=$(this).parent("span").attr("id");var H=I.split("_");var J=H[1];b=arrayDelete(b,J);$("#"+I+"").empty().append(e);j.deleteSubmitBtn()});$("#confirmdelete").die("click");$("#confirmdelete").live("click",function(){if(confirm("确定删除"+b.length+"条数据?")){var I=b.join(",");var H=config.phpUrl+"modelinterface.php?type=deleteeventhistoryhistory&deletestr="+I+"";$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:H,async:false,beforeSend:function(){},success:function(J){if(parseInt(J.result,10)){b.length=0;c(u,1)}else{alert("删除失败!");return false}},complete:function(){},error:function(){}})}else{return false}});$("#selectedcount").die("click");$("#selectedcount").live("click",function(){var H="<div id='selectdiv'><input type='button' name='selectall' id='selectall' value='全选' style='margin:0;' /><input type='button' name='selectnone' id='selectnone' value='清空' style='margin:0;'/></div>";if($("#selectdiv").length==0){$("body").append(H)}var I=$("#selectedcount").attr("currstate");if(I=="folded"){j.setSelectedCountPosition()}else{j.hideSelectedCount()}$("#selectdiv").bind("mouseleave",function(){j.hideSelectedCount()});$("#selectall").unbind("click");$("#selectall").bind("click",function(){$("#eventhistorylist").find("input[name=deleteitem]").each(function(L,N){var K=$(N).parent("span").attr("id");var J=K.split("_");var M=J[1];b=arrayAppend(b,M);$(N).parent().empty().append(m)});j.deleteSubmitBtn();j.setSelectedCountPosition()});$("#selectnone").unbind("click");$("#selectnone").bind("click",function(){$("#eventhistorylist").find("input[name=deleteitemselected]").each(function(L,N){var K=$(N).parent("span").attr("id");var J=K.split("_");var M=J[1];$(N).parent().empty().append(e)});b.length=0;j.deleteSubmitBtn();$("#selectdiv").remove()})});if(F!=null&&F.totalcount!=undefined&&F.totalcount>u){pageDisplay(F.totalcount,c,"eventhistorypage",u,n)}else{$("#eventhistorypage").empty()}},complete:function(){$("#waitimg").css({display:"none"})},error:function(){}})};o()}function mySortSelect(b,l,j,k,c,p,h,o){var n=b;var e;var g=function(){if(k==undefined){k=""}$("#choicebox").remove();var r="";$.each(n,function(u,v){r+="<fieldset>";r+="<legend>"+v.categoryname+"列表</legend>";r+="<div id='groupsort_"+v.categoryvalue+"'></div>";r+="</fieldset>"});if(h){r+="<fieldset>";r+="<legend>已选择的字段</legend>";r+="<div id='fieldstosort'>";r+="<div id='fieldsorderby'></div>";r+="<div id='fieldsorderbytype'>";r+="<input type='radio' name='fields_ordertype' value='desc' id='fields_ordertype_desc' class='outborder' checked='checked'/><label for='fields_ordertype_desc'>降序</label><input type='radio' name='fields_ordertype' value='asc' id='fields_ordertype_asc' class='outborder'/><label for='fields_ordertype_asc'>升序</label>";r+="<span><input type='button' id='fields_sort_add' value='添加排序' /></span>";r+="</div>";r+="</div>";r+="</fieldset>"}r+="<fieldset>";r+="<legend>"+k+"</legend>";r+="<div id='selectedsorts'></div>";r+="</fieldset>";r+="<div class='search'><input id='sortsubmit' name='sortsubmit' type='button' value='确定' />   <input id='canclesubmit' name='canclesubmit' type='button' value='取消' /></div>";var q='<div id="choicebox" title="'+k+'列表" style="position:absolute;display:none;z-index:9999;background-color:white;border:1px solid blue;font-size: 12px; width:490px;"></div>';if(p!=undefined){$("body").append(q);$("#choicebox").append(r)}else{$("<div id='choicebox' title='"+k+"列表'></div>").insertAfter("body");$("#choicebox").append(r);$("#choicebox").dialog({autoOpen:false,modal:true,width:850,close:function(){$("#commonstadiv").css("display","none")}})}i();a(n);if(p!=undefined){var t,s;t=$(p).offset().left+130;if(t>($(document.body).width()-$("#choicebox").width())){t=$(document.body).width()-$("#choicebox").width()-10}s=$(p).offset().top;$("#choicebox").slideDown("slow").css({display:"block",left:t+"px",top:s+"px"})}else{$("#choicebox").dialog("open")}$("#fields_sort_add").bind("click",function(B,C){var y=$("input[name=fields_orderby]:checked").length;if(y==0){alert("请选择排序字段!");return false}var z=$("input[name=fields_ordertype]:checked").length;if(z==0){alert("请选择排序类型!");return false}var D=$("input[name=fields_orderby]:checked").val();var v=$("input[name=fields_orderby]:checked").attr("calctype");var A="";if(v!=undefined){A='calctype="'+v+'"'}else{v=""}var x=$("label[for=fields_orderby_"+D+""+v+"]").text();var E=$("input[name=fields_ordertype]:checked").val();var u=$("label[for=fields_ordertype_"+E+"]").text();var w="<span class='selwordsbox' ><span class='sortitem' code='"+D+"' "+A+" ordertype='"+E+"'>"+x+"("+u+")</span><a name='cancleorderby' class='cancleitem'>×</a></span>";$("#selectedsorts").append(w)});$("#sortsubmit").unbind("click");$("#sortsubmit").bind("click",function(){var u=[];u=getSelectedVal();if(u.length>0){l(u)}else{alert("请添加"+k+"!");return false}$("#commonstadiv").css("display","none");if(p!=undefined){$("#choicebox").slideUp("slow")}else{$("#choicebox").dialog("close")}});$("#canclesubmit").bind("click",function(){$("#commonstadiv").css("display","none");$("#selectedsorts").empty();if(p!=undefined){$("#choicebox").slideUp("slow")}else{$("#choicebox").dialog("close")}})};this.cancleItem=function(u){$(u).parent().remove();var s=$(u).attr("code");var t=$(u).attr("calctype");var r;if(t!=undefined&&t!="field"){r="facet";$("#selectedsorts span[code="+s+"][calctype="+t+"]").parent().remove();if(h){if($("#fieldsorderby input[name=fields_orderby][value="+s+"]").length==0){$("#groupsort_"+r+" a[code='"+s+"'][sorttype='"+r+"']").removeClass().addClass("notselected")}}else{var q=$("#selectedsorts span[code="+s+"][calctype]").length;if(q==0){$("#groupsort_"+r+" a[code='"+s+"'][sorttype='"+r+"']").removeClass().addClass("notselected")}}}else{r="output";$("#selectedsorts span[code="+s+"]").each(function(){var v=$(this).attr("calctype");if(v==undefined||v=="field"){$(this).parent().remove()}});$("#groupsort_"+r+" a[code='"+s+"'][sorttype='"+r+"']").removeClass().addClass("notselected")}};this.getSelectedVal=function(){var q=[];$("#selectedsorts .sortitem").each(function(t,r){var s={};s.code=$(this).attr("code");s.name=$(this).text();if($(this).attr("calctype")!=undefined){s.calctype=$(this).attr("calctype")}if($(this).attr("ordertype")!=undefined){s.ordertype=$(this).attr("ordertype")}q.push(s)});return q};this.sendItem=function(u,t){var v=$(u).attr("name");var q=$(u).attr("code");var r=$(u).attr("sorttype");if(r=="facet"){myCommonStatistics("",u,function(y){if(y){var x=y.code.length;if(x>0){for(var w=0;w<x;w++){var z=v+y.name[w];m(u,z,q,y.code[w])}}}$("#commonstadiv").css({display:"none"})},2)}else{var s=v;m(u,s,q)}};var m=function(t,r,s,q){if(h){f(t,r,s,q)}else{d(t,r,s,q)}};var f=function(v,t,u,s){$(v).removeClass().addClass("selected");var q=true;$("#fieldsorderby input[name=fields_orderby]").each(function(x,w){if(s!=undefined){var z=$(w).val();var y=$(w).attr("calctype");if(u==z&&s==y){$(w).parent().remove();$("#selectedsorts span[code="+u+"][calctype="+s+"]").parent().remove();if($("#fieldsorderby input[name=fields_orderby][value="+u+"]").length==0){$(v).removeClass().addClass("notselected")}q=false}}else{var z=$(w).val();var y=$(w).attr("calctype");if(u==z&&(y==undefined||y=="field")){$(w).parent().remove();$("#selectedsorts span[code="+u+"]").each(function(){var A=$(this).attr("calctype");if(A==undefined||A=="field"){$(this).parent().remove()}});$(v).removeClass().addClass("notselected");q=false}}});if(q){var r=createUtilSelectSpanHtml("sltitem",t,u,"cancleItem",s);$("#fieldsorderby").append(r)}};var d=function(w,u,v,t){$(w).removeClass().addClass("selected");if(window.currInstance.instanceType==2&&!o){var r=$("#selectedsorts .sortitem").length;if(r>0){alert("联动模型只能选择一个字段");$(w).removeClass().addClass("notselected");return false}}var q=true;$("#selectedsorts .sortitem").each(function(z,y){if(t!=undefined){var B=$(y).attr("code");var A=$(y).attr("calctype");if(v==B&&t==A){$(y).parent().remove();$("#selectedsorts span[code="+v+"][calctype="+t+"]").parent().remove();q=false;var x=$("#selectedsorts span[code="+v+"][calctype]").length;if(x==0){$(w).removeClass().addClass("notselected")}}}else{var B=$(y).attr("code");var A=$(y).attr("calctype");if(v==B&&(A==undefined||A=="field")){$(y).parent().remove();$("#selectedsorts span[code="+v+"]").each(function(){var C=$(this).attr("calctype");if(C==undefined||C=="field"){$(this).parent().remove()}});$(w).removeClass().addClass("notselected");q=false}}});if(q){var s=createUtilSpanHtml("sortitem",u,v,undefined,undefined,"cancleItem",undefined,undefined,undefined,t);$("#selectedsorts").append(s)}};var i=function(){$.each(j,function(w,u){var t=u.name;var z=u.code;var q=u.calctype;if(h){var x="";if(q!=undefined){x='calctype="'+q+'"'}var y="";if(u.ordertype!=undefined){y="ordertype='"+u.ordertype+"'"}var s="<span class='selwordsbox' ><span class='sortitem' code='"+z+"' "+x+" "+y+" >"+t+"</span><a name='cancleorderby' class='cancleitem' >×</a></span>";$("#selectedsorts").append(s);var A=new RegExp("\\(降序\\)|\\(升序\\)","ig");var v=t.replace(A,"");var r=createUtilSelectSpanHtml("sltitem",v,z,"cancleItem",u.calctype);$("#fieldsorderby").append(r)}else{var r=createUtilSpanHtml("sortitem",t,z,undefined,undefined,"cancleItem",undefined,undefined,undefined,q);$("#selectedsorts").append(r)}})};var a=function(q){$.each(q,function(r,t){var s="";$.each(t.datalist,function(w,u){var v="class='notselected'";if(j!=undefined&&j.length>0){$.each(j,function(A,z){if(z.code==u.code){if(z.calctype!=undefined&&z.calctype!="field"){if(t.categoryvalue=="facet"){v="class='selected'";return false}}else{if(t.categoryvalue=="output"){v="class='selected'";return false}}}})}var y=u.name;var x="";if(getStringPx(y,12)>120){x="style='overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block;' title='"+y+"' "}s+="<a "+v+" onclick='sendItem(this, event)' sorttype="+t.categoryvalue+" code="+u.code+" "+x+" name="+u.name+">"+y+"</a>"});$("#groupsort_"+t.categoryvalue+"").empty().append(s)})};g()}function myCommonStatistics(d,b,a,c){var e=this;this.target=d;this.ele=b;this.commonstaChk=function(){var g="";if(e.target){g+='<div id="commonstadiv"  style="font-size: 12px;" class="search">'}else{g+='<div id="commonstadiv" style="position:absolute;display:none;z-index:9999;background-color:white;border:1px solid blue;font-size: 12px; width:264px;">'}g+='<span id="commonstaspan">';var f=[];if(c==2){f=["count","sum","average","max","min"]}else{if(c==3){f=["self","count","sum","average","max","min"]}}$.each(f,function(j,k){g+='<input type="checkbox" name="commonsta" id="commonsta_'+k+'" value="'+k+'" class="outborder" /><label for="commonsta_'+k+'">'+calcval2text(k)+"</label>"});if(!e.target){g+='<br/><a id="itemsubmit" style="cursor:pointer;">确定</a>'}g+="</span></div>";if($("#commonstadiv").length==0){if(!e.target){$("body").append(g)}else{$(e.target).before(g)}}if(!e.target){var i,h;i=$(e.ele).offset().left+30;h=$(e.ele).offset().top-$("#commonstadiv").height();$("#commonstadiv").css({top:h+"px",left:i+"px",display:"block"})}$("#commonstaspan input[name=commonsta]").attr("checked",false);$("#itemsubmit").unbind("click");$("#itemsubmit").bind("click",function(){var j=e.commonstaResult();if(j!=false){a(j)}})};this.commonstaResult=function(){var i={};var f=[];var g=[];var h=$("#commonstaspan input[name=commonsta]:checked").length;if(h==0){alert("请选择统计类型!");return false}$("#commonstaspan input[name=commonsta]:checked").each(function(){var k=$(this).attr("id");var j=$("#commonstadiv label[for="+k+"]").text();f.push("("+j+")");var l=$(this).val();g.push(l)});if(g.length>0){i.name=f;i.code=g}return i};this.commonstaClose=function(){$("#commonstadiv").css("display","none")};e.commonstaChk()};